/*M!999999\- enable the sandbox mode */ 
-- MariaDB dump 10.19  Distrib 10.5.29-MariaDB, for Linux (x86_64)
--
-- Host: 198.128.11.2    Database: cintolo
-- ------------------------------------------------------
-- Server version	10.6.22-MariaDB-0ubuntu0.22.04.1

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `ETL_PARAMETROS_EXTRACCION`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ETL_PARAMETROS_EXTRACCION` (
  `C_TABLE_SCHEMA` varchar(200) DEFAULT NULL,
  `C_TABLE_OWNER` varchar(200) DEFAULT NULL,
  `C_TABLE_NAME` varchar(200) DEFAULT NULL,
  `F_ULTIMO_PROCESO` datetime DEFAULT NULL,
  `N_CANTIDAD_EXTRAIDA` int(11) DEFAULT NULL,
  `C_FINALIZACION` varchar(10) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `agrupaciones_calidades`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `agrupaciones_calidades` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `descripcion` varchar(40) NOT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_usuario_alta_13` (`alta_usuario_id`),
  KEY `fk_usuario_baja_13` (`baja_usuario_id`),
  KEY `fk_usuario_mod_13` (`modificacion_usuario_id`),
  CONSTRAINT `fk_usuario_alta_13` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_13` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_13` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `agrupaciones_calidades_parametros_alargamiento`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `agrupaciones_calidades_parametros_alargamiento` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `agrupacion_calidad_id` int(11) NOT NULL,
  `alargamiento_b_tipo_min` decimal(8,4) DEFAULT NULL,
  `alargamiento_b_tipo_max` decimal(8,4) DEFAULT NULL,
  `alargamiento_b_origen_min` decimal(8,4) DEFAULT NULL,
  `alargamiento_b_origen_max` decimal(8,4) DEFAULT NULL,
  `alargamiento_b_alargamiento_min` decimal(5,2) DEFAULT NULL,
  `alargamiento_b_alargamiento_max` decimal(5,2) DEFAULT NULL,
  `alargamiento_b_dim1_min` decimal(8,4) DEFAULT NULL,
  `alargamiento_b_dim1_max` decimal(8,4) DEFAULT NULL,
  `alargamiento_b_dim2_min` decimal(8,4) DEFAULT NULL,
  `alargamiento_b_dim2_max` decimal(8,4) DEFAULT NULL,
  `alargamiento_b_probeta_min` decimal(8,4) DEFAULT NULL,
  `alargamiento_b_probeta_max` decimal(8,4) DEFAULT NULL,
  `alargamiento_b_sec_mbase_min` decimal(8,4) DEFAULT NULL,
  `alargamiento_b_sec_mbase_max` decimal(8,4) DEFAULT NULL,
  `alargamiento_s_tipo_cr_min` decimal(8,4) DEFAULT NULL,
  `alargamiento_s_tipo_cr_max` decimal(8,4) DEFAULT NULL,
  `alargamiento_s_origenlt_min` decimal(8,4) DEFAULT NULL,
  `alargamiento_s_origenlt_max` decimal(8,4) DEFAULT NULL,
  `alargamiento_s_alargamiento_min` decimal(5,2) DEFAULT NULL,
  `alargamiento_s_alargamiento_max` decimal(5,2) DEFAULT NULL,
  `alargamiento_s_dim1_min` decimal(8,4) DEFAULT NULL,
  `alargamiento_s_dim1_max` decimal(8,4) DEFAULT NULL,
  `alargamiento_s_dim2_min` decimal(8,4) DEFAULT NULL,
  `alargamiento_s_dim2_max` decimal(8,4) DEFAULT NULL,
  `alargamiento_s_probeta_min` decimal(8,4) DEFAULT NULL,
  `alargamiento_s_probeta_max` decimal(8,4) DEFAULT NULL,
  `alargamiento_s_seccion_min` decimal(8,4) DEFAULT NULL,
  `alargamiento_s_seccion_max` decimal(8,4) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_param_alarg` (`agrupacion_calidad_id`),
  CONSTRAINT `fk_param_alarg` FOREIGN KEY (`agrupacion_calidad_id`) REFERENCES `agrupaciones_calidades` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=60 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `agrupaciones_calidades_parametros_impacto`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `agrupaciones_calidades_parametros_impacto` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `agrupacion_calidad_id` int(11) NOT NULL,
  `impacto_b_1_min` decimal(8,4) DEFAULT NULL,
  `impacto_b_1_max` decimal(8,4) DEFAULT NULL,
  `impacto_b_2_min` decimal(8,4) DEFAULT NULL,
  `impacto_b_2_max` decimal(8,4) DEFAULT NULL,
  `impacto_b_3_min` decimal(8,4) DEFAULT NULL,
  `impacto_b_3_max` decimal(8,4) DEFAULT NULL,
  `impacto_a_1_min` decimal(8,4) DEFAULT NULL,
  `impacto_a_1_max` decimal(8,4) DEFAULT NULL,
  `impacto_a_2_min` decimal(8,4) DEFAULT NULL,
  `impacto_a_2_max` decimal(8,4) DEFAULT NULL,
  `impacto_a_3_min` decimal(8,4) DEFAULT NULL,
  `impacto_a_3_max` decimal(8,4) DEFAULT NULL,
  `impacto_c_1_min` decimal(8,4) DEFAULT NULL,
  `impacto_c_1_max` decimal(8,4) DEFAULT NULL,
  `impacto_c_2_min` decimal(8,4) DEFAULT NULL,
  `impacto_c_2_max` decimal(8,4) DEFAULT NULL,
  `impacto_c_3_min` decimal(8,4) DEFAULT NULL,
  `impacto_c_3_max` decimal(8,4) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_param_impacto` (`agrupacion_calidad_id`),
  CONSTRAINT `fk_param_impacto` FOREIGN KEY (`agrupacion_calidad_id`) REFERENCES `agrupaciones_calidades` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=60 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `agrupaciones_calidades_parametros_quimicos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `agrupaciones_calidades_parametros_quimicos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `agrupacion_calidad_id` int(11) NOT NULL,
  `aluminio_max` decimal(8,4) DEFAULT NULL,
  `aluminio_min` decimal(8,4) DEFAULT NULL,
  `azufre_max` decimal(8,4) DEFAULT NULL,
  `azufre_min` decimal(8,4) DEFAULT NULL,
  `boro_max` decimal(8,4) DEFAULT NULL,
  `boro_min` decimal(8,4) DEFAULT NULL,
  `carbono_equivalente_max` decimal(12,4) DEFAULT NULL,
  `carbono_equivalente_min` decimal(12,4) DEFAULT NULL,
  `carbono_max` decimal(8,4) DEFAULT NULL,
  `carbono_min` decimal(8,4) DEFAULT NULL,
  `cobre_max` decimal(8,4) DEFAULT NULL,
  `cobre_min` decimal(8,4) DEFAULT NULL,
  `cromo_max` decimal(8,4) DEFAULT NULL,
  `cromo_min` decimal(8,4) DEFAULT NULL,
  `fosforo_max` decimal(8,4) DEFAULT NULL,
  `fosforo_min` decimal(8,4) DEFAULT NULL,
  `manganeso_max` decimal(8,4) DEFAULT NULL,
  `manganeso_min` decimal(8,4) DEFAULT NULL,
  `molibdeno_max` decimal(8,4) DEFAULT NULL,
  `molibdeno_min` decimal(8,4) DEFAULT NULL,
  `niobio_max` decimal(8,4) DEFAULT NULL,
  `niobio_min` decimal(8,4) DEFAULT NULL,
  `niquel_max` decimal(8,4) DEFAULT NULL,
  `niquel_min` decimal(8,4) DEFAULT NULL,
  `nitrogeno_max` decimal(8,4) DEFAULT NULL,
  `nitrogeno_min` decimal(8,4) DEFAULT NULL,
  `pcm_max` decimal(12,4) DEFAULT NULL,
  `pcm_min` decimal(12,4) DEFAULT NULL,
  `silicio_max` decimal(8,4) DEFAULT NULL,
  `silicio_min` decimal(8,4) DEFAULT NULL,
  `titanio_max` decimal(8,4) DEFAULT NULL,
  `titanio_min` decimal(8,4) DEFAULT NULL,
  `vanadio_max` decimal(8,4) DEFAULT NULL,
  `vanadio_min` decimal(8,4) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_param_quim` (`agrupacion_calidad_id`),
  CONSTRAINT `fk_param_quim` FOREIGN KEY (`agrupacion_calidad_id`) REFERENCES `agrupaciones_calidades` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=60 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `agrupaciones_calidades_parametros_traccion`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `agrupaciones_calidades_parametros_traccion` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `agrupacion_calidad_id` int(11) NOT NULL,
  `traccion_b_fluencia_min` decimal(8,4) DEFAULT NULL,
  `traccion_b_fluencia_max` decimal(8,4) DEFAULT NULL,
  `traccion_b_rotura_min` decimal(8,4) DEFAULT NULL,
  `traccion_b_rotura_max` decimal(8,4) DEFAULT NULL,
  `traccion_b_alargamiento_min` decimal(8,4) DEFAULT NULL,
  `traccion_b_alargamiento_max` decimal(8,4) DEFAULT NULL,
  `traccion_b_dureza_min` decimal(8,4) DEFAULT NULL,
  `traccion_b_dureza_max` decimal(8,4) DEFAULT NULL,
  `traccion_a_fluencia_min` decimal(8,4) DEFAULT NULL,
  `traccion_a_fluencia_max` decimal(8,4) DEFAULT NULL,
  `traccion_a_rotura_min` decimal(8,4) DEFAULT NULL,
  `traccion_a_rotura_max` decimal(8,4) DEFAULT NULL,
  `traccion_a_alargamiento_min` decimal(8,4) DEFAULT NULL,
  `traccion_a_alargamiento_max` decimal(8,4) DEFAULT NULL,
  `traccion_a_pleg_cara_min` decimal(8,4) DEFAULT NULL,
  `traccion_a_pleg_cara_max` decimal(8,4) DEFAULT NULL,
  `traccion_a_pleg_lat_min` decimal(8,4) DEFAULT NULL,
  `traccion_a_pleg_lat_max` decimal(8,4) DEFAULT NULL,
  `traccion_a_pleg_raiz_min` decimal(8,4) DEFAULT NULL,
  `traccion_a_pleg_raiz_max` decimal(8,4) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_param_traccion` (`agrupacion_calidad_id`),
  CONSTRAINT `fk_param_traccion` FOREIGN KEY (`agrupacion_calidad_id`) REFERENCES `agrupaciones_calidades` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=60 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `articulos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `articulos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) DEFAULT NULL,
  `unidad_de_medida_id` int(11) NOT NULL,
  `unidad_de_medida_compras_id` int(11) NOT NULL,
  `proveedor_habitual` varchar(60) DEFAULT NULL,
  `tipo_id` int(11) NOT NULL,
  `descripcion` varchar(50) NOT NULL,
  `cod` varchar(27) DEFAULT NULL,
  `diametro` decimal(10,3) DEFAULT NULL,
  `largo` decimal(10,3) DEFAULT NULL,
  `espesor` decimal(10,3) DEFAULT NULL,
  `calidad_id` int(11) DEFAULT NULL,
  `stock_minimo` int(11) DEFAULT NULL,
  `stock_critico` int(11) DEFAULT NULL,
  `factor_conversion` decimal(10,3) DEFAULT NULL,
  `deposito_id` int(11) NOT NULL,
  `ajuste` char(1) DEFAULT NULL,
  `codigo_ajuste` int(11) DEFAULT NULL,
  `rubro_material` varchar(3) DEFAULT NULL,
  `rubro_provee` varchar(3) DEFAULT NULL,
  `proveedor_habitual_auxiliar` char(6) DEFAULT NULL,
  `proveedor_alt1` char(6) DEFAULT NULL,
  `proveedor_alt2` char(6) DEFAULT NULL,
  `proveedor_alt3` char(6) DEFAULT NULL,
  `proveedor_calif` char(1) DEFAULT NULL,
  `requiere_inspeccion` char(1) DEFAULT NULL,
  `imputacion_contable` char(20) DEFAULT NULL,
  `codigo_stkgto` char(1) DEFAULT NULL,
  `codigo_impositivo` char(1) DEFAULT NULL,
  `deposito_default` int(11) DEFAULT NULL,
  `estanteria` char(3) DEFAULT NULL,
  `fila` char(3) DEFAULT NULL,
  `columna` char(3) DEFAULT NULL,
  `lote_compra` int(11) DEFAULT NULL,
  `item` int(11) DEFAULT NULL,
  `especificacion` varchar(50) DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`),
  UNIQUE KEY `UK1` (`tipo_id`,`diametro`,`largo`,`espesor`,`calidad_id`),
  UNIQUE KEY `un_articulo` (`tipo_id`,`diametro`,`largo`,`espesor`,`calidad_id`),
  KEY `fk_usuario_alta_2` (`alta_usuario_id`),
  KEY `fk_usuario_baja_2` (`baja_usuario_id`),
  KEY `fk_usuario_mod_2` (`modificacion_usuario_id`),
  KEY `fk_medida` (`unidad_de_medida_id`),
  KEY `fk_medida_c` (`unidad_de_medida_compras_id`),
  KEY `fk_tipo` (`tipo_id`),
  KEY `fk_calidad` (`calidad_id`),
  KEY `fk_deposito` (`deposito_id`),
  CONSTRAINT `fk_calidad` FOREIGN KEY (`calidad_id`) REFERENCES `articulos_calidades` (`id`),
  CONSTRAINT `fk_deposito` FOREIGN KEY (`deposito_id`) REFERENCES `depositos` (`id`),
  CONSTRAINT `fk_medida` FOREIGN KEY (`unidad_de_medida_id`) REFERENCES `unidades_de_medida` (`id`),
  CONSTRAINT `fk_medida_c` FOREIGN KEY (`unidad_de_medida_compras_id`) REFERENCES `unidades_de_medida` (`id`),
  CONSTRAINT `fk_tipo` FOREIGN KEY (`tipo_id`) REFERENCES `articulos_tipos` (`id`),
  CONSTRAINT `fk_usuario_alta_2` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_2` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_2` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=30651 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `articulos_calidad`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `articulos_calidad` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `descripcion` varchar(40) NOT NULL,
  `codigo` varchar(9) NOT NULL,
  `campo_libre` varchar(40) DEFAULT NULL,
  `campo_libre2` varchar(40) DEFAULT NULL,
  `agrupa` int(11) DEFAULT NULL,
  `revision_año` year(4) DEFAULT NULL,
  `adenda_año` year(4) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `descripcion` (`descripcion`),
  UNIQUE KEY `codigo` (`codigo`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `articulos_calidades`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `articulos_calidades` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `descripcion` varchar(40) NOT NULL,
  `campo_libre` varchar(16) DEFAULT NULL,
  `alta_usuario_id` int(11) DEFAULT NULL,
  `alta_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_usuario_alta_16` (`alta_usuario_id`),
  KEY `fk_usuario_mod_16` (`modificacion_usuario_id`),
  KEY `fk_usuario_baja_16` (`baja_usuario_id`),
  CONSTRAINT `fk_usuario_alta_16` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_16` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_16` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=101 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `articulos_espesores`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `articulos_espesores` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `descripcion` varchar(40) NOT NULL,
  `codigo` varchar(9) NOT NULL,
  `campo_libre` varchar(40) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1323 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `articulos_familias`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `articulos_familias` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `descripcion` varchar(40) NOT NULL,
  `medida2` int(11) DEFAULT NULL,
  `norma` int(11) DEFAULT NULL,
  `calidad` int(11) DEFAULT NULL,
  `numero1` int(11) DEFAULT NULL,
  `numero2` int(11) DEFAULT NULL,
  `nomenclador` int(11) DEFAULT NULL,
  `orden` int(11) DEFAULT NULL,
  `cod_as400` varchar(5) DEFAULT NULL,
  `descripcion_ingles` varchar(40) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `descripcion` (`descripcion`)
) ENGINE=InnoDB AUTO_INCREMENT=61 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `articulos_normas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `articulos_normas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `descripcion` varchar(40) NOT NULL,
  `observaciones` varchar(100) DEFAULT NULL,
  `codigo` varchar(9) NOT NULL,
  `campo_libre` varchar(40) DEFAULT NULL,
  `campo_libre2` varchar(40) DEFAULT NULL,
  `revision_año` year(4) DEFAULT NULL,
  `adenda_año` year(4) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `descripcion` (`descripcion`),
  UNIQUE KEY `codigo` (`codigo`)
) ENGINE=InnoDB AUTO_INCREMENT=33 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `articulos_rubros`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `articulos_rubros` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `descripcion` varchar(40) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `descripcion` (`descripcion`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `articulos_tipos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `articulos_tipos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) NOT NULL,
  `descripcion` varchar(40) NOT NULL,
  `requiere_inspeccion` tinyint(1) NOT NULL,
  `requiere_colada` tinyint(1) NOT NULL,
  `requiere_dimensional` tinyint(1) NOT NULL,
  `requiere_cert_usina` tinyint(1) NOT NULL,
  `requiere_remito` tinyint(1) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`),
  UNIQUE KEY `descripcion` (`descripcion`)
) ENGINE=InnoDB AUTO_INCREMENT=100 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `articulos_unidades_de_medida`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `articulos_unidades_de_medida` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) NOT NULL,
  `tipo_id` int(11) NOT NULL,
  `descripcion` varchar(40) DEFAULT NULL,
  `abrev` varchar(10) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`),
  UNIQUE KEY `descripcion` (`descripcion`),
  UNIQUE KEY `abrev` (`abrev`),
  KEY `fk_tipo_medida` (`tipo_id`),
  CONSTRAINT `fk_tipo_medida` FOREIGN KEY (`tipo_id`) REFERENCES `articulos_unidades_de_medida_tipos` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=20 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `articulos_unidades_de_medida_tipos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `articulos_unidades_de_medida_tipos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `descripcion` varchar(40) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `descripcion` (`descripcion`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `as400_fichas_tecnicas_estados`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `as400_fichas_tecnicas_estados` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `ficha_tecnica_id` int(11) NOT NULL,
  `codigo_baja` char(1) NOT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `fk_usuario_alta_38` (`alta_usuario_id`),
  KEY `fk_ft_historial` (`ficha_tecnica_id`),
  CONSTRAINT `fk_ft_historial` FOREIGN KEY (`ficha_tecnica_id`) REFERENCES `fichas_tecnicas` (`id`),
  CONSTRAINT `fk_usuario_alta_38` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=50371 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `asientos_contables`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `asientos_contables` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) DEFAULT NULL,
  `periodo_fiscal_id` int(11) DEFAULT NULL,
  `centro_de_costo_id` int(11) NOT NULL,
  `descripcion` varchar(60) NOT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`),
  KEY `fk_usuario_alta_10` (`alta_usuario_id`),
  KEY `fk_periodo` (`periodo_fiscal_id`),
  KEY `fk_cc_asientos` (`centro_de_costo_id`),
  CONSTRAINT `fk_cc_asientos` FOREIGN KEY (`centro_de_costo_id`) REFERENCES `centros_de_costo` (`id`),
  CONSTRAINT `fk_periodo` FOREIGN KEY (`periodo_fiscal_id`) REFERENCES `periodos_fiscales` (`id`),
  CONSTRAINT `fk_usuario_alta_10` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `asientos_contables_lineas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `asientos_contables_lineas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) DEFAULT NULL,
  `combinacion_valida_id_erp` int(11) DEFAULT NULL,
  `asiento_contable_id` int(11) NOT NULL,
  `cuenta_contable_id` int(11) NOT NULL,
  `es_debe` tinyint(1) NOT NULL,
  `importe` decimal(15,2) DEFAULT NULL,
  `descripcion` varchar(100) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`),
  UNIQUE KEY `combinacion_valida_id_erp` (`combinacion_valida_id_erp`),
  KEY `fk_asiento` (`asiento_contable_id`),
  KEY `fk_cuenta` (`cuenta_contable_id`),
  CONSTRAINT `fk_asiento` FOREIGN KEY (`asiento_contable_id`) REFERENCES `asientos_contables` (`id`),
  CONSTRAINT `fk_cuenta` FOREIGN KEY (`cuenta_contable_id`) REFERENCES `cuentas_contables` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `aux_calculo_limite`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `aux_calculo_limite` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `calidad_id` int(11) DEFAULT 0,
  `parametro_aux` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=17 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `aux_calculo_limite_largo`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `aux_calculo_limite_largo` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `ancho` int(11) DEFAULT 0,
  `espesor` int(11) DEFAULT 0,
  `familia` varchar(50) DEFAULT NULL,
  `limite_largo` double DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=22 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `aux_log`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `aux_log` (
  `descripcion` varchar(50) DEFAULT NULL,
  `valor` varchar(50) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `aux_lote_economico`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `aux_lote_economico` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `cantidad` int(11) NOT NULL DEFAULT 0,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=78787 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `aux_op_estudios`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `aux_op_estudios` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `orden_de_produccion_id` int(11) NOT NULL,
  `laboratorio_oc` int(11) DEFAULT NULL,
  `es_la_version_vigente` tinyint(1) DEFAULT 1,
  `laboratorio` varchar(100) DEFAULT NULL,
  `fecha_envio_laboratorio` date DEFAULT NULL,
  `fecha_regreso_laboratorio` date DEFAULT NULL,
  `notas` varchar(300) DEFAULT NULL,
  `aprobacion_calidad_usuario_id` int(11) DEFAULT NULL,
  `aprobacion_calidad_fecha_hora` point DEFAULT NULL,
  `alta_usuario_id` int(11) DEFAULT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `perfil_de_barrada` varchar(4) NOT NULL,
  `probeta_tamano` varchar(50) DEFAULT NULL,
  `direccion` char(12) DEFAULT NULL,
  `probeta_cantidad` int(11) DEFAULT NULL,
  `biselado` tinyint(1) DEFAULT NULL,
  `soldadura` tinyint(4) DEFAULT NULL,
  `tratamiento_termico_1` varchar(100) DEFAULT NULL,
  `temperatura_1` varchar(15) DEFAULT NULL,
  `tratamiento_termico_2` varchar(50) DEFAULT NULL,
  `temperatura_2` varchar(15) DEFAULT NULL,
  `mb_quimico` tinyint(1) DEFAULT NULL,
  `mb_traccion` tinyint(1) DEFAULT NULL,
  `mb_charpy` tinyint(1) DEFAULT NULL,
  `mb_dureza` tinyint(1) DEFAULT NULL,
  `mb_plegado` tinyint(1) DEFAULT NULL,
  `ma_quimico` tinyint(1) DEFAULT NULL,
  `ma_traccion` tinyint(1) DEFAULT NULL,
  `ma_charpy` tinyint(1) DEFAULT NULL,
  `ma_dureza` tinyint(1) DEFAULT NULL,
  `ma_plegado` tinyint(1) DEFAULT NULL,
  `zac_quimico` tinyint(1) DEFAULT NULL,
  `zac_traccion` tinyint(1) DEFAULT NULL,
  `zac_charpy` tinyint(1) DEFAULT NULL,
  `zac_dureza` tinyint(1) DEFAULT NULL,
  `zac_plegado` tinyint(1) DEFAULT NULL,
  `charpy_temp` int(11) DEFAULT NULL,
  `horno1_id` int(11) DEFAULT NULL,
  `horno1_temperatura` int(11) DEFAULT NULL,
  `horno1_ingreso_fecha_hora` datetime DEFAULT NULL,
  `horno1_egreso_fecha_hora` datetime DEFAULT NULL,
  `horno1_control_legajo` int(11) DEFAULT NULL,
  `horno2_id` int(11) DEFAULT NULL,
  `horno2_temperatura` int(11) DEFAULT NULL,
  `horno2_ingreso_fecha_hora` datetime DEFAULT NULL,
  `horno2_egreso_fecha_hora` datetime DEFAULT NULL,
  `horno2_control_legajo` int(11) DEFAULT NULL,
  `colada_barrada` varchar(20) DEFAULT NULL,
  `agrupacion_calidad_id` int(11) DEFAULT NULL,
  `ensayo_fisico` int(11) DEFAULT NULL,
  `ensayo_quimico` int(11) DEFAULT NULL,
  `otros_ensayos` varchar(50) DEFAULT NULL,
  `soldadura_empresa` int(2) DEFAULT NULL,
  `soldadura_legajo` int(2) DEFAULT NULL,
  `soldadura_fecha` date DEFAULT NULL,
  `indicador_soldadura` char(1) DEFAULT NULL,
  `indicador_transformacion` char(1) DEFAULT NULL,
  `indicador_soldadura_transformacion` char(1) DEFAULT NULL,
  `corte_tilde` tinyint(1) DEFAULT NULL,
  `corte_fecha` date DEFAULT NULL,
  `soldadura_tilde` tinyint(1) DEFAULT NULL,
  `prensa_tilde` tinyint(1) DEFAULT NULL,
  `prensa_fecha` date DEFAULT NULL,
  `curvado_tilde` tinyint(1) DEFAULT NULL,
  `curvado_fecha` date DEFAULT NULL,
  `color_probetero` varchar(10) DEFAULT NULL,
  `norma_desc` varchar(100) DEFAULT NULL,
  `espesor_desc` varchar(100) DEFAULT NULL,
  `calidad_desc` varchar(100) DEFAULT NULL,
  `indicaciones_7y8` varchar(250) DEFAULT NULL,
  `indicaciones_6` varchar(100) DEFAULT NULL,
  `tipo_probetero` varchar(100) DEFAULT NULL,
  `art_desc` varchar(50) DEFAULT NULL,
  `pf_desc` varchar(50) DEFAULT NULL,
  `ubic_axial` varchar(50) DEFAULT NULL,
  `indicaciones40` varchar(100) DEFAULT NULL,
  `titulo` varchar(10) DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `fk_op_estudio` (`orden_de_produccion_id`,`alta_fecha_hora`) USING BTREE,
  KEY `fk_usuario_alta_31` (`alta_usuario_id`) USING BTREE,
  KEY `fk_aprobador_calidad_1` (`aprobacion_calidad_usuario_id`) USING BTREE,
  KEY `fk_ope_horno_1` (`horno1_id`) USING BTREE,
  KEY `fk_ope_horno_2` (`horno2_id`) USING BTREE,
  CONSTRAINT `aux_op_estudios_ibfk_1` FOREIGN KEY (`aprobacion_calidad_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `aux_op_estudios_ibfk_2` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `aux_op_estudios_ibfk_3` FOREIGN KEY (`horno1_id`) REFERENCES `maquinas_herramientas` (`id`),
  CONSTRAINT `aux_op_estudios_ibfk_4` FOREIGN KEY (`horno2_id`) REFERENCES `maquinas_herramientas` (`id`),
  CONSTRAINT `aux_op_estudios_ibfk_5` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=97072 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci ROW_FORMAT=DYNAMIC;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `aux_plantillas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `aux_plantillas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `familia` varchar(10) DEFAULT NULL,
  `medida1` decimal(10,3) DEFAULT NULL,
  `ancho` decimal(10,3) DEFAULT NULL,
  `largo` decimal(10,3) DEFAULT NULL,
  `perimetro` decimal(10,3) DEFAULT NULL,
  `medida2` decimal(10,3) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=107 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `aux_pz_hora`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `aux_pz_hora` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `proceso_id` int(11) DEFAULT 0,
  `pz_hora` decimal(10,3) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1672 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `aux_rxpieza`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `aux_rxpieza` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `accionextra` varchar(50) NOT NULL DEFAULT '0',
  `ancho` double DEFAULT NULL,
  `medida` double DEFAULT NULL,
  `cantidad` int(11) DEFAULT NULL,
  `familia` varchar(50) DEFAULT NULL,
  `etapa` varchar(50) DEFAULT NULL,
  `costuras` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `aux_tiempos_oxicorte`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `aux_tiempos_oxicorte` (
  `medida1` int(11) DEFAULT NULL,
  `carga` double DEFAULT NULL,
  `interno` double DEFAULT NULL,
  `externo1` double DEFAULT NULL,
  `externo2` double DEFAULT NULL,
  `descargar` double DEFAULT NULL,
  `medir` double DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `aux_tpm`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `aux_tpm` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `proceso_id` int(11) DEFAULT NULL,
  `maquina_id` int(11) DEFAULT NULL,
  `tiempo` double DEFAULT NULL,
  `orden` double DEFAULT NULL,
  `estado` varchar(2) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_aux_tpm_p` (`proceso_id`),
  KEY `fk_aux_tpm_maq` (`maquina_id`)
) ENGINE=InnoDB AUTO_INCREMENT=21360 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `aux_tterm`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `aux_tterm` (
  `id` int(11) NOT NULL DEFAULT 0,
  `etapa` int(11) NOT NULL,
  `subetapa` int(11) NOT NULL,
  `centro_de_costo_id` int(11) DEFAULT NULL,
  `descripcion` varchar(100) NOT NULL,
  `descrip_alt` varchar(100) NOT NULL,
  `temperatura` int(11) NOT NULL DEFAULT 0,
  `descripcion_corta` varchar(50) DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `carga_de_maquinas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `carga_de_maquinas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `maquina_id` int(11) NOT NULL,
  `secuencia_produccion` int(11) NOT NULL,
  `orden_de_produccion_id` int(11) NOT NULL,
  `proceso_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_carga` (`maquina_id`,`orden_de_produccion_id`,`proceso_id`),
  KEY `fk_carga_op` (`orden_de_produccion_id`),
  KEY `fk_carga_proc` (`proceso_id`),
  CONSTRAINT `fk_carga_maq` FOREIGN KEY (`maquina_id`) REFERENCES `maquinas_herramientas` (`id`),
  CONSTRAINT `fk_carga_op` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `fk_carga_proc` FOREIGN KEY (`proceso_id`) REFERENCES `fichas_tecnicas_procesos` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=73258 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='Tabla base donde volcar la planificación de producción del día';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `centros_de_costo`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `centros_de_costo` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) NOT NULL,
  `cc` varchar(8) NOT NULL,
  `descripcion` varchar(40) NOT NULL,
  `admite_movimiento` tinyint(1) NOT NULL,
  `esta_activo` tinyint(1) NOT NULL DEFAULT 1,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`),
  UNIQUE KEY `cc` (`cc`)
) ENGINE=InnoDB AUTO_INCREMENT=32 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `certificados_de_calidad`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `certificados_de_calidad` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `orden_de_despacho_id` int(11) NOT NULL,
  `tiene_requerimientos_adicionales` tinyint(1) NOT NULL,
  `aprobacion_usuario_id` int(11) DEFAULT NULL,
  `aprobacion_fecha_hora` datetime DEFAULT NULL,
  `archivo_nombre` varchar(60) DEFAULT NULL,
  `archivo_nombre_wd` varchar(20) DEFAULT NULL,
  `uniones_archivo_nombre` varchar(60) DEFAULT NULL,
  `uniones_archivo_nombre_wd` varchar(20) DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `fk_usuario_alta_47` (`alta_usuario_id`),
  KEY `fk_cert_despacho` (`orden_de_despacho_id`),
  KEY `fk_usuario_aprob_cert` (`aprobacion_usuario_id`),
  CONSTRAINT `fk_cert_despacho` FOREIGN KEY (`orden_de_despacho_id`) REFERENCES `ordenes_de_despacho` (`id`),
  CONSTRAINT `fk_usuario_alta_47` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_aprob_cert` FOREIGN KEY (`aprobacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `coladas_adicional`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `coladas_adicional` (
  `producto_fabricado_id` int(11) NOT NULL,
  `pedido_numero` int(11) NOT NULL,
  `unidades_pendiente` decimal(20,6) DEFAULT NULL,
  `fecha_pedido` date NOT NULL,
  `fecha_entrega` date DEFAULT NULL,
  `cliente_codigo` int(11) NOT NULL,
  `cliente_nombre` varchar(50) NOT NULL,
  KEY `fk_colada_pf` (`producto_fabricado_id`),
  CONSTRAINT `fk_colada_pf` FOREIGN KEY (`producto_fabricado_id`) REFERENCES `productos_fabricados` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `colores`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `colores` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `descripcion` varchar(20) NOT NULL,
  `codigo` varchar(4) DEFAULT NULL,
  `clasificacion` varchar(1) NOT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `descripcion` (`descripcion`),
  UNIQUE KEY `codigo` (`codigo`),
  UNIQUE KEY `UK1` (`codigo`),
  KEY `fk_usuario_alta_48` (`alta_usuario_id`),
  KEY `fk_usuario_baja_48` (`baja_usuario_id`),
  KEY `fk_usuario_mod_48` (`modificacion_usuario_id`),
  CONSTRAINT `fk_usuario_alta_48` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_48` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_48` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=624 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `contable_articulos_tipos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `contable_articulos_tipos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `articulo_tipo_id` int(11) DEFAULT NULL,
  `cuenta_contable_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_contable_articulos_tipos_articulos_tipos` (`articulo_tipo_id`),
  KEY `fk_contable_articulos_tipos_cuentas_contables` (`cuenta_contable_id`),
  CONSTRAINT `fk_contable_articulos_tipos_articulos_tipos` FOREIGN KEY (`articulo_tipo_id`) REFERENCES `articulos_tipos` (`id`),
  CONSTRAINT `fk_contable_articulos_tipos_cuentas_contables` FOREIGN KEY (`cuenta_contable_id`) REFERENCES `cuentas_contables` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `contable_procesos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `contable_procesos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `tipo_proceso` int(11) NOT NULL,
  `cuenta_contable_id` int(11) NOT NULL,
  `descripcion` varchar(50) NOT NULL,
  `centro_de_costo_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_contable_procesos_centros_de_costo` (`centro_de_costo_id`),
  KEY `fk_contable_procesos_cuentas_contables` (`cuenta_contable_id`),
  CONSTRAINT `fk_contable_procesos_centros_de_costo` FOREIGN KEY (`centro_de_costo_id`) REFERENCES `centros_de_costo` (`id`),
  CONSTRAINT `fk_contable_procesos_cuentas_contables` FOREIGN KEY (`cuenta_contable_id`) REFERENCES `cuentas_contables` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `costos_categorizaciones`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `costos_categorizaciones` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `descripcion` varchar(80) NOT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `descripcion` (`descripcion`),
  KEY `fk_usuario_alta_45` (`alta_usuario_id`),
  CONSTRAINT `fk_usuario_alta_45` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `costos_categorizaciones_estructuras`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `costos_categorizaciones_estructuras` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `costo_categorizacion_id` int(11) NOT NULL,
  `costo_estructura_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_categorizacion` (`costo_categorizacion_id`),
  KEY `fk_estructura` (`costo_estructura_id`),
  CONSTRAINT `fk_categorizacion` FOREIGN KEY (`costo_categorizacion_id`) REFERENCES `costos_categorizaciones` (`id`),
  CONSTRAINT `fk_estructura` FOREIGN KEY (`costo_estructura_id`) REFERENCES `costos_estructuras` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=55 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `costos_estructuras`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `costos_estructuras` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `descripcion` varchar(100) NOT NULL,
  `es_fabril` tinyint(1) NOT NULL,
  `origen` varchar(60) DEFAULT NULL,
  `valor` varchar(60) DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `descripcion` (`descripcion`),
  KEY `fk_usuario_alta_44` (`alta_usuario_id`),
  CONSTRAINT `fk_usuario_alta_44` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `costos_parametros_directos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `costos_parametros_directos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `periodo` date NOT NULL,
  `centro_de_costo_id` int(11) NOT NULL,
  `valor_mod` float DEFAULT NULL,
  `valor_moi` float DEFAULT NULL,
  `gastos_fijos_x_hora` float DEFAULT NULL,
  `gastos_var_x_hora` float DEFAULT NULL,
  `gastos_fijos_x_kg` float DEFAULT NULL,
  `gastos_var_x_kg` float DEFAULT NULL,
  `horas_preglob` float DEFAULT NULL,
  `porc_var_mp_tubo` float DEFAULT NULL,
  `porc_var_mp_chapa` float DEFAULT NULL,
  `porc_var_mod` float DEFAULT NULL,
  `porc_var_moi` float DEFAULT NULL,
  `porc_var_cif` float DEFAULT NULL,
  `porc_var_rpp` float DEFAULT NULL,
  `horas_presup` float DEFAULT NULL,
  `pesos_cif_real` float DEFAULT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `alta_usuario_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_periodo_cc` (`periodo`,`centro_de_costo_id`),
  KEY `fk_usuario_alta_73` (`alta_usuario_id`),
  KEY `fk_costos_p_d_cc` (`centro_de_costo_id`),
  CONSTRAINT `fk_costos_p_d_cc` FOREIGN KEY (`centro_de_costo_id`) REFERENCES `centros_de_costo` (`id`),
  CONSTRAINT `fk_usuario_alta_73` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `costos_parametros_variables`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `costos_parametros_variables` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `periodo` date NOT NULL,
  `rolados_virolas_hasta14_hasta34` float DEFAULT NULL,
  `rolados_virolas_masde14_hasta34` float DEFAULT NULL,
  `conos_concentricos_hasta78` float DEFAULT NULL,
  `conos_excentricos_hasta78` float DEFAULT NULL,
  `rolados_virolas_hasta14_masde34` float DEFAULT NULL,
  `rolados_virolas_masde14_masde34` float DEFAULT NULL,
  `conos_concentricos_masde78` float DEFAULT NULL,
  `conos_excentricos_masde78` float DEFAULT NULL,
  `radiografia_pesos_x_placa` float DEFAULT NULL,
  `particulas_magneticas_pesos_x_kg` float DEFAULT NULL,
  `particulas_magneticas_pesos_x_hr` float DEFAULT NULL,
  `rolado_pesos_reales` float DEFAULT NULL,
  `radiografia_pesos_reales` float DEFAULT NULL,
  `particulas_magneticas_pesos_reales` float DEFAULT NULL,
  `impuestos_mod` float DEFAULT NULL,
  `impuestos_moi` float DEFAULT NULL,
  `impuestos_gastos_fijos` float DEFAULT NULL,
  `impuestos_gastos_variables` float DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `UK_PERIODO` (`periodo`) USING BTREE,
  KEY `fk_usuario_alta_74` (`alta_usuario_id`),
  CONSTRAINT `fk_usuario_alta_74` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `costos_tarifas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `costos_tarifas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `centro_de_costo_id` int(11) NOT NULL,
  `es_la_version_vigente` tinyint(1) NOT NULL DEFAULT 1,
  `valor_mod` decimal(20,2) NOT NULL,
  `valor_moi` decimal(20,2) NOT NULL,
  `valor_fijo` decimal(20,2) NOT NULL,
  `valor_variable` decimal(20,2) NOT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `fk_cc_tarifa` (`centro_de_costo_id`),
  KEY `fk_usuario_alta_37` (`alta_usuario_id`),
  CONSTRAINT `fk_cc_tarifa` FOREIGN KEY (`centro_de_costo_id`) REFERENCES `centros_de_costo` (`id`),
  CONSTRAINT `fk_usuario_alta_37` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `cuentas_contables`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `cuentas_contables` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) NOT NULL,
  `codigo` varchar(50) NOT NULL,
  `descripcion` varchar(60) NOT NULL,
  `esta_activo` tinyint(1) NOT NULL DEFAULT 1,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`)
) ENGINE=InnoDB AUTO_INCREMENT=633 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `depositos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `depositos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) NOT NULL,
  `locator_id_erp` int(11) DEFAULT NULL,
  `cod` varchar(27) NOT NULL,
  `nombre` varchar(100) DEFAULT NULL,
  `descripcion` varchar(100) NOT NULL,
  `tipo_externo` tinyint(1) NOT NULL,
  `lote_obligatorio` tinyint(1) NOT NULL,
  `localizacion` varchar(25) DEFAULT NULL,
  `esta_activo` tinyint(1) NOT NULL DEFAULT 1,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`),
  UNIQUE KEY `locator_id_erp` (`locator_id_erp`)
) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `depositos_as400`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `depositos_as400` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `nombre` varchar(30) DEFAULT NULL,
  `descripcion` varchar(30) DEFAULT NULL,
  `localizacion` varchar(25) DEFAULT NULL,
  `codigo_postal` varchar(4) DEFAULT NULL,
  `localidad` varchar(50) DEFAULT NULL,
  `provincia` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ensayos_parametros`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ensayos_parametros` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `parte` varchar(2) NOT NULL,
  `parametro` varchar(4) NOT NULL,
  `descripcion` varchar(50) NOT NULL,
  `es_decimal` tinyint(1) NOT NULL,
  `unidad_de_medida_id` int(11) NOT NULL,
  `unidad_de_medida_desc` varchar(50) NOT NULL,
  `es_quimico` tinyint(1) NOT NULL DEFAULT 0,
  PRIMARY KEY (`id`),
  UNIQUE KEY `descripcion` (`descripcion`)
) ENGINE=InnoDB AUTO_INCREMENT=100 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ensayos_rangos_quimicos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ensayos_rangos_quimicos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `agrupacion_calidad_id` int(11) NOT NULL,
  `parametro_id` int(11) NOT NULL,
  `valor_minimo` decimal(10,6) DEFAULT NULL,
  `valor_maximo` decimal(10,6) DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_ensayos_par` (`agrupacion_calidad_id`,`parametro_id`) USING BTREE,
  KEY `fk_ensayos_par` (`parametro_id`),
  KEY `fk_usuario_mod_57` (`modificacion_usuario_id`),
  CONSTRAINT `fk_ensayos_agrup` FOREIGN KEY (`agrupacion_calidad_id`) REFERENCES `agrupaciones_calidades` (`id`),
  CONSTRAINT `fk_ensayos_par` FOREIGN KEY (`parametro_id`) REFERENCES `ensayos_parametros` (`id`),
  CONSTRAINT `fk_usuario_mod_57` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1153 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `esquemas_de_descuentos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `esquemas_de_descuentos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) NOT NULL,
  `nombre` varchar(70) NOT NULL,
  `descripcion` varchar(100) NOT NULL,
  `tasa` decimal(8,4) NOT NULL,
  `esta_activo` tinyint(1) NOT NULL DEFAULT 1,
  PRIMARY KEY (`id`),
  UNIQUE KEY `nombre` (`nombre`),
  UNIQUE KEY `id_erp` (`id_erp`),
  UNIQUE KEY `id_erp_2` (`id_erp`)
) ENGINE=InnoDB AUTO_INCREMENT=32 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `etapas_subetapas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `etapas_subetapas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `etapa` int(11) NOT NULL,
  `subetapa` int(11) NOT NULL,
  `centro_de_costo_id` int(11) DEFAULT NULL,
  `descripcion` varchar(100) NOT NULL,
  `descripcion_corta` varchar(50) DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  `es_especial` tinyint(1) NOT NULL DEFAULT 0,
  `necesita_tilde_de_corte` tinyint(1) NOT NULL DEFAULT 0,
  `necesita_tilde_de_curvado` tinyint(1) NOT NULL DEFAULT 0,
  `necesita_tilde_de_prensa` tinyint(1) NOT NULL DEFAULT 0,
  `necesita_tilde_de_soldadura` tinyint(1) NOT NULL DEFAULT 0,
  `declara_partes_automaticos_en_ingreso_a_etapa_terminado` tinyint(1) NOT NULL DEFAULT 0,
  `es_etapa_terminado` tinyint(1) NOT NULL DEFAULT 0,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_etapa_subetapa` (`etapa`,`subetapa`),
  KEY `fk_usuario_alta_1` (`alta_usuario_id`),
  KEY `fk_usuario_baja_1` (`baja_usuario_id`),
  KEY `fk_usuario_mod_1` (`modificacion_usuario_id`),
  KEY `fk_etapa_cc` (`centro_de_costo_id`),
  CONSTRAINT `fk_etapa_cc` FOREIGN KEY (`centro_de_costo_id`) REFERENCES `centros_de_costo` (`id`),
  CONSTRAINT `fk_usuario_alta_1` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_1` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_1` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `ch_etapa` CHECK (`etapa` >= 0),
  CONSTRAINT `ch_subetapa` CHECK (`subetapa` >= 0)
) ENGINE=InnoDB AUTO_INCREMENT=534 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `etapas_subetapas_suscripcion_maquinas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `etapas_subetapas_suscripcion_maquinas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `etapa_subetapa_id` int(11) NOT NULL,
  `maquina_id` int(11) NOT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_etapa_subetapa` (`etapa_subetapa_id`,`maquina_id`),
  KEY `fk_usuario_alta_40` (`alta_usuario_id`),
  KEY `fk_es_maq_2` (`maquina_id`),
  CONSTRAINT `fk_es_maq_1` FOREIGN KEY (`etapa_subetapa_id`) REFERENCES `etapas_subetapas` (`id`),
  CONSTRAINT `fk_es_maq_2` FOREIGN KEY (`maquina_id`) REFERENCES `maquinas_herramientas` (`id`),
  CONSTRAINT `fk_usuario_alta_40` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=455645 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `etl_articulos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `etl_articulos` (
  `id_erp` int(11) DEFAULT NULL,
  `codigo` int(11) NOT NULL DEFAULT 0
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `etl_articulos_completo`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `etl_articulos_completo` (
  `id_erp` int(11) NOT NULL,
  `codigo` int(11) NOT NULL DEFAULT 0,
  `tipo_id` int(11) NOT NULL,
  `diametro` decimal(10,3) DEFAULT NULL,
  `largo` decimal(10,3) DEFAULT NULL,
  `espesor` decimal(10,3) DEFAULT NULL,
  `calidad_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id_erp`),
  UNIQUE KEY `UK1` (`tipo_id`,`diametro`,`largo`,`espesor`,`calidad_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `etl_articulos_tipos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `etl_articulos_tipos` (
  `id_erp` int(11) NOT NULL,
  `codigo` int(11) NOT NULL DEFAULT 0
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `etl_articulos_unidades_de_medida`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `etl_articulos_unidades_de_medida` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `descripcion` varchar(40) DEFAULT NULL,
  `abrev` varchar(10) DEFAULT NULL,
  `unidad_medida_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `descripcion` (`descripcion`),
  UNIQUE KEY `abrev` (`abrev`)
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `etl_demo_pk`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `etl_demo_pk` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `codigo` char(4) NOT NULL,
  `descripcion` varchar(50) DEFAULT NULL,
  `origen` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `UK1` (`origen`,`codigo`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `etl_normas_calidad`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `etl_normas_calidad` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `codigo` char(2) DEFAULT NULL,
  `descripcion` varchar(50) DEFAULT NULL,
  `campo_libre` varchar(50) DEFAULT NULL,
  `agrupa` int(4) DEFAULT NULL,
  `revision_año` int(4) DEFAULT NULL,
  `adenda_año` int(4) DEFAULT NULL,
  `campo_libre2` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `codigo` (`codigo`)
) ENGINE=InnoDB AUTO_INCREMENT=624 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `etl_pfc_completo`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `etl_pfc_completo` (
  `id` int(11) NOT NULL DEFAULT 0,
  `id_erp` int(11) DEFAULT NULL,
  `descripcion` varchar(80) NOT NULL,
  `descripcion_ingles` varchar(40) NOT NULL,
  `agrupacion_calidad_id` int(11) NOT NULL,
  `medida2` int(11) DEFAULT NULL,
  `norma` int(11) DEFAULT NULL,
  `calidad` int(11) DEFAULT NULL,
  `numero1` int(11) DEFAULT NULL,
  `numero2` int(11) DEFAULT NULL,
  `nomenclador` int(11) DEFAULT NULL,
  `orden` int(11) DEFAULT NULL,
  `cod_as400` varchar(5) DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime DEFAULT current_timestamp(),
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `etl_productos_fabricados`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `etl_productos_fabricados` (
  `id_erp` int(11) NOT NULL,
  `codigo` int(11) NOT NULL,
  PRIMARY KEY (`id_erp`),
  UNIQUE KEY `Índice 2` (`codigo`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `etl_productos_fabricados_calidades`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `etl_productos_fabricados_calidades` (
  `codigo` varchar(5) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL,
  `id_erp` int(11) NOT NULL,
  UNIQUE KEY `Índice 1` (`codigo`),
  UNIQUE KEY `Índice 2` (`id_erp`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `etl_productos_fabricados_calidades_old`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `etl_productos_fabricados_calidades_old` (
  `id_erp` int(11) NOT NULL,
  `codigo` varchar(5) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL,
  PRIMARY KEY (`id_erp`),
  UNIQUE KEY `Índice 2` (`codigo`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `etl_productos_fabricados_espesores`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `etl_productos_fabricados_espesores` (
  `id_erp` int(11) DEFAULT NULL,
  `codigo` varchar(9) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL,
  UNIQUE KEY `Índice 1` (`id_erp`),
  UNIQUE KEY `Índice 2` (`codigo`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `etl_productos_fabricados_familias`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `etl_productos_fabricados_familias` (
  `id_erp` int(11) DEFAULT NULL,
  `codigo` varchar(5) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `etl_productos_fabricados_normas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `etl_productos_fabricados_normas` (
  `id_erp` int(11) DEFAULT NULL,
  `codigo` varchar(9) CHARACTER SET utf8mb4 COLLATE utf8mb4_spanish_ci NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `etl_proveedores`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `etl_proveedores` (
  `codigo` varchar(15) NOT NULL,
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) DEFAULT NULL,
  `nombre` varchar(150) NOT NULL,
  PRIMARY KEY (`codigo`),
  KEY `IDK` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=44 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `etl_sector_cc`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `etl_sector_cc` (
  `sector` int(11) NOT NULL,
  `cc` int(11) NOT NULL,
  `declara_partes` tinyint(1) NOT NULL DEFAULT 0,
  PRIMARY KEY (`sector`,`cc`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `etl_unidades_de_medida`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `etl_unidades_de_medida` (
  `id_erp` int(11) NOT NULL,
  `codigo` int(11) NOT NULL DEFAULT 0
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `fichas_tecnicas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `fichas_tecnicas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `producto_fabricado_id` int(11) NOT NULL,
  `alternativa` int(11) NOT NULL,
  `es_la_version_vigente` tinyint(1) NOT NULL DEFAULT 1,
  `articulo_id` int(11) NOT NULL,
  `aprobacion_usuario_id` int(11) DEFAULT NULL,
  `aprobacion_fecha_hora` datetime DEFAULT NULL,
  `peso_bruto` decimal(7,3) DEFAULT NULL,
  `peso_neto` decimal(7,3) DEFAULT NULL,
  `factor_conversion` decimal(7,3) DEFAULT NULL,
  `lote_economico` int(11) DEFAULT NULL,
  `estado_ingpro` char(1) DEFAULT NULL,
  `tubo_largo_n1` int(11) DEFAULT NULL,
  `tubo_largo_n2` int(11) DEFAULT NULL,
  `tubo_largo_bruto` int(11) DEFAULT NULL,
  `tubo_especial` decimal(20,3) DEFAULT NULL,
  `tubo_pxh` decimal(20,3) DEFAULT NULL,
  `tubo_tpm` decimal(20,3) DEFAULT NULL,
  `largo` decimal(20,6) DEFAULT NULL,
  `ancho` decimal(20,6) DEFAULT NULL,
  `diametro` decimal(20,3) DEFAULT NULL,
  `cantidad_gajos` int(11) DEFAULT NULL,
  `horas_hombre` decimal(12,3) DEFAULT NULL,
  `codigo_optima` char(1) DEFAULT NULL,
  `cantidad_costuras` int(11) DEFAULT NULL,
  `modificacion_hh` char(1) NOT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  `es_tipo_p` tinyint(1) NOT NULL DEFAULT 0,
  `leyenda` varchar(50) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_ft` (`producto_fabricado_id`,`alternativa`,`alta_fecha_hora`),
  KEY `fk_usuario_alta_3` (`alta_usuario_id`),
  KEY `fk_usuario_baja_3` (`baja_usuario_id`),
  KEY `fk_usuario_mod_3` (`modificacion_usuario_id`),
  KEY `fk_aprobador` (`aprobacion_usuario_id`),
  KEY `fk_pf_1` (`producto_fabricado_id`),
  CONSTRAINT `fk_aprobador` FOREIGN KEY (`aprobacion_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_pf_1` FOREIGN KEY (`producto_fabricado_id`) REFERENCES `productos_fabricados` (`id`),
  CONSTRAINT `fk_usuario_alta_3` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_3` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_3` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `ch_lote_econ` CHECK (`lote_economico` >= 0)
) ENGINE=InnoDB AUTO_INCREMENT=981489 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `fichas_tecnicas_historial`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `fichas_tecnicas_historial` (
  `ficha_tecnica_id` int(11) NOT NULL,
  `codigo_baja` char(1) DEFAULT NULL,
  `fecha_aprobacion` date NOT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  PRIMARY KEY (`ficha_tecnica_id`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `fichas_tecnicas_hojas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `fichas_tecnicas_hojas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `ficha_tecnica_id` int(11) NOT NULL,
  `etapa_subetapa_id` int(11) NOT NULL,
  `nro_hoja_proceso` char(2) NOT NULL,
  `secuencia` int(11) NOT NULL,
  `descripcion` text NOT NULL,
  `centro_de_costo_id` int(11) DEFAULT NULL,
  `maquina_id` int(11) DEFAULT NULL,
  `tipo_mh` int(11) DEFAULT NULL,
  `nro_mh` int(11) DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `UK1` (`ficha_tecnica_id`,`etapa_subetapa_id`,`nro_hoja_proceso`,`secuencia`),
  KEY `fk_usuario_alta_5` (`alta_usuario_id`),
  KEY `fk_usuario_mod_5` (`modificacion_usuario_id`),
  KEY `fk_ficha_tecnica_2` (`ficha_tecnica_id`),
  KEY `fk_etapasubetapa_3` (`etapa_subetapa_id`),
  KEY `fk_cc_1` (`centro_de_costo_id`),
  KEY `fk_maquina_5` (`maquina_id`),
  CONSTRAINT `fk_cc_1` FOREIGN KEY (`centro_de_costo_id`) REFERENCES `centros_de_costo` (`id`),
  CONSTRAINT `fk_etapasubetapa_3` FOREIGN KEY (`etapa_subetapa_id`) REFERENCES `etapas_subetapas` (`id`),
  CONSTRAINT `fk_ficha_tecnica_2` FOREIGN KEY (`ficha_tecnica_id`) REFERENCES `fichas_tecnicas` (`id`),
  CONSTRAINT `fk_maquina_5` FOREIGN KEY (`maquina_id`) REFERENCES `maquinas_herramientas` (`id`),
  CONSTRAINT `fk_usuario_alta_5` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_5` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1871861 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `fichas_tecnicas_hojas_automaticas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `fichas_tecnicas_hojas_automaticas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `ficha_tecnica_id` int(11) NOT NULL,
  `ln1` int(11) NOT NULL,
  `ln2` int(11) NOT NULL,
  `ancho` int(11) NOT NULL,
  `alto` int(11) NOT NULL,
  `corte_manual` tinyint(4) NOT NULL,
  `largo_corte` int(11) NOT NULL,
  `calculo_tau` decimal(20,6) NOT NULL,
  `proceso_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_ft_autom` (`ficha_tecnica_id`,`proceso_id`),
  KEY `fk_hp_autom_proc` (`proceso_id`),
  CONSTRAINT `fk_hp_autom_ft` FOREIGN KEY (`ficha_tecnica_id`) REFERENCES `fichas_tecnicas` (`id`),
  CONSTRAINT `fk_hp_autom_proc` FOREIGN KEY (`proceso_id`) REFERENCES `fichas_tecnicas_procesos` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=4081 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `fichas_tecnicas_maquinas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `fichas_tecnicas_maquinas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `proceso_id` int(11) NOT NULL,
  `maquina_id` int(11) NOT NULL,
  `orden` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_proc_orden_maq` (`proceso_id`,`orden`),
  KEY `fk_maquina_3` (`maquina_id`),
  KEY `un_proc_maq` (`proceso_id`,`maquina_id`) USING BTREE,
  CONSTRAINT `fk_maquina_3` FOREIGN KEY (`maquina_id`) REFERENCES `maquinas_herramientas` (`id`),
  CONSTRAINT `fk_proceso_2` FOREIGN KEY (`proceso_id`) REFERENCES `fichas_tecnicas_procesos` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=7948752 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `fichas_tecnicas_pesobruto`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `fichas_tecnicas_pesobruto` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `producto_fabricado_id` int(11) NOT NULL,
  `alternativa` int(11) NOT NULL,
  `peso_bruto_anterior` decimal(20,3) DEFAULT 0.000,
  `peso_bruto` decimal(20,3) DEFAULT 0.000,
  `peso_bruto_2` decimal(20,3) DEFAULT 0.000,
  `peso_bruto_porc` decimal(20,2) DEFAULT 0.00,
  `marca_calculo` char(3) NOT NULL,
  `nota_1` varchar(50) NOT NULL,
  `nota_2` varchar(50) NOT NULL,
  `piezas_x_chapa` decimal(20,2) DEFAULT 0.00,
  `unidades_x_chapa` decimal(20,2) DEFAULT 0.00,
  `peso_complementario` decimal(20,3) DEFAULT 0.000,
  `espesor_rejas` decimal(20,2) DEFAULT 0.00,
  `cantidad_rejas` int(11) DEFAULT 0,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  `ficha_tecnica_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_usuario_alta_6` (`alta_usuario_id`),
  KEY `fk_usuario_mod_6` (`modificacion_usuario_id`),
  KEY `fk_pf_4` (`producto_fabricado_id`),
  KEY `fk_ft_pb` (`ficha_tecnica_id`),
  CONSTRAINT `fk_ft_pb` FOREIGN KEY (`ficha_tecnica_id`) REFERENCES `fichas_tecnicas` (`id`),
  CONSTRAINT `fk_pf_4` FOREIGN KEY (`producto_fabricado_id`) REFERENCES `productos_fabricados` (`id`),
  CONSTRAINT `fk_usuario_alta_6` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_6` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=16476 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `fichas_tecnicas_procesos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `fichas_tecnicas_procesos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `ficha_tecnica_id` int(11) NOT NULL,
  `etapa_subetapa_id` int(11) NOT NULL,
  `orden` int(11) NOT NULL,
  `std_piezas` decimal(20,2) DEFAULT NULL,
  `nro_hoja_proceso` char(2) DEFAULT '',
  `codigo_estado` char(1) DEFAULT NULL,
  `tiempo_setup_maquina` decimal(20,2) DEFAULT NULL,
  `cantidad_operarios` decimal(20,2) DEFAULT NULL,
  `unidad_x_art` decimal(20,2) DEFAULT NULL,
  `cod_estado_setup` char(1) DEFAULT NULL,
  `cantidad_ciclos` int(11) DEFAULT NULL,
  `alta_usuario_id` int(11) DEFAULT NULL,
  `alta_fecha_hora` datetime DEFAULT NULL,
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  `grupo_ft_id` int(11) DEFAULT NULL,
  `maquina_4_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_orden` (`ficha_tecnica_id`,`orden`),
  KEY `fk_usuario_alta_4` (`alta_usuario_id`),
  KEY `fk_usuario_baja_4` (`baja_usuario_id`),
  KEY `fk_usuario_mod_4` (`modificacion_usuario_id`),
  KEY `fk_etapasubetapa_2` (`etapa_subetapa_id`),
  KEY `fk_gr_ft_proc` (`grupo_ft_id`),
  KEY `fk_proc_maq_4` (`maquina_4_id`),
  CONSTRAINT `fk_etapasubetapa_2` FOREIGN KEY (`etapa_subetapa_id`) REFERENCES `etapas_subetapas` (`id`),
  CONSTRAINT `fk_ficha_tecnica` FOREIGN KEY (`ficha_tecnica_id`) REFERENCES `fichas_tecnicas` (`id`),
  CONSTRAINT `fk_gr_ft_proc` FOREIGN KEY (`grupo_ft_id`) REFERENCES `grupos_ft` (`id`),
  CONSTRAINT `fk_proc_maq_4` FOREIGN KEY (`maquina_4_id`) REFERENCES `maquinas_herramientas` (`id`),
  CONSTRAINT `fk_usuario_alta_4` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_4` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_4` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=7779133 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `fichas_tecnicas_retencion`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `fichas_tecnicas_retencion` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `codigo` char(1) NOT NULL,
  `sino` char(1) NOT NULL,
  `descripcion` varchar(50) DEFAULT NULL,
  `descripcion_abreviada` varchar(50) DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_usuario_alta_53` (`alta_usuario_id`),
  KEY `fk_usuario_baja_53` (`baja_usuario_id`),
  KEY `fk_usuario_mod_53` (`modificacion_usuario_id`),
  CONSTRAINT `fk_usuario_alta_53` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_53` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_53` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `grupos_calidad_detalle`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `grupos_calidad_detalle` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `pf_calidad_id` int(11) NOT NULL,
  `agrupacion_calidad_id` int(11) NOT NULL,
  `calidad_str` char(2) DEFAULT NULL,
  `alta_usuario_id` int(11) DEFAULT NULL,
  `alta_fecha_hora` datetime DEFAULT NULL,
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_pfcal_agrupa` (`pf_calidad_id`,`agrupacion_calidad_id`),
  KEY `fk_pfcal_agrupa1` (`agrupacion_calidad_id`),
  CONSTRAINT `fk_pfcal_agrupa` FOREIGN KEY (`pf_calidad_id`) REFERENCES `productos_fabricados_calidades` (`id`),
  CONSTRAINT `fk_pfcal_agrupa1` FOREIGN KEY (`agrupacion_calidad_id`) REFERENCES `agrupaciones_calidades` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=297 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `grupos_ft`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `grupos_ft` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `alternativa` int(11) NOT NULL,
  `es_la_version_vigente` tinyint(1) NOT NULL DEFAULT 1,
  `aprobacion_usuario_id` int(11) DEFAULT NULL,
  `aprobacion_fecha_hora` datetime DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  `descripcion` varchar(100) NOT NULL,
  `descripcion_corta` varchar(15) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_grupos_ft` (`alternativa`,`alta_fecha_hora`),
  KEY `fk_usuario_alta_64` (`alta_usuario_id`),
  KEY `fk_usuario_baja_64` (`baja_usuario_id`),
  KEY `fk_usuario_mod_64` (`modificacion_usuario_id`),
  KEY `fk_gt_aprobador` (`aprobacion_usuario_id`),
  CONSTRAINT `fk_gt_aprobador` FOREIGN KEY (`aprobacion_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_alta_64` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_64` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_64` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=15 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `grupos_ft_maquinas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `grupos_ft_maquinas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `gr_proceso_id` int(11) NOT NULL,
  `maquina_id` int(11) NOT NULL,
  `orden` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_gr_m_orden` (`gr_proceso_id`,`orden`),
  KEY `fk_gr_maquina` (`maquina_id`),
  KEY `un_gr_proc_maq` (`gr_proceso_id`,`maquina_id`) USING BTREE,
  CONSTRAINT `fk_gr_maquina` FOREIGN KEY (`maquina_id`) REFERENCES `maquinas_herramientas` (`id`),
  CONSTRAINT `fk_gr_proceso` FOREIGN KEY (`gr_proceso_id`) REFERENCES `grupos_ft_procesos` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=134 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `grupos_ft_procesos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `grupos_ft_procesos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `grupo_ft_id` int(11) NOT NULL,
  `etapa_subetapa_id` int(11) NOT NULL,
  `orden` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_gr_orden` (`grupo_ft_id`,`orden`),
  UNIQUE KEY `un_grupo_es` (`grupo_ft_id`,`etapa_subetapa_id`),
  KEY `fk_gr_ft_etse` (`etapa_subetapa_id`),
  CONSTRAINT `fk_gr_ft_etse` FOREIGN KEY (`etapa_subetapa_id`) REFERENCES `etapas_subetapas` (`id`),
  CONSTRAINT `fk_grupo_ft_proc` FOREIGN KEY (`grupo_ft_id`) REFERENCES `grupos_ft` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=83 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `informes_de_recepcion`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `informes_de_recepcion` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_unico` text NOT NULL DEFAULT uuid(),
  `propietario_id` int(11) NOT NULL,
  `propietario_token` text NOT NULL,
  `orden_de_compra_id` int(11) NOT NULL,
  `articulo_id` int(11) NOT NULL,
  `cantidad_recibida` int(11) DEFAULT NULL,
  `remito_cod` text NOT NULL,
  `remito_imagen` text DEFAULT NULL,
  `colada` text DEFAULT NULL,
  `fecha` date NOT NULL DEFAULT date_format(curdate(),'%Y-%m-%d'),
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_unico` (`id_unico`) USING HASH,
  KEY `fk_propietario_22` (`propietario_id`),
  KEY `fk_orden_1` (`orden_de_compra_id`),
  KEY `fk_articulo_6` (`articulo_id`),
  CONSTRAINT `fk_articulo_6` FOREIGN KEY (`articulo_id`) REFERENCES `articulos` (`id`),
  CONSTRAINT `fk_orden_1` FOREIGN KEY (`orden_de_compra_id`) REFERENCES `ordenes_de_compra` (`id`),
  CONSTRAINT `fk_propietario_22` FOREIGN KEY (`propietario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `chk_cantidad_recibida_1` CHECK (`cantidad_recibida` > 0)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ingresos_produccion`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ingresos_produccion` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) DEFAULT NULL,
  `orden_de_produccion_id` int(11) NOT NULL,
  `tipo_de_movimiento_id` int(11) NOT NULL,
  `tipo_de_ingreso_id` int(11) NOT NULL,
  `comprobante_cajon` varchar(30) NOT NULL,
  `secuencia` int(11) NOT NULL,
  `cantidad` int(11) NOT NULL,
  `cantidad_aprobada` int(11) NOT NULL DEFAULT 0,
  `cantidad_retenida` int(11) NOT NULL DEFAULT 0,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `ingreso_deposito_usuario_id` int(11) DEFAULT NULL,
  `ingreso_deposito_fecha_hora` datetime DEFAULT NULL,
  `es_migrado` tinyint(1) NOT NULL DEFAULT 0,
  `retrabajo_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`),
  KEY `fk_usuario_alta_41` (`alta_usuario_id`),
  KEY `fk_orden_produccion` (`orden_de_produccion_id`),
  KEY `fk_tipo_ingr` (`tipo_de_ingreso_id`),
  KEY `fk_tipo_mov` (`tipo_de_movimiento_id`),
  KEY `fk_calidad_usuario` (`ingreso_deposito_usuario_id`),
  KEY `fk_ip_rt` (`retrabajo_id`),
  CONSTRAINT `fk_calidad_usuario` FOREIGN KEY (`ingreso_deposito_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_ip_rt` FOREIGN KEY (`retrabajo_id`) REFERENCES `retrabajos_cabecera` (`id`),
  CONSTRAINT `fk_orden_produccion` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `fk_tipo_ingr` FOREIGN KEY (`tipo_de_ingreso_id`) REFERENCES `ingresos_produccion_tipos_de_ingresos` (`id`),
  CONSTRAINT `fk_tipo_mov` FOREIGN KEY (`tipo_de_movimiento_id`) REFERENCES `ingresos_produccion_tipos_de_movimientos` (`id`),
  CONSTRAINT `fk_usuario_alta_41` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `chk_cantidadip` CHECK (`cantidad` > 0),
  CONSTRAINT `chk_cantidadaprob_ip` CHECK (`cantidad_aprobada` >= 0),
  CONSTRAINT `chk_cantidadrech_ip` CHECK (`cantidad_retenida` >= 0),
  CONSTRAINT `chk_cantidadtotal_ip` CHECK (`cantidad` >= `cantidad_aprobada` + `cantidad_retenida`)
) ENGINE=InnoDB AUTO_INCREMENT=81 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ingresos_produccion_ensayos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ingresos_produccion_ensayos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `orden_de_produccion_id` int(11) NOT NULL,
  `numero_produccion` int(11) NOT NULL,
  `fecha_produccion` date NOT NULL,
  `cantidad` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_ensayo_op` (`orden_de_produccion_id`),
  CONSTRAINT `fk_ensayo_op` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ingresos_produccion_tipos_de_ingresos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ingresos_produccion_tipos_de_ingresos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `descripcion` varchar(40) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `descripcion` (`descripcion`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ingresos_produccion_tipos_de_movimientos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ingresos_produccion_tipos_de_movimientos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `descripcion` varchar(40) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `descripcion` (`descripcion`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `instrumentos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `instrumentos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `codigo` varchar(6) NOT NULL DEFAULT '',
  `descripcion` varchar(50) DEFAULT NULL,
  `tipo` char(1) NOT NULL DEFAULT '',
  `subtipo` char(2) DEFAULT NULL,
  `ubicacion` char(2) DEFAULT NULL,
  `periodo_tipo` char(1) DEFAULT NULL,
  `periodo_numero` int(11) DEFAULT NULL,
  `patron_referencia` varchar(6) DEFAULT NULL,
  `tolerancia` varchar(10) DEFAULT NULL,
  `evaluacion` char(1) DEFAULT NULL,
  `controla` varchar(20) DEFAULT NULL,
  `control_ultimo` date DEFAULT NULL,
  `control_proximo` date DEFAULT NULL,
  `ente` varchar(20) DEFAULT NULL,
  `certificados` varchar(50) DEFAULT NULL,
  `observaciones` varchar(200) DEFAULT NULL,
  `estado` char(1) DEFAULT NULL,
  `control_usuario_id` int(11) DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_usuario_baja_34` (`baja_usuario_id`),
  CONSTRAINT `fk_usuario_baja_34` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2180 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `instrumentos_calibracion`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `instrumentos_calibracion` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `instrumento_id` int(11) DEFAULT NULL,
  `tipo` char(1) NOT NULL,
  `codigo` varchar(6) NOT NULL,
  `calibracion_fecha` date NOT NULL,
  `secuencia` int(11) NOT NULL,
  `empresa` int(11) DEFAULT NULL,
  `legajo` int(11) DEFAULT NULL,
  `alta_usuario_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_instrum_cal` (`tipo`,`codigo`,`calibracion_fecha`,`secuencia`),
  KEY `fk_instrumentos_cal` (`instrumento_id`),
  CONSTRAINT `fk_instrumentos_cal` FOREIGN KEY (`instrumento_id`) REFERENCES `instrumentos` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=28886 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `instrumentos_calibracion_lecturas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `instrumentos_calibracion_lecturas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `calibracion_id` int(11) NOT NULL,
  `secuencia` int(11) NOT NULL,
  `valor` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_calibracion_sec` (`calibracion_id`,`secuencia`),
  CONSTRAINT `fk_calibracion_lect` FOREIGN KEY (`calibracion_id`) REFERENCES `instrumentos_calibracion` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=94884 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `instrumentos_dimensiones`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `instrumentos_dimensiones` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `subtipo` char(2) NOT NULL DEFAULT '0',
  `patron_referencia` varchar(6) NOT NULL DEFAULT '',
  `secuencia` int(11) NOT NULL,
  `tolerancia_inferior` decimal(20,3) DEFAULT NULL,
  `tolerancia_superior` decimal(20,3) DEFAULT NULL,
  `unidad_medida` varchar(4) DEFAULT NULL,
  `columna` varchar(10) DEFAULT NULL,
  `renglon` varchar(10) DEFAULT NULL,
  `patron` decimal(20,2) DEFAULT NULL,
  `tipo_dimension` char(1) DEFAULT NULL,
  `alta_usuario_id` int(11) DEFAULT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_instrum_dim` (`subtipo`,`patron_referencia`,`secuencia`)
) ENGINE=InnoDB AUTO_INCREMENT=111 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `instrumentos_tenedores`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `instrumentos_tenedores` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `instrumento_id` int(11) NOT NULL,
  `orden` int(11) NOT NULL,
  `empresa` int(11) DEFAULT NULL,
  `usuario_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_instrum_ten` (`instrumento_id`,`orden`)
) ENGINE=InnoDB AUTO_INCREMENT=3714 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `legajos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `legajos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `apellido_nombre` varchar(250) NOT NULL,
  `sector` int(11) NOT NULL,
  `elaboracion` tinyint(1) NOT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_usuario_alta_62` (`alta_usuario_id`),
  KEY `fk_usuario_baja_62` (`baja_usuario_id`),
  KEY `fk_usuario_mod_62` (`modificacion_usuario_id`),
  CONSTRAINT `fk_usuario_alta_62` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_62` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_62` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1096 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `letras_coladas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `letras_coladas` (
  `codigo_letra` char(4) NOT NULL,
  `codigo_colada` char(10) NOT NULL,
  `mp_id` int(11) DEFAULT NULL,
  `cant_certificados` int(11) DEFAULT NULL,
  `metro_unidad` decimal(20,6) DEFAULT NULL,
  `numero_produccion` int(11) DEFAULT NULL,
  `ft_id` int(11) DEFAULT NULL,
  `peso_bruto` decimal(20,3) DEFAULT NULL,
  `peso_neto` decimal(20,3) DEFAULT NULL,
  `factor_conversion` decimal(20,3) DEFAULT NULL,
  `lote_economico` int(11) DEFAULT NULL,
  `total_item` int(11) DEFAULT NULL,
  `horas_hombre` decimal(20,6) DEFAULT NULL,
  `optima` char(1) DEFAULT NULL,
  `largo_neto_1` int(11) DEFAULT NULL,
  `largo_neto_2` int(11) DEFAULT NULL,
  `largo_bruto` int(11) DEFAULT NULL,
  `largo_chapa` int(11) DEFAULT NULL,
  `ancho_chapa` int(11) DEFAULT NULL,
  `diametro` int(11) DEFAULT NULL,
  `gajos` int(11) DEFAULT NULL,
  `costuras` int(11) DEFAULT NULL,
  `alta_fecha_hora` datetime DEFAULT NULL,
  `alta_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `baja_usuario_id` int(11) DEFAULT NULL,
  `ft_fecha_alta` date DEFAULT NULL,
  `ft_usuario_alta` int(11) DEFAULT NULL,
  `ft_fecha_modificacion` date DEFAULT NULL,
  `ft_usuario_modificacion` int(11) DEFAULT NULL,
  PRIMARY KEY (`codigo_letra`,`codigo_colada`) USING BTREE,
  KEY `mp_id` (`mp_id`),
  KEY `ft_id` (`ft_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `lineas_de_produccion`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `lineas_de_produccion` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `propietario_id` int(11) NOT NULL,
  `descripcion` varchar(40) NOT NULL,
  `cod` varchar(27) NOT NULL DEFAULT concat(lpad(floor(rand() * 10),2,'0'),' ',lpad(floor(rand() * 1000000),7,'0'),' ',lpad(floor(rand() * 100000),5,'0'),' ',lpad(floor(rand() * 1000000),7,'0'),' ',lpad(floor(rand() * 10),2,'0')),
  PRIMARY KEY (`id`),
  UNIQUE KEY `cod` (`cod`),
  KEY `fk_propietario_6` (`propietario_id`),
  CONSTRAINT `fk_propietario_6` FOREIGN KEY (`propietario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `lotes_economicos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `lotes_economicos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `producto_fabricado_id` int(11) NOT NULL,
  `lote_economico` int(11) NOT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `producto_fabricado_id` (`producto_fabricado_id`),
  KEY `fk_pf_le` (`producto_fabricado_id`),
  KEY `fk_usuario_alta_12` (`alta_usuario_id`),
  KEY `fk_usuario_mod_12` (`modificacion_usuario_id`),
  CONSTRAINT `fk_pf_le` FOREIGN KEY (`producto_fabricado_id`) REFERENCES `productos_fabricados` (`id`),
  CONSTRAINT `fk_usuario_alta_12` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_12` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `chk_cantidad_le` CHECK (`lote_economico` > 0)
) ENGINE=InnoDB AUTO_INCREMENT=4499 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `maquinas_herramientas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `maquinas_herramientas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `tipo_id` int(11) NOT NULL,
  `numero` int(11) NOT NULL,
  `centro_de_costo_id` int(11) NOT NULL,
  `descripcion` varchar(40) NOT NULL,
  `marca` varchar(30) NOT NULL,
  `fecha_fabricacion` date DEFAULT NULL,
  `material` varchar(100) DEFAULT NULL,
  `observaciones` varchar(500) DEFAULT NULL,
  `codigo_marca_aprob` varchar(50) DEFAULT NULL,
  `total_horas_uso` int(11) DEFAULT NULL,
  `acumulado_horas_uso` int(11) DEFAULT NULL,
  `horas_minimas_uso` int(11) DEFAULT NULL,
  `horas_criticas_uso` int(11) DEFAULT NULL,
  `unidades_control_uso` int(11) DEFAULT NULL,
  `acumulado_unidades_uso` int(11) DEFAULT NULL,
  `unidades_minimas_uso` int(11) DEFAULT NULL,
  `unidades_criticas_uso` int(11) DEFAULT NULL,
  `comentario_reparacion` varchar(50) DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_tipo_numero` (`tipo_id`,`numero`),
  UNIQUE KEY `UK1` (`tipo_id`,`numero`),
  KEY `fk_usuario_alta_7` (`alta_usuario_id`),
  KEY `fk_usuario_mod_7` (`modificacion_usuario_id`),
  KEY `fk_usuario_baja_7` (`baja_usuario_id`),
  KEY `fk_maquina_cc` (`centro_de_costo_id`),
  CONSTRAINT `fk_maquina` FOREIGN KEY (`tipo_id`) REFERENCES `maquinas_herramientas_tipos` (`id`),
  CONSTRAINT `fk_maquina_cc` FOREIGN KEY (`centro_de_costo_id`) REFERENCES `centros_de_costo` (`id`),
  CONSTRAINT `fk_usuario_alta_7` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_7` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_7` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=5651 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `maquinas_herramientas_matrices`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `maquinas_herramientas_matrices` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `maquina_id` int(11) NOT NULL,
  `familia` char(3) DEFAULT NULL,
  `medida_1` int(11) DEFAULT NULL,
  `medida_2` int(11) DEFAULT NULL,
  `espesor_codigo` char(2) DEFAULT NULL,
  `espesor_desde` int(11) DEFAULT NULL,
  `espesor_hasta` int(11) DEFAULT NULL,
  `rolado` int(11) DEFAULT NULL,
  `alta_fecha_hora` datetime NOT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `familia_id` int(11) DEFAULT NULL,
  `espesor_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `FK_maquinas_herramientas_matrices_maquinas_herramientas` (`maquina_id`) USING BTREE,
  CONSTRAINT `FK_maquinas_herramientas_matrices_maquinas_herramientas` FOREIGN KEY (`maquina_id`) REFERENCES `maquinas_herramientas` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=26701 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='Máq/Herra- Familias de artics.Asociadas a Matrices';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `maquinas_herramientas_tipos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `maquinas_herramientas_tipos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `descripcion` varchar(100) NOT NULL,
  `descripcion_abreviada` varchar(40) NOT NULL,
  `alta_usuario_id` int(11) DEFAULT NULL,
  `alta_fecha_hora` datetime DEFAULT NULL,
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_usuario_alta_11` (`alta_usuario_id`),
  KEY `fk_usuario_baja_11` (`baja_usuario_id`),
  KEY `fk_usuario_mod_11` (`modificacion_usuario_id`),
  CONSTRAINT `fk_usuario_alta_11` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_11` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_11` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=100 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `maquinas_setup`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `maquinas_setup` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `maquina_id` int(11) NOT NULL,
  `familia` char(3) DEFAULT NULL,
  `diametro_medida` char(1) DEFAULT NULL,
  `diametro_desde` int(11) DEFAULT NULL,
  `diametro_hasta` int(11) DEFAULT NULL,
  `tiempo_preparacion` int(11) NOT NULL DEFAULT 0,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `alta_usuario_id` int(11) NOT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `baja_usuario_id` int(11) DEFAULT NULL,
  `pf_familia_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `un_maq_setup` (`maquina_id`,`pf_familia_id`,`diametro_desde`,`diametro_hasta`,`id`) USING BTREE,
  KEY `fk_usuario_alta_59` (`alta_usuario_id`),
  KEY `fk_usuario_baja_59` (`baja_usuario_id`),
  KEY `fk_usuario_mod_59` (`modificacion_usuario_id`),
  KEY `fk_setup_familia` (`pf_familia_id`),
  CONSTRAINT `fk_maq_setup` FOREIGN KEY (`maquina_id`) REFERENCES `maquinas_herramientas` (`id`),
  CONSTRAINT `fk_setup_familia` FOREIGN KEY (`pf_familia_id`) REFERENCES `productos_fabricados_familias` (`id`),
  CONSTRAINT `fk_usuario_alta_59` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_59` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_59` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=3683 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='Tiempo de preparacion de las maquinas';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `materias_primas_movimientos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `materias_primas_movimientos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `orden_de_produccion_id` int(11) DEFAULT NULL,
  `colada` char(10) NOT NULL,
  `cod_ajuste` int(11) DEFAULT NULL,
  `metros_unidades` decimal(20,6) DEFAULT NULL,
  `deposito_id` int(11) DEFAULT NULL,
  `remito_numero` int(11) DEFAULT NULL,
  `cantidad` decimal(20,6) DEFAULT NULL,
  `alta_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `UK1` (`colada`,`alta_fecha_hora`,`cod_ajuste`),
  KEY `fk_op_mp_mov` (`orden_de_produccion_id`),
  CONSTRAINT `fk_op_mp_mov` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=136666 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `monedas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `monedas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) NOT NULL,
  `descripcion` varchar(100) NOT NULL,
  `abrev` varchar(10) NOT NULL,
  `simbolo` varchar(30) NOT NULL,
  `esta_activo` tinyint(1) NOT NULL DEFAULT 1,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`)
) ENGINE=InnoDB AUTO_INCREMENT=177 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `motivos_retencion`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `motivos_retencion` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `codigo_retencion` int(11) NOT NULL,
  `descripcion` varchar(60) NOT NULL,
  `descripcion_corta` varchar(30) DEFAULT NULL,
  `alta_usuario_id` int(11) DEFAULT NULL,
  `alta_fecha_hora` datetime DEFAULT NULL,
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `codigo_retencion` (`codigo_retencion`),
  KEY `fk_usuario_alta_17` (`alta_usuario_id`),
  KEY `fk_usuario_baja_17` (`baja_usuario_id`),
  KEY `fk_usuario_mod_17` (`modificacion_usuario_id`),
  CONSTRAINT `fk_usuario_alta_17` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_17` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_17` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=48 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `movimientos_materiales`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `movimientos_materiales` (
  `articulo_id` int(11) NOT NULL,
  `partida` char(3) DEFAULT NULL,
  `transaccion` int(11) NOT NULL,
  `numero_transaccion` int(11) NOT NULL,
  `numero_proveedor` int(11) DEFAULT NULL,
  `numero_remito` int(11) DEFAULT NULL,
  `fecha_transaccion` date DEFAULT NULL,
  `deposito` int(11) DEFAULT NULL,
  `cantidad_kg_mts` decimal(20,6) DEFAULT NULL,
  `cantidad_unidades` decimal(20,6) DEFAULT NULL,
  `precio_compra` decimal(20,6) DEFAULT NULL,
  `libre` char(1) DEFAULT NULL,
  KEY `fk_material_mov` (`articulo_id`),
  CONSTRAINT `fk_material_mov` FOREIGN KEY (`articulo_id`) REFERENCES `articulos` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `operaciones_provisorias`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `operaciones_provisorias` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `numero` int(11) NOT NULL,
  `orden_de_produccion_id` int(11) NOT NULL,
  `etapa_subetapa_id` int(11) NOT NULL,
  `marca_r_o` char(1) NOT NULL DEFAULT 'O',
  `cantidad_retenida` int(11) NOT NULL,
  `maquina_1_id` int(11) DEFAULT NULL,
  `maquina_2_id` int(11) DEFAULT NULL,
  `maquina_3_id` int(11) DEFAULT NULL,
  `maquina_4_id` int(11) DEFAULT NULL,
  `motivo_retencion` int(11) DEFAULT NULL,
  `cantidad_recuperada` int(11) NOT NULL,
  `cc_retrabajo` int(11) DEFAULT NULL COMMENT 'C.COSTOS RETRABA',
  `r_alta_fecha` date DEFAULT NULL COMMENT 'Retrabajo Alta',
  `producto_fabricado_id` int(11) DEFAULT NULL,
  `cc_orden_de_produccion` int(11) DEFAULT NULL,
  `letra_transferencia_origen` char(50) DEFAULT NULL,
  `comentarios_inicio` varchar(300) DEFAULT NULL,
  `ftsn` char(2) DEFAULT NULL COMMENT 'AGREGA FICHA TECNICA',
  `empresa` int(11) DEFAULT NULL,
  `sucursal` int(11) DEFAULT NULL,
  `legajo` int(11) DEFAULT NULL,
  `sector` int(11) DEFAULT NULL,
  `nro_remito` int(11) DEFAULT NULL,
  `año_parte_diario` int(11) DEFAULT NULL,
  `aprobado_puesta_marcha` int(11) DEFAULT NULL,
  `articulo_familia` int(11) DEFAULT NULL,
  `articulo_tipo` int(11) DEFAULT NULL,
  `cantidad_descarte` decimal(20,6) DEFAULT NULL,
  `cantidad_operarios` int(11) DEFAULT NULL,
  `cc` int(11) DEFAULT NULL,
  `colada` varchar(10) DEFAULT NULL,
  `estado` char(1) DEFAULT NULL,
  `estado_prep_maq` char(1) DEFAULT NULL,
  `etapa_subetapa_1_id` int(11) DEFAULT NULL,
  `etapa_subetapa_anterior_id` int(11) DEFAULT NULL,
  `etapa_subetapa_siguiente_id` int(11) DEFAULT NULL,
  `fecha_parte_diario` date DEFAULT NULL,
  `fecha_produccion` date DEFAULT NULL,
  `fecha_produccion_1` date DEFAULT NULL,
  `ficha_tecnica_1_id` int(11) DEFAULT NULL,
  `ficha_tecnica_id` int(11) DEFAULT NULL,
  `hoja_proceso` char(2) DEFAULT NULL,
  `letra` varchar(50) DEFAULT NULL,
  `letra_origen` varchar(50) DEFAULT NULL,
  `marca_comunicacion` char(1) DEFAULT NULL,
  `marca_op_emitida` char(1) DEFAULT NULL,
  `marca_pendiente_final` char(1) DEFAULT NULL,
  `piezas_x_ciclo` int(11) DEFAULT NULL,
  `relleno` varchar(30) DEFAULT NULL,
  `std_piezas` int(11) DEFAULT NULL,
  `tiempo_setup` int(11) DEFAULT NULL,
  `total_horas_hombre` decimal(20,6) DEFAULT NULL,
  `total_horas_maquina` decimal(20,6) DEFAULT NULL,
  `unidades_x_art` int(11) DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  `comentarios_fin` varchar(300) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `numero` (`numero`),
  KEY `fk_usuario_alta_72` (`alta_usuario_id`),
  KEY `fk_usuario_baja_72` (`baja_usuario_id`),
  KEY `fk_usuario_mod_72` (`modificacion_usuario_id`),
  KEY `fk_oprov` (`orden_de_produccion_id`),
  KEY `fk_oprov_reten` (`motivo_retencion`),
  KEY `fk_oprov_etse1` (`etapa_subetapa_id`),
  KEY `fk_oprov_maq_1` (`maquina_1_id`),
  KEY `fk_oprov_maq_2` (`maquina_2_id`),
  KEY `fk_oprov_maq_3` (`maquina_3_id`),
  KEY `fk_oprov_maq_4` (`maquina_4_id`),
  CONSTRAINT `fk_oprov` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `fk_oprov_etse1` FOREIGN KEY (`etapa_subetapa_id`) REFERENCES `etapas_subetapas` (`id`),
  CONSTRAINT `fk_oprov_maq_1` FOREIGN KEY (`maquina_1_id`) REFERENCES `maquinas_herramientas` (`id`),
  CONSTRAINT `fk_oprov_maq_2` FOREIGN KEY (`maquina_2_id`) REFERENCES `maquinas_herramientas` (`id`),
  CONSTRAINT `fk_oprov_maq_3` FOREIGN KEY (`maquina_3_id`) REFERENCES `maquinas_herramientas` (`id`),
  CONSTRAINT `fk_oprov_maq_4` FOREIGN KEY (`maquina_4_id`) REFERENCES `maquinas_herramientas` (`id`),
  CONSTRAINT `fk_oprov_reten` FOREIGN KEY (`motivo_retencion`) REFERENCES `motivos_retencion` (`codigo_retencion`),
  CONSTRAINT `fk_usuario_alta_72` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_72` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_72` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_de_compra`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_de_compra` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) NOT NULL,
  `proveedor_id` int(11) NOT NULL,
  `fecha_creacion` date NOT NULL,
  `fecha_objetivo` date NOT NULL,
  `es_borrador` tinyint(1) NOT NULL,
  `fue_rechazada` tinyint(1) DEFAULT 0,
  `esta_activo` tinyint(1) NOT NULL DEFAULT 1,
  `document_no_erp` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`),
  KEY `fk_proveedor_1` (`proveedor_id`),
  CONSTRAINT `fk_proveedor_1` FOREIGN KEY (`proveedor_id`) REFERENCES `proveedores_y_clientes` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=416 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_de_compra_articulos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_de_compra_articulos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) NOT NULL,
  `orden_de_compra_id` int(11) NOT NULL,
  `articulo_id` int(11) NOT NULL,
  `unidad_de_medida_id` int(11) NOT NULL,
  `cantidad` decimal(10,3) NOT NULL,
  `moneda_id` int(11) NOT NULL,
  `precio` decimal(20,2) NOT NULL,
  `fecha_creacion` date NOT NULL,
  `fecha_objetivo` date NOT NULL,
  `esta_activo` tinyint(1) NOT NULL DEFAULT 1,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`),
  KEY `fk_articulo_1` (`articulo_id`),
  KEY `fk_medida_2` (`unidad_de_medida_id`),
  KEY `fk_moneda_1` (`moneda_id`),
  KEY `fk_orden` (`orden_de_compra_id`),
  CONSTRAINT `fk_articulo_1` FOREIGN KEY (`articulo_id`) REFERENCES `articulos` (`id`),
  CONSTRAINT `fk_medida_2` FOREIGN KEY (`unidad_de_medida_id`) REFERENCES `unidades_de_medida` (`id`),
  CONSTRAINT `fk_moneda_1` FOREIGN KEY (`moneda_id`) REFERENCES `monedas` (`id`),
  CONSTRAINT `fk_orden` FOREIGN KEY (`orden_de_compra_id`) REFERENCES `ordenes_de_compra` (`id`),
  CONSTRAINT `chk_cantidad_recibida_4` CHECK (`cantidad` >= 0),
  CONSTRAINT `chk_precio` CHECK (`precio` >= 0)
) ENGINE=InnoDB AUTO_INCREMENT=313 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_de_despacho`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_de_despacho` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) NOT NULL,
  `cliente_id` int(11) NOT NULL,
  `estado_id` int(11) NOT NULL DEFAULT 1,
  `fecha_creacion` date NOT NULL,
  `fecha_objetivo` date NOT NULL,
  `pedido_id_erp` int(11) DEFAULT NULL,
  `remito_id_erp` int(11) DEFAULT NULL,
  `esta_activo` tinyint(1) NOT NULL DEFAULT 1,
  `armado_usuario_id` int(11) DEFAULT NULL,
  `armado_fecha_hora` datetime DEFAULT NULL,
  `confirmado_usuario_id` int(11) DEFAULT NULL,
  `confirmado_fecha_hora` datetime DEFAULT NULL,
  `esta_lista_para_ser_armada_erp` tinyint(1) NOT NULL DEFAULT 0,
  `document_no_erp` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`),
  KEY `fk_despacho_cliente` (`cliente_id`),
  KEY `fk_armado_usuario` (`armado_usuario_id`),
  KEY `fk_confirm_usuario` (`confirmado_usuario_id`),
  CONSTRAINT `fk_armado_usuario` FOREIGN KEY (`armado_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_confirm_usuario` FOREIGN KEY (`confirmado_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_despacho_cliente` FOREIGN KEY (`cliente_id`) REFERENCES `proveedores_y_clientes` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=174 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_de_despacho_armado`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_de_despacho_armado` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `od_item_id` int(11) NOT NULL,
  `orden_de_produccion_id` int(11) NOT NULL,
  `cantidad` int(11) NOT NULL,
  `id_erp` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_odd_armado` (`od_item_id`,`orden_de_produccion_id`),
  UNIQUE KEY `id_erp` (`id_erp`),
  KEY `fk_odd_op` (`orden_de_produccion_id`),
  CONSTRAINT `fk_odd_armado` FOREIGN KEY (`od_item_id`) REFERENCES `ordenes_de_despacho_items` (`id`),
  CONSTRAINT `fk_odd_op` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `ch_cert_cant` CHECK (`cantidad` > 0)
) ENGINE=InnoDB AUTO_INCREMENT=27 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_de_despacho_items`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_de_despacho_items` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) NOT NULL,
  `orden_de_despacho_id` int(11) NOT NULL,
  `producto_fabricado_id` int(11) NOT NULL,
  `cantidad` int(11) NOT NULL,
  `esta_activo` tinyint(1) NOT NULL DEFAULT 1,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`),
  KEY `fk_despacho` (`orden_de_despacho_id`),
  KEY `fk_despacho_pf` (`producto_fabricado_id`),
  CONSTRAINT `fk_despacho` FOREIGN KEY (`orden_de_despacho_id`) REFERENCES `ordenes_de_despacho` (`id`),
  CONSTRAINT `fk_despacho_pf` FOREIGN KEY (`producto_fabricado_id`) REFERENCES `productos_fabricados` (`id`),
  CONSTRAINT `ch_odd_cant` CHECK (`cantidad` >= 0)
) ENGINE=InnoDB AUTO_INCREMENT=354 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_de_produccion`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_de_produccion` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `ficha_tecnica_id` int(11) NOT NULL,
  `estado_id` int(11) NOT NULL DEFAULT 1,
  `cantidad` int(11) NOT NULL,
  `cantidad_fabricada` int(11) NOT NULL DEFAULT 0,
  `fecha_objetivo` date NOT NULL,
  `fue_lanzada` tinyint(1) NOT NULL DEFAULT 0,
  `proceso_actual` int(11) DEFAULT 0,
  `lote_economico` int(11) NOT NULL,
  `lanzamiento_fecha_hora` datetime DEFAULT NULL,
  `letra` varchar(4) DEFAULT NULL,
  `cantidad_mp_asignada` decimal(12,3) DEFAULT NULL,
  `recepcion_tecnica_id` int(11) DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_usuario_alta_27` (`alta_usuario_id`),
  KEY `fk_ficha_tecnica_1` (`ficha_tecnica_id`),
  KEY `fk_recepcion_4` (`recepcion_tecnica_id`),
  KEY `fk_estado` (`estado_id`),
  KEY `fk_usuario_baja_27` (`baja_usuario_id`),
  KEY `fk_usuario_mod_27` (`modificacion_usuario_id`),
  CONSTRAINT `fk_estado` FOREIGN KEY (`estado_id`) REFERENCES `ordenes_de_produccion_estados` (`id`),
  CONSTRAINT `fk_ficha_tecnica_1` FOREIGN KEY (`ficha_tecnica_id`) REFERENCES `fichas_tecnicas` (`id`),
  CONSTRAINT `fk_recepcion_4` FOREIGN KEY (`recepcion_tecnica_id`) REFERENCES `recepciones_tecnicas` (`id`),
  CONSTRAINT `fk_usuario_alta_27` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_27` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_27` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `chk_cantidad_fabricada` CHECK (`cantidad_fabricada` >= 0),
  CONSTRAINT `chk_cantidad_mp` CHECK (`cantidad_mp_asignada` > 0),
  CONSTRAINT `ch_cantidad_3` CHECK (`cantidad` >= 0)
) ENGINE=InnoDB AUTO_INCREMENT=1000118 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_de_produccion_archivos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_de_produccion_archivos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `estudio_id` int(11) NOT NULL,
  `nombre` varchar(60) NOT NULL,
  `nombre_wd` varchar(20) NOT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `fk_op_archivos` (`estudio_id`),
  KEY `fk_usuario_alta_60` (`alta_usuario_id`),
  CONSTRAINT `fk_op_archivos` FOREIGN KEY (`estudio_id`) REFERENCES `ordenes_de_produccion_estudios` (`id`),
  CONSTRAINT `fk_usuario_alta_60` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_de_produccion_cantidades`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_de_produccion_cantidades` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `orden_de_produccion_id` int(11) NOT NULL,
  `cantidad_anterior` int(11) NOT NULL,
  `cantidad_nueva` int(11) NOT NULL,
  `comentarios` varchar(255) NOT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `fk_usuario_alta_58` (`alta_usuario_id`),
  KEY `fk_op_cant` (`orden_de_produccion_id`),
  CONSTRAINT `fk_op_cant` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `fk_usuario_alta_58` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_de_produccion_comentarios`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_de_produccion_comentarios` (
  `orden_de_produccion_id` int(11) NOT NULL,
  `secuencia` int(11) NOT NULL,
  `comentarios` varchar(255) NOT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`orden_de_produccion_id`,`secuencia`) USING BTREE,
  KEY `fk_usuario_alta_56` (`alta_usuario_id`),
  CONSTRAINT `fk_op_comentarios` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `fk_usuario_alta_56` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_de_produccion_durezas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_de_produccion_durezas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `orden_de_produccion_id` int(11) NOT NULL,
  `dureza_1` decimal(20,6) NOT NULL,
  `dureza_2` decimal(20,6) NOT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `baja_usuario_id` int(11) DEFAULT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_op_partes` (`orden_de_produccion_id`) USING BTREE,
  KEY `fk_usuario_alta_63` (`alta_usuario_id`),
  KEY `fk_usuario_baja_63` (`baja_usuario_id`),
  KEY `fk_usuario_mod_63` (`modificacion_usuario_id`),
  CONSTRAINT `fk_usuario_alta_63` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_63` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_63` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=27967 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_de_produccion_estados`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_de_produccion_estados` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `descripcion` varchar(40) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `descripcion` (`descripcion`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_de_produccion_estudios`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_de_produccion_estudios` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `orden_de_produccion_id` int(11) NOT NULL,
  `laboratorio_oc` int(11) NOT NULL,
  `es_la_version_vigente` tinyint(1) DEFAULT 1,
  `laboratorio` varchar(100) DEFAULT NULL,
  `fecha_envio_laboratorio` date DEFAULT NULL,
  `fecha_regreso_laboratorio` date DEFAULT NULL,
  `notas` varchar(300) DEFAULT NULL,
  `aprobacion_calidad_usuario_id` int(11) DEFAULT NULL,
  `aprobacion_calidad_fecha_hora` datetime DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `perfil_de_barrada` varchar(4) NOT NULL,
  `probeta_tamano` char(50) DEFAULT NULL,
  `direccion` char(12) DEFAULT NULL,
  `probeta_cantidad` int(11) DEFAULT NULL,
  `biselado` tinyint(1) DEFAULT NULL,
  `soldadura` tinyint(4) DEFAULT NULL,
  `tratamiento_termico_1` varchar(100) DEFAULT NULL,
  `temperatura_1` varchar(15) DEFAULT NULL,
  `tratamiento_termico_2` varchar(100) DEFAULT NULL,
  `temperatura_2` varchar(15) DEFAULT NULL,
  `mb_quimico` tinyint(1) DEFAULT NULL,
  `mb_traccion` tinyint(1) DEFAULT NULL,
  `mb_charpy` tinyint(1) DEFAULT NULL,
  `mb_dureza` tinyint(1) DEFAULT NULL,
  `mb_plegado` tinyint(1) DEFAULT NULL,
  `ma_quimico` tinyint(1) DEFAULT NULL,
  `ma_traccion` tinyint(1) DEFAULT NULL,
  `ma_charpy` tinyint(1) DEFAULT NULL,
  `ma_dureza` tinyint(1) DEFAULT NULL,
  `ma_plegado` tinyint(1) DEFAULT NULL,
  `zac_quimico` tinyint(1) DEFAULT NULL,
  `zac_traccion` tinyint(1) DEFAULT NULL,
  `zac_charpy` tinyint(1) DEFAULT NULL,
  `zac_dureza` tinyint(1) DEFAULT NULL,
  `zac_plegado` tinyint(1) DEFAULT NULL,
  `horno1_id` int(11) DEFAULT NULL,
  `horno1_temperatura` int(11) DEFAULT NULL,
  `horno1_ingreso_fecha_hora` datetime DEFAULT NULL,
  `horno1_egreso_fecha_hora` datetime DEFAULT NULL,
  `horno1_control_legajo` int(11) DEFAULT NULL,
  `horno2_id` int(11) DEFAULT NULL,
  `horno2_temperatura` int(11) DEFAULT NULL,
  `horno2_ingreso_fecha_hora` datetime DEFAULT NULL,
  `horno2_egreso_fecha_hora` datetime DEFAULT NULL,
  `horno2_control_legajo` int(11) DEFAULT NULL,
  `colada_barrada` varchar(20) NOT NULL,
  `agrupacion_calidad_id` int(11) NOT NULL,
  `ensayo_fisico` int(11) DEFAULT NULL,
  `ensayo_quimico` int(11) DEFAULT NULL,
  `otros_ensayos` varchar(50) DEFAULT NULL,
  `corte_fecha` date DEFAULT NULL,
  `corte_tilde` tinyint(1) DEFAULT NULL,
  `curvado_fecha` date DEFAULT NULL,
  `curvado_tilde` tinyint(1) DEFAULT NULL,
  `indicador_soldadura` char(1) DEFAULT NULL,
  `indicador_soldadura_transformacion` char(1) DEFAULT NULL,
  `indicador_transformacion` char(1) DEFAULT NULL,
  `prensa_fecha` date DEFAULT NULL,
  `prensa_tilde` tinyint(1) DEFAULT NULL,
  `soldadura_empresa` int(2) DEFAULT NULL,
  `soldadura_fecha` date DEFAULT NULL,
  `soldadura_legajo` int(2) DEFAULT NULL,
  `soldadura_tilde` tinyint(1) DEFAULT NULL,
  `ubic_axial` varchar(50) DEFAULT NULL,
  `indicaciones40` varchar(100) DEFAULT NULL,
  `titulo` varchar(10) DEFAULT NULL,
  `tipo_probetero` varchar(100) DEFAULT NULL,
  `indicaciones_6` varchar(100) DEFAULT NULL,
  `indicaciones_7y8` varchar(250) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `fk_op_estudio` (`orden_de_produccion_id`,`alta_fecha_hora`) USING BTREE,
  KEY `fk_usuario_alta_31` (`alta_usuario_id`),
  KEY `fk_aprobador_calidad_1` (`aprobacion_calidad_usuario_id`),
  KEY `fk_ope_horno_1` (`horno1_id`),
  KEY `fk_ope_horno_2` (`horno2_id`),
  CONSTRAINT `fk_aprobador_calidad_1` FOREIGN KEY (`aprobacion_calidad_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_op_estudio` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `fk_ope_horno_1` FOREIGN KEY (`horno1_id`) REFERENCES `maquinas_herramientas` (`id`),
  CONSTRAINT `fk_ope_horno_2` FOREIGN KEY (`horno2_id`) REFERENCES `maquinas_herramientas` (`id`),
  CONSTRAINT `fk_usuario_alta_31` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=89716 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_de_produccion_estudios_detalle`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_de_produccion_estudios_detalle` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `estudio_id` int(11) NOT NULL,
  `parametro_id` int(11) NOT NULL,
  `elemento` varchar(50) NOT NULL DEFAULT '',
  `valor` varchar(50) NOT NULL DEFAULT '',
  `valor_adicional` varchar(50) DEFAULT NULL,
  `observaciones` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_op_estudio_det` (`estudio_id`),
  CONSTRAINT `fk_op_estudio_det` FOREIGN KEY (`estudio_id`) REFERENCES `ordenes_de_produccion_estudios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=169 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_de_produccion_estudios_historial`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_de_produccion_estudios_historial` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `estudio_id` int(11) NOT NULL,
  `accion` varchar(50) NOT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `fk_usuario_alta_55` (`alta_usuario_id`),
  KEY `fk_estudio_op` (`estudio_id`),
  CONSTRAINT `fk_estudio_op` FOREIGN KEY (`estudio_id`) REFERENCES `ordenes_de_produccion_estudios` (`id`),
  CONSTRAINT `fk_usuario_alta_55` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=98901 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_de_produccion_estudios_partes`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_de_produccion_estudios_partes` (
  `estudio_id` int(11) NOT NULL,
  `parametro_id` int(11) NOT NULL,
  `valor_decimal` decimal(20,6) DEFAULT NULL,
  `valor_texto` varchar(50) DEFAULT NULL,
  UNIQUE KEY `un_barrada_partes` (`estudio_id`,`parametro_id`) USING BTREE,
  KEY `fk_barrada_par` (`parametro_id`),
  CONSTRAINT `fk_barrada_par` FOREIGN KEY (`parametro_id`) REFERENCES `ensayos_parametros` (`id`),
  CONSTRAINT `fk_partes_op` FOREIGN KEY (`estudio_id`) REFERENCES `ordenes_de_produccion_estudios` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_de_produccion_estudios_resultados`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_de_produccion_estudios_resultados` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `estudio_id` int(11) NOT NULL,
  `parametro_id` int(11) NOT NULL,
  `resultado` varchar(150) NOT NULL,
  `resultado_id` int(11) NOT NULL,
  `valor` decimal(15,6) DEFAULT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `fk_barrada_par_r` (`parametro_id`),
  KEY `fk_partes_op_r` (`estudio_id`),
  CONSTRAINT `fk_barrada_par_r` FOREIGN KEY (`parametro_id`) REFERENCES `ensayos_parametros` (`id`),
  CONSTRAINT `fk_partes_op_r` FOREIGN KEY (`estudio_id`) REFERENCES `ordenes_de_produccion_estudios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=17860 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_de_produccion_matriceria`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_de_produccion_matriceria` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `estado_id` int(11) NOT NULL DEFAULT 1,
  `numero` int(11) NOT NULL,
  `tipo_id` int(11) NOT NULL,
  `centro_de_costo_id` int(11) NOT NULL,
  `descripcion` varchar(100) NOT NULL,
  `marca` varchar(80) DEFAULT NULL,
  `fecha_objetivo` date NOT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_usuario_alta_26` (`alta_usuario_id`),
  KEY `fk_usuario_baja_26` (`baja_usuario_id`),
  KEY `fk_usuario_mod_26` (`modificacion_usuario_id`),
  KEY `fk_opm_cc` (`centro_de_costo_id`),
  KEY `fk_opm_tipom` (`tipo_id`),
  CONSTRAINT `fk_opm_cc` FOREIGN KEY (`centro_de_costo_id`) REFERENCES `centros_de_costo` (`id`),
  CONSTRAINT `fk_opm_tipom` FOREIGN KEY (`tipo_id`) REFERENCES `maquinas_herramientas_tipos` (`id`),
  CONSTRAINT `fk_usuario_alta_26` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_26` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_26` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_de_produccion_pesadas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_de_produccion_pesadas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `orden_de_produccion_id` int(11) NOT NULL,
  `peso_neto` decimal(20,3) DEFAULT NULL,
  `fecha_p` date DEFAULT NULL,
  `fecha_c` date DEFAULT NULL,
  `marca_1` char(1) DEFAULT NULL,
  `marca_2` char(1) DEFAULT NULL,
  `marca_3` char(1) DEFAULT NULL,
  `marca_4` char(1) DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `p_usuario_id` int(11) DEFAULT NULL,
  `c_usuario_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `orden_de_produccion_id` (`orden_de_produccion_id`),
  UNIQUE KEY `orden_de_produccion_id_2` (`orden_de_produccion_id`),
  KEY `fk_op_pesada` (`orden_de_produccion_id`),
  KEY `fk_usuario_alta_61` (`alta_usuario_id`),
  KEY `fk_usuario_p` (`p_usuario_id`),
  KEY `fk_usuario_c` (`c_usuario_id`),
  CONSTRAINT `fk_op_pesada` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `fk_usuario_c` FOREIGN KEY (`c_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_p` FOREIGN KEY (`p_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=36 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_de_produccion_planificacion`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_de_produccion_planificacion` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `orden_de_produccion_id` int(11) NOT NULL,
  `fecha_firme` datetime NOT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `orden_de_produccion_id` (`orden_de_produccion_id`),
  KEY `fk_usuario_alta_66` (`alta_usuario_id`),
  KEY `fk_usuario_mod_66` (`modificacion_usuario_id`),
  CONSTRAINT `fk_op_planif` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `fk_usuario_alta_66` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_66` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_de_produccion_ultima_letra`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_de_produccion_ultima_letra` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `letra` varchar(4) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_de_produccion_ventas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_de_produccion_ventas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `orden_de_produccion_id` int(11) NOT NULL,
  `cliente_id` int(11) NOT NULL,
  `pedido_nro` int(11) NOT NULL,
  `pedido_cantidad` int(11) DEFAULT NULL,
  `observaciones` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_op_ventas` (`orden_de_produccion_id`,`pedido_nro`),
  KEY `fk_op_venta_cliente` (`cliente_id`),
  CONSTRAINT `fk_op_adicional` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `fk_op_venta_cliente` FOREIGN KEY (`cliente_id`) REFERENCES `proveedores_y_clientes` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_de_trabajo`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_de_trabajo` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `numero` int(11) NOT NULL,
  `empresa` int(11) DEFAULT NULL,
  `centro_de_costo_id` int(11) DEFAULT NULL,
  `maquina_id` int(11) DEFAULT NULL,
  `tipo_de_tarea_id` int(11) NOT NULL,
  `solicitante` varchar(50) DEFAULT NULL,
  `fecha_pedido` date NOT NULL DEFAULT curdate(),
  `fecha_estimada_inicio` date DEFAULT NULL,
  `fecha_estimada_fin` date DEFAULT NULL,
  `fecha_hora_fin` datetime DEFAULT NULL,
  `cant_estimada_horas` int(11) DEFAULT NULL,
  `cant_estimada_dias` int(11) DEFAULT NULL,
  `mp_reales` decimal(20,6) DEFAULT NULL,
  `repuesto_reales` decimal(20,6) DEFAULT NULL,
  `cant_horas` decimal(20,6) DEFAULT NULL,
  `otros_gastos` decimal(20,6) DEFAULT NULL,
  `usuario_cierre_id` int(11) DEFAULT NULL,
  `comentarios_inicio` varchar(2000) DEFAULT NULL,
  `cc_responsable` int(11) DEFAULT NULL,
  `hora_inicio` datetime DEFAULT NULL,
  `hora_entrega` datetime DEFAULT NULL,
  `feriados` char(1) DEFAULT NULL,
  `parada` char(1) DEFAULT NULL,
  `total_horas_uso_x_dia` decimal(20,6) DEFAULT NULL,
  `hora_inicio_maq` datetime DEFAULT NULL,
  `total_horas_parada` decimal(20,6) DEFAULT NULL,
  `alta_usuario_id` int(11) DEFAULT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  `sabados` char(1) DEFAULT NULL,
  `domingos` char(1) DEFAULT NULL,
  `comentarios_fin` varchar(1500) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `UK_ORDEN_TRABAJO` (`numero`),
  KEY `fk_usuario_alta_18` (`alta_usuario_id`),
  KEY `fk_usuario_baja_18` (`baja_usuario_id`),
  KEY `fk_usuario_mod_18` (`modificacion_usuario_id`),
  KEY `fk_ot_cc` (`centro_de_costo_id`),
  KEY `fk_ot_mh` (`maquina_id`),
  KEY `fk_usuario_cierre_ot` (`usuario_cierre_id`),
  CONSTRAINT `fk_ot_cc` FOREIGN KEY (`centro_de_costo_id`) REFERENCES `centros_de_costo` (`id`),
  CONSTRAINT `fk_ot_mh` FOREIGN KEY (`maquina_id`) REFERENCES `maquinas_herramientas` (`id`),
  CONSTRAINT `fk_usuario_alta_18` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_18` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_cierre_ot` FOREIGN KEY (`usuario_cierre_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_18` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=53288 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ordenes_retenidas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ordenes_retenidas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `articulo` int(11) NOT NULL,
  `alternativa` int(11) DEFAULT NULL,
  `produccion_fecha` date DEFAULT NULL,
  `etapa_subetapa_id` int(11) DEFAULT NULL,
  `letra_op` varchar(50) DEFAULT NULL,
  `orden_produccion` int(11) NOT NULL,
  `letra_op_nueva` varchar(50) DEFAULT NULL,
  `articulo_nuevo` int(11) DEFAULT NULL,
  `orden_produccion_nueva` int(11) NOT NULL,
  `alternativa_nueva` int(11) DEFAULT NULL,
  `retencion_fecha` date DEFAULT NULL,
  `cantidad_retenida` int(11) DEFAULT NULL,
  `liberacion_fecha` date DEFAULT NULL,
  `liberacion_usuario_id` int(11) DEFAULT NULL,
  `op_nueva_fecha` date DEFAULT NULL,
  `op_nueva_usuario_id` int(11) DEFAULT NULL,
  `retrabajo_numero` int(11) DEFAULT NULL,
  `ft_id` int(11) DEFAULT NULL,
  `ft_nueva_id` int(11) DEFAULT NULL,
  `alta_usuario_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `orden_produccion` (`orden_produccion`,`orden_produccion_nueva`)
) ENGINE=InnoDB AUTO_INCREMENT=1494 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `partes_diarios_declaracion_de_consumos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `partes_diarios_declaracion_de_consumos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `maquina_id` int(11) NOT NULL,
  `orden_de_produccion_id` int(11) NOT NULL,
  `cantidad` decimal(15,3) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `fecha` date NOT NULL,
  `id_erp` int(11) DEFAULT NULL,
  `es_migrado` tinyint(1) NOT NULL DEFAULT 0,
  `es_automatico` tinyint(1) NOT NULL DEFAULT 0,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_pd_consumo` (`alta_fecha_hora`,`maquina_id`,`orden_de_produccion_id`),
  UNIQUE KEY `id_erp` (`id_erp`),
  KEY `fk_maquina_2` (`maquina_id`),
  KEY `fk_op_consumo` (`orden_de_produccion_id`),
  CONSTRAINT `fk_maquina_2` FOREIGN KEY (`maquina_id`) REFERENCES `maquinas_herramientas` (`id`),
  CONSTRAINT `fk_op_consumo` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=313619 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `partes_diarios_declaracion_de_horas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `partes_diarios_declaracion_de_horas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `maquina_id` int(11) DEFAULT NULL,
  `orden_de_produccion_id` int(11) DEFAULT NULL,
  `proceso_id` int(11) DEFAULT NULL,
  `horario_desde` datetime DEFAULT NULL,
  `horario_hasta` datetime DEFAULT NULL,
  `motivo_interrupcion_id` int(11) DEFAULT NULL,
  `cant_ok` int(11) DEFAULT NULL,
  `cant_mal` int(11) DEFAULT NULL,
  `legajo` int(11) DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  `etapa_subetapa_id` int(11) DEFAULT NULL,
  `observaciones` varchar(50) DEFAULT NULL,
  `turno` int(1) DEFAULT NULL,
  `centro_de_costo_id` int(11) DEFAULT NULL,
  `tipo_maquina` int(11) DEFAULT NULL,
  `empresa` int(11) DEFAULT NULL,
  `nro_retrabajo` int(11) DEFAULT NULL,
  `horas_total` decimal(6,2) DEFAULT NULL,
  `horas_setup` decimal(6,2) DEFAULT NULL,
  `horas_netas` decimal(6,2) DEFAULT NULL,
  `fecha` date NOT NULL,
  `consumo_id` int(11) DEFAULT NULL,
  `etapa_terminado_id` int(11) DEFAULT NULL,
  `orden_de_trabajo_id` int(11) DEFAULT NULL,
  `retrabajo_proceso_id` int(11) DEFAULT NULL,
  `operacion_provisoria_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `UK_PK` (`horario_desde`,`maquina_id`) USING BTREE,
  KEY `fk_usuario_alta_32` (`alta_usuario_id`),
  KEY `fk_usuario_mod_32` (`modificacion_usuario_id`),
  KEY `fk_maquina_1` (`maquina_id`),
  KEY `fk_proceso_3` (`proceso_id`),
  KEY `fk_op_horas` (`orden_de_produccion_id`),
  KEY `fk_interrupcion` (`motivo_interrupcion_id`),
  KEY `fk_consumo_pd` (`consumo_id`),
  KEY `fk_etapater_pd` (`etapa_terminado_id`),
  KEY `fk_partes_ot` (`orden_de_trabajo_id`),
  KEY `fk_partes_retrabajos_p` (`retrabajo_proceso_id`),
  KEY `fk_partes_oprov` (`operacion_provisoria_id`),
  CONSTRAINT `fk_consumo_pd` FOREIGN KEY (`consumo_id`) REFERENCES `partes_diarios_declaracion_de_consumos` (`id`),
  CONSTRAINT `fk_etapater_pd` FOREIGN KEY (`etapa_terminado_id`) REFERENCES `ingresos_produccion` (`id`),
  CONSTRAINT `fk_interrupcion` FOREIGN KEY (`motivo_interrupcion_id`) REFERENCES `partes_diarios_motivos_interrupcion` (`id`),
  CONSTRAINT `fk_maquina_1` FOREIGN KEY (`maquina_id`) REFERENCES `maquinas_herramientas` (`id`),
  CONSTRAINT `fk_op_horas` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `fk_partes_oprov` FOREIGN KEY (`operacion_provisoria_id`) REFERENCES `operaciones_provisorias` (`id`),
  CONSTRAINT `fk_partes_ot` FOREIGN KEY (`orden_de_trabajo_id`) REFERENCES `ordenes_de_trabajo` (`id`),
  CONSTRAINT `fk_partes_retrabajos_p` FOREIGN KEY (`retrabajo_proceso_id`) REFERENCES `retrabajos_detalle` (`id`),
  CONSTRAINT `fk_proceso_3` FOREIGN KEY (`proceso_id`) REFERENCES `fichas_tecnicas_procesos` (`id`),
  CONSTRAINT `fk_usuario_alta_32` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_32` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1183043 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `partes_diarios_motivos_interrupcion`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `partes_diarios_motivos_interrupcion` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `descripcion` varchar(100) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=100 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `perfiles_barrada`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `perfiles_barrada` (
  `agrupacion_calidad` int(11) NOT NULL,
  `descripcion` varchar(50) NOT NULL DEFAULT '',
  `tipo_material` varchar(50) NOT NULL DEFAULT '',
  PRIMARY KEY (`agrupacion_calidad`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `perfiles_barrada_especificaciones`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `perfiles_barrada_especificaciones` (
  `agrupacion_calidad` int(11) NOT NULL,
  `parametro_id` int(11) NOT NULL,
  `valor_minimo` decimal(20,6) DEFAULT NULL,
  `valor_maximo` decimal(20,6) DEFAULT NULL,
  `valor_medio` decimal(20,6) DEFAULT NULL,
  `desvio_standard` decimal(20,6) DEFAULT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `alta_usuario_id` int(11) NOT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `baja_usuario_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`agrupacion_calidad`,`parametro_id`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `perfiles_barrada_parametros`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `perfiles_barrada_parametros` (
  `parametro_id` int(11) NOT NULL AUTO_INCREMENT,
  `codigo` varchar(10) NOT NULL,
  `descripcion` varchar(50) DEFAULT NULL,
  `unidad_de_medida_id` int(11) DEFAULT NULL,
  `unidad_de_medida_desc` varchar(50) DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL DEFAULT current_timestamp(),
  `alta_fecha_hora` datetime DEFAULT NULL,
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`parametro_id`),
  UNIQUE KEY `codigo` (`codigo`),
  KEY `fk_usuario_alta_19` (`alta_usuario_id`),
  KEY `fk_usuario_baja_19` (`baja_usuario_id`),
  KEY `fk_usuario_mod_19` (`modificacion_usuario_id`),
  CONSTRAINT `fk_usuario_alta_19` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_19` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_19` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=26 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `periodos_fiscales`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `periodos_fiscales` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) NOT NULL,
  `numero` int(11) NOT NULL,
  `anyo` int(11) NOT NULL,
  `anyo_id_erp` int(11) NOT NULL,
  `descripcion` varchar(50) NOT NULL,
  `fecha_desde` date NOT NULL,
  `fecha_hasta` date NOT NULL,
  `razon_social` varchar(120) NOT NULL,
  `esta_cerrado` tinyint(1) NOT NULL,
  `esta_activo` tinyint(1) NOT NULL DEFAULT 1,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`)
) ENGINE=InnoDB AUTO_INCREMENT=198 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `planificacion_de_ventas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `planificacion_de_ventas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `articulo_id` int(11) NOT NULL,
  `orden_venta` varchar(25) DEFAULT NULL,
  `cantidad` int(11) NOT NULL,
  `fecha_compromiso` datetime NOT NULL,
  `cliente` varchar(100) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_articulo_5` (`articulo_id`),
  CONSTRAINT `fk_articulo_5` FOREIGN KEY (`articulo_id`) REFERENCES `articulos` (`id`),
  CONSTRAINT `ch_cantidad` CHECK (`cantidad` > 0)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `plantas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `plantas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `nombre` varchar(30) NOT NULL,
  `direccion` varchar(80) DEFAULT NULL,
  `cuit` varchar(15) DEFAULT NULL,
  `iibb` varchar(15) DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `nombre` (`nombre`),
  KEY `fk_usuario_alta_39` (`alta_usuario_id`),
  CONSTRAINT `fk_usuario_alta_39` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `plantillas_corte`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `plantillas_corte` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `maquina_id` int(11) DEFAULT NULL,
  `tipo_destino` int(11) NOT NULL,
  `diametro_disco` int(11) DEFAULT NULL,
  `ancho_chapa` int(11) DEFAULT NULL,
  `largo_chapa` int(11) DEFAULT NULL,
  `piezas_chapa` int(11) DEFAULT NULL,
  `sobrante_sistema` int(11) DEFAULT NULL,
  `descripcion` varchar(50) DEFAULT NULL,
  `alta_usuario_id` int(11) DEFAULT NULL,
  `alta_fecha_hora` datetime DEFAULT NULL,
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `UK1` (`maquina_id`,`diametro_disco`,`ancho_chapa`,`largo_chapa`),
  KEY `fk_usuario_alta_20` (`alta_usuario_id`),
  KEY `fk_usuario_baja_20` (`baja_usuario_id`),
  KEY `fk_usuario_mod_20` (`modificacion_usuario_id`),
  KEY `fk_plantilla_maq` (`maquina_id`),
  CONSTRAINT `fk_usuario_alta_20` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_20` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_20` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6503 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `produccion_movimientos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `produccion_movimientos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `orden_de_produccion_id` int(11) NOT NULL,
  `fecha_produccion` date DEFAULT NULL,
  `numero_produccion` int(11) DEFAULT NULL,
  `numero_articulo` int(11) DEFAULT NULL,
  `origen` char(2) DEFAULT NULL,
  `transaccion` int(11) DEFAULT NULL,
  `cantidad` decimal(20,6) DEFAULT NULL,
  `secuencia` int(11) DEFAULT NULL,
  `marca_control` char(50) DEFAULT NULL,
  `marca_info` char(50) DEFAULT NULL,
  `fecha_control_calidad` date DEFAULT NULL,
  `alta_usuario_id` int(11) DEFAULT NULL,
  `hora_sistema` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_usuario_alta_21` (`alta_usuario_id`),
  KEY `fk_op_pf_mov` (`orden_de_produccion_id`),
  CONSTRAINT `fk_op_pf_mov` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `fk_usuario_alta_21` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `productos_fabricados`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `productos_fabricados` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) DEFAULT NULL,
  `descripcion` varchar(100) NOT NULL,
  `tipo_id` int(11) NOT NULL,
  `familia_id` int(11) NOT NULL,
  `espesor_id` int(11) NOT NULL,
  `calidad_id` int(11) NOT NULL,
  `medida_1` int(11) DEFAULT NULL,
  `medida_2` int(11) DEFAULT NULL,
  `norma_id` int(11) NOT NULL,
  `unidad_de_medida_id` int(11) NOT NULL,
  `stock_critico` int(11) NOT NULL,
  `stock_minimo` int(11) NOT NULL,
  `peso_bruto` decimal(10,3) DEFAULT NULL,
  `peso_neto` decimal(10,3) DEFAULT NULL,
  `deposito_id` int(11) DEFAULT NULL,
  `orden` int(11) DEFAULT NULL,
  `campo_libre1` char(1) DEFAULT NULL,
  `campo_libre2` char(1) DEFAULT NULL,
  `unidad_x_bulto` decimal(20,6) DEFAULT NULL,
  `fecha_ultima_compra` datetime DEFAULT NULL,
  `iva_codigo` int(11) DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`),
  KEY `fk_usuario_alta_8` (`alta_usuario_id`),
  KEY `fk_usuario_baja_8` (`baja_usuario_id`),
  KEY `fk_tipo_pf` (`tipo_id`),
  KEY `fk_familia_1` (`familia_id`),
  KEY `fk_espesor` (`espesor_id`),
  KEY `fk_calidad_1` (`calidad_id`),
  KEY `fk_norma` (`norma_id`),
  KEY `fk_medida_1` (`unidad_de_medida_id`),
  KEY `fk_deposito_2` (`deposito_id`),
  KEY `fk_usuario_mod_8` (`modificacion_usuario_id`),
  CONSTRAINT `fk_calidad_1` FOREIGN KEY (`calidad_id`) REFERENCES `productos_fabricados_calidades` (`id`),
  CONSTRAINT `fk_deposito_2` FOREIGN KEY (`deposito_id`) REFERENCES `depositos` (`id`),
  CONSTRAINT `fk_espesor` FOREIGN KEY (`espesor_id`) REFERENCES `productos_fabricados_espesores` (`id`),
  CONSTRAINT `fk_familia_1` FOREIGN KEY (`familia_id`) REFERENCES `productos_fabricados_familias` (`id`),
  CONSTRAINT `fk_medida_1` FOREIGN KEY (`unidad_de_medida_id`) REFERENCES `unidades_de_medida` (`id`),
  CONSTRAINT `fk_norma` FOREIGN KEY (`norma_id`) REFERENCES `productos_fabricados_normas` (`id`),
  CONSTRAINT `fk_tipo_pf` FOREIGN KEY (`tipo_id`) REFERENCES `productos_fabricados_tipos` (`id`),
  CONSTRAINT `fk_usuario_alta_8` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_8` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_8` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=99039112 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `productos_fabricados_calidades`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `productos_fabricados_calidades` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) DEFAULT NULL,
  `descripcion` varchar(80) NOT NULL,
  `descripcion_ingles` varchar(40) NOT NULL,
  `agrupacion_calidad_id` int(11) NOT NULL,
  `medida2` int(11) DEFAULT NULL,
  `norma` int(11) DEFAULT NULL,
  `calidad` int(11) DEFAULT NULL,
  `numero1` int(11) DEFAULT NULL,
  `numero2` int(11) DEFAULT NULL,
  `nomenclador` int(11) DEFAULT NULL,
  `orden` int(11) DEFAULT NULL,
  `cod_as400` varchar(5) CHARACTER SET utf8mb3 COLLATE utf8mb3_bin DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  `revision_año` int(4) DEFAULT NULL,
  `adenda_año` int(4) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`),
  UNIQUE KEY `UK1` (`cod_as400`),
  KEY `fk_usuario_alta_29` (`alta_usuario_id`),
  KEY `fk_usuario_baja_29` (`baja_usuario_id`),
  KEY `fk_usuario_mod_29` (`modificacion_usuario_id`),
  KEY `fk_agrupa` (`agrupacion_calidad_id`),
  CONSTRAINT `fk_agrupa` FOREIGN KEY (`agrupacion_calidad_id`) REFERENCES `agrupaciones_calidades` (`id`),
  CONSTRAINT `fk_usuario_alta_29` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_29` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_29` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2686 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `productos_fabricados_entregas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `productos_fabricados_entregas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `orden_de_produccion_id` int(11) NOT NULL,
  `fecha_entrega` date DEFAULT NULL,
  `alta_usuario_id` int(11) DEFAULT NULL,
  `alta_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_usuario_mod_22` (`modificacion_usuario_id`),
  KEY `fk_op_entregas` (`alta_usuario_id`),
  CONSTRAINT `fk_op_entregas` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_alta_22` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_22` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `productos_fabricados_espesores`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `productos_fabricados_espesores` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) DEFAULT NULL,
  `descripcion` varchar(40) NOT NULL,
  `campo_libre` varchar(40) DEFAULT NULL,
  `codigo` varchar(9) CHARACTER SET utf8mb3 COLLATE utf8mb3_bin DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`),
  UNIQUE KEY `UK1` (`codigo`),
  KEY `fk_usuario_alta_30` (`alta_usuario_id`),
  KEY `fk_usuario_baja_30` (`baja_usuario_id`),
  KEY `fk_usuario_mod_30` (`modificacion_usuario_id`),
  CONSTRAINT `fk_usuario_alta_30` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_30` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_30` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2745 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `productos_fabricados_familias`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `productos_fabricados_familias` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) DEFAULT NULL,
  `descripcion` varchar(40) NOT NULL,
  `descripcion_ingles` varchar(40) NOT NULL,
  `medida2` int(11) DEFAULT NULL,
  `norma` int(11) DEFAULT NULL,
  `orden` int(11) DEFAULT NULL,
  `calidad` int(11) DEFAULT NULL,
  `numero1` int(11) DEFAULT NULL,
  `numero2` int(11) DEFAULT NULL,
  `nomenclador` int(11) DEFAULT NULL,
  `cod_as400` varchar(5) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `descripcion` (`descripcion`),
  UNIQUE KEY `id_erp` (`id_erp`),
  UNIQUE KEY `UK1` (`cod_as400`)
) ENGINE=InnoDB AUTO_INCREMENT=60 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `productos_fabricados_normas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `productos_fabricados_normas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) DEFAULT NULL,
  `descripcion` varchar(40) NOT NULL,
  `observaciones` varchar(100) DEFAULT NULL,
  `codigo` varchar(9) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL,
  `campo_libre` varchar(40) DEFAULT NULL,
  `campo_libre2` varchar(40) DEFAULT NULL,
  `revision_año` year(4) DEFAULT NULL,
  `adenda_año` year(4) DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `codigo` (`codigo`),
  UNIQUE KEY `id_erp` (`id_erp`),
  KEY `fk_usuario_alta_28` (`alta_usuario_id`),
  KEY `fk_usuario_baja_28` (`baja_usuario_id`),
  KEY `fk_usuario_mod_28` (`modificacion_usuario_id`),
  CONSTRAINT `fk_usuario_alta_28` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_28` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_28` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=43 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `productos_fabricados_tipos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `productos_fabricados_tipos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `descripcion` varchar(40) NOT NULL,
  `tipo_de_factura_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `descripcion` (`descripcion`)
) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `programas_auxiliares`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `programas_auxiliares` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `definicion` text NOT NULL,
  `descripcion` varchar(80) NOT NULL,
  `ejecucion` varchar(300) NOT NULL,
  `es_la_version_vigente` tinyint(1) NOT NULL DEFAULT 1,
  `nombre` varchar(50) NOT NULL,
  `nombre_de_la_funcion` varchar(50) NOT NULL,
  `parametro_de_salida` varchar(20) NOT NULL,
  `parametro_de_salida_descripcion` varchar(255) NOT NULL,
  `parametros_de_entrada` varchar(200) NOT NULL,
  `parametros_de_entrada_descripcion` varchar(300) NOT NULL,
  `programa_auxiliar_id` int(11) NOT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `tablas_manipulables` text DEFAULT NULL,
  `programa_auxiliar_padre_id` int(11) DEFAULT NULL,
  `observaciones` varchar(200) NOT NULL DEFAULT '',
  PRIMARY KEY (`id`),
  KEY `fk_usuario_alta_46` (`alta_usuario_id`),
  CONSTRAINT `fk_usuario_alta_46` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=313 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `proveedores_y_clientes`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `proveedores_y_clientes` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) DEFAULT NULL,
  `nombre` varchar(150) NOT NULL,
  `cuit` varchar(15) DEFAULT NULL,
  `es_cliente` tinyint(1) NOT NULL,
  `es_proveedor` tinyint(1) NOT NULL,
  `es_proveedor_de_produccion` tinyint(1) NOT NULL,
  `esta_activo` tinyint(1) NOT NULL DEFAULT 1,
  `es_empleado` tinyint(1) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`)
) ENGINE=InnoDB AUTO_INCREMENT=11078 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `radiografias`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `radiografias` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `orden_de_produccion_id` int(11) NOT NULL,
  `etapa_subetapa_id` int(11) NOT NULL,
  `ficha_tecnica_id` int(11) NOT NULL,
  `costuras` int(11) DEFAULT NULL,
  `reparada` char(2) DEFAULT NULL,
  `cant_reparadas` int(11) DEFAULT NULL,
  `estado` char(2) DEFAULT NULL,
  `informe_rx` char(9) NOT NULL,
  `certificado_rx` int(11) DEFAULT NULL,
  `remito` int(11) DEFAULT NULL,
  `cliente` int(11) DEFAULT NULL,
  `nro_item` int(11) DEFAULT NULL,
  `transf_letra` char(4) DEFAULT NULL,
  `transf_op` int(11) DEFAULT NULL,
  `transf_articulo` int(11) DEFAULT NULL,
  `ensayo` int(11) DEFAULT NULL,
  `carga_usuario_id` int(11) DEFAULT NULL,
  `alta_comprobante_usuario_id` int(11) DEFAULT NULL,
  `alta_comprobante_fecha` date DEFAULT NULL,
  `comprobante_fecha` date DEFAULT NULL,
  `alta_rx_usuario_id` int(11) DEFAULT NULL,
  `alta_rx_fecha_hora` datetime DEFAULT NULL,
  `modificacion_comprobante_usuario_id` int(11) DEFAULT NULL,
  `modificacion_comprobante_fecha` date DEFAULT NULL,
  `modificacion_rx_usuario_id` int(11) DEFAULT NULL,
  `modificacion_rx_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `UK1` (`informe_rx`),
  KEY `fk_usuario_carga` (`carga_usuario_id`),
  KEY `fk_usuario_compr` (`alta_comprobante_usuario_id`),
  KEY `fk_usuario_rx` (`alta_rx_usuario_id`),
  KEY `fk_usuario_mod_c` (`modificacion_comprobante_usuario_id`),
  KEY `fk_usuario_mod_rx` (`modificacion_rx_usuario_id`),
  KEY `fk_radio_op` (`orden_de_produccion_id`),
  CONSTRAINT `fk_radio_op` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `fk_usuario_carga` FOREIGN KEY (`carga_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_compr` FOREIGN KEY (`alta_comprobante_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_c` FOREIGN KEY (`modificacion_comprobante_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_rx` FOREIGN KEY (`modificacion_rx_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_rx` FOREIGN KEY (`alta_rx_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=70674 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `radiografias_uniones`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `radiografias_uniones` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `radiografia_id` int(11) NOT NULL,
  `informe_rx_grupo` char(9) NOT NULL,
  `secuencia` int(11) DEFAULT NULL,
  `estado` char(1) DEFAULT NULL,
  `termina_usuario_id` int(11) DEFAULT NULL,
  `termina_fecha_hora` datetime DEFAULT NULL,
  `inspeccion_usuario_id` int(11) DEFAULT NULL,
  `inspeccion_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `fk_radiografia` (`radiografia_id`) USING BTREE,
  KEY `fk_usuario_ter` (`termina_usuario_id`),
  KEY `fk_usuario_insp` (`inspeccion_usuario_id`),
  CONSTRAINT `fk_radiografia` FOREIGN KEY (`radiografia_id`) REFERENCES `radiografias` (`id`),
  CONSTRAINT `fk_usuario_insp` FOREIGN KEY (`inspeccion_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_ter` FOREIGN KEY (`termina_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=66450 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `recepciones_de_mercaderia`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `recepciones_de_mercaderia` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `orden_de_compra_id` int(11) NOT NULL,
  `articulo_id` int(11) NOT NULL,
  `cantidad_recibida` decimal(10,3) NOT NULL,
  `cantidad_recibida_unidades` decimal(10,3) NOT NULL,
  `cantidad_saldo_anterior` decimal(10,3) NOT NULL,
  `cantidad_aprobada` decimal(10,3) DEFAULT NULL,
  `cantidad_aprobada_unidades` decimal(10,3) DEFAULT NULL,
  `cantidad_rechazada` decimal(10,3) DEFAULT NULL,
  `cantidad_rechazada_unidades` decimal(10,3) DEFAULT NULL,
  `remito_cod` varchar(30) NOT NULL,
  `remito_archivo_nombre` varchar(60) NOT NULL,
  `remito_archivo_nombre_wd` varchar(20) NOT NULL,
  `remito_id_erp` int(11) DEFAULT NULL,
  `remito_devolucion_id_erp` int(11) DEFAULT NULL,
  `recepcion_tecnica_id` int(11) DEFAULT NULL,
  `inspeccion_fecha_hora` datetime DEFAULT NULL,
  `inspeccion_usuario_id` int(11) DEFAULT NULL,
  `inspeccionado` tinyint(1) DEFAULT 0,
  `motivo_de_rechazo` varchar(300) DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `asiento_contable_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_usuario_alta_24` (`alta_usuario_id`),
  KEY `fk_orden_2` (`orden_de_compra_id`),
  KEY `fk_articulo_7` (`articulo_id`),
  KEY `fk_usuario_2` (`inspeccion_usuario_id`),
  KEY `fk_recepcion_tec` (`recepcion_tecnica_id`),
  KEY `fk_recepciones_de_mercaderia_asientos_contables` (`asiento_contable_id`),
  CONSTRAINT `fk_articulo_7` FOREIGN KEY (`articulo_id`) REFERENCES `articulos` (`id`),
  CONSTRAINT `fk_orden_2` FOREIGN KEY (`orden_de_compra_id`) REFERENCES `ordenes_de_compra` (`id`),
  CONSTRAINT `fk_recepcion_tec` FOREIGN KEY (`recepcion_tecnica_id`) REFERENCES `recepciones_tecnicas` (`id`),
  CONSTRAINT `fk_recepciones_de_mercaderia_asientos_contables` FOREIGN KEY (`asiento_contable_id`) REFERENCES `asientos_contables` (`id`),
  CONSTRAINT `fk_usuario_2` FOREIGN KEY (`inspeccion_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_alta_24` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `chk_cantidad_recibida_2` CHECK (`cantidad_recibida` > 0),
  CONSTRAINT `chk_cantidad_aprobada_1` CHECK (`cantidad_aprobada` >= 0),
  CONSTRAINT `chk_cantidad_aprobadau_1` CHECK (`cantidad_aprobada_unidades` >= 0),
  CONSTRAINT `chk_cantidad_rechazada_1` CHECK (`cantidad_rechazada` >= 0),
  CONSTRAINT `chk_cantidad_rechazadau_1` CHECK (`cantidad_rechazada_unidades` >= 0),
  CONSTRAINT `chk_cantidad_aprobada_2` CHECK (`cantidad_aprobada` <= `cantidad_recibida`),
  CONSTRAINT `chk_cantidad_rechazada_2` CHECK (`cantidad_rechazada` <= `cantidad_recibida`)
) ENGINE=InnoDB AUTO_INCREMENT=128 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `recepciones_tecnicas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `recepciones_tecnicas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `articulo_id` int(11) NOT NULL,
  `proveedor_id` int(11) NOT NULL,
  `colada` varchar(15) NOT NULL,
  `color_id` int(11) DEFAULT NULL,
  `agrupacion_calidad_id` int(11) DEFAULT NULL,
  `es_la_version_vigente` tinyint(1) NOT NULL DEFAULT 1,
  `aprobacion_calidad_usuario_id` int(11) DEFAULT NULL,
  `aprobacion_calidad_fecha_hora` datetime DEFAULT NULL,
  `secuencia_analisis` int(11) DEFAULT NULL,
  `fecha_pedido` datetime DEFAULT NULL,
  `orden_compra` int(11) DEFAULT NULL,
  `laboratorio` varchar(50) DEFAULT NULL,
  `laboratorio_oc` int(11) DEFAULT NULL,
  `ensayo_fisico` int(11) DEFAULT NULL,
  `ensayo_quimico` int(11) DEFAULT NULL,
  `otros_ensayos` varchar(50) DEFAULT NULL,
  `certificado` varchar(100) DEFAULT NULL,
  `metros_unidades` decimal(20,6) DEFAULT NULL,
  `cant_orden_prod` int(11) DEFAULT NULL,
  `codigo_empresa` int(11) DEFAULT NULL,
  `fabricante_desc` varchar(50) DEFAULT NULL,
  `color_desc` varchar(50) DEFAULT NULL,
  `material_desc` varchar(50) DEFAULT NULL,
  `pqrsoldadura` varchar(15) DEFAULT NULL,
  `usina_cod` varchar(50) DEFAULT NULL,
  `usina_archivo_nombre` varchar(60) DEFAULT NULL,
  `usina_archivo_nombre_wd` varchar(20) DEFAULT NULL,
  `dimensional_archivo_nombre` varchar(60) DEFAULT NULL,
  `dimensional_archivo_nombre_wd` varchar(20) DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `baja_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  `observaciones_certificado` varchar(50) DEFAULT NULL,
  `es_material_de_terceros` tinyint(1) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `UK1` (`articulo_id`,`fecha_pedido`,`secuencia_analisis`,`colada`),
  KEY `fk_usuario_alta_23` (`alta_usuario_id`),
  KEY `fk_usuario_baja_23` (`baja_usuario_id`),
  KEY `fk_color` (`color_id`),
  KEY `fk_colada_prov` (`proveedor_id`),
  KEY `fk_aprobador_calidad` (`aprobacion_calidad_usuario_id`),
  KEY `fk_agrupa_2` (`agrupacion_calidad_id`),
  CONSTRAINT `FK_recepciones_tecnicas_articulos` FOREIGN KEY (`articulo_id`) REFERENCES `articulos` (`id`),
  CONSTRAINT `fk_agrupa_2` FOREIGN KEY (`agrupacion_calidad_id`) REFERENCES `agrupaciones_calidades` (`id`),
  CONSTRAINT `fk_aprobador_calidad` FOREIGN KEY (`aprobacion_calidad_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_colada_prov` FOREIGN KEY (`proveedor_id`) REFERENCES `proveedores_y_clientes` (`id`),
  CONSTRAINT `fk_color` FOREIGN KEY (`color_id`) REFERENCES `colores` (`id`),
  CONSTRAINT `fk_usuario_alta_23` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_23` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=76993 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `recepciones_tecnicas_historial`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `recepciones_tecnicas_historial` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `alta_usuario_id` int(11) NOT NULL,
  `recepcion_tecnica_id` int(11) NOT NULL,
  `accion` varchar(50) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `UK1` (`recepcion_tecnica_id`,`alta_fecha_hora`),
  KEY `fk_usuario_1` (`alta_usuario_id`),
  KEY `fk_recepcion_3` (`recepcion_tecnica_id`),
  CONSTRAINT `fk_recepcion_3` FOREIGN KEY (`recepcion_tecnica_id`) REFERENCES `recepciones_tecnicas` (`id`),
  CONSTRAINT `fk_usuario_alta_54` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=131335 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `recepciones_tecnicas_partes`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `recepciones_tecnicas_partes` (
  `recepcion_tecnica_id` int(11) NOT NULL,
  `valor_decimal` decimal(20,6) DEFAULT NULL,
  `valor_texto` varchar(50) DEFAULT NULL,
  `parametro_id` int(11) NOT NULL,
  UNIQUE KEY `un_colada_partes` (`recepcion_tecnica_id`,`parametro_id`) USING BTREE,
  KEY `fk_colada_par` (`parametro_id`),
  CONSTRAINT `fk_colada_par` FOREIGN KEY (`parametro_id`) REFERENCES `ensayos_parametros` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `recepciones_tecnicas_resultados`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `recepciones_tecnicas_resultados` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `recepcion_tecnica_id` int(11) NOT NULL,
  `parametro_id` int(11) NOT NULL,
  `resultado` varchar(150) NOT NULL,
  `resultado_id` int(11) NOT NULL,
  `valor` decimal(15,6) DEFAULT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `fk_colada_par_r` (`parametro_id`),
  KEY `fk_partes_rt_r` (`recepcion_tecnica_id`),
  CONSTRAINT `fk_colada_par_r` FOREIGN KEY (`parametro_id`) REFERENCES `ensayos_parametros` (`id`),
  CONSTRAINT `fk_partes_rt_r` FOREIGN KEY (`recepcion_tecnica_id`) REFERENCES `recepciones_tecnicas` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=145386 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `recepciones_tecnicas_resultados_vieja`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `recepciones_tecnicas_resultados_vieja` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `recepcion_tecnica_id` int(11) DEFAULT NULL,
  `parametro_id` int(11) DEFAULT NULL,
  `resultado` varchar(100) DEFAULT NULL,
  `valor` double DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=49676 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `recepciones_tecnicas_tipos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `recepciones_tecnicas_tipos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `descripcion` varchar(50) NOT NULL,
  `valor` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `descripcion` (`descripcion`),
  UNIQUE KEY `valor` (`valor`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `registros_mrp`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `registros_mrp` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `contempla_compras` tinyint(1) NOT NULL,
  `contempla_pendientes_inspeccion` tinyint(1) NOT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `fk_usuario_alta_25` (`alta_usuario_id`),
  CONSTRAINT `fk_usuario_alta_25` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=116 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `registros_mrp_lineas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `registros_mrp_lineas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `mrp_id` int(11) NOT NULL,
  `articulo_id` int(11) NOT NULL,
  `cantidad_demandada` decimal(15,3) NOT NULL,
  `cantidad_disponible` decimal(15,3) NOT NULL,
  `cantidad_pendiente_inspeccion` decimal(15,3) NOT NULL,
  `cantidad_pendiente_recepcion` decimal(15,3) NOT NULL,
  `cantidad_sugerida` decimal(15,3) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_mrp` (`mrp_id`),
  KEY `fk_articulo_mrp` (`articulo_id`),
  CONSTRAINT `fk_articulo_mrp` FOREIGN KEY (`articulo_id`) REFERENCES `articulos` (`id`),
  CONSTRAINT `fk_mrp` FOREIGN KEY (`mrp_id`) REFERENCES `registros_mrp` (`id`),
  CONSTRAINT `ch_mrp_cant_1` CHECK (`cantidad_demandada` >= 0),
  CONSTRAINT `ch_mrp_cant_2` CHECK (`cantidad_disponible` >= 0),
  CONSTRAINT `ch_mrp_cant_3` CHECK (`cantidad_pendiente_inspeccion` >= 0),
  CONSTRAINT `ch_mrp_cant_4` CHECK (`cantidad_pendiente_recepcion` >= 0)
) ENGINE=InnoDB AUTO_INCREMENT=390 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `req_especiales_cabecera`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `req_especiales_cabecera` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'MARCA R/O ',
  `marca_r_o` char(1) NOT NULL DEFAULT 'E',
  `numero` int(11) NOT NULL,
  `r_etapa_subetapa_id` int(11) DEFAULT NULL COMMENT 'CODIGO              ETAPA / subetapa',
  `cc_retrabajo` int(11) DEFAULT NULL COMMENT 'C.COSTOS RETRABA',
  `r_alta_fecha` date DEFAULT NULL COMMENT 'Retrabajo Alta',
  `cantidad_retenida` int(11) NOT NULL,
  `cantidad_recuperada` int(11) NOT NULL,
  `orden_de_produccion_id` int(11) NOT NULL,
  `letra` char(4) DEFAULT NULL COMMENT 'CODIGO              LETRAS',
  `producto_fabricado_id` int(11) DEFAULT NULL COMMENT 'NUMERO              ARTICULO',
  `cc_orden_de_produccion` int(11) DEFAULT NULL COMMENT 'C.COSTOS O.PROD.',
  `letra_transferencia_origen` char(50) DEFAULT NULL COMMENT 'TRANSF.LETRA ORIGEN',
  `comentarios_inicio` varchar(300) DEFAULT NULL,
  `ftsn` char(2) DEFAULT NULL COMMENT 'AGREGA FICHA TECNICA',
  `empresa` int(11) DEFAULT NULL,
  `sucursal` int(11) DEFAULT NULL,
  `legajo` int(11) DEFAULT NULL,
  `sector` int(11) DEFAULT NULL COMMENT 'SECTOR',
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `alta_usuario_id` int(11) NOT NULL,
  `nro_remito` int(11) DEFAULT NULL COMMENT 'NUMERO              REMITO',
  `comentarios_fin` varchar(300) DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `numero` (`numero`),
  KEY `fk_op_req_esp` (`orden_de_produccion_id`),
  KEY `fk_usuario_alta_14` (`alta_usuario_id`),
  CONSTRAINT `fk_op_req_esp` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `fk_usuario_alta_14` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=188516 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='Tabla PM212RO';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `req_especiales_detalle`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `req_especiales_detalle` (
  `ficha_tecnica_id` int(11) DEFAULT NULL,
  `fecha_produccion` date DEFAULT NULL,
  `etapa_subetapa_id` int(11) NOT NULL,
  `cantidad_lanzamiento` int(11) DEFAULT NULL,
  `cantidad_producida` int(11) DEFAULT NULL,
  `total_horas_hombre` decimal(20,6) DEFAULT NULL,
  `total_horas_maquina` decimal(20,6) DEFAULT NULL,
  `fecha_parte_diario` date DEFAULT NULL,
  `etapa_subetapa_anterior_id` int(11) DEFAULT NULL,
  `etapa_subetapa_siguiente_id` int(11) DEFAULT NULL,
  `marca_pendiente_final` char(1) DEFAULT NULL,
  `marca_op_emitida` char(1) DEFAULT NULL,
  `orden_de_produccion_id` int(11) DEFAULT NULL,
  `secuencia` int(11) NOT NULL,
  `colada` varchar(10) DEFAULT NULL,
  `articulo_tipo` int(11) DEFAULT NULL,
  `articulo_familia` int(11) DEFAULT NULL,
  `cantidad_descarte` decimal(20,6) DEFAULT NULL,
  `marca_comunicacion` char(1) DEFAULT NULL,
  `año_parte_diario` int(11) DEFAULT NULL,
  `letra` varchar(50) DEFAULT NULL,
  `ficha_tecnica_1_id` int(11) DEFAULT NULL,
  `fecha_produccion_1` date DEFAULT NULL,
  `etapa_subetapa_1_id` int(11) DEFAULT NULL,
  `letra_origen` varchar(50) DEFAULT NULL,
  `std_piezas` int(11) DEFAULT NULL,
  `hoja_proceso` char(2) DEFAULT NULL,
  `estado` char(1) DEFAULT NULL,
  `tiempo_setup` int(11) DEFAULT NULL,
  `cantidad_operarios` int(11) DEFAULT NULL,
  `unidades_x_art` int(11) DEFAULT NULL,
  `cc` int(11) DEFAULT NULL,
  `numero` int(11) NOT NULL,
  `aprobado_puesta_marcha` int(11) DEFAULT NULL,
  `estado_prep_maq` char(1) DEFAULT NULL,
  `piezas_x_ciclo` int(11) DEFAULT NULL,
  `relleno` varchar(30) DEFAULT NULL,
  `id` int(11) NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_req_esp_detalle` (`numero`,`orden_de_produccion_id`,`secuencia`) USING BTREE,
  KEY `fk_req_esp_etse` (`etapa_subetapa_id`),
  CONSTRAINT `fk_req_esp_etse` FOREIGN KEY (`etapa_subetapa_id`) REFERENCES `etapas_subetapas` (`id`),
  CONSTRAINT `fk_req_esp_numero` FOREIGN KEY (`numero`) REFERENCES `req_especiales_cabecera` (`numero`)
) ENGINE=InnoDB AUTO_INCREMENT=26 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='PM212AO	- Produc - Ords.Producc. Adicional (Retrab/O.Provi) \r\n';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `retrabajos_cabecera`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `retrabajos_cabecera` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'MARCA R/O ',
  `marca_r_o` char(1) NOT NULL DEFAULT 'R',
  `numero` int(11) NOT NULL,
  `concepto` int(11) DEFAULT NULL COMMENT 'CODIGO              CONCEPTO',
  `subcodigo_retenida` int(11) DEFAULT NULL COMMENT 'SUBCODIGO RETENIDA',
  `motivo_retencion` int(11) NOT NULL,
  `r_etapa_subetapa_id` int(11) DEFAULT NULL COMMENT 'CODIGO              ETAPA / subetapa',
  `cc_retrabajo` int(11) DEFAULT NULL COMMENT 'C.COSTOS RETRABA',
  `r_alta_fecha` date DEFAULT NULL COMMENT 'Retrabajo Alta',
  `cantidad_retenida` int(11) NOT NULL,
  `cantidad_recuperada` int(11) NOT NULL DEFAULT 0,
  `orden_de_produccion_id` int(11) NOT NULL,
  `letra` char(4) DEFAULT NULL COMMENT 'CODIGO              LETRAS',
  `producto_fabricado_id` int(11) DEFAULT NULL COMMENT 'NUMERO              ARTICULO',
  `etapa_subetapa_id` int(11) DEFAULT NULL COMMENT 'CODIGO              ETAPA/SUBETAPA',
  `cc_orden_de_produccion` int(11) DEFAULT NULL COMMENT 'C.COSTOS O.PROD.',
  `secuencia` int(11) DEFAULT NULL COMMENT 'NRO.DE SECUENCIA',
  `letra_transferencia_origen` char(50) DEFAULT NULL COMMENT 'TRANSF.LETRA ORIGEN',
  `comentarios_inicio` varchar(1000) DEFAULT NULL,
  `ftsn` char(2) DEFAULT NULL COMMENT 'AGREGA FICHA TECNICA',
  `empresa` int(11) DEFAULT NULL,
  `sucursal` int(11) DEFAULT NULL,
  `legajo` int(11) DEFAULT NULL,
  `sector` int(11) DEFAULT NULL COMMENT 'SECTOR',
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `alta_usuario_id` int(11) NOT NULL,
  `nro_remito` int(11) DEFAULT NULL COMMENT 'NUMERO              REMITO',
  `submotivo_retencion_id` int(11) NOT NULL,
  `cantidad_descartada` int(11) NOT NULL DEFAULT 0,
  `proceso_ft_id` int(11) NOT NULL,
  `comentarios_fin` varchar(1500) DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `numero` (`numero`),
  KEY `fk_retrabajos_sub` (`submotivo_retencion_id`),
  KEY `fk_usuario_alta_71` (`alta_usuario_id`),
  KEY `fk_retrab_etse` (`etapa_subetapa_id`),
  KEY `fk_retrab_r_etse` (`r_etapa_subetapa_id`),
  KEY `fk_op_retrabajos` (`orden_de_produccion_id`),
  KEY `fk_rt_proc` (`proceso_ft_id`),
  CONSTRAINT `fk_op_retrabajos` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `fk_retrab_etse` FOREIGN KEY (`etapa_subetapa_id`) REFERENCES `etapas_subetapas` (`id`),
  CONSTRAINT `fk_retrab_r_etse` FOREIGN KEY (`r_etapa_subetapa_id`) REFERENCES `etapas_subetapas` (`id`),
  CONSTRAINT `fk_retrabajos_sub` FOREIGN KEY (`submotivo_retencion_id`) REFERENCES `submotivos_retencion` (`id`),
  CONSTRAINT `fk_rt_proc` FOREIGN KEY (`proceso_ft_id`) REFERENCES `fichas_tecnicas_procesos` (`id`),
  CONSTRAINT `fk_usuario_alta_71` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `ch_rt_ret` CHECK (`cantidad_retenida` >= 0),
  CONSTRAINT `ch_rt_rec` CHECK (`cantidad_recuperada` >= 0),
  CONSTRAINT `ch_rt_des` CHECK (`cantidad_descartada` >= 0)
) ENGINE=InnoDB AUTO_INCREMENT=258365 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='Tabla PM212RO';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `retrabajos_detalle`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `retrabajos_detalle` (
  `ficha_tecnica_id` int(11) DEFAULT NULL,
  `fecha_produccion` date DEFAULT NULL,
  `etapa_subetapa_id` int(11) NOT NULL,
  `cantidad_lanzamiento` int(11) DEFAULT NULL,
  `cantidad_producida` int(11) DEFAULT NULL,
  `total_horas_hombre` decimal(20,6) DEFAULT NULL,
  `total_horas_maquina` decimal(20,6) DEFAULT NULL,
  `fecha_parte_diario` date DEFAULT NULL,
  `etapa_subetapa_anterior_id` int(11) DEFAULT NULL,
  `etapa_subetapa_siguiente_id` int(11) DEFAULT NULL,
  `marca_pendiente_final` char(1) DEFAULT NULL,
  `marca_op_emitida` char(1) DEFAULT NULL,
  `orden_de_produccion_id` int(11) DEFAULT NULL,
  `secuencia` int(11) NOT NULL,
  `colada` varchar(10) DEFAULT NULL,
  `articulo_tipo` int(11) DEFAULT NULL,
  `articulo_familia` int(11) DEFAULT NULL,
  `cantidad_descarte` decimal(20,6) DEFAULT NULL,
  `marca_comunicacion` char(1) DEFAULT NULL,
  `año_parte_diario` int(11) DEFAULT NULL,
  `letra` varchar(50) DEFAULT NULL,
  `ficha_tecnica_1_id` int(11) DEFAULT NULL,
  `fecha_produccion_1` date DEFAULT NULL,
  `etapa_subetapa_1_id` int(11) DEFAULT NULL,
  `letra_origen` varchar(50) DEFAULT NULL,
  `std_piezas` int(11) DEFAULT NULL,
  `hoja_proceso` char(2) DEFAULT NULL,
  `estado` char(1) DEFAULT NULL,
  `tiempo_setup` int(11) DEFAULT NULL,
  `cantidad_operarios` int(11) DEFAULT NULL,
  `unidades_x_art` int(11) DEFAULT NULL,
  `cc` int(11) DEFAULT NULL,
  `numero` int(11) NOT NULL,
  `aprobado_puesta_marcha` int(11) DEFAULT NULL,
  `estado_prep_maq` char(1) DEFAULT NULL,
  `piezas_x_ciclo` int(11) DEFAULT NULL,
  `relleno` varchar(30) DEFAULT NULL,
  `id` int(11) NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`id`),
  UNIQUE KEY `UK_RETRABAJO` (`numero`,`orden_de_produccion_id`,`secuencia`) USING BTREE,
  KEY `fk_retrab_detalle_etse` (`etapa_subetapa_id`),
  CONSTRAINT `fk_retrab_detalle_etse` FOREIGN KEY (`etapa_subetapa_id`) REFERENCES `etapas_subetapas` (`id`),
  CONSTRAINT `fk_retrab_numero` FOREIGN KEY (`numero`) REFERENCES `retrabajos_cabecera` (`numero`)
) ENGINE=InnoDB AUTO_INCREMENT=45353 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='PM212AO	- Produc - Ords.Producc. Adicional (Retrab/O.Provi) \r\n';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `saldos_produccion`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `saldos_produccion` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `orden_de_produccion_id` int(11) NOT NULL,
  `ingreso` decimal(20,6) DEFAULT NULL,
  `ajustes` decimal(20,6) DEFAULT NULL,
  `ccant` decimal(20,6) DEFAULT NULL,
  `retenida` decimal(20,6) DEFAULT NULL,
  `pstock` decimal(20,6) DEFAULT NULL,
  `saldo` decimal(20,6) DEFAULT NULL,
  `fecha_cierre` date DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `fk_saldo_op` (`orden_de_produccion_id`) USING BTREE,
  CONSTRAINT `fk_saldo_op` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=538 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `sincronizacion_erp`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `sincronizacion_erp` (
  `ultima_vez` datetime DEFAULT NULL,
  `cada_x_minutos` int(11) DEFAULT NULL,
  `logrado_asientos` tinyint(1) DEFAULT NULL,
  `logrado_cuentas` tinyint(1) DEFAULT NULL,
  `logrado_depositos` tinyint(1) DEFAULT NULL,
  `logrado_vales` tinyint(1) DEFAULT NULL,
  `logrado_materiales` tinyint(1) DEFAULT NULL,
  `logrado_ordenes_de_compra` tinyint(1) DEFAULT NULL,
  `logrado_periodos` tinyint(1) DEFAULT NULL,
  `logrado_productos_fabricados` tinyint(1) DEFAULT NULL,
  `logrado_proveedores_y_clientes` tinyint(1) DEFAULT NULL,
  `logrado_remitos_oc` tinyint(1) DEFAULT NULL,
  `logrado_tarifas` tinyint(1) DEFAULT NULL,
  `logrado_unidades` tinyint(1) DEFAULT NULL,
  `logrado_ventas` tinyint(1) DEFAULT NULL,
  `logrados_todos` tinyint(1) DEFAULT NULL,
  `logrado_ingresos_pf` tinyint(1) DEFAULT NULL,
  `logrado_ordenes_de_despacho` tinyint(1) DEFAULT NULL,
  `ultima_vez_exitoso` datetime DEFAULT NULL,
  `logrado_consumos` tinyint(1) DEFAULT NULL,
  `logrado_centros` tinyint(1) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `soldadura_consumibles`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `soldadura_consumibles` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `orden_de_produccion_id` int(11) NOT NULL,
  `de16` varchar(20) DEFAULT NULL,
  `de24` varchar(20) DEFAULT NULL,
  `de32` varchar(20) DEFAULT NULL,
  `de04` varchar(20) DEFAULT NULL,
  `defl` varchar(20) DEFAULT NULL,
  `deproc` varchar(20) DEFAULT NULL,
  `ot01` varchar(20) DEFAULT NULL,
  `ot02` varchar(20) DEFAULT NULL,
  `alta_usuario_id` int(11) DEFAULT NULL,
  `alta_fecha_hora` datetime DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_soldadura_op` (`orden_de_produccion_id`),
  KEY `fk_usuario_alta_15` (`alta_usuario_id`),
  KEY `fk_usuario_mod_15` (`modificacion_usuario_id`),
  CONSTRAINT `fk_soldadura_op` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `fk_usuario_alta_15` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_15` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `stocks_chatarra_y_viruta`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `stocks_chatarra_y_viruta` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `producto_fabricado_id` int(11) NOT NULL,
  `deposito_id` int(11) NOT NULL,
  `cantidad_disponible` decimal(15,3) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_dep_chatarra` (`producto_fabricado_id`,`deposito_id`),
  KEY `fk_deposito_5` (`deposito_id`),
  CONSTRAINT `fk_deposito_5` FOREIGN KEY (`deposito_id`) REFERENCES `depositos` (`id`),
  CONSTRAINT `fk_pf_6` FOREIGN KEY (`producto_fabricado_id`) REFERENCES `productos_fabricados` (`id`),
  CONSTRAINT `ch_cantidad_7` CHECK (`cantidad_disponible` >= 0)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `stocks_chatarra_y_viruta_movimientos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `stocks_chatarra_y_viruta_movimientos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `producto_fabricado_id` int(11) NOT NULL,
  `tipo_id` int(11) NOT NULL,
  `detalle` varchar(100) NOT NULL,
  `cantidad` decimal(15,3) NOT NULL,
  `consumo_id` int(11) DEFAULT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `orden_de_produccion_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_mov_chat_pf` (`producto_fabricado_id`),
  KEY `fk_mov_chat_cons` (`consumo_id`),
  KEY `fk_mov_chat_op` (`orden_de_produccion_id`),
  CONSTRAINT `fk_mov_chat_cons` FOREIGN KEY (`consumo_id`) REFERENCES `partes_diarios_declaracion_de_consumos` (`id`),
  CONSTRAINT `fk_mov_chat_op` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `fk_mov_chat_pf` FOREIGN KEY (`producto_fabricado_id`) REFERENCES `productos_fabricados` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `stocks_materiales`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `stocks_materiales` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `articulo_id` int(11) NOT NULL,
  `deposito_id` int(11) NOT NULL,
  `recepcion_tecnica_id` int(11) DEFAULT NULL,
  `cantidad_disponible` decimal(15,3) NOT NULL DEFAULT 0.000,
  `cantidad_pendiente` decimal(15,3) NOT NULL DEFAULT 0.000,
  `cantidad_reservada` decimal(15,3) NOT NULL DEFAULT 0.000,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_stock_mp` (`recepcion_tecnica_id`,`deposito_id`),
  KEY `fk_articulo_10` (`articulo_id`),
  KEY `fk_deposito_4` (`deposito_id`),
  CONSTRAINT `fk_articulo_10` FOREIGN KEY (`articulo_id`) REFERENCES `articulos` (`id`),
  CONSTRAINT `fk_deposito_4` FOREIGN KEY (`deposito_id`) REFERENCES `depositos` (`id`),
  CONSTRAINT `ch_cantidad_stock_1` CHECK (`cantidad_disponible` >= 0),
  CONSTRAINT `ch_cantidad_stock_2` CHECK (`cantidad_pendiente` >= 0),
  CONSTRAINT `ch_cantidad_stock_3` CHECK (`cantidad_reservada` >= 0)
) ENGINE=InnoDB AUTO_INCREMENT=41046 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `stocks_materiales_movimientos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `stocks_materiales_movimientos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `articulo_id` int(11) NOT NULL,
  `tipo_id` int(11) NOT NULL,
  `detalle` varchar(100) NOT NULL,
  `cantidad` decimal(15,3) NOT NULL,
  `orden_de_compra_id` int(11) DEFAULT NULL,
  `orden_de_produccion_id` int(11) DEFAULT NULL,
  `recepcion_de_mercaderia_id` int(11) DEFAULT NULL,
  `recepcion_tecnica_id` int(11) DEFAULT NULL,
  `vale_de_consumo_id` int(11) DEFAULT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `asiento_contable_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_articulo_11` (`articulo_id`),
  KEY `fk_mov_estado` (`tipo_id`),
  KEY `fk_oc` (`orden_de_compra_id`),
  KEY `fk_op_stocks` (`orden_de_produccion_id`),
  KEY `fk_rm_mov` (`recepcion_de_mercaderia_id`),
  KEY `fk_recepcion_5` (`recepcion_tecnica_id`),
  KEY `fk_vale_mov` (`vale_de_consumo_id`),
  KEY `fk_stocks_materiales_movimientos_asientos_contables` (`asiento_contable_id`),
  CONSTRAINT `fk_articulo_11` FOREIGN KEY (`articulo_id`) REFERENCES `articulos` (`id`),
  CONSTRAINT `fk_oc` FOREIGN KEY (`orden_de_compra_id`) REFERENCES `ordenes_de_compra` (`id`),
  CONSTRAINT `fk_op_stocks` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `fk_recepcion_5` FOREIGN KEY (`recepcion_tecnica_id`) REFERENCES `recepciones_tecnicas` (`id`),
  CONSTRAINT `fk_rm_mov` FOREIGN KEY (`recepcion_de_mercaderia_id`) REFERENCES `recepciones_de_mercaderia` (`id`),
  CONSTRAINT `fk_stocks_materiales_movimientos_asientos_contables` FOREIGN KEY (`asiento_contable_id`) REFERENCES `asientos_contables` (`id`),
  CONSTRAINT `fk_vale_mov` FOREIGN KEY (`vale_de_consumo_id`) REFERENCES `vales_de_consumo` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=481 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `stocks_productos_fabricados`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `stocks_productos_fabricados` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `deposito_id` int(11) NOT NULL,
  `cantidad_real` int(11) DEFAULT 0,
  `cantidad_ordenada` int(11) DEFAULT 0,
  `cantidad_reservada` int(11) DEFAULT 0,
  `orden_de_produccion_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_stock_pf` (`orden_de_produccion_id`,`deposito_id`),
  KEY `fk_deposito_3` (`deposito_id`),
  CONSTRAINT `fk_deposito_3` FOREIGN KEY (`deposito_id`) REFERENCES `depositos` (`id`),
  CONSTRAINT `fk_stocks_pf_op` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `ch_cantidad_4` CHECK (`cantidad_real` >= 0),
  CONSTRAINT `ch_cantidad_5` CHECK (`cantidad_ordenada` >= 0),
  CONSTRAINT `ch_cantidad_6` CHECK (`cantidad_reservada` >= 0)
) ENGINE=InnoDB AUTO_INCREMENT=7245 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `stocks_productos_fabricados_movimientos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `stocks_productos_fabricados_movimientos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `producto_fabricado_id` int(11) NOT NULL,
  `tipo_id` int(11) NOT NULL,
  `detalle` varchar(100) NOT NULL,
  `cantidad` decimal(15,3) NOT NULL,
  `orden_de_compra_id` int(11) DEFAULT NULL,
  `orden_de_produccion_id` int(11) DEFAULT NULL,
  `ingreso_produccion_id` int(11) DEFAULT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `orden_de_despacho_id` int(11) DEFAULT NULL,
  `retrabajo_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_pf_5` (`producto_fabricado_id`),
  KEY `fk_mov_estado_1` (`tipo_id`),
  KEY `fk_oc_1` (`orden_de_compra_id`),
  KEY `fk_op_stocks_mov` (`orden_de_produccion_id`),
  KEY `fk_ingreso` (`ingreso_produccion_id`),
  KEY `fk_stock_despacho` (`orden_de_despacho_id`),
  KEY `fk_stock_rt` (`retrabajo_id`),
  CONSTRAINT `fk_ingreso` FOREIGN KEY (`ingreso_produccion_id`) REFERENCES `ingresos_produccion` (`id`),
  CONSTRAINT `fk_oc_1` FOREIGN KEY (`orden_de_compra_id`) REFERENCES `ordenes_de_compra` (`id`),
  CONSTRAINT `fk_op_stocks_mov` FOREIGN KEY (`orden_de_produccion_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `fk_pf_5` FOREIGN KEY (`producto_fabricado_id`) REFERENCES `productos_fabricados` (`id`),
  CONSTRAINT `fk_stock_despacho` FOREIGN KEY (`orden_de_despacho_id`) REFERENCES `ordenes_de_despacho` (`id`),
  CONSTRAINT `fk_stock_rt` FOREIGN KEY (`retrabajo_id`) REFERENCES `retrabajos_cabecera` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=133 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `submotivos_retencion`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `submotivos_retencion` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `concepto` int(11) NOT NULL,
  `subconcepto` int(11) NOT NULL,
  `descripcion` varchar(50) NOT NULL,
  `descripcion_corta` varchar(50) NOT NULL,
  `alta_fecha_hora` date NOT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `modificacion_fecha_hora` date DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `baja_fecha_hora` date DEFAULT NULL,
  `baja_usuario_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `UK CPTO SUBCPTO` (`concepto`,`subconcepto`),
  KEY `fk_usuario_alta_69` (`alta_usuario_id`),
  KEY `fk_usuario_baja_69` (`baja_usuario_id`),
  KEY `fk_usuario_mod_69` (`modificacion_usuario_id`),
  CONSTRAINT `fk_usuario_alta_69` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_69` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_69` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=25 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='PM211SU	- Maestro de Subcodigos de Retenidas                \r\n \r\n';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `tabla_calculo_paquete`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `tabla_calculo_paquete` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `numero` int(11) DEFAULT NULL,
  `ancho` int(11) DEFAULT NULL,
  `alto` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=25 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `tabla_sierras`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `tabla_sierras` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `diametro` decimal(10,3) DEFAULT NULL,
  `espesor` decimal(10,3) DEFAULT NULL,
  `ancho_dano420` int(11) DEFAULT NULL,
  `alto_dano420` int(11) DEFAULT NULL,
  `ancho_meto380` int(11) DEFAULT NULL,
  `alto_meto380` int(11) DEFAULT NULL,
  `ancho_dano520` int(11) DEFAULT NULL,
  `alto_dano520` int(11) DEFAULT NULL,
  `ancho_meto550` int(11) DEFAULT NULL,
  `alto_meto550` int(11) DEFAULT NULL,
  `ancho_uniz` int(11) DEFAULT NULL,
  `alto_uniz` int(11) DEFAULT NULL,
  `largo_tubo` double DEFAULT NULL,
  `lote_calculado` double DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=186 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `tarifas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `tarifas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) NOT NULL,
  `descripcion` varchar(100) NOT NULL,
  `moneda_id` int(11) NOT NULL,
  `incluye_impuestos` tinyint(1) NOT NULL,
  `incluye_percepciones` tinyint(1) NOT NULL,
  `esta_activo` tinyint(1) NOT NULL DEFAULT 1,
  `es_de_venta` tinyint(1) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `descripcion` (`descripcion`),
  UNIQUE KEY `id_erp` (`id_erp`),
  UNIQUE KEY `id_erp_2` (`id_erp`),
  KEY `fk_moneda` (`moneda_id`),
  CONSTRAINT `fk_moneda` FOREIGN KEY (`moneda_id`) REFERENCES `monedas` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=42 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `tarifas_versiones`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `tarifas_versiones` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) NOT NULL,
  `nombre` varchar(100) NOT NULL,
  `tarifa_id` int(11) NOT NULL,
  `esquema_de_descuentos_id` int(11) NOT NULL,
  `esta_activo` tinyint(1) NOT NULL DEFAULT 1,
  PRIMARY KEY (`id`),
  UNIQUE KEY `nombre` (`nombre`),
  UNIQUE KEY `id_erp` (`id_erp`),
  UNIQUE KEY `id_erp_2` (`id_erp`),
  KEY `fk_tarifa_1` (`tarifa_id`),
  KEY `fk_descuentos` (`esquema_de_descuentos_id`),
  CONSTRAINT `fk_descuentos` FOREIGN KEY (`esquema_de_descuentos_id`) REFERENCES `esquemas_de_descuentos` (`id`),
  CONSTRAINT `fk_tarifa_1` FOREIGN KEY (`tarifa_id`) REFERENCES `tarifas` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=28 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `tipos_de_documentos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `tipos_de_documentos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `descripcion` varchar(50) DEFAULT NULL,
  `codigo` char(2) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='Tabla para plasmar las distintas actividades con documentos con el fin de poder parametrizar cada actividad con los costos';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `tipos_de_maquinas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `tipos_de_maquinas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `descripcion` varchar(50) DEFAULT NULL,
  `descripcion_abreviada` varchar(12) DEFAULT NULL,
  `alta_fecha_hora` date DEFAULT NULL,
  `modificacion_fecha_hora` date DEFAULT NULL,
  `baja_fecha_hora` date DEFAULT NULL,
  `alta_usuario_id` int(11) DEFAULT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `baja_usuario_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=100 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `tipos_de_tareas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `tipos_de_tareas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `descripcion` varchar(100) DEFAULT NULL,
  `descripcion_abreviada` varchar(12) DEFAULT NULL,
  `alta_fecha_hora` datetime NOT NULL DEFAULT current_timestamp(),
  `modificacion_fecha_hora` datetime DEFAULT NULL,
  `baja_fecha_hora` datetime DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `modificacion_usuario_id` int(11) DEFAULT NULL,
  `baja_usuario_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE,
  KEY `fk_usuario_alta_68` (`alta_usuario_id`),
  KEY `fk_usuario_baja_68` (`baja_usuario_id`),
  KEY `fk_usuario_mod_68` (`modificacion_usuario_id`),
  CONSTRAINT `fk_usuario_alta_68` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_baja_68` FOREIGN KEY (`baja_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_usuario_mod_68` FOREIGN KEY (`modificacion_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=10 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `transformaciones`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `transformaciones` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `orden_de_produccion_actual_id` int(11) NOT NULL,
  `n_op_vale` int(11) DEFAULT NULL,
  `p_o_t` int(1) NOT NULL,
  `orden_de_produccion_origen_id` int(11) DEFAULT NULL,
  `letra_reventa` varchar(10) DEFAULT NULL,
  `marca` varchar(24) DEFAULT NULL,
  `articulo_origen` int(11) DEFAULT NULL,
  `fecha_op_actual` date DEFAULT NULL,
  `letra_op_actual` char(4) DEFAULT NULL,
  `letra_origen` varchar(4) DEFAULT NULL,
  `producto_fabricado_actual_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_transf_op_actual` (`orden_de_produccion_actual_id`),
  KEY `fk_transf_op_origen` (`orden_de_produccion_origen_id`),
  KEY `fk_tr_pf` (`producto_fabricado_actual_id`),
  CONSTRAINT `fk_tr_pf` FOREIGN KEY (`producto_fabricado_actual_id`) REFERENCES `productos_fabricados` (`id`),
  CONSTRAINT `fk_transf_op_actual` FOREIGN KEY (`orden_de_produccion_actual_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `fk_transf_op_origen` FOREIGN KEY (`orden_de_produccion_origen_id`) REFERENCES `ordenes_de_produccion` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `transformaciones_detalle`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `transformaciones_detalle` (
  `producto_fabricado_id` int(11) DEFAULT NULL,
  `fecha_produccion` date DEFAULT NULL,
  `etapa_subetapa_id` int(11) DEFAULT NULL,
  `cantidad_lanzamiento` int(11) DEFAULT NULL,
  `cantidad_producida` int(11) DEFAULT NULL,
  `total_horas_hombre` decimal(20,6) DEFAULT NULL,
  `total_horas_maquina` decimal(20,6) DEFAULT NULL,
  `fecha_parte_diario` date DEFAULT NULL,
  `etapa_subetapa_anterior_id` int(11) DEFAULT NULL,
  `etapa_subetapa_siguiente_id` int(11) DEFAULT NULL,
  `marca_pendiente_final` char(1) DEFAULT NULL,
  `marca_op_emitida` char(1) DEFAULT NULL,
  `orden_de_produccion_id` int(11) DEFAULT NULL,
  `secuencia` int(11) DEFAULT NULL,
  `colada` varchar(10) DEFAULT NULL,
  `articulo_tipo` int(11) DEFAULT NULL,
  `articulo_familia` int(11) DEFAULT NULL,
  `cantidad_descarte` decimal(20,6) DEFAULT NULL,
  `marca_comunicacion` char(1) DEFAULT NULL,
  `año_parte_diario` int(11) DEFAULT NULL,
  `letra` varchar(50) DEFAULT NULL,
  `ficha_tecnica_1_id` int(11) DEFAULT NULL,
  `fecha_produccion_1` date DEFAULT NULL,
  `etapa_subetapa_1_id` int(11) DEFAULT NULL,
  `letra_origen` varchar(50) DEFAULT NULL,
  `std_piezas` int(11) DEFAULT NULL,
  `maq_1_id` int(11) DEFAULT NULL,
  `maq_2_id` int(11) DEFAULT NULL,
  `maq_3_id` int(11) DEFAULT NULL,
  `maq_4_id` int(11) DEFAULT NULL,
  `hoja_proceso` char(2) DEFAULT NULL,
  `estado` char(1) DEFAULT NULL,
  `tiempo_setup` int(11) DEFAULT NULL,
  `cantidad_operarios` int(11) DEFAULT NULL,
  `unidades_x_art` int(11) DEFAULT NULL,
  `cc` int(11) DEFAULT NULL,
  `numero_retrabajo` int(11) DEFAULT NULL,
  `aprobado_puesta_marcha` int(11) DEFAULT NULL,
  `estado_prep_maq` char(1) DEFAULT NULL,
  `piezas_x_ciclo` int(11) DEFAULT NULL,
  `relleno` varchar(30) DEFAULT NULL,
  UNIQUE KEY `UK_RETRABAJO` (`numero_retrabajo`,`orden_de_produccion_id`,`secuencia`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='PM212AO	- Produc - Ords.Producc. Adicional (Retrab/O.Provi) \r\n';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `transformaciones_seguimiento`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `transformaciones_seguimiento` (
  `vale_nro` int(11) NOT NULL,
  `producto_finalizado` int(11) DEFAULT NULL,
  `letras_origen` varchar(50) DEFAULT NULL,
  `fecha_movimiento` date DEFAULT NULL,
  `cantidad` int(11) DEFAULT NULL,
  `req_control_calidad` char(1) NOT NULL,
  `preparacion_fecha` date DEFAULT NULL,
  `preparacion_usuario_id` int(11) DEFAULT NULL,
  `control_calidad_fecha` date DEFAULT NULL,
  `control_calidad_usuario_id` int(11) DEFAULT NULL,
  `ingenieria_fecha` date DEFAULT NULL,
  `ingenieria_usuario_id` int(11) DEFAULT NULL,
  `nuevo_op_fecha` date DEFAULT NULL,
  `nuevo_letras` varchar(50) DEFAULT NULL,
  `producto_fabricado_actual_id` int(11) NOT NULL,
  `estado` char(1) DEFAULT NULL,
  `stock_fecha` date DEFAULT NULL,
  `stock_usuario_id` int(11) DEFAULT NULL,
  `observaciones` varchar(50) DEFAULT NULL,
  `cc` int(11) DEFAULT NULL,
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `orden_de_produccion_origen_id` int(11) NOT NULL,
  `orden_de_produccion_actual_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `vale_nro` (`vale_nro`),
  KEY `fk_transf_seg_op_origen` (`orden_de_produccion_origen_id`),
  KEY `fk_transf_seg_op_actual` (`orden_de_produccion_actual_id`),
  KEY `fk_trs_usuario_prep` (`preparacion_usuario_id`),
  KEY `fk_trs_usuario_cal` (`control_calidad_usuario_id`),
  KEY `fk_trs_usuario_ing` (`ingenieria_usuario_id`),
  KEY `fk_trs_usuario_stock` (`stock_usuario_id`),
  KEY `fk_trs_pf` (`producto_fabricado_actual_id`),
  CONSTRAINT `fk_transf_seg_op_actual` FOREIGN KEY (`orden_de_produccion_actual_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `fk_transf_seg_op_origen` FOREIGN KEY (`orden_de_produccion_origen_id`) REFERENCES `ordenes_de_produccion` (`id`),
  CONSTRAINT `fk_trs_pf` FOREIGN KEY (`producto_fabricado_actual_id`) REFERENCES `productos_fabricados` (`id`),
  CONSTRAINT `fk_trs_usuario_cal` FOREIGN KEY (`control_calidad_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_trs_usuario_ing` FOREIGN KEY (`ingenieria_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_trs_usuario_prep` FOREIGN KEY (`preparacion_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_trs_usuario_stock` FOREIGN KEY (`stock_usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=7087 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ultimo_valor`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ultimo_valor` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `letra` varchar(4) NOT NULL,
  `laboratorio_oc` int(11) NOT NULL,
  `comprobante_cajon` int(11) NOT NULL,
  `numero_retrabajo_opprov_reqespecial` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `letra` (`letra`),
  UNIQUE KEY `laboratorio_oc` (`laboratorio_oc`),
  UNIQUE KEY `comprobante_cajon` (`comprobante_cajon`),
  UNIQUE KEY `numero_retrabajo_opprov_reqespecial` (`numero_retrabajo_opprov_reqespecial`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `unidades_de_medida`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `unidades_de_medida` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) NOT NULL,
  `descripcion` varchar(40) DEFAULT NULL,
  `abrev` varchar(10) DEFAULT NULL,
  `es_de_tiempo` tinyint(1) DEFAULT 0,
  `esta_activo` tinyint(1) NOT NULL DEFAULT 1,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`),
  UNIQUE KEY `descripcion` (`descripcion`)
) ENGINE=InnoDB AUTO_INCREMENT=21 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `usuarios`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `usuarios` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `username` varchar(30) NOT NULL,
  `nombre_completo` varchar(50) DEFAULT NULL,
  `email` varchar(256) DEFAULT NULL,
  `hash_clave` varchar(150) NOT NULL,
  `habilitado` tinyint(1) NOT NULL DEFAULT 1,
  `barra_lateral_dinamica` tinyint(1) NOT NULL DEFAULT 0,
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`)
) ENGINE=InnoDB AUTO_INCREMENT=536 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `usuarios_roles`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `usuarios_roles` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `nombre` varchar(30) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `nombre` (`nombre`)
) ENGINE=InnoDB AUTO_INCREMENT=18 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `usuarios_suscripcion_accesos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `usuarios_suscripcion_accesos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `rol_id` int(11) NOT NULL,
  `ruta` varchar(100) NOT NULL,
  `nivel` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_rol_ruta` (`rol_id`,`ruta`),
  CONSTRAINT `fk_rol_accesos` FOREIGN KEY (`rol_id`) REFERENCES `usuarios_roles` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=3404 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `usuarios_suscripcion_roles`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `usuarios_suscripcion_roles` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `usuario_id` int(11) NOT NULL,
  `rol_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `un_usuario_rol` (`usuario_id`,`rol_id`),
  KEY `fk_rol` (`rol_id`),
  CONSTRAINT `fk_rol` FOREIGN KEY (`rol_id`) REFERENCES `usuarios_roles` (`id`),
  CONSTRAINT `fk_usuario` FOREIGN KEY (`usuario_id`) REFERENCES `usuarios` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=21 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `vales_de_consumo`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `vales_de_consumo` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `centro_de_costo_id` int(11) NOT NULL,
  `orden_de_trabajo_id` int(11) DEFAULT NULL,
  `es_devolucion` tinyint(1) NOT NULL,
  `descripcion` varchar(100) DEFAULT NULL,
  `alta_usuario_id` int(11) NOT NULL,
  `solicitud_fecha` date DEFAULT curdate(),
  PRIMARY KEY (`id`),
  KEY `fk_usuario_alta_9` (`alta_usuario_id`),
  KEY `fk_cc_vale` (`centro_de_costo_id`),
  KEY `fk_vale_ot` (`orden_de_trabajo_id`),
  CONSTRAINT `fk_cc_vale` FOREIGN KEY (`centro_de_costo_id`) REFERENCES `centros_de_costo` (`id`),
  CONSTRAINT `fk_usuario_alta_9` FOREIGN KEY (`alta_usuario_id`) REFERENCES `usuarios` (`id`),
  CONSTRAINT `fk_vale_ot` FOREIGN KEY (`orden_de_trabajo_id`) REFERENCES `ordenes_de_trabajo` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=511 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `vales_de_consumo_articulos`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `vales_de_consumo_articulos` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `vale_de_consumo_id` int(11) NOT NULL,
  `articulo_id` int(11) NOT NULL,
  `maquina_id` int(11) DEFAULT NULL,
  `cantidad_solicitada` decimal(15,3) NOT NULL,
  `fue_cancelado` tinyint(1) DEFAULT 0,
  `orden_de_trabajo_id` int(11) DEFAULT NULL,
  `item_vale` int(11) DEFAULT NULL,
  `rubro_material` char(3) DEFAULT NULL,
  `rubro_proveedor` char(3) DEFAULT NULL,
  `descripcion` varchar(60) DEFAULT NULL,
  `unidad_medida` char(3) DEFAULT NULL,
  `deposito` char(2) DEFAULT NULL,
  `fecha_solicitud` date DEFAULT NULL,
  `fecha_entrega` date DEFAULT NULL,
  `estado_item` char(1) DEFAULT NULL,
  `imputacion` char(20) DEFAULT NULL,
  `veces_entrega` int(11) DEFAULT NULL,
  `cantidad_entregada` decimal(15,3) DEFAULT 0.000,
  `total_entregado` decimal(15,3) DEFAULT NULL,
  `precio` decimal(15,2) DEFAULT NULL,
  `moneda` char(3) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_vale` (`vale_de_consumo_id`),
  KEY `fk_insumos` (`articulo_id`),
  KEY `fk_vale_maquina` (`maquina_id`),
  KEY `fk_vale_ot_2` (`orden_de_trabajo_id`),
  CONSTRAINT `fk_insumos` FOREIGN KEY (`articulo_id`) REFERENCES `articulos` (`id`),
  CONSTRAINT `fk_vale` FOREIGN KEY (`vale_de_consumo_id`) REFERENCES `vales_de_consumo` (`id`),
  CONSTRAINT `fk_vale_maquina` FOREIGN KEY (`maquina_id`) REFERENCES `maquinas_herramientas` (`id`),
  CONSTRAINT `fk_vale_ot_2` FOREIGN KEY (`orden_de_trabajo_id`) REFERENCES `ordenes_de_trabajo` (`id`),
  CONSTRAINT `ch_cant_vale1` CHECK (`cantidad_solicitada` > 0),
  CONSTRAINT `ch_cant_vale2` CHECK (`cantidad_entregada` >= 0),
  CONSTRAINT `ch_cant_vale3` CHECK (`cantidad_entregada` <= `cantidad_solicitada`)
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `vales_de_consumo_entregas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `vales_de_consumo_entregas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) DEFAULT NULL,
  `vale_de_consumo_articulo_id` int(11) NOT NULL,
  `legajo` int(11) NOT NULL,
  `cantidad` decimal(15,3) NOT NULL,
  `fecha` date DEFAULT curdate(),
  `descripcion` varchar(100) DEFAULT NULL,
  `empresa` int(11) DEFAULT NULL,
  `entrega_veces` int(11) DEFAULT NULL,
  `entrega_total` decimal(15,3) DEFAULT NULL,
  `estado_entrega` char(1) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`),
  KEY `fk_vale_legajo` (`vale_de_consumo_articulo_id`),
  CONSTRAINT `fk_vale_legajo` FOREIGN KEY (`vale_de_consumo_articulo_id`) REFERENCES `vales_de_consumo_articulos` (`id`),
  CONSTRAINT `ch_cant_vale4` CHECK (`cantidad` > 0)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ventas`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ventas` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_erp` int(11) DEFAULT NULL,
  `cliente_id` int(11) NOT NULL,
  `fecha_creacion` date DEFAULT curdate(),
  `fecha_objetivo` date NOT NULL,
  `esta_activo` tinyint(1) NOT NULL DEFAULT 1,
  `es_borrador` tinyint(1) NOT NULL,
  `document_no_erp` int(11) NOT NULL,
  `requerimientos_adicionales` varchar(100) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`),
  KEY `fk_cliente` (`cliente_id`),
  CONSTRAINT `fk_cliente` FOREIGN KEY (`cliente_id`) REFERENCES `proveedores_y_clientes` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=463 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `ventas_productos_fabricados`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `ventas_productos_fabricados` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `venta_id` int(11) NOT NULL,
  `producto_fabricado_id` int(11) NOT NULL,
  `cantidad` int(11) NOT NULL,
  `precio` decimal(20,2) NOT NULL,
  `fecha_creacion` date NOT NULL,
  `fecha_objetivo` date NOT NULL,
  `moneda_id` int(11) NOT NULL,
  `unidad_de_medida_id` int(11) NOT NULL,
  `id_erp` int(11) DEFAULT NULL,
  `esta_activo` tinyint(1) NOT NULL DEFAULT 1,
  `requerimientos_adicionales` varchar(100) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_erp` (`id_erp`),
  KEY `fk_venta` (`venta_id`),
  KEY `fk_pf_2` (`producto_fabricado_id`),
  KEY `fk_medida_3` (`unidad_de_medida_id`),
  KEY `fk_moneda_2` (`moneda_id`),
  CONSTRAINT `fk_medida_3` FOREIGN KEY (`unidad_de_medida_id`) REFERENCES `unidades_de_medida` (`id`),
  CONSTRAINT `fk_moneda_2` FOREIGN KEY (`moneda_id`) REFERENCES `monedas` (`id`),
  CONSTRAINT `fk_pf_2` FOREIGN KEY (`producto_fabricado_id`) REFERENCES `productos_fabricados` (`id`),
  CONSTRAINT `fk_venta` FOREIGN KEY (`venta_id`) REFERENCES `ventas` (`id`),
  CONSTRAINT `chk_cantidad_recibida_3` CHECK (`cantidad` >= 0),
  CONSTRAINT `chk_precio` CHECK (`precio` >= 0)
) ENGINE=InnoDB AUTO_INCREMENT=1280 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `volante_secuencia`
--

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8mb4 */;
CREATE TABLE `volante_secuencia` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `fecha_produccion` date NOT NULL,
  `secuencia` int(11) NOT NULL,
  `marca_info` char(1) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping routines for database 'cintolo'
--
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Analisis_mecanicos_grupo10`(id_colada INT, es_cintolo BOOLEAN) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_general_ci
BEGIN
        DECLARE v_grupo INT;
        DECLARE v_probeta VARCHAR(50);
        DECLARE v_tipo VARCHAR(2);
        DECLARE v_orig VARCHAR(2);
        DECLARE v_espesor DOUBLE;
        DECLARE v_alargamiento_pb DOUBLE;
        DECLARE v_flue_mb DOUBLE;
        DECLARE v_rotu_mb DOUBLE;
        DECLARE v_dureza_mb DOUBLE;
        DECLARE v_resultado VARCHAR(100);
        DECLARE v_resultado_id INT;

        SET v_grupo = 10;

        IF es_cintolo = 0 THEN
            SELECT valor_texto
            INTO v_probeta
            FROM recepciones_tecnicas_partes rtp
            LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
            WHERE rtp.recepcion_tecnica_id = id_colada
            AND par.parametro = 'PROB'
            AND par.parte = 'PB';
            SELECT valor_texto
            INTO v_tipo
            FROM recepciones_tecnicas_partes rtp
            LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
            WHERE rtp.recepcion_tecnica_id = id_colada
            AND par.parte = 'PB' AND par.parametro = 'TIPO';
            SELECT valor_texto
            INTO v_orig
            FROM recepciones_tecnicas_partes rtp
            LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
            WHERE rtp.recepcion_tecnica_id = id_colada
            AND par.parte = 'PB' AND par.parametro = 'ORIG';
            SELECT valor_decimal
            INTO v_espesor
            FROM recepciones_tecnicas_partes rtp
            LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
            WHERE rtp.recepcion_tecnica_id = id_colada
            AND par.parte = 'PB' AND par.parametro = 'DIM2';
            SELECT valor_decimal * 1000
            INTO v_alargamiento_pb
            FROM recepciones_tecnicas_partes rtp
            LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
            WHERE rtp.recepcion_tecnica_id = id_colada
            AND par.parametro = 'ALAR'
            AND par.parte = 'MB';
            SELECT valor_decimal
            INTO v_flue_mb
            FROM recepciones_tecnicas_partes rtp
            LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
            WHERE rtp.recepcion_tecnica_id = id_colada
            AND par.parametro = 'FLUE'
            AND par.parte = 'MB';

            SELECT valor_decimal * 1000
            INTO v_dureza_mb
            FROM recepciones_tecnicas_partes rtp
            LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
            WHERE rtp.recepcion_tecnica_id = id_colada
            AND par.parametro = 'DURE'
            AND par.parte = 'MB';
        
            SELECT valor_decimal
            INTO v_rotu_mb
            FROM recepciones_tecnicas_partes rtp
            LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
            WHERE rtp.recepcion_tecnica_id = id_colada
            AND par.parametro = 'ROTU'
            AND par.parte = 'MB';
        ELSE
            SELECT valor_texto
            INTO v_probeta
            FROM ordenes_de_produccion_estudios_partes rtp
            LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
            WHERE rtp.estudio_id = id_colada
            AND par.parametro = 'PROB'
            AND par.parte = 'PB';

            SELECT valor_texto
            INTO v_tipo
            FROM ordenes_de_produccion_estudios_partes rtp
            LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
            WHERE rtp.estudio_id = id_colada
            AND par.parte = 'PB' AND par.parametro = 'TIPO';

            SELECT valor_texto
            INTO v_orig
            FROM ordenes_de_produccion_estudios_partes rtp
            LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
            WHERE rtp.estudio_id = id_colada
            AND par.parte = 'PB' AND par.parametro = 'ORIG';

            SELECT valor_decimal
            INTO v_espesor
            FROM ordenes_de_produccion_estudios_partes rtp
            LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
            WHERE rtp.estudio_id = id_colada
            AND par.parte = 'PB' AND par.parametro = 'DIM2';

            SELECT valor_decimal * 1000
            INTO v_alargamiento_pb
            FROM ordenes_de_produccion_estudios_partes rtp
            LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
            WHERE rtp.estudio_id = id_colada
            AND par.parametro = 'ALAR'
            AND par.parte = 'MB';

            SELECT valor_decimal
            INTO v_flue_mb
            FROM ordenes_de_produccion_estudios_partes rtp
            LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
            WHERE rtp.estudio_id = id_colada
            AND par.parametro = 'FLUE'
            AND par.parte = 'MB';

            SELECT valor_decimal * 1000
            INTO v_dureza_mb
            FROM ordenes_de_produccion_estudios_partes rtp
            LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
            WHERE rtp.estudio_id = id_colada
            AND par.parametro = 'DURE'
            AND par.parte = 'MB';

            SELECT valor_decimal
            INTO v_rotu_mb
            FROM ordenes_de_produccion_estudios_partes rtp
            LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
            WHERE rtp.estudio_id = id_colada
            AND par.parametro = 'ROTU'
            AND par.parte = 'MB';
        END IF;

        IF v_flue_mb >= 260 THEN
            SET v_resultado = 'FLUENZA METAL BASE EN RANGO';
            SET v_resultado_id = 10;
        ELSE
            SET v_resultado = 'FLUENZA METAL POR DEBAJO DEL MINIMO';
            SET v_resultado_id = -1;
        END IF;

        IF es_cintolo = 0 THEN
            INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
            VALUES (id_colada, 18, v_flue_mb, v_resultado, v_resultado_id);
        ELSE
            INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
            VALUES (id_colada, 18, v_flue_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_dureza_mb < 197 THEN
            SET v_resultado = 'DUREZA METAL BASE EN RANGO';
            SET v_resultado_id = 10;
        ELSE
            SET v_resultado = 'DUREZA METAL POR ENCIMA DEL MAXIMO';
            SET v_resultado_id = 1;
        END IF;

        IF es_cintolo = 0 THEN
            INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
            VALUES (id_colada, 17 , v_dureza_mb, v_resultado, v_resultado_id);
        ELSE
            INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
            VALUES (id_colada, 17 , v_dureza_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_rotu_mb >= 485 THEN
            SET v_resultado = 'ROTURA METAL BASE EN RANGO';
            SET v_resultado_id = 10;
        ELSE
            SET v_resultado = 'ROTURA METAL POR DEBAJO DEL MINIMO';
            SET v_resultado_id = -1;
        END IF;
        
        IF es_cintolo = 0 THEN
            INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
            VALUES (id_colada, 20, v_rotu_mb, v_resultado, v_resultado_id);
        ELSE
            INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
            VALUES (id_colada, 20, v_rotu_mb, v_resultado, v_resultado_id);
        END IF;
        
        IF v_grupo = 10 THEN
            IF v_probeta LIKE '50%' THEN
                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  IF(v_alargamiento_pb < 0.21, 'MENOR al MINIMO ', 'EN RANGO'));
                SET v_resultado_id = IF(v_alargamiento_pb < 0.21, -1, 10);
            ELSE
                IF v_probeta = '200' THEN
                    SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  IF(v_alargamiento_pb < 0.17, 'MENOR al MINIMO ', 'EN RANGO'));
                    SET v_resultado_id = IF(v_alargamiento_pb < 0.17, -1, 10);
                ELSE
                    SET v_resultado = 'ALARGAMIENTO NO PUEDE CALCULARSE - PROBETA FUERA DE LO PREVISTO ';
                    SET v_resultado_id = 0;
                END IF;
            END IF;
        END IF;
    
        IF es_cintolo = 0 THEN
            INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
            VALUES (id_colada, 39, v_alargamiento_pb, v_resultado, v_resultado_id);
        ELSE
            INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
            VALUES (id_colada, 39, v_alargamiento_pb, v_resultado, v_resultado_id);
        END IF;

        RETURN v_resultado;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `analisis_mecanicos_grupo111`(es_cintolo BOOLEAN) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_general_ci
BEGIN
        DECLARE v_grupo INT;
        DECLARE v_tipo VARCHAR(2);
        DECLARE v_orig VARCHAR(2);
        DECLARE v_espesor DOUBLE;
        DECLARE v_alargamiento_pb DOUBLE;
        DECLARE v_flue_mb DOUBLE;
        DECLARE v_rotu_mb DOUBLE;
        DECLARE v_dureza_mb DOUBLE;
        DECLARE v_resultado VARCHAR(100);
        DECLARE v_resultado_id INT;
        SET v_grupo = 111;

        IF es_cintolo = 0 THEN
                SELECT valor_texto
                INTO v_tipo
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal * 1000
                INTO v_alargamiento_pb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'ALAR'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_flue_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                SELECT valor_decimal * 1000
                INTO v_dureza_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_rotu_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';

        ELSE
                SELECT valor_texto
                INTO v_tipo
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal * 1000
                INTO v_alargamiento_pb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'ALAR'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_flue_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                SELECT valor_decimal * 1000
                INTO v_dureza_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_rotu_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';

        END IF;


        IF v_flue_mb >= 310 THEN
                SET v_resultado = 'FLUENZA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'FLUENZA METAL POR DEBAJO DEL MINIMO';
                SET v_resultado_id = -1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 18, v_flue_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 18, v_flue_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_dureza_mb <= 217 THEN
                SET v_resultado = 'DUREZA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'DUREZA METAL POR ENCIMA DEL MAXIMO';
                SET v_resultado_id = 1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 17 , v_dureza_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 17 , v_dureza_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_rotu_mb >= 520 THEN
                SET v_resultado = 'ROTURA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'ROTURA METAL POR DEBAJO DEL MINIMO';
                SET v_resultado_id = -1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 20 , v_rotu_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 20 , v_rotu_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_grupo = 111 THEN
                IF v_tipo = 'R' THEN
                        IF v_orig = 'L' THEN
                                IF v_espesor >= 7.94 THEN
                                        SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < 0.30, 'MENOR al MINIMO ', 'EN RANGO'));
                                        SET v_resultado_id = if(v_alargamiento_pb < 0.30, -1, 10);
                                ELSE
                                        SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < ( 48 * (v_espesor / 25.4 ) + 15), 'MENOR al MINIMO ', 'EN RANGO'));
                                        SET v_resultado_id = if(v_alargamiento_pb < ( 48 * (v_espesor / 25.4 ) + 15), -1, 10);
                                END IF;
                        ELSE
                                IF v_espesor >= 7.94 THEN
                                        SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < 0.20, 'MENOR al MINIMO ', 'EN RANGO'));
                                        SET v_resultado_id = if(v_alargamiento_pb < 0.20, -1, 10);
                                ELSE
                                        SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < ( 32 * (v_espesor / 25.4 ) + 15), 'MENOR al MINIMO ', 'EN RANGO'));
                                        SET v_resultado_id = if(v_alargamiento_pb < ( 32 * (v_espesor / 25.4 ) + 10), -1, 10);

                                END IF;
                        END IF;
                ELSE
                        SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < IF (v_tipo = 'L', 0.22, 0.14), 'MENOR al MINIMO ', 'EN RANGO'));
                        SET v_resultado_id = if(v_alargamiento_pb < IF (v_tipo = 'L', 0.22, 0.14), -1, 10);
                END IF;
        END IF;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 39 , v_alargamiento_pb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 39 , v_alargamiento_pb, v_resultado, v_resultado_id);
        END IF;

        RETURN v_resultado;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `analisis_mecanicos_grupo112y113`(es_cintolo BOOLEAN) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_general_ci
BEGIN
        DECLARE v_grupo INT;
        DECLARE v_tipo VARCHAR(2);
        DECLARE v_orig VARCHAR(2);
        DECLARE v_espesor DOUBLE;
        DECLARE v_alargamiento_pb DOUBLE;
        DECLARE v_flue_mb DOUBLE;
        DECLARE v_rotu_mb DOUBLE;
        DECLARE v_dureza_mb DOUBLE;
        DECLARE v_resultado VARCHAR(100);
        DECLARE v_resultado_id INT;

        IF es_cintolo = 0 THEN
                SELECT valor_texto
                INTO v_tipo
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal * 1000
                INTO v_alargamiento_pb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'ALAR'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_flue_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                SELECT valor_decimal * 1000
                INTO v_dureza_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_rotu_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';

        ELSE
                SELECT valor_texto
                INTO v_tipo
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal * 1000
                INTO v_alargamiento_pb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'ALAR'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_flue_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                SELECT valor_decimal * 1000
                INTO v_dureza_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_rotu_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';
        END IF;

        IF v_flue_mb >= 275 THEN
                SET v_resultado = 'FLUENZA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'FLUENZA METAL POR DEBAJO DEL MINIMO';
                SET v_resultado_id = -1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 18, v_flue_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 18, v_flue_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_dureza_mb <= 197 THEN
                SET v_resultado = 'DUREZA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'DUREZA METAL POR ENCIMA DEL MAXIMO';
                SET v_resultado_id = 1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 17 , v_dureza_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 17 , v_dureza_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_rotu_mb >= 485 THEN
                SET v_resultado = 'ROTURA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'ROTURA METAL POR DEBAJO DEL MINIMO';
                SET v_resultado_id = -1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 20 , v_rotu_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 20 , v_rotu_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_tipo = 'R' THEN
                IF v_orig = 'L' THEN
                        IF v_espesor >= 7.94 THEN
                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < 0.30, 'MENOR al MINIMO ', 'EN RANGO'));
                                SET v_resultado_id = if(v_alargamiento_pb < 0.30, -1, 10);
                        ELSE
                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < ( 48 * (v_espesor / 25.4 ) + 15), 'MENOR al MINIMO ', 'EN RANGO'));
                                SET v_resultado_id = if(v_alargamiento_pb < ( 48 * (v_espesor / 25.4 ) + 15), -1, 10);
                        END IF  ;
                ELSE
                        IF v_espesor >= 7.94 THEN
                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < 0.20, 'MENOR al MINIMO ', 'EN RANGO'));
                                SET v_resultado_id = if(v_alargamiento_pb < 0.20, -1, 10);
                        ELSE
                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < ( 32 * (v_espesor / 25.4 ) + 15), 'MENOR al MINIMO ', 'EN RANGO'));
                                SET v_resultado_id = if(v_alargamiento_pb < ( 32 * (v_espesor / 25.4 ) + 10), -1, 10);

                        END IF  ;
                END IF;
        ELSE
                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < IF (v_tipo = 'L', 0.22, 0.14), 'MENOR al MINIMO ', 'EN RANGO'));
                SET v_resultado_id = if(v_alargamiento_pb < IF (v_tipo = 'L', 0.22, 0.14), -1, 10);
        END IF;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 39 , v_alargamiento_pb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 39 , v_alargamiento_pb, v_resultado, v_resultado_id);
        END IF;

        RETURN v_resultado;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `analisis_mecanicos_grupo12`(id_colada INT, es_cintolo BOOLEAN) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_general_ci
BEGIN
        DECLARE v_grupo INT;
        DECLARE v_tipo VARCHAR(2);
        DECLARE v_orig VARCHAR(2);
        DECLARE v_espesor DOUBLE;
        DECLARE v_alargamiento_pb DOUBLE;
        DECLARE v_flue_mb DOUBLE;
        DECLARE v_rotu_mb DOUBLE;
        DECLARE v_dureza_mb DOUBLE;
        DECLARE v_resultado VARCHAR(100);
        DECLARE v_resultado_id INT;

        SET v_grupo = 12;

        IF es_cintolo = 0 THEN
                SELECT valor_texto
                INTO v_tipo
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal * 1000
                INTO v_alargamiento_pb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'ALAR'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_flue_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                SELECT valor_decimal * 1000
                INTO v_dureza_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_rotu_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';

        ELSE
                SELECT valor_texto
                INTO v_tipo
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal * 1000
                INTO v_alargamiento_pb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'ALAR'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_flue_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                SELECT valor_decimal * 1000
                INTO v_dureza_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_rotu_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';
        END IF;

        IF v_flue_mb >= 205 THEN
                SET v_resultado = 'FLUENZA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'FLUENZA METAL POR DEBAJO DEL MINIMO';
                SET v_resultado_id = -1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 18, v_flue_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 18, v_flue_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_dureza_mb <= 197 THEN
                SET v_resultado = 'DUREZA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'DUREZA METAL POR ENCIMA DEL MAXIMO';
                SET v_resultado_id = 1;
        END IF;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 17 , v_dureza_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 17 , v_dureza_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_rotu_mb >= 515 THEN
                SET v_resultado = 'ROTURA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'ROTURA METAL POR DEBAJO DEL MINIMO';
                SET v_resultado_id = -1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 20 , v_rotu_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 20 , v_rotu_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_tipo = 'L' THEN
                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < 0.28, 'MENOR al MINIMO ', 'EN RANGO'));
                SET v_resultado_id = if(v_alargamiento_pb < 0.28, -1, 10);
        ELSE
                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < 0.2, 'MENOR al MINIMO ', 'EN RANGO'));
                SET v_resultado_id = if(v_alargamiento_pb < 0.2, -1, 10);
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 39 , v_alargamiento_pb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 39 , v_alargamiento_pb, v_resultado, v_resultado_id);
        END IF;

        RETURN v_resultado;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `analisis_mecanicos_grupo223`(es_cintolo BOOLEAN) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_general_ci
BEGIN
        DECLARE v_grupo INT;
        DECLARE v_tipo VARCHAR(2);
        DECLARE v_orig VARCHAR(2);
        DECLARE v_espesor DOUBLE;
        DECLARE v_alargamiento_pb DOUBLE;
        DECLARE v_flue_mb DOUBLE;
        DECLARE v_rotu_mb DOUBLE;
        DECLARE v_dureza_mb DOUBLE;
        DECLARE v_resultado VARCHAR(100);
        DECLARE v_resultado_id INT;
        SET v_grupo = 223;

        IF es_cintolo = 0 THEN
                SELECT valor_texto
                INTO v_tipo
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal *1000
                INTO v_alargamiento_pb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'ALAR'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_flue_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                SELECT valor_decimal * 1000
                INTO v_dureza_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_rotu_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';
        ELSE
                SELECT valor_texto
                INTO v_tipo
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal *1000
                INTO v_alargamiento_pb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'ALAR'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_flue_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                SELECT valor_decimal * 1000
                INTO v_dureza_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_rotu_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';

        END IF;

        IF v_flue_mb >= 310 THEN
            SET v_resultado = 'FLUENZA METAL BASE EN RANGO';
            SET v_resultado_id = 10;
        ELSE
            SET v_resultado = 'FLUENZA METAL POR DEBAJO DEL MINIMO';
            SET v_resultado_id = -1;
        END if;

        IF es_cintolo = 0 THEN
            INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
            VALUES (id_colada, 18, v_flue_mb, v_resultado, v_resultado_id);
        ELSE
            INSERT INTO ordenes_de_produccion_estudios_partes (estudio_id, parametro_id, valor, resultado, resultado_id)
            VALUES (id_colada, 18, v_flue_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_dureza_mb <= 217 THEN
            SET v_resultado = 'DUREZA METAL BASE EN RANGO';
            SET v_resultado_id = 10;
        ELSE
            SET v_resultado = 'DUREZA METAL POR ENCIMA DEL MAXIMO';
            SET v_resultado_id = 1;
        END if;

        IF es_cintolo = 0 THEN
            INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
            VALUES (id_colada, 17, v_dureza_mb, v_resultado, v_resultado_id);
        ELSE
            INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
            VALUES (id_colada, 17, v_dureza_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_rotu_mb >= 520 THEN
            SET v_resultado = 'ROTURA METAL BASE EN RANGO';
            SET v_resultado_id = 10;
        ELSE
            SET v_resultado = 'ROTURA METAL POR DEBAJO DEL MINIMO';
            SET v_resultado_id = -1;
        END if;

        IF es_cintolo = 0 THEN
            INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
            VALUES (id_colada, 20, v_rotu_mb, v_resultado, v_resultado_id);
        ELSE
            INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
            VALUES (id_colada, 20, v_rotu_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_grupo = 223 THEN
                IF v_tipo = 'R' THEN
                        IF v_orig = 'L' THEN
                                IF v_espesor >= 7.94 THEN
                                        SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < 0.30, 'MENOR al MINIMO ', 'EN RANGO'));
                                        SET v_resultado_id = if(v_alargamiento_pb < 0.30, -1, 10);
                                ELSE
                                        SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < ( 48 * (v_espesor / 25.4 ) + 15), 'MENOR al MINIMO ', 'EN RANGO'));
                                        SET v_resultado_id = if(v_alargamiento_pb < ( 48 * (v_espesor / 25.4 ) + 15), -1, 10);
                                END IF  ;
                        ELSE
                                IF v_espesor >= 7.94 THEN
                                        SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < 0.20, 'MENOR al MINIMO ', 'EN RANGO'));
                                        SET v_resultado_id = if(v_alargamiento_pb < 0.20, -1, 10);
                                ELSE
                                        SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < ( 32 * (v_espesor / 25.4 ) + 15), 'MENOR al MINIMO ', 'EN RANGO'));
                                        SET v_resultado_id = if(v_alargamiento_pb < ( 32 * (v_espesor / 25.4 ) + 10), -1, 10);
                                END IF  ;
                        END IF;
                ELSE
                        SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < IF (v_tipo = 'L', 0.22, 0.14), 'MENOR al MINIMO ', 'EN RANGO'));
                        SET v_resultado_id = if(v_alargamiento_pb < IF (v_tipo = 'L', 0.22, 0.14), -1, 10);
                END IF;
        END IF;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 39 , v_alargamiento_pb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_partes (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 39 , v_alargamiento_pb, v_resultado, v_resultado_id);
        END IF;

        RETURN v_resultado;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'NO_AUTO_VALUE_ON_ZERO' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `analisis_mecanicos_grupo224`(`id_colada` INT,
	`es_cintolo` INT
) RETURNS varchar(100) CHARSET utf8mb4 COLLATE utf8mb4_general_ci
BEGIN
       DECLARE v_grupo INT;
        DECLARE v_tipo VARCHAR(2);
        DECLARE v_orig VARCHAR(2);
        DECLARE v_espesor DOUBLE;
        DECLARE v_alargamiento_pb DOUBLE;
        DECLARE v_flue_mb DOUBLE;
        DECLARE v_rotu_mb DOUBLE;
        DECLARE v_dureza_mb DOUBLE;
        DECLARE v_resultado VARCHAR(100);
        DECLARE v_resultado_id INT;

        SET v_grupo = 224;

                SELECT valor_texto
                INTO v_tipo
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal *1000
                INTO v_alargamiento_pb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'ALAR'
                AND par.parte = 'PB';



                SELECT valor_decimal
                INTO v_flue_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                if v_flue_mb >= 310 then
                        SET v_resultado = 'FLUENZA METAL BASE EN RANGO';
                        SET v_resultado_id = 10;
                ELSE
                        SET v_resultado = 'FLUENZA METAL POR DEBAJO DEL MINIMO';
                        SET v_resultado_id = -1;
                END if;
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 18 , v_flue_mb, v_resultado, v_resultado_id);

                SELECT valor_decimal * 1000
                INTO v_dureza_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';

                if v_dureza_mb <= 197 then
                        SET v_resultado = 'DUREZA METAL BASE EN RANGO';
                        SET v_resultado_id = 10;
                ELSE
                        SET v_resultado = 'DUREZA METAL POR ENCIMA DEL MAXIMO';
                        SET v_resultado_id = 1;
                END if;
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 17 , v_dureza_mb, v_resultado, v_resultado_id);





                SELECT valor_decimal
                INTO v_rotu_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';

                if v_rotu_mb >= 520 then
                        SET v_resultado = 'ROTURA METAL BASE EN RANGO';
                        SET v_resultado_id = 10;
                ELSE
                        SET v_resultado = 'ROTURA METAL POR DEBAJO DEL MINIMO';
                        SET v_resultado_id = -1;
                END if;
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 20 , v_rotu_mb, v_resultado, v_resultado_id);


                if v_grupo = 224 THEN
                        if v_tipo = 'R' THEN
                                if v_orig = 'L' THEN
                                        if v_espesor >= 7.94 THEN
                                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < 0.30, 'MENOR al MINIMO ', 'EN RANGO'));
                                                SET v_resultado_id = if(v_alargamiento_pb < 0.30, -1, 10);
                                        else
                                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < ( 48 * (v_espesor / 25.4 ) + 15), 'MENOR al MINIMO ', 'EN RANGO'));
                                                SET v_resultado_id = if(v_alargamiento_pb < ( 48 * (v_espesor / 25.4 ) + 15), -1, 10);

                                        END IF  ;
                                ELSE
                                        if v_espesor >= 7.94 THEN
                                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < 0.20, 'MENOR al MINIMO ', 'EN RANGO'));
                                                SET v_resultado_id = if(v_alargamiento_pb < 0.20, -1, 10);
                                        else
                                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < ( 32 * (v_espesor / 25.4 ) + 15), 'MENOR al MINIMO ', 'EN RANGO'));
                                                SET v_resultado_id = if(v_alargamiento_pb < ( 32 * (v_espesor / 25.4 ) + 10), -1, 10);

                                        END IF  ;

                                END IF;
                        ELSE
                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < if (v_tipo = 'L', 0.22, 0.14), 'MENOR al MINIMO ', 'EN RANGO'));
                                SET v_resultado_id = if(v_alargamiento_pb < if (v_tipo = 'L', 0.22, 0.14), -1, 10);


                        END IF;
                END IF;
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada,39 , v_alargamiento_pb, v_resultado, v_resultado_id);

                RETURN v_resultado;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Analisis_mecanicos_grupo42a70`(id_cintolo INT, es_cintolo BOOLEAN, p_grupo INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_general_ci
BEGIN

    DECLARE v_grupo INT;
    DECLARE v_probeta DOUBLE;
    DECLARE v_tipo VARCHAR(2);
    DECLARE v_orig VARCHAR(2);
    DECLARE v_espesor DOUBLE;
    DECLARE v_alargamiento_pb DOUBLE;
    DECLARE v_flue_mb DOUBLE;
    DECLARE v_rotu_mb DOUBLE;
    DECLARE v_dureza_mb DOUBLE;
    DECLARE v_resultado VARCHAR(100);
    DECLARE v_resultado_id INT;
    DECLARE v_flue_min DOUBLE;
    DECLARE v_rotu_min DOUBLE;
    DECLARE v_charpy_promedio DOUBLE;
    DECLARE v_charpy_minimo DOUBLE;
    DECLARE v_tamaño_probeta VARCHAR(20);
    SET v_grupo = p_grupo;

        IF es_cintolo = 0 THEN
                SELECT valor_texto
                INTO v_probeta
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_cintolo
                AND par.parametro = 'PROB'
                AND par.parte = 'PB';

                SELECT valor_texto
                INTO v_tipo
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_cintolo
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_cintolo
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_cintolo
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal *1000
                INTO v_alargamiento_pb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_cintolo
                AND par.parametro = 'ALAR'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_flue_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_cintolo
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                SELECT AVG(valor_decimal), MIN(valor_decimal)
                INTO v_charpy_promedio, v_charpy_minimo
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_cintolo
                AND par.parametro IN ('PRB1', 'PRB2', 'PRB3')
                AND par.parte = 'MB';

                SELECT valor_texto
                INTO v_tamaño_probeta
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_cintolo
                AND par.parte = 'MB' AND par.parametro = 'TPRO';

                SELECT valor_decimal
                INTO v_dureza_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_cintolo
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_rotu_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_cintolo
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';

        ELSE
                SELECT valor_texto
                INTO v_probeta
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_cintolo
                AND par.parametro = 'PROB'
                AND par.parte = 'PB';

                SELECT valor_texto
                INTO v_tipo
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_cintolo
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_cintolo
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_cintolo
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal *1000
                INTO v_alargamiento_pb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_cintolo
                AND par.parametro = 'ALAR'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_flue_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_cintolo
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                SELECT AVG(valor_decimal), MIN(valor_decimal)
                INTO v_charpy_promedio, v_charpy_minimo
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_cintolo
                AND par.parametro IN ('PRB1', 'PRB2', 'PRB3')
                AND par.parte = 'MB';

                SELECT valor_texto
                INTO v_tamaño_probeta
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_cintolo
                AND par.parte = 'MB' AND par.parametro = 'TPRO';

                SELECT valor_decimal
                INTO v_dureza_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_cintolo
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_rotu_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_cintolo
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';

        END IF;

        CASE v_grupo
                WHEN 42 THEN
                        SET v_flue_min = 290;
                WHEN 46 THEN
                        SET v_flue_min = 318;
                WHEN 52 THEN
                        set v_flue_min = 359;
                WHEN 56 THEN
                        set v_flue_min = 387;
                WHEN 60 THEN
                        SET v_flue_min = 414;
                when 65 THEN
                        set v_flue_min =449;
                WHEN 70 THEN
                        set v_flue_min = 483 ;
        END CASE;

        IF v_flue_mb >= v_flue_min THEN
            SET v_resultado = 'FLUENZA METAL BASE EN RANGO';
            SET v_resultado_id = 10;
            ELSE
            SET v_resultado = 'FLUENZA METAL POR DEBAJO DEL MINIMO';
            SET v_resultado_id = -1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_cintolo, 18 , v_flue_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_cintolo, 18 , v_flue_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_dureza_mb < 235 THEN
                SET v_resultado = 'DUREZA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'DUREZA METAL POR ENCIMA DEL MAXIMO';
                SET v_resultado_id = 1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_cintolo, 17 , v_dureza_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_cintolo, 17 , v_dureza_mb, v_resultado, v_resultado_id);
        END IF;


        CASE v_grupo
                WHEN 42 THEN
                        SET v_rotu_min = 414 ;
                WHEN 46 THEN
                        SET v_rotu_min = 435 ;
                WHEN 52 THEN
                        set v_rotu_min = 456;
                WHEN 56 THEN
                        set v_rotu_min = 490;
                WHEN 60 THEN
                        SET v_rotu_min = 518;
                when 65 THEN
                        set v_rotu_min = 531;
                WHEN 70 THEN
                        set v_flue_min = 566;
        END CASE;

        IF v_rotu_mb >= v_rotu_min THEN
                SET v_resultado = 'ROTURA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'ROTURA METAL POR DEBAJO DEL MINIMO';
                SET v_resultado_id = -1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_cintolo, 20 , v_rotu_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_cintolo, 20 , v_rotu_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_probeta = 50.8 THEN
                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < if(v_grupo IN (42,46,52), 0.25, IF (v_grupo = 70, 18, 20)), 'MENOR al MINIMO ', 'EN RANGO'));
                SET v_resultado_id = if(v_resultado like '%MENOR%', -1, 10);
        ELSE
                SET v_resultado = 'ALARGAMIENTO NO PUEDE CALCULARSE - PROBETA FUERA DE LO PREVISTO ';
                SET v_resultado_id = 0;
        END if;


        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_cintolo,39 , v_alargamiento_pb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_cintolo,39 , v_alargamiento_pb, v_resultado, v_resultado_id);
        END IF;

        IF v_tamaño_probeta like '10 X 10%' THEN
                SET v_resultado = CONCAT ('Promedio Charpy Metal Base - ', if(v_charpy_promedio > 0.272, 'RANGO CORRECTO', 'INFERIOR AL MINIMO'));
                SET v_resultado_id = IF (v_charpy_promedio > 0.272, 10, -1);
        ELSE
                SET v_resultado = CONCAT ('Promedio Charpy Metal Base - ', if(v_charpy_promedio > 0.2, 'RANGO CORRECTO', 'INFERIOR AL MINIMO'));
                SET v_resultado_id = if(v_charpy_promedio > 0.2 , 10, -1);
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_cintolo,95 , v_charpy_promedio, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_cintolo,95 , v_charpy_promedio, v_resultado, v_resultado_id);
        END IF;

        IF v_tamaño_probeta LIKE '10 X 10%' THEN
                SET v_resultado = CONCAT ('Charpy Metal Base (valor mínimo) ', IF ( v_charpy_minimo > 0.204, 'RANGO CORRECTO', 'INFERIOR AL MINIMO'));
                SET v_resultado_id = IF ( v_charpy_minimo  > 0.204, 10, -1);
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_cintolo,94 , v_charpy_minimo, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_cintolo,94 , v_charpy_minimo, v_resultado, v_resultado_id);
        END IF;

        RETURN v_resultado;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `analisis_mecanicos_grupo6`(id_colada INT, es_cintolo BOOLEAN) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_general_ci
BEGIN
        DECLARE v_grupo INT;
        DECLARE v_probeta DOUBLE;
        DECLARE v_tipo VARCHAR(2);
        DECLARE v_orig VARCHAR(2);
        DECLARE v_espesor DOUBLE;
        DECLARE v_alargamiento_pb DOUBLE;
        DECLARE v_flue_mb DOUBLE;
        DECLARE v_rotu_mb DOUBLE;
        DECLARE v_dureza_mb DOUBLE;
        DECLARE v_resultado VARCHAR(100);
        DECLARE v_resultado_id INT;
        DECLARE v_flue_min DOUBLE;
        DECLARE v_rotu_min DOUBLE;
        DECLARE v_dure_max DOUBLE;
        DECLARE v_rotu_max DOUBLE;
        DECLARE v_charpy_promedio DOUBLE;
        DECLARE v_charpy_minimo DOUBLE;

        DECLARE v_tamaño_probeta VARCHAR(20);

        SET v_grupo = 6;
        SET v_flue_min = 240;
        SET v_rotu_min = 520;
        SET v_rotu_max = 655;
        SET v_dure_max = 197;

        IF es_cintolo = 0 THEN

                SELECT valor_texto
                INTO v_probeta
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'PROB'
                AND par.parte = 'PB';

                SELECT valor_texto
                INTO v_tipo
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal * 1000
                INTO v_alargamiento_pb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'ALAR'
                AND par.parte IN ( 'MB');

                SELECT valor_decimal
                INTO v_flue_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                SELECT AVG(valor_decimal), MIN(valor_decimal)
                INTO v_charpy_promedio, v_charpy_minimo
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id= id_colada
                AND par.parametro IN ('PRB1', 'PRB2', 'PRB3')
                AND par.parte = 'MB';

                SELECT valor_texto
                INTO v_tamaño_probeta
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'MB' AND par.parametro = 'TPRO';

                SELECT valor_decimal * 1000
                INTO v_dureza_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_rotu_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';

        ELSE
                SELECT valor_texto
                INTO v_probeta
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'PROB'
                AND par.parte = 'PB';

                SELECT valor_texto
                INTO v_tipo
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal * 1000
                INTO v_alargamiento_pb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'ALAR'
                AND par.parte IN ('MB');

                SELECT valor_decimal
                INTO v_flue_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                SELECT AVG(valor_decimal), MIN(valor_decimal)
                INTO v_charpy_promedio, v_charpy_minimo
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro IN ('PRB1', 'PRB2', 'PRB3')
                AND par.parte = 'MB';

                SELECT valor_texto
                INTO v_tamaño_probeta
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'MB' AND par.parametro = 'TPRO';

                SELECT valor_decimal * 1000
                INTO v_dureza_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_rotu_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';

        END IF;

        IF v_flue_mb >= v_flue_min THEN
            SET v_resultado = 'FLUENZA METAL BASE EN RANGO';
            SET v_resultado_id = 10;
        ELSE
            SET v_resultado = 'FLUENZA METAL POR DEBAJO DEL MINIMO';
                    SET v_resultado_id = -1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 18, v_flue_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 18, v_flue_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_dureza_mb < v_dure_max THEN
                SET v_resultado = 'DUREZA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'DUREZA METAL POR ENCIMA DEL MAXIMO';
                SET v_resultado_id = 1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 17 , v_dureza_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 17 , v_dureza_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_rotu_mb >= v_rotu_min THEN
                SET v_resultado = 'ROTURA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'ROTURA METAL POR DEBAJO DEL MINIMO';
                SET v_resultado_id = -1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 20 , v_rotu_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 20 , v_rotu_mb, v_resultado, v_resultado_id);
        END IF;


                IF v_tipo = 'R' THEN
                   IF v_orig = 'L' THEN
                      IF v_espesor >= 7.94 THEN
                         SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < 0.30, 'MENOR al MINIMO ', 'EN RANGO'));
                         SET v_resultado_id = if(v_alargamiento_pb < 0.30, -1, 10);
                       ELSE
                          SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < ( 48 * (v_espesor / 25.4 ) + 15), 'MENOR al MINIMO ', 'EN RANGO'));
                          SET v_resultado_id = if(v_alargamiento_pb < ( 48 * (v_espesor / 25.4 ) + 15), -1, 10);

                        END IF  ;
                     ELSE
                     IF v_espesor >= 7.94 THEN
                        SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < 0.20, 'MENOR al MINIMO ', 'EN RANGO'));
                        SET v_resultado_id = if(v_alargamiento_pb < 0.20, -1, 10);
                     ELSE
                        SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < ( 32 * (v_espesor / 25.4 ) + 15), 'MENOR al MINIMO ', 'EN RANGO'));
                        SET v_resultado_id = if(v_alargamiento_pb < ( 32 * (v_espesor / 25.4 ) + 10), -1, 10);
                      END IF  ;

                                END IF;
                        ELSE
                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < IF (v_tipo = 'L', 0.22, 0.14), 'MENOR al MINIMO ', 'EN RANGO'));
                                SET v_resultado_id = if(v_alargamiento_pb < IF (v_tipo = 'L', 0.22, 0.14), -1, 10);


                        END IF;

        IF es_cintolo = 0 THEN

                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 39 , v_alargamiento_pb, v_resultado, v_resultado_id);
        ELSE

                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 39 , v_alargamiento_pb, v_resultado, v_resultado_id);
        END IF;



        IF v_tamaño_probeta = '10 X 10 X 55 MM' THEN
                SET v_resultado = CONCAT ('Promedio Charpy Metal Base - ', if(v_charpy_promedio > 0.18, 'RANGO CORRECTO', 'INFERIOR AL MINIMO'));
                SET v_resultado_id = IF (v_charpy_promedio > 0.18, 10, -1);
        ELSE
                IF v_tamaño_probeta = '10 X 7.5 X 55MM' THEN
                                                                SET v_resultado = CONCAT ('Promedio Charpy Metal Base - ', if(v_charpy_promedio > 0.14, 'RANGO CORRECTO', 'INFERIOR AL MINIMO'));
                        SET v_resultado_id = if(v_charpy_promedio > 0.14 , 10, -1);
                                ELSE
                                        IF v_tamaño_probeta = '10 X 5 X 55MM' THEN
                                                                        SET v_resultado = CONCAT ('Promedio Charpy Metal Base - ', if(v_charpy_promedio > 0.09, 'RANGO CORRECTO', 'INFERIOR AL MINIMO'));
                                SET v_resultado_id = if(v_charpy_promedio > 0.09 , 10, -1);
                                        ELSE
                                                SET v_resultado = CONCAT ('Promedio Charpy Metal Base - ', if(v_charpy_promedio > 0.05, 'RANGO CORRECTO', 'INFERIOR AL MINIMO'));
                                SET v_resultado_id = if(v_charpy_promedio > 0.05 , 10, -1);
                                        END IF;
                                                        END if;
        END if;


        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada,95 , v_charpy_promedio, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada,95 , v_charpy_promedio, v_resultado, v_resultado_id);
        END IF;

        IF v_tamaño_probeta = '10 X 10 X 55 MM' THEN
                        SET v_resultado = CONCAT ('Charpy Metal Base (valor mínimo) ', IF ( v_charpy_minimo > 0.14, 'RANGO CORRECTO', 'INFERIOR AL MINIMO'));
                        SET v_resultado_id = IF ( v_charpy_minimo  > 0.14, 10, -1);
        ELSE
                       IF v_tamaño_probeta = '10 X 7.5 X 55MM' THEN
                                          SET v_resultado = CONCAT ('Charpy Metal Base (valor mínimo) ', IF ( v_charpy_minimo > 0.11, 'RANGO CORRECTO', 'INFERIOR AL MINIMO'));
                        SET v_resultado_id = IF ( v_charpy_minimo  > 0.11, 10, -1);
              ELSE
                        IF v_tamaño_probeta = '10 X 5 X 55MM' THEN
                                                   SET v_resultado = CONCAT ('Charpy Metal Base (valor mínimo) ', IF ( v_charpy_minimo > 0.7, 'RANGO CORRECTO', 'INFERIOR AL MINIMO'));
                        SET v_resultado_id = IF ( v_charpy_minimo  > 0.7, 10, -1);
                                                ELSE
                                                        SET v_resultado = CONCAT ('Charpy Metal Base (valor mínimo) ', IF ( v_charpy_minimo > 0.4, 'RANGO CORRECTO', 'INFERIOR AL MINIMO'));
                        SET v_resultado_id = IF ( v_charpy_minimo  > 0.4, 10, -1);
                                                END IF;
                                  END IF;
                  END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada,94 , v_charpy_minimo, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada,94 , v_charpy_minimo, v_resultado, v_resultado_id);
        END IF;

        RETURN v_resultado;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `analisis_mecanicos_grupo7_8_13`(id_colada INT, es_cintolo BOOLEAN, p_grupo INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_general_ci
BEGIN
        DECLARE v_grupo INT;
        DECLARE v_probeta VARCHAR(50);
        DECLARE v_tipo VARCHAR(2);
        DECLARE v_orig VARCHAR(2);
        DECLARE v_espesor DOUBLE;
        DECLARE v_alargamiento_pb DOUBLE;
        DECLARE v_flue_mb DOUBLE;
        DECLARE v_rotu_mb DOUBLE;
        DECLARE v_dureza_mb DOUBLE;
        DECLARE v_resultado VARCHAR(100);
        DECLARE v_resultado_id INT;
        DECLARE v_flue_min DOUBLE;
        DECLARE v_rotu_min DOUBLE;
        DECLARE v_dure_max DOUBLE;
        SET v_grupo = p_grupo;
        SET v_flue_min = 205;
        SET v_dure_max = 197;
        SET v_rotu_min = 505;

        IF es_cintolo = 0 THEN
                SELECT valor_texto
                INTO v_probeta
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'PROB'
                AND par.parte = 'PB';

                SELECT valor_texto
                INTO v_tipo
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal * 1000
                INTO v_alargamiento_pb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'ALAR'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_flue_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                SELECT valor_decimal * 1000
                INTO v_dureza_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_rotu_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';
        ELSE
                SELECT valor_texto
                INTO v_probeta
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'PROB'
                AND par.parte = 'PB';

                SELECT valor_texto
                INTO v_tipo
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal * 1000
                INTO v_alargamiento_pb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'ALAR'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_flue_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                SELECT valor_decimal * 1000
                INTO v_dureza_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_rotu_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON par.id = rtp.parametro_id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';
        END IF;

        IF v_flue_mb >= v_flue_min THEN
                SET v_resultado = 'FLUENZA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'FLUENZA METAL POR DEBAJO DEL MINIMO';
                SET v_resultado_id = -1;
        END if;


        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 18, v_flue_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 18, v_flue_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_dureza_mb < v_dure_max THEN
                SET v_resultado = 'DUREZA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'DUREZA METAL POR ENCIMA DEL MAXIMO';
                SET v_resultado_id = 1;
        END if;

        if es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 17 , v_dureza_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 17 , v_dureza_mb, v_resultado, v_resultado_id);
        END IF;


        IF v_rotu_mb >= v_rotu_min THEN
                SET v_resultado = 'ROTURA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'ROTURA METAL POR DEBAJO DEL MINIMO';
                SET v_resultado_id = -1;
        END IF;

        if es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 20 , v_rotu_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 20 , v_rotu_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_grupo IN ( 7,8,13) THEN
                IF v_probeta LIKE '50%' THEN
                    SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < IF (v_orig = 'L', 0.28, 0.2), 'MENOR al MINIMO ', 'EN RANGO'));
                    SET v_resultado_id = if(v_alargamiento_pb < IF ( v_orig = 'L', 0.28, 0.2), -1, 10);
                ELSE
                    SET v_resultado = 'ALARGAMIENTO NO PUEDE CALCULARSE - PROBETA FUERA DE LO PREVISTO ';
                    SET v_resultado_id = 0;
                END IF;
        END IF;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 39 , v_alargamiento_pb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 39 , v_alargamiento_pb, v_resultado, v_resultado_id);
        END IF;

        RETURN v_resultado;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Analisis_mecanicos_grupo_2`(id_colada INT, es_cintolo BOOLEAN) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_general_ci
BEGIN
        DECLARE v_grupo INT;
        DECLARE v_tipo VARCHAR(2);
        DECLARE v_orig VARCHAR(2);
        DECLARE v_espesor DOUBLE;
        DECLARE v_alargamiento_pb DOUBLE;
        DECLARE v_flue_mb DOUBLE;
        DECLARE v_rotu_mb DOUBLE;
        DECLARE v_dureza_mb DOUBLE;
        DECLARE v_resultado VARCHAR(100);
        DECLARE v_resultado_id INT;

        SET v_grupo = 2;

        IF es_cintolo = 0 THEN
                SELECT valor_texto
                INTO v_tipo
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal * 1000
                INTO v_alargamiento_pb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'ALAR'
                AND par.parte = 'PB';



                SELECT valor_decimal
                INTO v_flue_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_dureza_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_rotu_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';

        ELSE

                SELECT valor_texto
                INTO v_tipo
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal * 1000
                INTO v_alargamiento_pb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'ALAR'
                AND par.parte = 'PB';

                SELECT valor_decimal
                INTO v_flue_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_dureza_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_rotu_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';

        END IF;

        IF v_flue_mb >= 240 THEN
                SET v_resultado = 'FLUENZA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'FLUENZA METAL POR DEBAJO DEL MINIMO';
                SET v_resultado_id = -1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 18, v_flue_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 18, v_flue_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_dureza_mb < 197 THEN
                SET v_resultado = 'DUREZA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'DUREZA METAL POR ENCIMA DEL MAXIMO';
                SET v_resultado_id = 1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 17 , v_dureza_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 17 , v_dureza_mb, v_resultado, v_resultado_id);
        END IF;


        IF v_rotu_mb >= 415 THEN
                        SET v_resultado = 'ROTURA METAL BASE EN RANGO';
                        SET v_resultado_id = 10;
        ELSE
                        SET v_resultado = 'ROTURA METAL POR DEBAJO DEL MINIMO';
                        SET v_resultado_id = -1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 20 , v_rotu_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 20 , v_rotu_mb, v_resultado, v_resultado_id);
        END IF;


                IF v_grupo = 2 THEN
                        IF v_tipo = 'R' THEN
                                IF v_orig = 'L' THEN
                                        IF v_espesor >= 7.94 THEN
                                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < 0.30, 'MENOR al MINIMO ', 'EN RANGO'));
                                                SET v_resultado_id = if(v_alargamiento_pb < 0.30, -1, 10);
                                        ELSE
                                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < ( 48 * (v_espesor / 25.4 ) + 15), 'MENOR al MINIMO ', 'EN RANGO'));
                                                SET v_resultado_id = if(v_alargamiento_pb < ( 48 * (v_espesor / 25.4 ) + 15), -1, 10);

                                        END IF  ;
                                ELSE
                                        IF v_espesor >= 7.94 THEN
                                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < 0.20, 'MENOR al MINIMO ', 'EN RANGO'));
                                                SET v_resultado_id = if(v_alargamiento_pb < 0.20, -1, 10);
                                        ELSE
                                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < ( 48 * (v_espesor / 25.4 ) + 15), 'MENOR al MINIMO ', 'EN RANGO'));
                                                SET v_resultado_id = if(v_alargamiento_pb < ( 32 * (v_espesor / 25.4 ) + 10), -1, 10);

                                        END IF  ;

                                END IF;
                        ELSE
                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < IF (v_tipo = 'L', 0.22, 0.14), 'MENOR al MINIMO ', 'EN RANGO'));
                                SET v_resultado_id = if(v_alargamiento_pb < IF (v_tipo = 'L', 0.22, 0.14), -1, 10);


                        END IF;
                END IF;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 39 , v_alargamiento_pb, v_resultado, v_resultado_id);

        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 39 , v_alargamiento_pb, v_resultado, v_resultado_id);
        END IF;

        RETURN v_resultado;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `analisis_mecanico_grupo221`(id_colada INT, es_cintolo BOOLEAN) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_general_ci
BEGIN
        DECLARE v_grupo INT;
        DECLARE v_tipo VARCHAR(2);
        DECLARE v_orig VARCHAR(2);
        DECLARE v_espesor DOUBLE;
        DECLARE v_alargamiento_pb DOUBLE;
        DECLARE v_flue_mb DOUBLE;
        DECLARE v_rotu_mb DOUBLE;
        DECLARE v_dureza_mb DOUBLE;
        DECLARE v_resultado VARCHAR(100);
        DECLARE v_resultado_id INT;
        SET v_grupo = 221;

        IF es_cintolo = 0 THEN
                SELECT valor_texto
                INTO v_tipo
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal *1000
                INTO v_alargamiento_pb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'ALAR'
                AND par.parte = 'PB';

                SELECT valor_decimal
                INTO v_flue_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_dureza_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_rotu_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';
        ELSE
                SELECT valor_texto
                INTO v_tipo
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal *1000
                INTO v_alargamiento_pb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'ALAR'
                AND par.parte = 'PB';

                SELECT valor_decimal
                INTO v_flue_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_dureza_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_rotu_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';

        END IF;

        IF v_flue_mb >= 205 THEN
                SET v_resultado = 'FLUENZA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'FLUENZA METAL POR DEBAJO DEL MINIMO';
                SET v_resultado_id = -1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 18, v_flue_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_partes (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 18, v_flue_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_dureza_mb <= 197 THEN
            SET v_resultado = 'DUREZA METAL BASE EN RANGO';
            SET v_resultado_id = 10;
        ELSE
            SET v_resultado = 'DUREZA METAL POR ENCIMA DEL MAXIMO';
            SET v_resultado_id = 1;
        END if;

        IF es_cintolo = 0 THEN
            INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
            VALUES (id_colada, 17, v_dureza_mb, v_resultado, v_resultado_id);
        ELSE
            INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
            VALUES (id_colada, 17, v_dureza_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_rotu_mb >= 415 THEN
            SET v_resultado = 'ROTURA METAL BASE EN RANGO';
            SET v_resultado_id = 10;
        ELSE
            SET v_resultado = 'ROTURA METAL POR DEBAJO DEL MINIMO';
            SET v_resultado_id = -1;
        END if;

        IF es_cintolo = 0 THEN
            INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
            VALUES (id_colada, 20 , v_rotu_mb, v_resultado, v_resultado_id);
        ELSE
            INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
            VALUES (id_colada, 20 , v_rotu_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_grupo = 221 THEN
                IF v_tipo = 'R' THEN
                        IF v_orig = 'L' THEN
                                IF v_espesor >= 7.94 THEN
                                        SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < 0.30, 'MENOR al MINIMO ', 'EN RANGO'));
                                        SET v_resultado_id = if(v_alargamiento_pb < 0.30, -1, 10);
                                ELSE
                                        SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < ( 48 * (v_espesor / 25.4 ) + 15), 'MENOR al MINIMO ', 'EN RANGO'));
                                        SET v_resultado_id = if(v_alargamiento_pb < ( 48 * (v_espesor / 25.4 ) + 15), -1, 10);
                                END IF  ;
                        ELSE
                                IF v_espesor >= 7.94 THEN
                                        SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < 0.20, 'MENOR al MINIMO ', 'EN RANGO'));
                                        SET v_resultado_id = if(v_alargamiento_pb < 0.20, -1, 10);
                                ELSE
                                        SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < ( 32 * (v_espesor / 25.4 ) + 15), 'MENOR al MINIMO ', 'EN RANGO'));
                                        SET v_resultado_id = if(v_alargamiento_pb < ( 32 * (v_espesor / 25.4 ) + 10), -1, 10);
                                END IF  ;
                        END IF;
                ELSE
                        SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < IF (v_tipo = 'L', 0.22, 0.14), 'MENOR al MINIMO ', 'EN RANGO'));
                        SET v_resultado_id = if(v_alargamiento_pb < IF (v_tipo = 'L', 0.22, 0.14), -1, 10);
                END IF;
        END IF;

        IF es_cintolo = 0 THEN
            INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
            VALUES (id_colada, 39, v_alargamiento_pb, v_resultado, v_resultado_id);
        ELSE
            INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
            VALUES (id_colada, 39, v_alargamiento_pb, v_resultado, v_resultado_id);
        END IF;

        RETURN v_resultado;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `analisis_mecanico_grupo4`(id_colada INT, es_cintolo BOOLEAN) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_general_ci
BEGIN
        DECLARE v_grupo INT;
        DECLARE v_tipo VARCHAR(2);
        DECLARE v_orig VARCHAR(2);
        DECLARE v_espesor DOUBLE;
        DECLARE v_alargamiento_pb DOUBLE;
        DECLARE v_flue_mb DOUBLE;
        DECLARE v_rotu_mb DOUBLE;
        DECLARE v_dureza_mb DOUBLE;
        DECLARE v_resultado VARCHAR(100);
        DECLARE v_resultado_id INT;

        SET v_grupo = 4;

        IF es_cintolo = 0 THEN
                SELECT valor_texto
                INTO v_tipo
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal *1000
                INTO v_alargamiento_pb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'ALAR'
                AND par.parte = 'PB';

                SELECT valor_decimal
                INTO v_flue_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_rotu_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_dureza_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';
        ELSE
                SELECT valor_texto
                INTO v_tipo
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal *1000
                INTO v_alargamiento_pb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'ALAR'
                AND par.parte = 'PB';

                SELECT valor_decimal
                INTO v_flue_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_rotu_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';

                 SELECT valor_decimal
                INTO v_dureza_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';
        END IF;

        IF v_flue_mb >= 310 THEN
                SET v_resultado = 'FLUENZA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'FLUENZA METAL POR DEBAJO DEL MINIMO';
                SET v_resultado_id = -1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 18, v_flue_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 18, v_flue_mb, v_resultado, v_resultado_id);
        END IF;


        IF v_dureza_mb <= 217 THEN
                SET v_resultado = 'DUREZA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'DUREZA METAL POR ENCIMA DEL MAXIMO';
                SET v_resultado_id = 1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 17 , v_dureza_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 17 , v_dureza_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_rotu_mb >= 520 THEN
                        SET v_resultado = 'ROTURA METAL BASE EN RANGO';
                        SET v_resultado_id = 10;
        ELSE
                        SET v_resultado = 'ROTURA METAL POR DEBAJO DEL MINIMO';
                        SET v_resultado_id = -1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 20 , v_rotu_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 20 , v_rotu_mb, v_resultado, v_resultado_id);
        END IF;

                IF v_grupo = 4 THEN
                        IF v_tipo = 'R' THEN
                                IF v_orig = 'L' THEN
                                        IF v_espesor >= 7.94 THEN
                                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < 0.30, 'MENOR al MINIMO ', 'EN RANGO'));
                                                SET v_resultado_id = if(v_alargamiento_pb < 0.30, -1, 10);
                                        ELSE
                                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < ( 48 * (v_espesor / 25.4 ) + 15), 'MENOR al MINIMO ', 'EN RANGO'));
                                                SET v_resultado_id = if(v_alargamiento_pb < ( 48 * (v_espesor / 25.4 ) + 15), -1, 10);

                                        END IF  ;
                                ELSE
                                        IF v_espesor >= 7.94 THEN
                                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < 0.20, 'MENOR al MINIMO ', 'EN RANGO'));
                                                SET v_resultado_id = if(v_alargamiento_pb < 0.20, -1, 10);
                                        ELSE
                                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < ( 32 * (v_espesor / 25.4 ) + 15), 'MENOR al MINIMO ', 'EN RANGO'));
                                                SET v_resultado_id = if(v_alargamiento_pb < ( 32 * (v_espesor / 25.4 ) + 10), -1, 10);

                                        END IF  ;

                                END IF;
                        ELSE
                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < IF (v_tipo = 'L', 0.22, 0.14), 'MENOR al MINIMO ', 'EN RANGO'));
                                SET v_resultado_id = if(v_alargamiento_pb < IF (v_tipo = 'L', 0.22, 0.14), -1, 10);


                        END IF;
                END IF;
        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 39 , v_alargamiento_pb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 39 , v_alargamiento_pb, v_resultado, v_resultado_id);
        END IF;

        RETURN v_resultado;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `analisis_mecanico_grupo5`(id_colada INT, es_cintolo BOOLEAN) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_general_ci
BEGIN
        DECLARE v_grupo INT;
        DECLARE v_tipo VARCHAR(2);
        DECLARE v_orig VARCHAR(2);
        DECLARE v_espesor DOUBLE;
        DECLARE v_alargamiento_pb DOUBLE;
        DECLARE v_flue_mb DOUBLE;
        DECLARE v_rotu_mb DOUBLE;
        DECLARE v_dureza_mb DOUBLE;
        DECLARE v_resultado VARCHAR(100);
        DECLARE v_resultado_id INT;

        SET v_grupo = 5;

        IF es_cintolo = 0 THEN
                SELECT valor_texto
                INTO v_tipo
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal * 1000
                INTO v_alargamiento_pb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'ALAR'
                AND par.parte = 'PB';

                SELECT valor_decimal
                INTO v_flue_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_dureza_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_rotu_mb
                FROM recepciones_tecnicas_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';
        ELSE
                SELECT valor_texto
                INTO v_tipo
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'TIPO';

                SELECT valor_texto
                INTO v_orig
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'ORIG';

                SELECT valor_decimal
                INTO v_espesor
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parte = 'PB' AND par.parametro = 'DIM2';

                SELECT valor_decimal * 1000
                INTO v_alargamiento_pb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'ALAR'
                AND par.parte = 'PB';

                SELECT valor_decimal
                INTO v_flue_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'FLUE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_dureza_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'DURE'
                AND par.parte = 'MB';

                SELECT valor_decimal
                INTO v_rotu_mb
                FROM ordenes_de_produccion_estudios_partes rtp
                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada
                AND par.parametro = 'ROTU'
                AND par.parte = 'MB';
        END IF;

        IF v_flue_mb >= 205 THEN
                SET v_resultado = 'FLUENZA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'FLUENZA METAL POR DEBAJO DEL MINIMO';
                SET v_resultado_id = -1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 18, v_flue_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 18, v_flue_mb, v_resultado, v_resultado_id);
        END IF;


        IF v_dureza_mb < 217 THEN
                SET v_resultado = 'DUREZA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'DUREZA METAL POR ENCIMA DEL MAXIMO';
                SET v_resultado_id = 1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 17 , v_dureza_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 17 , v_dureza_mb, v_resultado, v_resultado_id);
        END IF;

        IF v_rotu_mb >= 415 THEN
                SET v_resultado = 'ROTURA METAL BASE EN RANGO';
                SET v_resultado_id = 10;
        ELSE
                SET v_resultado = 'ROTURA METAL POR DEBAJO DEL MINIMO';
                SET v_resultado_id = -1;
        END if;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 20 , v_rotu_mb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 20 , v_rotu_mb, v_resultado, v_resultado_id);
        END IF;

                IF v_grupo = 5 THEN
                        IF v_tipo = 'R' THEN
                                IF v_orig = 'L' THEN
                                        IF v_espesor >= 7.94 THEN
                                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < 0.30, 'MENOR al MINIMO ', 'EN RANGO'));
                                                SET v_resultado_id = if(v_alargamiento_pb < 0.30, -1, 10);
                                        ELSE
                                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < ( 48 * (v_espesor / 25.4 ) + 15), 'MENOR al MINIMO ', 'EN RANGO'));
                                                SET v_resultado_id = if(v_alargamiento_pb < ( 48 * (v_espesor / 25.4 ) + 15), -1, 10);

                                        END IF  ;
                                ELSE
                                        IF v_espesor >= 7.94 THEN
                                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < 0.20, 'MENOR al MINIMO ', 'EN RANGO'));
                                                SET v_resultado_id = if(v_alargamiento_pb < 0.20, -1, 10);
                                        ELSE
                                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < ( 32 * (v_espesor / 25.4 ) + 15), 'MENOR al MINIMO ', 'EN RANGO'));
                                                SET v_resultado_id = if(v_alargamiento_pb < ( 32 * (v_espesor / 25.4 ) + 10), -1, 10);

                                        END IF  ;

                                END IF;
                        ELSE
                                SET v_resultado = CONCAT ('ALARGAMIENTO METAL BASE ',  if(v_alargamiento_pb < IF (v_tipo = 'L', 0.22, 0.14), 'MENOR al MINIMO ', 'EN RANGO'));
                                SET v_resultado_id = if(v_alargamiento_pb < IF (v_tipo = 'L', 0.22, 0.14), -1, 10);
                        END IF;
                END IF;

        IF es_cintolo = 0 THEN
                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 39 , v_alargamiento_pb, v_resultado, v_resultado_id);
        ELSE
                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                VALUES (id_colada, 39 , v_alargamiento_pb, v_resultado, v_resultado_id);
        END IF;

        RETURN v_resultado;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `CalcularConsumoUnitarioDeMp`(ft_id INT) RETURNS decimal(10,5)
BEGIN
        DECLARE resultado DECIMAL (10, 5);
        DECLARE mp_tipo_id INT;
        DECLARE mp_largo INT;
        DECLARE mp_diametro INT;
        DECLARE mp_chapa_peso DECIMAL (20, 6);
        DECLARE mp_factor_conversion DECIMAL (10, 3);
        DECLARE pf_tubo_largo_bruto INT;
        DECLARE pf_chapa_peso_bruto INT;
        DECLARE v_cant_piezas DECIMAL(10, 5);
        DECLARE resultado_PBC_json JSON;
        --
        SELECT a.tipo_id, a.diametro, a.largo, a.factor_conversion, ft.tubo_largo_bruto, ft.peso_bruto
        INTO mp_tipo_id, mp_diametro, mp_largo, mp_factor_conversion, pf_tubo_largo_bruto, pf_chapa_peso_bruto
        FROM fichas_tecnicas ft
        INNER JOIN articulos a ON a.id = ft.articulo_id
        WHERE ft.id = ft_id;
        --
        IF mp_tipo_id IN (1, 3) THEN
            -- tubo de MP:
            SET resultado = pf_tubo_largo_bruto / 1000;  -- retorna metros de tubo
            SET resultado = ROUND(resultado, 3);
        ELSE
            -- chapa de MP:
            SET resultado_PBC_json = Calculo_PBCinicial(ft_id);
            --
            SELECT COALESCE(CAST(JSON_EXTRACT(resultado_PBC_json, '$.PIEZAS') AS DECIMAL(10, 5)), 0) FROM dual INTO v_cant_piezas;
            --
            IF v_cant_piezas > 0 THEN
                SET resultado = 1 / v_cant_piezas;
            ELSE
                SET mp_chapa_peso = mp_diametro * mp_largo * mp_factor_conversion / 1000000;
                SET resultado = pf_chapa_peso_bruto / mp_chapa_peso;  -- (kg)/(kg/u)   retorna unidades de chapa
            END IF;
            --
        END IF;
        --
        RETURN resultado;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `CalcularPCMyCEq`(colada_id INT, es_cintolo BOOL) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
    DECLARE F DECIMAL(20, 6);
    DECLARE resultado_pcm DECIMAL(20, 6);
    DECLARE resultado_carbono_equivalente DECIMAL(20, 6);
    DECLARE v_grupo INT;
    --
    DECLARE BORO DECIMAL(20, 6);
    DECLARE CARBONO DECIMAL(20, 6);
    DECLARE COBRE DECIMAL(20, 6);
    DECLARE CROMO DECIMAL(20, 6);
    DECLARE MANGANESO DECIMAL(20, 6);
    DECLARE MOLIBDENO DECIMAL(20, 6);
    DECLARE NIOBIO DECIMAL(20, 6);
    DECLARE NIQUEL DECIMAL(20, 6);
    DECLARE SILICIO DECIMAL(20, 6);
    DECLARE VANADIO DECIMAL(20, 6);
    --
    IF es_cintolo THEN
        SELECT agrupacion_calidad_id INTO v_grupo FROM ordenes_de_produccion_estudios WHERE id = colada_id;
        SELECT valor_decimal INTO CARBONO FROM ordenes_de_produccion_estudios_partes
            INNER JOIN ensayos_parametros ep ON ep.id = ordenes_de_produccion_estudios_partes.parametro_id
            WHERE estudio_id = colada_id AND ep.descripcion = 'carbono';
        SELECT valor_decimal INTO SILICIO FROM ordenes_de_produccion_estudios_partes
            INNER JOIN ensayos_parametros ep ON ep.id = ordenes_de_produccion_estudios_partes.parametro_id
            WHERE estudio_id = colada_id AND ep.descripcion = 'silicio';
        SELECT valor_decimal INTO MANGANESO FROM ordenes_de_produccion_estudios_partes
            INNER JOIN ensayos_parametros ep ON ep.id = ordenes_de_produccion_estudios_partes.parametro_id
            WHERE estudio_id = colada_id AND ep.descripcion = 'manganeso';
        SELECT valor_decimal INTO COBRE FROM ordenes_de_produccion_estudios_partes
            INNER JOIN ensayos_parametros ep ON ep.id = ordenes_de_produccion_estudios_partes.parametro_id
            WHERE estudio_id = colada_id AND ep.descripcion = 'cobre';
        SELECT valor_decimal INTO NIOBIO FROM ordenes_de_produccion_estudios_partes
            INNER JOIN ensayos_parametros ep ON ep.id = ordenes_de_produccion_estudios_partes.parametro_id
            WHERE estudio_id = colada_id AND ep.descripcion = 'niobio';
        SELECT valor_decimal INTO CROMO FROM ordenes_de_produccion_estudios_partes
            INNER JOIN ensayos_parametros ep ON ep.id = ordenes_de_produccion_estudios_partes.parametro_id
            WHERE estudio_id = colada_id AND ep.descripcion = 'cromo';
        SELECT valor_decimal INTO NIQUEL FROM ordenes_de_produccion_estudios_partes
            INNER JOIN ensayos_parametros ep ON ep.id = ordenes_de_produccion_estudios_partes.parametro_id
            WHERE estudio_id = colada_id AND ep.descripcion = 'niquel';
        SELECT valor_decimal INTO MOLIBDENO FROM ordenes_de_produccion_estudios_partes
            INNER JOIN ensayos_parametros ep ON ep.id = ordenes_de_produccion_estudios_partes.parametro_id
            WHERE estudio_id = colada_id AND ep.descripcion = 'molibdeno';
        SELECT valor_decimal INTO VANADIO FROM ordenes_de_produccion_estudios_partes
            INNER JOIN ensayos_parametros ep ON ep.id = ordenes_de_produccion_estudios_partes.parametro_id
            WHERE estudio_id = colada_id AND ep.descripcion = 'vanadio';
        SELECT valor_decimal INTO BORO FROM ordenes_de_produccion_estudios_partes
            INNER JOIN ensayos_parametros ep ON ep.id = ordenes_de_produccion_estudios_partes.parametro_id
            WHERE estudio_id = colada_id AND ep.descripcion = 'boro';
    ELSE
        SELECT agrupacion_calidad_id INTO v_grupo FROM recepciones_tecnicas WHERE id = colada_id;
        SELECT valor_decimal INTO CARBONO FROM recepciones_tecnicas_partes
            INNER JOIN ensayos_parametros ep ON ep.id = recepciones_tecnicas_partes.parametro_id
            WHERE recepcion_tecnica_id = colada_id AND ep.descripcion = 'carbono';
        SELECT valor_decimal INTO SILICIO FROM recepciones_tecnicas_partes
            INNER JOIN ensayos_parametros ep ON ep.id = recepciones_tecnicas_partes.parametro_id
            WHERE recepcion_tecnica_id = colada_id AND ep.descripcion = 'silicio';
        SELECT valor_decimal INTO MANGANESO FROM recepciones_tecnicas_partes
            INNER JOIN ensayos_parametros ep ON ep.id = recepciones_tecnicas_partes.parametro_id
            WHERE recepcion_tecnica_id = colada_id AND ep.descripcion = 'manganeso';
        SELECT valor_decimal INTO COBRE FROM recepciones_tecnicas_partes
            INNER JOIN ensayos_parametros ep ON ep.id = recepciones_tecnicas_partes.parametro_id
            WHERE recepcion_tecnica_id = colada_id AND ep.descripcion = 'cobre';
        SELECT valor_decimal INTO CROMO FROM recepciones_tecnicas_partes
            INNER JOIN ensayos_parametros ep ON ep.id = recepciones_tecnicas_partes.parametro_id
            WHERE recepcion_tecnica_id = colada_id AND ep.descripcion = 'cromo';
        SELECT valor_decimal INTO NIOBIO FROM recepciones_tecnicas_partes
            INNER JOIN ensayos_parametros ep ON ep.id = recepciones_tecnicas_partes.parametro_id
            WHERE recepcion_tecnica_id = colada_id AND ep.descripcion = 'niobio';
        SELECT valor_decimal INTO NIQUEL FROM recepciones_tecnicas_partes
            INNER JOIN ensayos_parametros ep ON ep.id = recepciones_tecnicas_partes.parametro_id
            WHERE recepcion_tecnica_id = colada_id AND ep.descripcion = 'niquel';
        SELECT valor_decimal INTO MOLIBDENO FROM recepciones_tecnicas_partes
            INNER JOIN ensayos_parametros ep ON ep.id = recepciones_tecnicas_partes.parametro_id
            WHERE recepcion_tecnica_id = colada_id AND ep.descripcion = 'molibdeno';
        SELECT valor_decimal INTO VANADIO FROM recepciones_tecnicas_partes
            INNER JOIN ensayos_parametros ep ON ep.id = recepciones_tecnicas_partes.parametro_id
            WHERE recepcion_tecnica_id = colada_id AND ep.descripcion = 'vanadio';
        SELECT valor_decimal INTO BORO FROM recepciones_tecnicas_partes
            INNER JOIN ensayos_parametros ep ON ep.id = recepciones_tecnicas_partes.parametro_id
            WHERE recepcion_tecnica_id = colada_id AND ep.descripcion = 'boro';
    END IF;
    --
    IF BORO IS NULL THEN SET BORO = 0; END IF;
    IF CARBONO IS NULL THEN SET CARBONO = 0; END IF;
    IF COBRE IS NULL THEN SET COBRE = 0; END IF;
    IF CROMO IS NULL THEN SET CROMO = 0; END IF;
    IF MANGANESO IS NULL THEN SET MANGANESO = 0; END IF;
    IF MOLIBDENO IS NULL THEN SET MOLIBDENO = 0; END IF;
    IF NIOBIO IS NULL THEN SET NIOBIO = 0; END IF;
    IF NIQUEL IS NULL THEN SET NIQUEL = 0; END IF;
    IF SILICIO IS NULL THEN SET SILICIO = 0; END IF;
    IF VANADIO IS NULL THEN SET VANADIO = 0; END IF;
    --
    IF v_grupo IN (2, 4, 5, 6, 7, 8, 9, 10, 12, 13, 111, 112, 113, 221, 222, 223) THEN
        SET resultado_carbono_equivalente = CARBONO + (MANGANESO / 6) + (CROMO + MOLIBDENO + VANADIO) / 5 + (COBRE + NIQUEL) / 15;
        SET resultado_pcm = (CARBONO + (SILICIO / 30) + (MANGANESO + COBRE + CROMO) / 20 + (NIQUEL / 60) + (MOLIBDENO / 15) + (VANADIO / 10))/1000 + (BORO / 5);
    ELSEIF v_grupo IN (42, 46, 52, 56, 60, 65, 70) THEN
        IF CARBONO > 0.0017 THEN
            SET resultado_carbono_equivalente = CARBONO + (MANGANESO / 6) + (CROMO + MOLIBDENO + VANADIO) / 5 + (COBRE + NIQUEL) / 15;
        ELSE
            IF CARBONO < 0.0006 THEN SET F = 0.53;
            ELSEIF CARBONO = 0.0006 THEN SET F = 0.54;
            ELSEIF CARBONO = 0.0007 THEN SET F = 0.56;
            ELSEIF CARBONO = 0.0008 THEN SET F = 0.58;
            ELSEIF CARBONO = 0.0009 THEN SET F = 0.62;
            ELSEIF CARBONO = 0.0010 THEN SET F = 0.66;
            ELSEIF CARBONO = 0.0011 THEN SET F = 0.70;
            ELSEIF CARBONO = 0.0012 THEN SET F = 0.75;
            ELSEIF CARBONO = 0.0013 THEN SET F = 0.80;
            ELSEIF CARBONO = 0.0014 THEN SET F = 0.85;
            ELSEIF CARBONO = 0.0015 THEN SET F = 0.88;
            ELSEIF CARBONO = 0.0016 THEN SET F = 0.92;
            ELSEIF CARBONO = 0.0017 THEN SET F = 0.94;
            END IF;
            SET resultado_carbono_equivalente = CARBONO + F * ((MANGANESO / 6) + (SILICIO / 24) + (COBRE / 24) + (NIQUEL / 20)) + ((CROMO + MOLIBDENO + VANADIO + NIOBIO) + 5 * BORO);
        END IF;
        SET resultado_pcm = (CARBONO + (SILICIO / 30 ) + (MANGANESO + COBRE + CROMO) / 20 + (NIQUEL / 60) + (MOLIBDENO / 15) + (VANADIO / 10))/1000 + (BORO / 5);
    ELSE
        SET resultado_carbono_equivalente = 0;
        SET resultado_pcm = 0;
    END IF;
    --
    RETURN JSON_OBJECT('carbono_eq', resultado_carbono_equivalente, 'pcm', resultado_pcm);
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Calculo_calib_setup`(p_ftid INT, p_orden INT, p_etapa INT, p_subetapa INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
		DECLARE v_tiempo DOUBLE;
		DECLARE v_tiempo_ft DOUBLE;
		DECLARE v_estado VARCHAR(1);
		DECLARE json_result JSON;
		DECLARE v_ftp_id INT;
		DECLARE i INT;
		DECLARE v_maquina INT;
		DECLARE v_max_orden INT;
		DECLARE v_medida1 DOUBLE;
		DECLARE v_medida2 DOUBLE;
		DECLARE v_familia VARCHAR(10);
		DECLARE v_suma_tiempos DOUBLE;

		SELECT pf.medida_1, pf.medida_2, pff.cod_as400
		INTO v_medida1, v_medida2, v_familia
		FROM fichas_tecnicas ft
		LEFT JOIN articulos ar ON ft.articulo_id = ar.id
		LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
		LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id 
		WHERE ft.id = p_ftid;

		IF v_familia IN ('TE', 'TER', 'TNS', 'TRS', 'CRU', 'CZR') THEN 
			IF v_medida1 <=	500 THEN
				SET v_tiempo = IF(p_subetapa IN (1, 3, 4), 1, IF(p_subetapa = 5, 0.75, 0));
			ELSE
				IF v_medida1 <=	600 THEN
					SET v_tiempo = IF(p_subetapa IN (1, 3, 4), 1.25, IF(p_subetapa = 5, 1, 0));
				ELSE
					IF v_medida1 <=	2400 THEN
						SET v_tiempo = IF(p_subetapa IN (1, 3), 1.5, IF(p_subetapa = 4, 1.25, IF(p_subetapa = 5, 1, 0)));
					ELSE
						IF v_medida1 <=	3200 THEN
							SET v_tiempo = IF(p_subetapa IN (1, 3, 4), 1.5, IF(p_subetapa = 5, 1.25, 0));
						ELSE
							IF v_medida1 >=	3400 THEN
								SET v_tiempo = IF(p_subetapa IN (1, 3), 1.75, IF(p_subetapa = 4, 1.5, IF(p_subetapa = 5, 1.25, 0)));
							END IF;
						END IF;
					END IF;
				END IF;
			END IF;
		END IF;

		IF v_familia IN ('CRL', 'C45', 'CRC', 'L18', 'C18') THEN 
			IF v_medida1 <=	500 THEN
				SET v_tiempo = IF(p_subetapa IN (1, 3, 6, 7), 0.5, 0);
			ELSE 
				IF v_medida1 <=	600 THEN
					SET v_tiempo = IF(p_subetapa IN (1, 3, 6, 7), 0.75, 0);
				ELSE 
					IF v_medida1 <=	3200 THEN
						SET v_tiempo = IF(p_subetapa IN (1, 3, 6, 7), 1.25, 0);
					ELSE 
						IF v_medida1 >=	3400 THEN
							SET v_tiempo = IF(p_subetapa IN (1, 3, 6, 7), 1.5, 0);
						END IF;
					END IF;
				END IF;
			END IF;
		END IF;

		IF v_familia IN ('REC', 'REE', 'SWC', 'SWE', 'FNI') THEN
			IF v_medida1 <=	500 THEN
				SET v_tiempo = IF(p_subetapa IN (1, 3, 6, 7), 0.75, 0);
			ELSE
				IF v_medida1 <=	600 THEN
					SET v_tiempo = IF(p_subetapa IN (1, 3), 0.75,IF(p_subetapa IN (6, 7), 0.5, 0));
				ELSE
					IF v_medida1 <=1200 THEN
						SET v_tiempo = IF(p_subetapa IN (1, 3, 6, 7), 1, 0);
					ELSE
						IF v_medida1 <= 2400 THEN
							SET v_tiempo = IF(p_subetapa IN (1, 3), 1.25, IF(p_subetapa IN (6, 7), 1, 0));
						ELSE
							IF v_medida1 <= 3200 THEN
								SET v_tiempo = IF(p_subetapa IN (1, 3), 1.5, IF(p_subetapa IN (6, 7), 1.25, 0));
							ELSE
								IF v_medida1 >=	3400 THEN
									SET v_tiempo = IF(p_subetapa IN (1, 3), 1.5, IF(p_subetapa IN (6, 7), 1.25, 0));
								END if;
							END IF;
						END IF;
					END IF;
				END IF;
			END IF;
		END IF;

		IF v_familia IN ('CAS', 'CAT') THEN
			IF v_medida1 <=	500 THEN
				SET v_tiempo = IF(p_subetapa IN (1, 3), 0.5, 0);
			ELSE
				IF v_medida1 <=	600 THEN
					SET v_tiempo = IF(p_subetapa IN (1, 3), 0.5, 0);
				ELSE
					IF v_medida1 <= 3200 THEN
						SET v_tiempo = IF(p_subetapa IN (1, 3), 1.5, 0);
					ELSE
						IF v_medida1 >=	3400 THEN
							SET v_tiempo = IF(p_subetapa IN (1, 3), 1.75, 0);
						END IF;
					END IF;
				END IF;
			END IF;
		END IF;

		RETURN v_tiempo;
	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Calculo_LB_PB_tubo`(p_idft INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
    DECLARE json_result JSON;
    DECLARE v_largoneto1 DOUBLE;
    DECLARE v_largoneto2 DOUBLE;
    DECLARE v_largobruto INT;
    DECLARE v_pesobruto DOUBLE;
    DECLARE v_factorconversion DOUBLE;

    SELECT ifnull(ft.tubo_largo_n1, 0), ifnull(ft.tubo_largo_n2, 0), ifnull(ft.factor_conversion, 0)
    INTO v_largoneto1, v_largoneto2, v_factorconversion
    FROM fichas_tecnicas ft
    WHERE id = p_idft;

    if v_largoneto1 + v_largoneto2 > 0 THEN
            if v_largoneto2 = 0 THEN
                    set v_largobruto = (v_largoneto1 + 2) * 1.025;
            else
                    set v_largobruto = ((v_largoneto1 + v_largoneto2 + 3) / 2 + 3)  * 1.025;
            END if;
    else
            set v_largobruto = 0;

    END if;

    SET v_pesobruto = v_largobruto * v_factorconversion / 1000;

        SELECT JSON_ARRAYAGG(JSON_OBJECT('LargoBruto', v_largobruto, 'PesoBruto', v_pesobruto, 'Factor de Conversion', v_factorconversion))
            INTO json_result
    FROM dual;


    RETURN json_result;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Calculo_limite`(p_ftid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
		DECLARE v_ancho DOUBLE;
		DECLARE v_largo DOUBLE;
		DECLARE v_espesor DOUBLE;
		DECLARE v_calidad INT;
		DECLARE v_atributo_calidad VARCHAR(10);
		DECLARE v_respuesta VARCHAR(100);
		DECLARE v_primeretapa INT;
		DECLARE v_primersubetapa INT;
		DECLARE v_ultimamaquina INT;

		SELECT ar.espesor /1000 , ar.calidad_id, ar.largo , ar.diametro , aux.parametro_aux
		INTO v_espesor, v_calidad, v_largo, v_ancho, v_atributo_calidad
		FROM fichas_tecnicas ft
		LEFT JOIN articulos ar ON ft.articulo_id = ar.id
		LEFT JOIN aux_calculo_limite aux ON ar.calidad_id = aux.calidad_id
		WHERE ft.id = p_ftid
		AND ft.es_la_version_vigente = 1;

		SELECT etapa, subetapa
		INTO v_primeretapa, v_primersubetapa
		FROM fichas_tecnicas_procesos ftp
		LEFT JOIN etapas_subetapas es ON ftp.etapa_subetapa_id = es.id
		WHERE ftp.ficha_tecnica_id = p_ftid
		AND ftp.orden = 1;

		SELECT MAX(maquina_id)
		INTO v_ultimamaquina
		FROM fichas_tecnicas_maquinas ftm
		WHERE ftm.proceso_id = (SELECT MAX(id)
			FROM fichas_tecnicas_procesos ftp
			WHERE ftp.ficha_tecnica_id = p_ftid);

		IF v_ancho = 1500 THEN
			if v_espesor < 9 THEN 
				SET v_respuesta = 700;
			ELSE
				IF v_espesor < 11  THEN
					SET v_respuesta = 1000;
				ELSE 
					IF v_espesor < 12 THEN
						SET v_respuesta = 1500;
					ELSE 
						IF v_espesor < 13 THEN
							SET v_respuesta = 1000 ;
						ELSE 	
							SET v_respuesta = 1500;
						END IF;	
					END IF; 
				END IF;
			END IF;	
		END IF;

		SELECT limite_largo
		INTO v_respuesta
		FROM aux_calculo_limite_largo ll
		WHERE ancho = v_ancho
		AND espesor = (
			SELECT MIN(espesor) 
			FROM aux_calculo_limite_largo lbis
			WHERE ll.ancho = lbis.ancho
			AND ll.familia = lbis.familia
			AND lbis.espesor > v_espesor);

		RETURN v_respuesta;

	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Calculo_PBCDisco`(p_ftid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
		DECLARE v_ancho DOUBLE;
		DECLARE v_largo_chapa DOUBLE;
		DECLARE v_ancho_chapa DOUBLE;
		DECLARE v_esp_chapa DOUBLE;
		DECLARE v_largo DOUBLE; 
		DECLARE v_diametro DOUBLE;
		DECLARE v_medida1 DOUBLE;
		DECLARE v_medida2 DOUBLE;
		DECLARE v_devuelve VARCHAR(50);
		DECLARE v_cant_art_pieza INT;
		DECLARE v_cant_piezas_chapa INT;
		DECLARE v_ANCHOxPIEZA INT;
		DECLARE v_LARGOxPIEZA INT;
		DECLARE v_DISCOTEORICO DOUBLE;
		DECLARE v_DISCOxANCHO DOUBLE;
		DECLARE v_DISCOxLARGO DOUBLE;
		DECLARE v_LARGOSOBRANTE DOUBLE;
		DECLARE v_sobrante DOUBLE;
		DECLARE v_sobrante1 DOUBLE;
		DECLARE v_sobrante2 DOUBLE;
		DECLARE v_limite DOUBLE;
		DECLARE v_descuento DOUBLE;
		DECLARE v_sobsistema DOUBLE;
		DECLARE v_pesochapaest DOUBLE;
		DECLARE v_PBC DECIMAL(10,3);
		DECLARE v_pesocuadrado DECIMAL(10,3);
		DECLARE v_HP VARCHAR(100);
		--
		SELECT ft.ancho, ar.largo, ar.diametro, ar.espesor / 1000, ft.largo, ft.diametro, pf.medida_1, pf.medida_2, ftp.unidad_x_art
		INTO v_ancho, v_largo_chapa, v_ancho_chapa, v_esp_chapa, v_largo, v_diametro, v_medida1, v_medida2, v_cant_art_pieza
		FROM fichas_tecnicas ft
		LEFT JOIN fichas_tecnicas_procesos ftp ON ft.id = ftp.ficha_tecnica_id
		LEFT JOIN articulos ar ON ft.articulo_id = ar.id
		LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
		WHERE ft.id = p_ftid
		AND ftp.etapa_subetapa_id IN (4,188) 
		AND ftp.orden = 1;
		--
		SELECT MAX(plant.piezas_chapa), MAX(plant.sobrante_sistema)
		INTO v_cant_piezas_chapa, v_sobsistema
		FROM plantillas_corte plant
		WHERE plant.ancho_chapa= v_ancho_chapa AND plant.largo_chapa = v_largo_chapa AND diametro_disco = v_diametro;
		--
		SET v_DISCOxANCHO = TRUNCATE(v_ancho_chapa / v_diametro,0);
		SET v_DISCOxLARGO = TRUNCATE(v_largo_chapa / v_diametro,0) ;
		SET v_DISCOTEORICO = v_DISCOxANCHO * v_DISCOxLARGO;
		SET v_LARGOSOBRANTE = v_largo_chapa - (v_DISCOxLARGO * v_diametro);
		SET v_sobrante = IF(v_DISCOxANCHO > 1, 0, v_LARGOSOBRANTE);
		SET v_sobrante1 = IF(v_cant_piezas_chapa / v_discoteorico = 1, v_sobrante, 0);
		SET v_sobrante2 = IF(v_sobsistema = 0, v_sobrante1, v_sobsistema);
		SET v_limite = Calculo_limite(p_ftid);
		SET v_descuento = IF(v_sobrante2 < v_limite, 0, v_sobrante2);
		SET v_pesochapaest = (v_largo_chapa - v_descuento) * v_ancho_chapa * v_esp_chapa * 0.00000791;
		SET v_PBC = v_pesochapaest / v_cant_piezas_chapa / v_cant_art_pieza;
		SET v_pesocuadrado = v_diametro * v_diametro * v_esp_chapa * 0.00000791;
		SET v_devuelve = CONCAT(' PBC: ', v_PBC, ' - PCU: ', v_pesocuadrado );
		SET v_HP = CONCAT('UNIDADES ', v_cant_piezas_chapa / v_cant_art_pieza, ' - PIEZAS ', v_cant_art_pieza * v_cant_piezas_chapa);
		--
		INSERT INTO aux_log (descripcion, valor)
		VALUES
		('ancho', v_ancho),
		('largo chapa', v_largo_chapa),
		('ancho chapa', v_ancho_chapa),
		('espesor', v_esp_chapa),
		('largo', v_largo),
		('diametro', v_diametro),
		('medida1', v_medida1),
		('medida2', v_medida2),
		('cant art pieza', v_cant_art_pieza),
		('cant piezas chapa', v_cant_piezas_chapa),
		('ancho x pieza', v_ANCHOxPIEZA),
		('largo x pieza', v_LARGOxPIEZA),
		('Disco teorico', v_DISCOTEORICO),
		('Disco x ancho', v_DISCOxANCHO),
		('Disco x largo', v_DISCOxLARGO),
		('Largo sobrante', v_LARGOSOBRANTE),
		('sobrante', v_sobrante),
		('sobrante1', v_sobrante1),
		('sobrante2', v_sobrante2),
		('limite', v_limite),
		('descuento', v_descuento),
		('sob sistema', v_sobsistema),
		('peso chapa est', v_pesochapaest);
		--
		RETURN JSON_OBJECT('DEFINICION', 'DISCO', 'PBC' , v_PBC, 'PCU' , v_pesocuadrado, 'HOJA DE PROCESO',v_HP, 'UNIDADES',  v_cant_piezas_chapa / v_cant_art_pieza, 'PIEZAS', v_cant_piezas_chapa / v_cant_art_pieza);
	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Calculo_PBCGuillotina`(p_ftid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
		DECLARE v_cant_tiras int;
		DECLARE v_ancho DOUBLE;
		DECLARE v_ancho_chapa DOUBLE;
		DECLARE v_largo_chapa DOUBLE;
		DECLARE v_diametro DOUBLE;
		DECLARE v_tope DOUBLE;
		DECLARE v_piezasxtira INT;
		DECLARE v_cantidad_c DECIMAL(10,3);
		DECLARE v_esp_chapa DOUBLE;
		DECLARE v_pesochapa DECIMAL (10, 1);
		DECLARE v_pbc_devuelve DECIMAL(10, 3);
		DECLARE v_pesocuadrado DECIMAL(10, 3);
		DECLARE v_HP VARCHAR(100);

		SELECT ft.diametro / 1000, ft.ancho,  ar.largo, ar.diametro, ar.espesor /1000,  TRUNCATE( ar.largo / ft.ancho,0)
		INTO v_diametro, v_ancho, v_largo_chapa, v_ancho_chapa, v_esp_chapa, v_cant_tiras
		FROM fichas_tecnicas ft
		LEFT JOIN articulos ar ON ft.articulo_id = ar.id
		WHERE ft.id = p_ftid;

		CASE 
			WHEN (v_diametro < 9) THEN
				SET v_tope = 5.1;
			WHEN (v_diametro < 106) THEN
				SET v_tope = 6;
			WHEN (v_diametro < 125) THEN
				SET v_tope = 7;
			WHEN (v_diametro < 180) THEN
				SET v_tope = 8;
			ELSE
				SET v_tope = 9;
		END CASE;

		SET v_piezasxtira = (v_ancho_chapa + 15) / (v_diametro + v_tope);
		SET v_cantidad_c = v_piezasxtira * v_cant_tiras;
		SET v_pesochapa = v_ancho_chapa * v_largo_chapa * v_esp_chapa * 0.00000791;
		SET v_pbc_devuelve = v_pesochapa / v_cantidad_c;
		SET v_pesocuadrado = v_ancho *  (v_diametro + v_tope) * v_esp_chapa * 0.00000791;
		SET v_HP =  CONCAT('CANT TIRAS ', v_cant_tiras, ' - PIEZAS  ', v_cantidad_C);
		RETURN JSON_OBJECT('DEFINICION', 'GUILLOTINA', 'PBC', v_pbc_devuelve, 'PCU', v_pesocuadrado, 'HOJA PROCESO', v_HP, 'CANT TIRAS', v_cant_tiras, 'PIEZAS', v_cantidad_C / 1);

	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Calculo_PBCinicial`(p_ftid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
		DECLARE v_primer_etapasub INT;
		DECLARE v_ancho_chapa DOUBLE;
		DECLARE v_largo_chapa DOUBLE;
		DECLARE v_diametro DOUBLE;
		DECLARE v_largo DOUBLE;
		DECLARE v_ancho DOUBLE;
		DECLARE v_esp_chapa DOUBLE;
		DECLARE v_medida1 DOUBLE;
		DECLARE v_medida2 DOUBLE;
		DECLARE v_definicion VARCHAR(20);
		DECLARE v_pcu VARCHAR (20);
		DECLARE v_pbc VARCHAR(20);
		-- DECLARE JSON_result JSON;
		DECLARE resultado_json JSON;

		SELECT MIN(ftp.etapa_subetapa_id)
		INTO v_primer_etapasub
		FROM fichas_tecnicas_procesos ftp
		WHERE orden = 1
		AND p_ftid = ftp.ficha_tecnica_id;

		SELECT ft.ancho, ar.largo, ar.diametro, ar.espesor / 1000, ft.largo, ft.diametro, pf.medida_1, pf.medida_2
		INTO v_ancho, v_largo_chapa, v_ancho_chapa, v_esp_chapa, v_largo, v_diametro, v_medida1, v_medida2
		FROM fichas_tecnicas ft
		LEFT JOIN fichas_tecnicas_procesos ftp ON ft.id = ftp.ficha_tecnica_id
		LEFT JOIN articulos ar ON ft.articulo_id = ar.id
		LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
		WHERE ft.id = p_ftid
		AND ft.es_la_version_vigente = 1
		AND ftp.etapa_subetapa_id IN (4,188) 
		AND ftp.orden = 1;

		IF v_primer_etapasub = 7 THEN
			SET v_definicion = 'GUILLOTINA';
			SET resultado_json = Calculo_PBCGuillotina(p_ftid);
		ELSE
			IF v_diametro > 0 THEN
				SET v_definicion = 'DISCO';
				SET resultado_json = Calculo_PBCDisco(p_ftid);
			ELSE
				IF v_largo > 0 THEN
					SET v_definicion = 'RECTANGULO';
					SET resultado_json = Calculo_PBCRectangulo(p_ftid);
				ELSE
					SET v_definicion = 'PLANTILLA';
					SET resultado_json = Calculo_PBCPlantilla(p_ftid);
				END IF;
			END IF;
		END IF;

		-- SELECT JSON_EXTRACT (resultado_json, '$.PBC') FROM dual INTO v_pbc;

		-- SELECT JSON_EXTRACT (resultado_json, '$.PCU') FROM dual INTO v_pcu;

		-- SELECT JSON_ARRAYAGG(JSON_OBJECT('DEFINICION', v_definicion, 'PBC', v_pbc, 'PCU', v_pcu))
		-- INTO json_result
		-- FROM dual;

		RETURN resultado_json;
	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Calculo_PBCPlantilla`(p_ftid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
		DECLARE devuelve VARCHAR(50);
		DECLARE v_largo_chapa DOUBLE;
		DECLARE v_ancho_chapa DOUBLE;
		DECLARE v_esp_chapa DOUBLE;
		DECLARE v_cant_art_pieza INT;
		DECLARE v_cant_piezas_chapa INT;
		DECLARE v_cp DOUBLE;
		DECLARE v_limite DOUBLE;
		DECLARE v_descuento DOUBLE;
		DECLARE v_sobsistema DOUBLE;
		DECLARE v_pesochapa DOUBLE;
		DECLARE v_PBC DECIMAL (10,3);
		DECLARE v_familia VARCHAR(10);
		DECLARE v_HP VARCHAR(100);
		DECLARE json_result JSON;

		SET v_cp = 0.00000791;

		SELECT ar.largo, ar.diametro, ar.espesor / 1000, ftp.unidad_x_art, pff.cod_as400
		INTO v_largo_chapa, v_ancho_chapa, v_esp_chapa, v_cant_art_pieza, v_familia
		FROM fichas_tecnicas ft
		LEFT JOIN fichas_tecnicas_procesos ftp ON ft.id = ftp.ficha_tecnica_id
		LEFT JOIN articulos ar ON ft.articulo_id = ar.id
		LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
		LEFT JOIN productos_fabricados_familias pff ON pff.id = pf.familia_id
		WHERE ft.id = p_ftid
		AND ftp.etapa_subetapa_id IN (4, 188) 
		AND ftp.orden = 1;
		--
		SELECT plant.piezas_chapa, plant.sobrante_sistema
		INTO v_cant_piezas_chapa, v_sobsistema
		FROM fichas_tecnicas_procesos ftp 
		LEFT JOIN maquinas_herramientas maq ON maq.id = ftp.maquina_4_id
		LEFT JOIN plantillas_corte plant ON plant.maquina_id = ftp.maquina_4_id AND plant.ancho_chapa= v_ancho_chapa AND plant.largo_chapa = v_largo_chapa
		WHERE maq.tipo_id = 83
		AND ftp.ficha_tecnica_id = p_ftid;
		--
		SET v_limite = IFNULL(Calculo_limite (p_ftid), 0);
		SET v_descuento = IF(v_limite <= v_sobsistema, v_sobsistema, 0);
		SET v_pesochapa = v_ancho_chapa * (v_largo_chapa - v_descuento) * v_esp_chapa * v_cp;
		SET v_PBC = v_pesochapa / v_cant_art_pieza / v_cant_piezas_chapa;
		SET v_HP = CONCAT('UNIDADES - ', v_cant_piezas_chapa, ' - PIEZAS - ', v_cant_piezas_chapa / v_cant_art_pieza);
		SET json_result = JSON_OBJECT('DEFINICION', 'PLANTILLA', 'PBC' , v_PBC, 'PCU' , '0.000', 'HOJA de PROCESO', v_HP, 'UNIDADES', v_cant_piezas_chapa, 'PIEZAS', v_cant_piezas_chapa / v_cant_art_pieza);
		--
		RETURN json_result;
	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Calculo_PBCRectangulo`(p_ftid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
		DECLARE v_ancho_chapa DOUBLE;
		DECLARE v_largo_chapa DOUBLE;
		DECLARE v_diametro DOUBLE;
		DECLARE v_largo DOUBLE;
		DECLARE v_ancho DOUBLE;
		DECLARE v_cantidad_c DOUBLE;
		DECLARE v_esp_chapa DOUBLE;
		DECLARE v_pesochapa DOUBLE;
		DECLARE v_medida1 DOUBLE;
		DECLARE v_medida2 DOUBLE;
		DECLARE v_cant_art_pieza DOUBLE;
		DECLARE v_cant_piezas_chapa DOUBLE;
		DECLARE v_pbc_devuelve DOUBLE;
		DECLARE v_cant_calc1 DOUBLE;
		DECLARE v_pesochapaestimado_calc1 VARCHAR(20);
		DECLARE v_cant_calc2 DOUBLE;
		DECLARE v_pesochapaestimado_calc2 DOUBLE;
		DECLARE v_subcalc1 VARCHAR(50);
		DECLARE v_subcalc2 VARCHAR(50);
		DECLARE v_limite INT;	
		DECLARE v_PBC DECIMAL(10,3);
		DECLARE v_PCU DECIMAL(10,3);
		DECLARE v_respuesta VARCHAR(70);
		DECLARE v_HP VARCHAR(100);

		SELECT ft.ancho, ar.largo, ar.diametro, ar.espesor / 1000, ft.largo  , pf.medida_1, pf.medida_2, ftp.unidad_x_art
		INTO v_ancho, v_largo_chapa, v_ancho_chapa, v_esp_chapa, v_largo, v_medida1, v_medida2, v_cant_art_pieza
		FROM fichas_tecnicas ft
		LEFT JOIN fichas_tecnicas_procesos ftp ON ft.id = ftp.ficha_tecnica_id
		LEFT JOIN articulos ar ON ft.articulo_id = ar.id
		LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
		WHERE ft.id = p_ftid
		AND ftp.etapa_subetapa_id IN (4,188) 
		AND ftp.orden = 1;
		
		SELECT plant.piezas_chapa
		INTO v_cant_piezas_chapa
		FROM  plantillas_corte plant 
		WHERE plant.maquina_id = 0 AND plant.ancho_chapa= v_ancho_chapa AND plant.largo_chapa = v_ancho_chapa
		AND plant.diametro_disco = v_largo;
		
		IF v_cant_piezas_chapa IS NULL THEN
			SET v_cant_piezas_chapa = 1;
		END IF;
		
		SELECT `Calculo_limite` (p_ftid)
		INTO v_limite;

		SELECT `SubCalculo1_PBCRect`(v_ancho_chapa, v_largo_chapa, v_esp_chapa, v_ancho, v_largo, v_limite)
		INTO v_subcalc1;

		SET v_cant_calc1 = SUBSTR(v_subcalc1,1,INSTR(v_subcalc1,' - ') - 1);

		SET v_pesochapaestimado_calc1 = SUBSTR(v_subcalc1, INSTR(v_subcalc1,' - ') + 3, LENGTH(v_subcalc1));
		
		SELECT `SubCalculo2_PBCRect`(v_ancho_chapa, v_largo_chapa, v_esp_chapa, v_ancho, v_largo, v_limite)
		INTO v_subcalc2;

		SET v_cant_calc2 = SUBSTR(v_subcalc2,1,INSTR(v_subcalc2,' - ') - 1);

		SET v_pesochapaestimado_calc2 = SUBSTR(v_subcalc2, INSTR(v_subcalc2,' - ') + 3, LENGTH(v_subcalc2));
		
		IF v_cant_calc1 >= v_cant_calc2 THEN
			SET v_cantidad_c = v_cant_calc1;
			SET v_PBC = TRUNCATE(v_pesochapaestimado_calc1 / if(v_cantidad_c = 0, 1, v_cantidad_c) * v_cant_art_pieza * v_cant_piezas_chapa, 2);
		ELSE 
			SET v_cantidad_c = v_cant_calc2;
			SET v_PBC = TRUNCATE(v_pesochapaestimado_calc2 / if(v_cantidad_c = 0, 1, v_cantidad_c) * v_cant_art_pieza * v_cant_piezas_chapa, 2);
		END IF;
		
		SET v_PCU = TRUNCATE(v_ancho * v_largo * v_esp_chapa * v_cant_art_pieza * 0.00000791, 2);
		
		SET v_respuesta = CONCAT(' PBC: ', v_PBC, ' - PCU: ', v_PCU );

		SET v_HP = CONCAT('UNIDADES - ', v_cantidad_c, ' - PIEZAS', v_cantidad_c / v_cant_art_pieza);
		RETURN JSON_OBJECT('DEFINICION', 'RECTANGULO', 'PBC' , v_PBC, 'PCU', v_PCU, 'HOJA DE PROCESO', v_HP, 'UNIDADES', v_cantidad_c, 'PIEZAS', v_cantidad_c / v_cant_art_pieza );

	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Calculo_PzHoraInicial`(p_ftid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
		DECLARE json_result JSON;
		DECLARE v_maq_tipo INT;
		DECLARE v_maq_nro INT;
		DECLARE v_etapa INT;
		DECLARE v_subetapa INT;
		DECLARE v_familia VARCHAR(10);
		DECLARE v_diam_disco DECIMAL(10,3);
		--
		SELECT maq.tipo_id, maq.numero, et.etapa, et.subetapa
		INTO v_maq_tipo, v_maq_nro, v_etapa, v_subetapa
		FROM fichas_tecnicas_procesos ftp
		LEFT JOIN fichas_tecnicas_maquinas ftm ON ftp.id = ftm.proceso_id
		LEFT JOIN maquinas_herramientas maq ON ftm.maquina_id = maq.id
		LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
		WHERE ftp.orden = 1
		AND ftp.ficha_tecnica_id = p_ftid;
		--
		SELECT pff.cod_as400, ft.diametro / 1000
		INTO v_familia, v_diam_disco
		FROM fichas_tecnicas ft
		LEFT JOIN productos_fabricados pf ON pf.id = ft.producto_fabricado_id
		LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id
		WHERE ft.id = p_ftid;
		--
		IF v_maq_tipo = 21 THEN
			IF v_maq_nro IN (9, 11, 12) THEN
				SET json_result = SubCalculo_PzHora_Sierra_Dano420(p_ftid);
			END IF;
			IF v_maq_nro IN (13) THEN
				SET json_result = SubCalculo_PzHora_Sierra_Dano520(p_ftid);
			END IF;
			IF v_maq_nro IN (7) THEN
				SET json_result = SubCalculo_PzHora_Sierra_Metora380(p_ftid);
			END IF;
			IF v_maq_nro IN (8) THEN
				SET json_result = SubCalculo_PzHora_Sierra_Metora550(p_ftid);
			END IF;
			IF v_maq_nro IN (6) THEN
				SET json_result = SubCalculo_PzHora_Sierra_UNIZ(p_ftid);
			END IF;
		END IF;
		--
		IF v_etapa = 1 AND v_subetapa = 13 THEN
			SET json_result = SubCalculo_PzHora_Pant1_13_Rejas(p_ftid);
		END IF;
		--
		IF v_etapa = 1 AND v_subetapa = 23 THEN
			SET json_result = SubCalculo_PzHora_Pant1_23_Regletas(p_ftid);
		END IF;
		--
		IF v_maq_tipo = 4 AND v_maq_nro IN (30,31) THEN
			IF v_familia IN ('CAS', 'CAT') THEN
				SET json_result = SubCalculo_PzHora_Pant_Casquete(p_ftid);
			END IF;
			--
			IF v_familia IN ('C45',	'CRL', 'CRC', 	'REC', 'REE') THEN
				SET json_result = SubCalculo_PzHora_Pant_Plantilla(p_ftid,v_familia);
			END IF;
			--
			IF v_familia IN ('TE',	'TER',	'TNS',	'TRS',	'FNI'	,'RTA',	'RET') THEN
				SET json_result = SubCalculo_PzHora_Pant_te(p_ftid);
			END IF;
			--
			IF v_familia IN ('REF') THEN
				SET json_result = SubCalculo_PzHora_Pant_refuerzo(p_ftid);
			END IF;
			--
			IF v_familia IN ('CRU', 'CZR') THEN
				IF IFNULL(v_diam_disco, 0) > 0 THEN
					SET json_result = SubCalculo_PzHora_Pant_Plantilla(p_ftid, v_familia);
				ELSE
					SET json_result = SubCalculo_PzHora_Pant_te(p_ftid);
				END IF;
			END IF;
		END IF; 
		--
		RETURN json_result;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Calculo_PzHora_Grupo_Inicial`(p_ftid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
        DECLARE json_result JSON;
        DECLARE v_proceso_id INT;
        DECLARE v_max_orden INT;
        DECLARE v_min_orden INT;
        DECLARE v_etapa INT;
        DECLARE v_subetapa INT;
        DECLARE i INT;
        --
        DECLARE v_pz_hora DECIMAL(10,3);
		SELECT MIN(orden), MAX(orden)
		INTO v_min_orden, v_max_orden
		FROM fichas_tecnicas_procesos ftp
		WHERE IFNULL(ftp.grupo_ft_id,0) > 0	AND ftp.ficha_tecnica_id = p_ftid;
		--
		DELETE FROM aux_pz_hora WHERE 1 = 1;
		--
		SET i = v_min_orden;
		--
        WHILE i <= v_max_orden DO
			SELECT ftp.id, et.etapa, et.subetapa
			INTO v_proceso_id, v_etapa, v_subetapa
			FROM fichas_tecnicas_procesos ftp
			LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id 
			WHERE  ftp.ficha_tecnica_id = p_ftid AND ftp.orden = i;
            --
			IF v_etapa = 6 AND v_subetapa = 33 THEN
				SET v_pz_hora = SubCalculo_PzHoraSoldadura_ET633(p_ftid);
			END IF;
			IF v_etapa = 6 AND v_subetapa = 17 THEN
				SET v_pz_hora = SubCalculo_PzHoraSoldadura_ET617(p_ftid);
			END IF;
            IF v_etapa = 6 AND v_subetapa = 30 THEN
				SET v_pz_hora = SubCalculo_PzHoraSoldadura_ET630(p_ftid);
			END IF;
			IF v_etapa = 6 AND v_subetapa = 18 THEN
				SET v_pz_hora = SubCalculo_PzHoraSoldadura_ET618(p_ftid);
			END IF;
			IF v_etapa = 6 AND v_subetapa = 34 THEN
				SET v_pz_hora = SubCalculo_PzHoraSoldadura_ET634(p_ftid);
			END IF;
			IF v_etapa = 6 AND v_subetapa = 35 THEN
				SET v_pz_hora = SubCalculo_PzHoraSoldadura_ET635(p_ftid);
			END IF;
			IF v_etapa = 4 AND v_subetapa = 2 THEN
				SET v_pz_hora = SubCalculo_PzHoraSoldadura_ET402(p_ftid);
			END IF;
            --
			SET	i = i + 1;
            --
			INSERT INTO aux_pz_hora(proceso_id, pz_hora)
			VALUES (v_proceso_id, v_pz_hora);
		END WHILE;
		--
        SELECT JSON_ARRAYAGG(JSON_OBJECT('FTP_id', aux.proceso_id, 'Piezas por hora', aux.pz_hora))
        INTO json_result
        FROM aux_pz_hora aux;
        RETURN json_result;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Calculo_TPM`(p_ftid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_general_ci
BEGIN
		DECLARE v_tiempo_maq DOUBLE;
		DECLARE v_tiempo DOUBLE;
		DECLARE v_tiempo_maq4 DOUBLE;
		DECLARE v_tiempo_ft DOUBLE;
		DECLARE v_estado VARCHAR(1);
		DECLARE json_result JSON;
		DECLARE v_ftp_id INT;
		DECLARE i INT;
		DECLARE j INT;
		DECLARE v_maquina INT;
		DECLARE v_max_orden INT;
		DECLARE v_medida1 DOUBLE;
		DECLARE v_medida2 DOUBLE;
		DECLARE v_familia VARCHAR(10);
		DECLARE v_suma_tiempos DOUBLE;
		DECLARE v_etapa INT;
		DECLARE v_subetapa INT; 
		DECLARE v_cant_oper DOUBLE;
		DECLARE v_cant_maquinas INT;
		DECLARE v_min_id INT;
		DECLARE v_max_id INT;
		--
		SELECT pf.medida_1, pf.medida_2, pff.cod_as400
		INTO v_medida1, v_medida2, v_familia
		FROM fichas_tecnicas ft
		LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
		LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id 
		WHERE ft.id = p_ftid;
		--
		SELECT MAX(orden)
		INTO v_max_orden
		FROM fichas_tecnicas_procesos ftp
		WHERE ftp.ficha_tecnica_id = p_ftid;
		--
		IF v_max_orden IS NULL OR v_max_orden = 0 THEN
			RETURN NULL;
		END IF;
		--
		DELETE FROM aux_tpm WHERE 1 = 1;
		--
		SET i = 1;
		SET v_suma_tiempos = 0;
		WHILE i <= v_max_orden DO
			SET v_tiempo = NULL;
			SET j = 0;
			SELECT COUNT(*), MIN(ftm.id), MAX(ftm.id)
			INTO v_cant_maquinas, v_min_id, v_max_id 
			FROM fichas_tecnicas_maquinas ftm
			LEFT JOIN fichas_tecnicas_procesos ftp ON ftm.proceso_id = ftp.id
			WHERE ftp.ficha_tecnica_id = p_ftid
			AND ftp.orden = i;
			--
			WHILE j < v_cant_maquinas DO
				SELECT ftp.id, ftp.cod_estado_setup, ftp.cantidad_operarios, MAX(mset.tiempo_preparacion),  ftp.tiempo_setup_maquina, et.etapa, et.subetapa
				INTO v_ftp_id, v_estado, v_cant_oper, v_tiempo_maq, v_tiempo_ft, v_etapa, v_subetapa
				FROM fichas_tecnicas_procesos ftp
				LEFT JOIN fichas_tecnicas_maquinas ftm ON ftp.id = ftm.proceso_id
				LEFT JOIN maquinas_setup mset
					ON mset.maquina_id = ftm.maquina_id AND IFNULL(mset.familia, v_familia) = v_familia AND mset.baja_usuario_id IS NULL 				AND v_medida1 BETWEEN mset.diametro_desde AND mset.diametro_hasta
				LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
				WHERE ftp.ficha_tecnica_id = p_ftid
				AND ftp.orden = i
				AND ftm.id = v_min_id + j
				GROUP BY ftp.id, ftp.cod_estado_setup, ftp.tiempo_setup_maquina, et.etapa, et.subetapa;
				SET j = j + 1;
				SET v_tiempo = v_tiempo + v_tiempo_maq;
			END WHILE;
			--
			SELECT  mset.tiempo_preparacion
			INTO v_tiempo_maq4
			FROM fichas_tecnicas_procesos ftp
			LEFT JOIN maquinas_setup mset
				ON mset.maquina_id = ftp.maquina_4_id AND IFNULL(mset.familia, v_familia) = v_familia AND mset.baja_usuario_id IS NULL AND v_medida1 BETWEEN mset.diametro_desde AND mset.diametro_hasta
			LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
			WHERE ftp.ficha_tecnica_id = p_ftid
			AND ftp.orden = i
			GROUP BY ftp.id, ftp.cod_estado_setup, ftp.tiempo_setup_maquina, et.etapa, et.subetapa;
			--
			IF v_etapa = 27 THEN 
				SET v_tiempo = Calculo_calib_setup(p_ftid, i, v_etapa, v_subetapa) * IF(v_cant_oper = 1, 2, 1) * 100;
			END IF;
			IF v_tiempo IS NOT NULL THEN
				CASE v_estado
					WHEN 'A' THEN 
						SET v_tiempo = v_tiempo * 0.1;
					WHEN 'B' THEN
						SET v_tiempo = v_tiempo * 0.25;
					WHEN 'D' THEN
						SET v_tiempo = v_tiempo * 0.5;
					WHEN 'E' THEN
						SET v_tiempo = v_tiempo * 0.75;
					WHEN 'F' THEN
						SET v_tiempo = v_tiempo * 0.9;
					ELSE 
						SET v_tiempo = v_tiempo * 1;
				END CASE;
				IF v_cant_oper > 0 THEN 
					SET v_tiempo = (v_tiempo + IFNULL(v_tiempo_maq4, 0)) / v_cant_oper;
				END IF;
				IF v_estado NOT IN ('C', 'P', 'S', 'M') THEN
					INSERT INTO aux_tpm (proceso_id, tiempo, orden, estado)
					VALUES (v_ftp_id, v_tiempo, i, v_estado);
				ELSE
					INSERT INTO aux_tpm (proceso_id, tiempo, orden, estado)
					VALUES (v_ftp_id, v_tiempo_ft, i, v_estado);
				END IF;
            ELSE
				SELECT ftp.id, ftp.cod_estado_setup, ftp.cantidad_operarios, SUM(mset.tiempo_preparacion)
				INTO v_ftp_id, v_estado, v_cant_oper, v_tiempo 
				FROM fichas_tecnicas_procesos ftp
				LEFT JOIN fichas_tecnicas_maquinas ftm ON ftp.id = ftm.proceso_id
				LEFT JOIN maquinas_setup mset
					ON mset.maquina_id = ftm.maquina_id AND mset.familia IS NULL AND mset.baja_usuario_id IS NULL
				WHERE ftp.ficha_tecnica_id = p_ftid
				AND v_medida1 BETWEEN mset.diametro_desde AND mset.diametro_hasta
				AND ftp.orden = i
				GROUP BY ftp.id, ftp.cod_estado_setup, ftp.cantidad_operarios;
				--
				IF v_tiempo IS NOT NULL THEN
					CASE v_estado
						WHEN 'A' THEN 
							SET v_tiempo = v_tiempo * 0.1;
						WHEN 'B' THEN
							SET v_tiempo = v_tiempo * 0.25;
						WHEN 'D' THEN
							SET v_tiempo = v_tiempo * 0.5;
						WHEN 'E' THEN
							SET v_tiempo = v_tiempo * 0.75;
						WHEN 'F' THEN
							SET v_tiempo = v_tiempo * 0.9;
						ELSE 
							SET v_tiempo = v_tiempo * 1;
					END CASE;
					IF v_cant_oper > 0 THEN 
						SET v_tiempo = (v_tiempo + IFNULL(v_tiempo_maq4, 0)) / v_cant_oper; 
					END IF;
					IF v_estado NOT IN ('C', 'P', 'S', 'M') THEN
						INSERT INTO aux_tpm (proceso_id, tiempo, orden, estado)
						VALUES (v_ftp_id, v_tiempo, i, v_estado);
					ELSE 
						INSERT INTO aux_tpm (proceso_id, tiempo, orden, estado)
						VALUES (v_ftp_id, v_tiempo_ft, i, v_estado);
					END IF;
				END IF;
			END IF;
			--
			SET i = i + 1;
			IF v_estado NOT IN ('C', 'P', 'S', 'M') THEN
				SET v_suma_tiempos = v_suma_tiempos + IFNULL(v_tiempo, 0);
			ELSE
				SET v_suma_tiempos = v_suma_tiempos + IFNULL(v_tiempo_ft, 0);
			END IF;
		END WHILE;
		--
		INSERT INTO aux_tpm (proceso_id, maquina_id, tiempo, orden, estado)
		VALUES (NULL, NULL, v_suma_tiempos / 100, 0, ' ');
		--
		SELECT JSON_ARRAYAGG(JSON_OBJECT('FTP_id', aux.proceso_id, 'Tiempo de preparación de maquinas', aux.tiempo / 100, 'Orden', aux.orden))
		INTO json_result
		FROM aux_tpm aux;
		--
		RETURN json_result;
	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `FuncionAsignacionBarrada`(p_opid INT) RETURNS varchar(5) CHARSET utf8mb4 COLLATE utf8mb4_general_ci
BEGIN
        DECLARE v_orden INT;
        DECLARE v_ficha INT;
        DECLARE v_materia INT;
        DECLARE v_calidad INT;
        DECLARE v_grupo INT;
        DECLARE v_norma INT;
        DECLARE v_horno INT;
        DECLARE v_solda INT;
        DECLARE v_calen INT;
        DECLARE v_hay02 INT;
        DECLARE v_hay05 INT;
        DECLARE v_hay14 INT;
        DECLARE v_maq_gas INT;
        DECLARE v_maq_ind INT;
        DECLARE v_barrada VARCHAR(3);
        DECLARE v_letra VARCHAR(4);
        --
        SELECT COUNT(*) INTO v_norma
            FROM ordenes_de_produccion op
            LEFT JOIN fichas_tecnicas_procesos ft ON op.ficha_tecnica_id = ft.ficha_tecnica_id
            WHERE op.id = p_opid AND etapa_subetapa_id = 55;
        --
        IF v_norma > 0 THEN SET v_norma = 1; END IF;
        --
        SELECT COUNT(*)
            INTO v_solda
            FROM ordenes_de_produccion op
            LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
            LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
            WHERE op.id = p_opid AND (etapa = 15 OR (etapa = 6 AND subetapa = 11))
        ;
        --
        IF v_solda > 0 THEN SET v_solda = 1; END IF;
        --
        SELECT COUNT(*)
            INTO v_calen
            FROM ordenes_de_produccion op
            LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
            LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
            WHERE op.id = p_opid AND etapa = 19
        ;
        IF v_calen = 0 THEN
            SELECT COUNT(*) INTO v_calen
            FROM ordenes_de_produccion op
            LEFT JOIN fichas_tecnicas_procesos ftp ON ftp.ficha_tecnica_id = op.ficha_tecnica_id
            LEFT JOIN fichas_tecnicas_maquinas ftm ON ftp.id = ftm.proceso_id
            LEFT JOIN maquinas_herramientas maq ON ftm.maquina_id = maq.id
            WHERE op.id = p_opid AND ((maq.tipo_id = 12 AND numero > 1) OR (maq.tipo_id = 7 AND numero IN (1, 2, 3, 4, 5, 7)));
        END IF;
        SELECT COUNT(*) INTO v_horno
            FROM ordenes_de_produccion op
            LEFT JOIN fichas_tecnicas_procesos ftp ON ftp.ficha_tecnica_id = op.ficha_tecnica_id
            LEFT JOIN fichas_tecnicas_maquinas ftm ON ftp.id = ftm.proceso_id
            LEFT JOIN maquinas_herramientas maq ON ftm.maquina_id = maq.id
            WHERE op.id = p_opid
            AND  (maq.tipo_id = 12 AND maq.numero > 1);
        SELECT COUNT(*) INTO v_hay02
            FROM ordenes_de_produccion op
            left join fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
            LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
            WHERE op.id = p_opid
            AND  etapa = 2;
        SELECT COUNT(*) INTO v_hay05
        FROM ordenes_de_produccion op
            LEFT join fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
            LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
            WHERE op.id = p_opid
            AND etapa = 5;
	    SELECT COUNT(*) INTO v_hay14
        FROM ordenes_de_produccion op
            LEFT join fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
            LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
            WHERE op.id = p_opid
            AND etapa = 14;
        SELECT COUNT(*) INTO v_maq_gas
            FROM ordenes_de_produccion op
            LEFT JOIN fichas_tecnicas_procesos ftp ON ftp.ficha_tecnica_id = op.ficha_tecnica_id
            LEFT JOIN fichas_tecnicas_maquinas ftm ON ftp.id = ftm.proceso_id
            LEFT JOIN maquinas_herramientas maq ON ftm.maquina_id = maq.id
            WHERE op.id = p_opid
            AND maq.tipo_id = 7
            AND maq.numero IN (1, 2, 3, 4);
        SELECT COUNT(*) INTO v_maq_ind
            FROM ordenes_de_produccion op
            LEFT JOIN fichas_tecnicas_procesos ftp ON ftp.ficha_tecnica_id = op.ficha_tecnica_id
            LEFT JOIN fichas_tecnicas_maquinas ftm ON ftp.id = ftm.proceso_id
            LEFT JOIN maquinas_herramientas maq ON ftm.maquina_id = maq.id
            WHERE op.id = p_opid
                AND maq.tipo_id = 7
                AND maq.numero IN (5, 7);
        --
        SELECT op.id orden, ft.id ficha, ft.articulo_id, pf.calidad_id calidad, gc.agrupacion_calidad_id grupo, op.letra
            INTO v_orden, v_ficha, v_materia, v_calidad, v_grupo, v_letra
            FROM ordenes_de_produccion op,
                fichas_tecnicas ft,
                productos_fabricados_calidades gc,
                        productos_fabricados pf
            WHERE op.ficha_tecnica_id = ft.id
                AND ft.producto_fabricado_id = pf.id
                AND gc.id = pf.calidad_id
                AND op.id = p_opid;
        --
        IF v_grupo IN (7, 8, 12, 13) THEN
            SET v_barrada = '/SA';
        END IF;
        IF v_grupo IN (2, 10) THEN
            IF v_norma > 0 THEN
                SET v_barrada = '/N';
            ELSE
                IF v_horno > 0 THEN
                    IF (v_hay02 = 0 or v_hay05 > 0 or v_hay14 > 0) THEN
                        SET v_barrada = '/P';
                    END IF;
                ELSE
                    IF v_maq_gas > 0 THEN
                        SET v_barrada = '/C';
                    END IF;
                    IF v_maq_ind > 0 THEN
                        SET v_barrada = '/I';
                    END IF;
                END IF;
            END IF;
        END IF;
        IF v_grupo =  5 THEN
            SET v_barrada = '/FA';
        END IF;
        IF v_grupo IN (111, 112, 113, 221, 222, 223, 4) THEN
            SET v_barrada = '/NR';
        END IF;
        IF v_grupo = 6 THEN
            IF v_solda = 0 THEN
                SET v_barrada = '/L6';
            ELSE
                SET v_barrada = CONCAT('/', SUBSTR(v_letra,2,3));
            END IF;
        END IF;
        IF v_grupo IN (42, 46, 52, 56, 60, 65, 70) THEN
            SET v_barrada = CONCAT('/', CAST(v_grupo AS CHAR));
        END IF;
        IF v_grupo = 1200 THEN
            SET v_barrada = '/SP';
        END IF;
        RETURN v_barrada;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `FuncionAsignaPlantilla`(p_ftid INT) RETURNS int(11)
BEGIN
		DECLARE v_medida1 DECIMAL(10,3);
		DECLARE v_medida2 DECIMAL(10,3);
		DECLARE v_espesor DECIMAL(10,3);
		DECLARE v_espesor_id INT;
		DECLARE v_familia VARCHAR(3);
		DECLARE v_rolado INT;
		DECLARE v_resultado VARCHAR(10);

		SELECT pf.medida_1, pf.medida_2, pff.cod_as400, pf.espesor_id, ar.espesor
		INTO v_medida1, v_medida2, v_familia, v_espesor_id, v_espesor
		FROM fichas_tecnicas ft
		LEFT JOIN articulos ar ON ft.articulo_id = ar.id
		LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
		LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id
		WHERE ft.id = p_ftid;

		SELECT COUNT(*)
		INTO v_rolado
		FROM fichas_tecnicas_procesos ftp
		LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
		WHERE et.etapa = 30 AND et.subetapa = 1
		AND ft.id = p_ftid;

		IF v_familia IN ('CRL', 'C45', 'CRC') THEN
			SELECT mhm.maquina_id
			INTO v_resultado
			FROM maquinas_herramientas_matrices mhm
			WHERE mhm.medida_1 = v_medida1
			AND mhm.familia = v_familia
			AND v_espesor BETWEEN mhm.espesor_desde AND mhm.espesor_hasta;
		END IF;

		IF v_familia IN ('REC', 'REE') THEN
			SELECT mhm.maquina_id
			INTO v_resultado
			FROM maquinas_herramientas_matrices mhm
			WHERE mhm.medida_1 = v_medida1
			AND mhm.familia = v_familia
			AND mhm.medida_2 = v_medida2
			AND mhm.rolado = v_rolado
			AND v_espesor BETWEEN mhm.espesor_desde AND mhm.espesor_hasta;
		END IF;

		IF v_familia IN ('CRU', 'CZR', 'RET', 'REF') THEN
			SELECT mhm.maquina_id
			INTO v_resultado
			from maquinas_herramientas_matrices mhm
			WHERE mhm.medida_1 = v_medida1
			AND mhm.medida_2 = v_medida2
			AND mhm.familia = v_familia;
		END IF;

		RETURN v_resultado;
	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'NO_AUTO_VALUE_ON_ZERO' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `FuncionBarradaColada`(`p_barrada` INT
) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
        	DECLARE v_grupo INT;
        	DECLARE v_resultado VARCHAR(100);
			DECLARE v_CeqforL DOUBLE;
			DECLARE v_carbono DOUBLE;
			DECLARE v_manganeso DOUBLE;
			DECLARE v_f DOUBLE;
			DECLARE v_CUNICRMB DOUBLE;
			DECLARE v_CUMB DOUBLE;
			DECLARE v_tipo VARCHAR(2);
			DECLARE v_orig VARCHAR(2);
			DECLARE v_espesor DOUBLE;
			DECLARE v_alargamiento_pb DOUBLE;
			DECLARE v_resultado_id INT;
			DECLARE json_resultado JSON;

        SELECT rt.agrupacion_calidad_id
        INTO v_grupo
        FROM recepciones_tecnicas rt
        WHERE rt.id = p_barrada;



        INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
        (SELECT p_barrada, par.id, rtp.valor_decimal,
        concat(par.parametro, if (rtp.valor_decimal < ifnull(esp.valor_minimo,0), ' - MENOR QUE EL MINIMO',
        if (rtp.valor_decimal > ifnull(esp.valor_maximo,9999), ' - SUPERA EL MAXIMO', ' - RANGO CORRECTO'))),
        if (rtp.valor_decimal < ifnull(esp.valor_minimo,0), -1,
        if (rtp.valor_decimal > ifnull(esp.valor_maximo,9999), 1, 10))
        FROM recepciones_tecnicas_partes rtp
        LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
        LEFT JOIN ensayos_rangos_quimicos esp ON par.id = esp.parametro_id
        WHERE rtp.recepcion_tecnica_id = p_barrada
        AND esp.agrupacion_calidad_id = v_grupo
        );

        INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, resultado, resultado_id)
        (SELECT p_barrada, par.id, CONCAT(par.descripcion, ' SIN RESULTADO INFORMADO'), 0
		  FROM ensayos_rangos_quimicos pbe
		  LEFT JOIN ensayos_parametros par ON pbe.parametro_id = par.id
			WHERE pbe.agrupacion_calidad_id = v_grupo
        AND (valor_minimo IS not NULL OR valor_maximo IS NOT NULL)
 			AND NOT EXISTS
 			(SELECT * FROM recepciones_tecnicas_partes rtp
 					WHERE pbe.parametro_id = rtp.parametro_id
					 AND rtp.recepcion_tecnica_id = p_barrada)
         );


      	SELECT sum(if(par.descripcion = 'carbono', valor_decimal, 0)), sum(if(par.descripcion = 'manganeso', valor_decimal, 0))
		   INTO v_carbono, v_manganeso
      	FROM recepciones_tecnicas_partes rtp
      	LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
        	WHERE rtp.recepcion_tecnica_id = p_barrada;

			



		SELECT sum(if(par.parametro = 'C', valor_decimal, 0)), sum(if(par.parametro = 'Mn', valor_decimal/6, if(par.parametro IN ('Cr', 'Mo', 'V'), valor_decimal / 5,
		if(par.parametro IN ('Ni','Cu') , valor_decimal / 15, valor_decimal))))
		INTO v_carbono, v_CeqforL
      FROM recepciones_tecnicas_partes rtp
        LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
        LEFT JOIN ensayos_rangos_quimicos esp ON par.id = esp.parametro_id
		          WHERE rtp.recepcion_tecnica_id = p_barrada
        AND esp.agrupacion_calidad_id = v_grupo
        AND par.parametro IN ('Co', 'Mn', 'Cr', 'Mb', 'V', 'Ni', 'Cu')
        ;

			SELECT SUM(ifnull(rtp.valor_decimal,0))
			INTO v_CUNICRMB
			FROM recepciones_tecnicas_partes rtp
			LEFT JOIN ensayos_parametros par ON par.id  = rtp.parametro_id
			WHERE rtp.recepcion_tecnica_id = p_barrada
			AND par.parametro IN ('Cu', 'Ni', 'Cr', 'Mb');

			SELECT SUM(ifnull(rtp.valor_decimal,0))
			INTO v_CUMB
			FROM recepciones_tecnicas_partes rtp
			LEFT JOIN ensayos_parametros par ON par.id  = rtp.parametro_id
			WHERE rtp.recepcion_tecnica_id = p_barrada
			AND par.parametro IN ('Cu','Mb');

		IF v_grupo BETWEEN 42 AND 70 THEN
			IF v_carbono > 0.17 THEN
				IF v_CeqForL < 0.45 THEN
					SET  v_resultado = 'Carbono mayor a 0.17 - CeqforL RANGO CORRECTO';
					SET v_resultado_id = 10;
				ELSE
					SET v_resultado ='Carbono mayor 0.17 - CeqforL SUPERA EL MAXIMO de 0.45%'  ;
					SET v_resultado_id = 1;
				END IF;
			ELSE

				CASE v_carbono
   				WHEN 0.06 THEN set v_f = 0.54;
   				WHEN 0.07 THEN set v_f = 0.56;
					WHEN 0.08 THEN set v_f = 0.58;
					WHEN 0.09 THEN set v_f = 0.62;
					WHEN 0.10 THEN set v_f = 0.66;
					WHEN 0.11 THEN set v_f = 0.70;
					WHEN 0.12 THEN set v_f = 0.75;
					WHEN 0.13 THEN set v_f = 0.80;
					WHEN 0.14 THEN set v_f = 0.85;
					WHEN 0.15 THEN set v_f = 0.88;
   				WHEN 0.16 THEN set v_f = 0.92;
					WHEN 0.17 THEN set v_f = 0.94;
				ELSE
					SET v_f = 0.53;
				END CASE;
				
				SELECT sum(if(par.parametro = 'C', valor_decimal, 0)
					+ v_f * if(par.parametro = 'Mn', valor_decimal/6, 0)
					+ if(par.parametro = 'Si' , valor_decimal/24, 0)
					+ if(par.parametro = 'Cu', valor_decimal / 24, 0 )
					+ if(par.parametro = 'Ni', valor_decimal / 20, 0 )
					+ if(par.parametro IN ('Cr', 'Mb', 'V', 'Nb') , valor_decimal, 0))
					INTO v_CeqforL
      			FROM recepciones_tecnicas_partes rtp
        			LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
        			LEFT JOIN ensayos_rangos_quimicos esp ON par.id = esp.parametro_id
        			WHERE rtp.recepcion_tecnica_id = p_barrada
        				AND esp.agrupacion_calidad_id = v_grupo;

				IF v_CeqForL < 0.45 THEN
					SET  v_resultado = 'Carbono menor a 0.17 - CeqforL RANGO CORRECTO';
					SET v_resultado_id = 10;
				ELSE
					SET v_resultado ='Carbono menor 0.17 - CeqforL SUPERA EL MAXIMO de 0.45%'  ;
					SET v_resultado_id = 1;
				END IF;

			END IF;



			INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
			VALUES (p_barrada, 99, v_CeqForL, v_resultado, v_resultado_id);
		END IF;

		IF v_grupo = 2 THEN
			if v_manganeso BETWEEN 1.06 AND 1.35 THEN
				if (v_carbono < 0.25 AND v_manganeso + (0.25 - v_carbono) * 0.06 < 1.35) THEN
					SET	v_resultado = 'Rango mayor de Manganeso permitido por reducción de carbono con respecto al máximo';
					SET v_resultado_id = 10;
				END IF;
				INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
				VALUES (p_barrada, 97, ifnull(v_manganeso,0), v_resultado, v_resultado_id);

			END if;



			IF ifnull(v_CeqForL,0) < 0.5 THEN
					SET  v_resultado = 'CeqforL RANGO CORRECTO';
					SET v_resultado_id = 10;
				ELSE
					SET v_resultado ='CeqforL SUPERA EL MAXIMO de 0.5%'  ;
					SET v_resultado_id= 1;
				END IF;
			INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado,resultado_id)
			VALUES (p_barrada, 98, ifnull(v_CeqForL,0), v_resultado, v_resultado_id);



			if IFNULL(v_CUNICRMB,0) > 1 THEN
				SET v_resultado = 'Cobre+Niquel+Cromo+Molbideno SUPERA EL MAXIMO de 1%'  ;
				SET v_resultado_id = 1;
			else
				SET v_resultado = 'Cobre+Niquel+Cromo+Molbideno RANGO CORRECTO'  ;
				SET v_resultado_id = 10;
			END if;
			INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
			VALUES (p_barrada, 97, ifnull(v_CUNICRMB,0), v_resultado, v_resultado_id);
		END IF;

		IF V_GRUPO = 10 THEN
			if v_manganeso BETWEEN 1.06 AND 1.30 THEN
				if (v_carbono < 0.25 AND v_manganeso + (0.25 - v_carbono) * 0.06 < 1.30) THEN
					SET	v_resultado = 'Rango mayor de Manganeso permitido por reducción de carbono con respecto al máximo';
					SET v_resultado_id = 10;
				END IF;
				INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
				VALUES (p_barrada, 1, ifnull(v_manganeso,0), v_resultado, v_resultado_id);

			END if;



			IF ifnull(v_CeqForL,0) < 0.43 THEN
					SET  v_resultado = 'CeqforL RANGO CORRECTO';
					SET v_resultado_id = 10;
				ELSE
					SET v_resultado ='CeqforL SUPERA EL MAXIMO de 0.43%'  ;
					SET v_resultado_id= 1;
				END IF;
			INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado,resultado_id)
			VALUES (p_barrada, 99, ifnull(v_CeqForL,0), v_resultado, v_resultado_id);



			if IFNULL(v_CUNICRMB,0) > 1 THEN
				SET v_resultado = 'Cobre+Niquel+Cromo+Molbideno SUPERA EL MAXIMO de 1%'  ;
				SET v_resultado_id = 1;
			else
				SET v_resultado = 'Cobre+Niquel+Cromo+Molbideno RANGO CORRECTO'  ;
				SET v_resultado_id = 10;
			END if;
			INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
			VALUES (p_barrada, 97, ifnull(v_CUNICRMB,0), v_resultado, v_resultado_id);


			if IFNULL(v_CUMB,0) > 0.32 THEN
				SET v_resultado = 'Cobre+Molbideno SUPERA EL MAXIMO de 0.32%'  ;
				SET v_resultado_id = 1;
			else
				SET v_resultado = 'Cobre+Molbideno RANGO CORRECTO'  ;
				SET v_resultado_id = 10;
			END if;
			INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
			VALUES (p_barrada, 96, ifnull(v_CUMB,0), v_resultado, v_resultado_id);

		END IF;


		if v_grupo = 2 then
			SET v_resultado = analisis_mecanicos_grupo_2 (p_barrada);
		END if;

		if v_grupo = 10 then
			SET v_resultado = analisis_mecanicos_grupo10 (p_barrada);
		END if;

		if v_grupo BETWEEN 42 AND 70 THEN
		   set v_resultado = Analisis_mecanicos_grupo42a70 (p_barrada, v_grupo) ;
		END IF;

		SELECT JSON_ARRAYAGG(JSON_OBJECT('parametro_id', rts.parametro_id, 'parametro_descripcion', par.descripcion,  'resultado_id', resultado_id, 'resultado_descripcion', resultado))
		INTO json_resultado
      FROM recepciones_tecnicas_resultados rts
		LEFT JOIN ensayos_parametros par ON rts.parametro_id = par.id
		WHERE recepcion_tecnica_id = p_barrada AND rts.alta_fecha_hora = (SELECT MAX(alta_fecha_hora)
		FROM recepciones_tecnicas_resultados rt2 WHERE recepcion_tecnica_id = rts.recepcion_tecnica_id)
		;

      RETURN json_resultado;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `FuncionColorProbetero`(p_opid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_general_ci
BEGIN
        DECLARE v_color_probetero VARCHAR(50);
        DECLARE v_transfor INT;
        DECLARE v_cc_31 INT;
        DECLARE result_json JSON;
        DECLARE v_agru_mp INT;
        DECLARE v_et_70 INT;
        --
        SELECT COUNT(*)
        INTO v_cc_31
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON ftp.ficha_tecnica_id = op.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
        WHERE et.centro_de_costo_id = 5
        AND op.id = p_opid;
        --
        SELECT COUNT(*)
        INTO v_et_70
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON ftp.ficha_tecnica_id = op.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
        WHERE et.etapa = 70
        AND ftp.orden = 1
        AND op.id = p_opid;
        --
        SELECT ac.id
        INTO v_agru_mp
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas ft ON op.ficha_tecnica_id = ft.id
        LEFT JOIN articulos ar ON ft.articulo_id = ar.id
        LEFT JOIN articulos_calidades ac ON ar.calidad_id = ac.id
        WHERE op.id = p_opid;
        --
        SET v_transfor = IF(v_et_70 > 0, 1,0);
        --
        IF v_transfor = 1 THEN
            IF v_cc_31 > 0 THEN
                SET v_color_probetero = 'PROBETERO PRENSA AZUL';
            ELSE
                IF v_agru_mp IN (7,8,12) THEN
                    SET v_color_probetero = 'PROBETERO PRENSA VERDE';
                ELSE
                    SET v_color_probetero = 'PROBETERO PRENSA GRIS';
                END IF;
            END IF;	
        ELSE
            SET v_color_probetero = 'PROBETERO PRENSA AZUL';
        END IF;
        --
        RETURN v_color_probetero;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `FuncionQuimicosAnteriores`(p_opid INT) RETURNS int(1)
BEGIN
        DECLARE v_quim_ant INT;
        DECLARE v_colada_barrada VARCHAR(50);
        DECLARE v_barrada VARCHAR(5);
        DECLARE v_ensayo_quimico INT;
        --
        SET v_quim_ant = 0;
        --
        SELECT ope.colada_barrada, SUBSTRING_INDEX(ope.colada_barrada, '/', -1)
        INTO v_colada_barrada, v_barrada
        FROM ordenes_de_produccion_estudios ope
        WHERE ope.orden_de_produccion_id = p_opid AND es_la_version_vigente;
        --
        IF v_barrada LIKE 'A%' AND v_barrada <> 'A01' THEN
            SELECT ope.ensayo_quimico
            INTO v_ensayo_quimico
            FROM ordenes_de_produccion_estudios ope
            WHERE es_la_version_vigente
            AND colada_barrada = CONCAT(SUBSTRING_INDEX(v_colada_barrada, '/', 1), '/A01')
            LIMIT 1;
            --
            IF IFNULL(v_ensayo_quimico,0) > 0 THEN
                SET v_quim_ant = 1;
            ELSE
                SELECT ope.ensayo_quimico
                INTO v_ensayo_quimico
                FROM ordenes_de_produccion_estudios ope
                WHERE es_la_version_vigente
                AND colada_barrada = SUBSTRING_INDEX(v_colada_barrada, '/', 1)
                LIMIT 1;
                --
                IF IFNULL(v_ensayo_quimico,0) > 0 THEN
                    SET v_quim_ant = 1;
                ELSE
                    SELECT rt.ensayo_quimico
                    INTO v_ensayo_quimico
                    FROM recepciones_tecnicas rt
                    WHERE rt.colada = SUBSTRING_INDEX(v_colada_barrada, '/', 1)
                    LIMIT 1;
                    --
                    IF IFNULL(v_ensayo_quimico,0) > 0 THEN
                        SET v_quim_ant = 1;
                    END IF;
                END IF;
            END IF;
        END IF;
        --
        IF v_barrada = 'A01' THEN
            SELECT rt.ensayo_quimico
            INTO v_ensayo_quimico
            FROM recepciones_tecnicas rt
            WHERE rt.colada = SUBSTRING_INDEX(v_colada_barrada, '/', 1)
            LIMIT 1;
            --
            IF IFNULL(v_ensayo_quimico, 0) > 0 THEN
                SET v_quim_ant = 1;
            END IF;
            --
            IF v_quim_ant = 0 THEN
                SELECT ope.ensayo_quimico
                INTO v_ensayo_quimico
                FROM ordenes_de_produccion_estudios ope
                WHERE es_la_version_vigente
                AND colada_barrada LIKE CONCAT(SUBSTRING_INDEX(v_colada_barrada, '/', 1), '/N%')
                LIMIT 1;
                --
                IF IFNULL(v_ensayo_quimico, 0) > 0 THEN
                    SET v_quim_ant = 1;
                END IF;
                --
                IF v_quim_ant = 0 THEN
                    SELECT ope.ensayo_quimico
                    INTO v_ensayo_quimico
                    FROM ordenes_de_produccion_estudios ope
                    WHERE es_la_version_vigente
                    AND colada_barrada = CONCAT(SUBSTRING_INDEX(v_colada_barrada, '/', 1), '/TR')
                    LIMIT 1;
                    --
                    IF IFNULL(v_ensayo_quimico,0) > 0 THEN
                        SET v_quim_ant = 1;
                    END IF;
                END IF;
            END IF;
        END IF;
        --
        RETURN v_quim_ant;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `FuncionTildes`(p_opid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
        DECLARE json_result JSON;
        DECLARE v_familia VARCHAR(10);
        DECLARE v_medida1 DOUBLE;
        DECLARE v_medida2 DOUBLE;
        DECLARE v_perfilbarrada VARCHAR (5);
        DECLARE v_solda INT;
        DECLARE v_tilde_corte int;
        DECLARE v_tilde_curvado INT;
        DECLARE v_tilde_prensa int;
		--
        SELECT pf.medida_1, pf.medida_2, pff.cod_as400
        INTO v_medida1, v_medida2, v_familia
        FROM ordenes_de_produccion op
        LEFT join fichas_tecnicas ft ON op.ficha_tecnica_id = ft.id
        LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
        LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id
        WHERE op.id = p_opid;
		--
        SELECT COUNT(*)
        INTO v_solda
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
        WHERE op.id = p_opid AND (etapa = 15 OR (etapa = 6 AND subetapa = 11));
		--
        IF v_solda > 0 THEN
            SET v_solda = 1;
        END IF;
		--
        SELECT perfil_de_barrada
        INTO v_perfilbarrada
        FROM ordenes_de_produccion_estudios ope
        INNER JOIN ordenes_de_produccion op ON op.id = ope.orden_de_produccion_id AND es_la_version_vigente IS TRUE
        WHERE op.id = p_opid;
		--
        IF v_perfilbarrada IN ('/N', '/NR', '/NE', '/FA') or v_solda = 1 THEN
            SET v_tilde_prensa = 1;
        ELSE
            SET v_tilde_prensa = 0;
        END IF;
		--
        IF v_perfilbarrada IN ('/C', '/I') THEN
            SET v_tilde_curvado = 1;
        ELSE
            SET v_tilde_curvado = 0;
        END IF;
        --
        IF v_familia IN ('CRC', 'CRL', 'FTE', 'FTR', 'FNI', 'F90', 'REF', 'RET', 'SWC', 'SWE', 'TE', 'TEM', 'TER', 'TNS', 'TRS')
        AND v_medida1 BETWEEN 200 AND 400 THEN
            SET v_tilde_corte = 0;
        ELSE
            SET v_tilde_corte = 1;
        END IF;
		--
        SELECT JSON_ARRAYAGG(JSON_OBJECT('Curvado', v_tilde_curvado, 'Soldado', v_solda, 'Prensa', v_tilde_prensa, 'Corte',  v_tilde_corte))
        INTO json_result
        FROM dual;
		--
        RETURN json_result;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `FuncionTratamientoTermico`(p_opid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
        DECLARE v_subetapa INT;
        DECLARE v_tt_desc VARCHAR(100);
        DECLARE v_tt_temp INT;
        DECLARE v_tt_desc_1 VARCHAR(100);
        DECLARE v_tt_temp_1 INT;
        DECLARE v_tt_desc_2 VARCHAR(100);
        DECLARE v_tt_temp_2 INT;
        DECLARE result_json JSON;
        DECLARE vueltas INT;
        DECLARE i INT;
        DECLARE v_max_orden INT;
        DECLARE v_min_orden INT;
        --
        SELECT COUNT(*), MAX(orden), MIN(orden)
        INTO vueltas, v_max_orden, v_min_orden
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
        WHERE op.id = p_opid
        AND et.etapa = 19
        AND et.subetapa IN (1, 2, 4, 5, 14,16,20,21,22,27);
        --
        SET i =  1;
        WHILE i <= vueltas DO
            SELECT aux.subetapa, aux.descrip_alt, aux.temperatura
            INTO v_subetapa, v_tt_desc, v_tt_temp
            FROM ordenes_de_produccion op
            LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
            LEFT JOIN aux_tterm aux ON ftp.etapa_subetapa_id = aux.id
            WHERE op.id = p_opid
            AND ftp.orden = IF(i = 1, v_min_orden, v_max_orden)
            AND aux.etapa = 19;
            --
            IF v_subetapa IN (4,5) THEN
            	SELECT maq.numero
            	INTO v_tt_temp
            	FROM ordenes_de_produccion op
                LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
                LEFT JOIN fichas_tecnicas_maquinas ftm ON ftp.id = ftm.proceso_id
                LEFT JOIN maquinas_herramientas maq ON maq.id = ftm.maquina_id
            	WHERE op.id = p_opid
            	AND ftp.orden = IF(i = 1, v_min_orden, v_max_orden)
            	AND maq.tipo_id IN (95, 96)
                LIMIT 1;
            END IF;
            --
            IF i = 1 THEN 
                SET v_tt_desc_1 = v_tt_desc;
                SET v_tt_temp_1 = v_tt_temp;
            ELSE
                SET v_tt_desc_2 = v_tt_desc;
                SET v_tt_temp_2 = v_tt_temp;
            END IF;	
            --
            SET i= i + 1;
        END WHILE;
        -- RETURN CONCAT( v_tt_desc_1, ' - ', v_tt_temp,  ' - ', ifnull(v_tt_desc_2, '') );
        RETURN JSON_OBJECT('TT_DESC_1', v_tt_desc_1, 'TT_TEMP_1', v_tt_temp_1, 'TT_DESC_2', v_tt_desc_2, 'TT_TEMP_2', v_tt_temp_2);
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Funcion_OC_laboratorio`(p_opid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
        DECLARE v_ra318 VARCHAR(50);
        DECLARE v_inspeccion VARCHAR(50);
        DECLARE v_et3014 INT;
        DECLARE v_et3013 INT;
        DECLARE v_tipo INT;
        DECLARE v_inox VARCHAR(10);
        DECLARE v_direccion VARCHAR(50);
        DECLARE v_cant_probetas INT;
        DECLARE v_biseladas INT;
        DECLARE v_perfilbarrada VARCHAR(10);
        DECLARE v_calidad_mp INT;
        DECLARE v_tipoprobetero VARCHAR(50);
        DECLARE v_fpp006 VARCHAR(50);
        DECLARE v_espesor DECIMAL(10,3);
        DECLARE v_familia VARCHAR(10);
        DECLARE v_tildecurvado INT;
        DECLARE v_tildeprensa INT;
        DECLARE v_medida1 DECIMAL(10,3);
        DECLARE v_medida2 DECIMAL(10,3);
        DECLARE v_texto3 VARCHAR(100);
        DECLARE v_texto7y8 VARCHAR(200);
        DECLARE v_fpp050 VARCHAR(10);
        DECLARE v_quim_sol VARCHAR(10);
        DECLARE v_quim_zac VARCHAR(10);
        DECLARE v_quim_ant INT;
        DECLARE v_valor_charpy VARCHAR(50); -- TEXTO52
        DECLARE v_quim_mb BOOLEAN;
        DECLARE v_traccion_mb BOOLEAN;
        DECLARE v_traccion_sol BOOLEAN;
        DECLARE v_traccion_zac BOOLEAN;
        DECLARE v_charpy_mb BOOLEAN;
        DECLARE v_charpy_sol BOOLEAN;
        DECLARE v_charpy_zac BOOLEAN;
        DECLARE v_dureza_mb BOOLEAN;
        DECLARE v_dureza_sol BOOLEAN;
        DECLARE v_dureza_zac BOOLEAN;
        DECLARE v_plegado_mb BOOLEAN;
        DECLARE v_plegado_sol BOOLEAN;
        DECLARE v_plegado_zac BOOLEAN;
        DECLARE v_piso VARCHAR(75);
        DECLARE v_solda INT;
        DECLARE v_art_cali VARCHAR(100);
        DECLARE v_art_desc VARCHAR(100);
        DECLARE v_pf_desc VARCHAR(100);
        DECLARE v_diametro DECIMAL(10,3);
        DECLARE v_cali_desc VARCHAR(30);
        DECLARE v_espesor_desc VARCHAR(30);
        DECLARE v_norma_desc VARCHAR(30);
        -- DECLARE v_art_desc VARCHAR(50);
        -- DECLARE v_pf_desc VARCHAR(50);
        DECLARE v_tt_desc_1 VARCHAR(100);
        DECLARE v_tt_desc_2 VARCHAR(100);
        DECLARE v_tt_temp_1 VARCHAR(10);
        DECLARE v_tt_temp_2 VARCHAR(10);
        DECLARE v_fpp40y41 VARCHAR(100);
        DECLARE v_titu_form VARCHAR(10);
        DECLARE v_boca DECIMAL(10,3);
        DECLARE v_ubic_axial VARCHAR(50);
        DECLARE v_transfo INT;
		--
        SET v_texto7y8 = '';
        SET v_traccion_mb = 0;
        SET v_charpy_mb = 0;
        SET v_plegado_mb = 0;
        SET v_direccion = IF(v_tipo IN (1,3,5), '(-)', 'TRANSVERSAL');
        SET v_cant_probetas = 1;
        SET v_biseladas = 0;        
        SET v_quim_ant = FuncionQuimicosAnteriores(p_opid);
        SET v_cant_probetas = 1;
        --
        SELECT ar.tipo_id, ar.espesor / 1000, pf.medida_1, pf.medida_2,  pff.cod_as400, ar.descripcion, ac.descripcion, pf.descripcion, ar.diametro, pfc.descripcion, pfe.descripcion, pfn.descripcion, ar.descripcion, pf.descripcion
        INTO v_tipo, v_espesor, v_medida1, v_medida2, v_familia, v_art_desc, v_art_cali, v_pf_desc, v_diametro, v_cali_desc, v_espesor_desc, v_norma_desc, v_art_desc, v_pf_desc
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas  ft ON op.ficha_tecnica_id = ft.id
        LEFT JOIN articulos ar ON ar.id = ft.articulo_id
        LEFT JOIN articulos_calidades ac ON ar.calidad_id = ac.id
        LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
        LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id 
        LEFT JOIN productos_fabricados_calidades pfc ON pfc.id = pf.calidad_id
        LEFT JOIN productos_fabricados_espesores pfe ON pfe.id = pf.espesor_id
        LEFT JOIN productos_fabricados_normas pfn ON pfn.id = pf.norma_id
        WHERE op.id = p_opid;
        --
        SELECT COUNT(*)
        INTO v_et3014
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
        WHERE op.id = p_opid
        AND et.etapa = 30 AND et.subetapa = 14;
        --
        SELECT COUNT(*)
        INTO v_et3013
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
        WHERE op.id = p_opid
        AND et.etapa = 30 AND et.subetapa = 13;
        --
        SELECT COUNT(*)
        INTO v_solda
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
        WHERE op.id = p_opid AND (etapa = 15 OR (etapa = 6 AND subetapa = 11));
        --
        SELECT COUNT(*)
        INTO v_transfo
        FROM fichas_tecnicas_procesos ftp
        LEFT JOIN ordenes_de_produccion op ON ftp.ficha_tecnica_id = op.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
        WHERE ftp.orden = 1
        AND op.id = p_opid
        AND et.etapa = 70;
        --
        SET v_ra318 = IF(v_et3014 > 0, 1, 0);
        SET v_inspeccion  = IF(v_et3013 > 0, 1, 0);
        SET v_inox = IF(v_tipo IN (3,4), 'RECOCIDO', '');
        SET v_direccion = IF(v_tipo NOT IN (1,3,5), 'TRANSVERSAL', '-');
        --
        SELECT FuncionAsignacionBarrada(p_opid)
        INTO v_perfilbarrada;
        --
        IF v_perfilbarrada IN ('/C', '/I') THEN
            SET v_fpp006 = 'CURVADO';
            SET v_tipoprobetero = 'PROBETERO CURVADO';
            SET v_tildecurvado = 1;
            SET v_texto3 = IF(v_tipo IN (3, 4), 'Diam. x 150 mm de largo o 100x150mm', 'Cortar TUBO de 150mm de largo');
        ELSE
            IF v_perfilbarrada IN ('/P', '/SA') THEN
                SET v_fpp006 = 'PRENSA';
                SET v_tipoprobetero = FuncionColorProbetero(p_opid);
                SET v_tildeprensa = 1;
            END IF;
        END IF;
        --
        SET v_quim_mb  = IF(v_quim_ant = 0, 1, IF(v_inspeccion > 0 OR v_ra318 > 0, 1, 0));
        SET v_quim_sol = 0;
        SET v_quim_zac = 0;
        SET v_traccion_mb  = 1;
        SET v_traccion_sol = 0;
        SET v_traccion_zac = 0;
        SET v_valor_charpy = 'Charpy -29ºC';
        SET v_charpy_mb  = 0;
        SET v_charpy_sol = 0;
        SET v_charpy_zac = 0;
        SET v_dureza_mb  = 1;
        SET v_dureza_sol = IF((v_inspeccion > 0 OR v_ra318 > 0 OR v_transfo > 0) AND v_solda > 0, 1, 0);
        SET v_dureza_zac = IF(v_inspeccion > 0 AND v_solda > 0, 1,  0);
        SET v_plegado_mb  = 0;
        SET v_plegado_sol = 0;
        SET v_plegado_zac = 0;
        SET v_texto3 =  IF(v_texto3 = NULL, IF(v_tipo IN (2,4), '2 probetas de 150 x 350 mm - Biseladas', ''), v_texto3); -- Consultar Roque
        SET v_cant_probetas = IF(v_tipo IN (2,4),2, 0);
        SET v_biseladas = IF(v_tipo IN (2,4),1, 0);
        SET v_piso = IF(v_perfilbarrada = '/SA', 'EC 7.4.1.35', 'EC 7.4.1.23 rev01');
        --
        IF v_familia IN ('CRC', 'CRL', 'FTE', 'FTR', 'FNI', 'F90', 'REF', 'RET', 'SWC', 'SWE', 'TE', 'TEM', 'TER', 'TNS', 'TRS') THEN
            IF v_medida1 BETWEEN 200 AND 400 THEN
                SET v_texto3 = IF(v_texto3 = NULL, IF(v_tipo IN (3,4), 'Diam. x 150 mm de largo o 100x150mm', 'PIEZA'), v_texto3);
                SET v_texto7y8 = 'Segregar 1 pieza en el primer lote de producción identificarla (si no lo esta) y llevarla a Probetas a entregar.';
            ELSE
                SET v_texto7y8 = 'Acompañar el calentamiento del primer lote de producción con la probeta y llevarla a Probetas a entregar.';
                SET v_fpp050 = 'LLEVAR A';
            END IF;
        ELSE
            SET  v_texto7y8 = 'Acompañar el calentamiento del primer lote de producción con la probeta y llevarla a Probetas a entregar.';
            SET v_fpp050 = 'LLEVAR A';
        END IF;
        --
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_DESC_1') FROM dual INTO v_tt_desc_1;
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_TEMP_1') FROM dual INTO v_tt_temp_1;
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_DESC_2') FROM dual INTO v_tt_desc_2;
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_TEMP_2') FROM dual INTO v_tt_temp_2;
        --
        DELETE FROM aux_op_estudios WHERE 1 = 1;
        --
        INSERT INTO aux_op_estudios (orden_de_produccion_id, perfil_de_barrada, probeta_tamano,
            direccion, probeta_cantidad,
            biselado, soldadura,
            tratamiento_termico_1, temperatura_1, tratamiento_termico_2, temperatura_2,
            mb_quimico, mb_traccion, mb_charpy,mb_dureza,mb_plegado,
            ma_quimico, ma_traccion, ma_charpy,   ma_dureza,   ma_plegado,
            zac_quimico,  zac_traccion,   zac_charpy,   zac_dureza,   zac_plegado, calidad_desc, espesor_desc, norma_desc, indicaciones_7y8, indicaciones_6, tipo_probetero, art_desc, pf_desc)
        VALUES (p_opid, v_perfilbarrada, v_texto3, v_direccion, v_cant_probetas, v_biseladas, v_solda, v_tt_desc_1, v_tt_temp_1, v_tt_desc_2, v_tt_temp_2,
            v_quim_mb , v_traccion_mb ,v_charpy_mb, v_dureza_mb , v_plegado_mb ,
            v_quim_sol ,  v_traccion_sol, v_charpy_sol , v_dureza_sol , v_plegado_sol ,
            v_quim_zac ,  v_traccion_zac, v_charpy_zac , v_dureza_zac , v_plegado_zac, 
            v_cali_desc, v_espesor_desc, v_norma_desc, v_texto7y8, v_fpp006, v_tipoprobetero, v_art_desc, v_pf_desc)
        ;
        --  RETURN CONCAT(v_perfilbarrada,' - ', v_tipo, ' - ', v_texto3, ' - ', v_tipoprobetero, ' - ', v_tildecurvado, ' - ', v_art_desc, ' - ', v_pf_desc);
        RETURN JSON_OBJECT(
            'orden_de_produccion_id', p_opid,
            'perfil_de_barrada', v_perfilbarrada,
            'probeta_tamano', v_texto3,
            'direccion', v_direccion,
            'probeta_cantidad', v_cant_probetas,
            'biselado', v_biseladas,
            'soldadura', v_solda,
            'tratamiento_termico_1', v_tt_desc_1,
            'temperatura_1', v_tt_temp_1,
            'tratamiento_termico_2', v_tt_desc_2,
            'temperatura_2', v_tt_temp_2,
            'mb_quimico', v_quim_mb,
            'mb_traccion', v_traccion_mb,
            'mb_charpy', v_charpy_mb,
            'mb_dureza', v_dureza_mb,
            'mb_plegado', v_plegado_mb,
            'ma_quimico', v_quim_sol,
            'ma_traccion', v_traccion_sol,
            'ma_charpy', v_charpy_sol,
            'ma_dureza', v_dureza_sol,
            'ma_plegado', v_plegado_sol,
            'zac_quimico', v_quim_zac,
            'zac_traccion', v_traccion_zac,
            'zac_charpy', v_charpy_zac,
            'zac_dureza', v_dureza_zac,
            'zac_plegado', v_plegado_zac,
            'calidad_desc', v_cali_desc,
            'espesor_desc', v_espesor_desc,
            'norma_desc', v_norma_desc,
            'indicaciones_7y8', v_texto7y8,
            'indicaciones_6', v_fpp006,
            'tipo_probetero', v_tipoprobetero,
            'art_desc', v_art_desc,
            'pf_desc', v_pf_desc,
            'ubic_axial', v_ubic_axial,
            'indicaciones40', v_fpp40y41,
            'titulo', v_titu_form
        );
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Funcion_OC_laboratorio_inicial`(p_opid INT, p_nro_oc INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
        DECLARE v_perfilbarrada VARCHAR(10);
        DECLARE json_result JSON;
        DECLARE v_transfo INT;
        DECLARE v_medida1 DECIMAL(10, 3);
        --
        SELECT COUNT(*)
        INTO v_transfo
        FROM fichas_tecnicas_procesos ftp
        LEFT JOIN ordenes_de_produccion op ON ftp.ficha_tecnica_id = op.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
        WHERE ftp.orden = 1
        AND op.id = p_opid
        AND et.etapa = 70;
        --
        SELECT pf.medida_1
        INTO v_medida1
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas ft ON ft.id = op.ficha_tecnica_id
        LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
        WHERE op.id = p_opid;
		--	
        SET v_perfilbarrada = FuncionAsignacionBarrada(p_opid);
        --
        IF v_perfilbarrada IN ('/C', '/I', '/P', '/SA') THEN
            SET json_result = Funcion_OC_laboratorio(p_opid);
        END IF;
        --
        IF v_perfilbarrada IN ('/42', '/46', '/52', '/56', '/60',  '/65', '/70') THEN
            IF v_transfo > 0 AND v_medida1 BETWEEN 200 AND 400 THEN
            	SET json_result = Funcion_OC_lab_FPMP(p_opid);
            ELSE
                SET json_result = Funcion_OC_lab_42a70(p_opid);
            END IF;
        END IF;
        --
        IF v_perfilbarrada IN ('/N', '/NR', '/NE', '/FA', '/NS', '/TR') THEN
            SET json_result = Funcion_OC_rubpp1(p_opid);
        END IF;
        --
        IF v_perfilbarrada = 'L6' THEN
            IF v_transfo > 0 AND v_medida1 BETWEEN 200 AND 400 THEN
                SET json_result = Funcion_OC_lab_FPL6(p_opid);
            ELSE
                SET json_result = Funcion_OC_lab_L6yletras(p_opid);
            END IF;
        END IF;
        --
        RETURN json_result;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Funcion_OC_lab_42a70`(p_opid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
        DECLARE v_ra318 VARCHAR(50);
        DECLARE v_inspeccion VARCHAR(50);
        DECLARE v_et3014 INT;
        DECLARE v_et3013 INT;
        DECLARE v_tipo INT;
        DECLARE v_inox VARCHAR(10);
        DECLARE v_direccion VARCHAR(50);
        DECLARE v_cant_probetas INT;
        DECLARE v_biseladas INT;
        DECLARE v_perfilbarrada VARCHAR(10);
        DECLARE v_calidad_mp INT;
        DECLARE v_tipoprobetero VARCHAR(50);
        DECLARE v_fpp006 VARCHAR(50);
        DECLARE v_espesor DECIMAL(10,3);
        DECLARE v_familia VARCHAR(10);
        DECLARE v_tildecurvado INT;
        DECLARE v_tildeprensa INT;
        DECLARE v_tildesoldadura INT;
        DECLARE v_medida1 DECIMAL(10,3);
        DECLARE v_medida2 DECIMAL(10,3);
        DECLARE v_texto3 VARCHAR(100);
        DECLARE v_texto7y8 VARCHAR(100);
        DECLARE v_fpp050 VARCHAR(10);
        DECLARE v_quim_sol VARCHAR(10);
        DECLARE v_quim_zac VARCHAR(10);
        DECLARE v_quim_ant INT;
        DECLARE v_valor_charpy VARCHAR(50); -- TEXTO52
        DECLARE v_quim_mb BOOLEAN;
        DECLARE v_traccion_mb BOOLEAN;
        DECLARE v_traccion_sol BOOLEAN;
        DECLARE v_traccion_zac BOOLEAN;
        DECLARE v_charpy_mb BOOLEAN;
        DECLARE v_charpy_sol BOOLEAN;
        DECLARE v_charpy_zac BOOLEAN;
        DECLARE v_dureza_mb BOOLEAN;
        DECLARE v_dureza_sol BOOLEAN;
        DECLARE v_dureza_zac BOOLEAN;
        DECLARE v_plegado_mb BOOLEAN;
        DECLARE v_plegado_sol BOOLEAN;
        DECLARE v_plegado_zac BOOLEAN;
        DECLARE v_piso VARCHAR(75);
        DECLARE v_solda INT;
        DECLARE v_tt_desc_1 VARCHAR(50);
        DECLARE v_tt_desc_2 VARCHAR(50);
        DECLARE v_tt_temp_1 VARCHAR(10);
        DECLARE v_tt_temp_2 VARCHAR(10);
        DECLARE v_art_cali VARCHAR(100);
        DECLARE v_art_desc VARCHAR(100);
        DECLARE v_pf_desc VARCHAR(100);
        DECLARE v_diametro DECIMAL(10,3);
        DECLARE v_cali_desc VARCHAR(30);
        DECLARE v_espesor_desc VARCHAR(30);
        DECLARE v_norma_desc VARCHAR(30);
        DECLARE v_agru_cali_id INT;
        DECLARE v_boca DECIMAL(10, 3);
        DECLARE v_ubic_axial VARCHAR(50);
        DECLARE v_titu_form VARCHAR(10);
        DECLARE v_fpp40y41 VARCHAR(100);
        --
        SET v_texto7y8 = '';
        SET v_traccion_mb = 0;
        SET v_charpy_mb = 0;
        SET v_plegado_mb = 0;
        SET v_direccion = IF(v_tipo IN (1,3,5), '(-)', 'TRANSVERSAL');
        SET v_cant_probetas = 1;
        SET v_biseladas = 0;
        SET v_quim_ant = FuncionQuimicosAnteriores(p_opid);
        --
        SELECT ar.tipo_id, ar.espesor / 1000, pf.medida_1, pf.medida_2,  pff.cod_as400, ar.descripcion, ac.descripcion, pf.descripcion, ar.diametro, pfc.agrupacion_calidad_id, pfc.descripcion, pfe.descripcion, pfn.descripcion, ar.descripcion, pf.descripcion
        INTO v_tipo, v_espesor, v_medida1, v_medida2, v_familia, v_art_desc, v_art_cali, v_pf_desc, v_diametro, v_agru_cali_id, v_cali_desc, v_espesor_desc, v_norma_desc, v_art_desc, v_pf_desc
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas ft ON op.ficha_tecnica_id = ft.id
        LEFT JOIN articulos ar ON ar.id = ft.articulo_id
        LEFT JOIN articulos_calidades ac ON ar.calidad_id = ac.id
        LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
        LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id 
        LEFT JOIN productos_fabricados_calidades pfc ON pfc.id = pf.calidad_id
        LEFT JOIN productos_fabricados_espesores pfe ON pfe.id = pf.espesor_id
        LEFT JOIN productos_fabricados_normas pfn ON pfn.id = pf.norma_id
        WHERE op.id = p_opid;
        --
        SELECT COUNT(*)
        INTO v_et3014
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
        WHERE op.id = p_opid
        AND et.etapa = 30 AND et.subetapa = 14;
        --
        SELECT COUNT(*)
        INTO v_et3013
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
        WHERE op.id = p_opid
        AND et.etapa = 30 AND et.subetapa = 13;
        --
        SELECT COUNT(*)
        INTO v_solda
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
        WHERE op.id = p_opid AND (etapa = 15 OR (etapa = 6 AND subetapa = 11));
        --
        SET v_ra318 = IF(v_et3014 > 0, 1, 0);
        SET v_inspeccion  = IF(v_et3013 > 0, 1, 0);
        SET v_direccion = IF(v_tipo IN (1,3,5), '(-)', 'Transversal');
        SET v_boca = IF(v_medida1 > v_medida2, v_medida1, v_medida2);
        IF v_boca <= 600 THEN
            SET v_direccion = 'Longitudinal';
            SET v_ubic_axial = 'Ubicación axial de muestra ';
            SET v_ubic_axial = CONCAT(v_ubic_axial, IF(v_espesor <= 38100, '1/2  t', '1/4 t'));
        ELSE
            SET v_direccion = 'Transversal';
        END IF;
        --        
        IF v_tipo IN (1,5) THEN
            SET v_texto3 = IF( v_diametro <= 30000 AND v_agru_cali_id = 6, 'Diam. x 350 mm', 'Diam. x 200 mm de largo o 150x200mm');
        END IF;
        IF v_tipo IN (2) THEN
            SET v_texto3 = '150 x 200 mm.';
        ELSE
            IF v_tipo IN (3,4) THEN
                SET v_texto3 = 'Diam. x 150 mm de largo o 100x150mm';
            END IF;
        END IF;
        --
      	SET v_tipoprobetero = FuncionColorProbetero(p_opid);
        SET v_quim_ant = FuncionQuimicosAnteriores(p_opid);
        --
        SELECT FuncionAsignacionBarrada(p_opid) 
        INTO v_perfilbarrada;
        --
        IF v_solda > 0 THEN
            IF V_tipo IN (2,4) THEN 
                SET v_fpp006 = 'SOLDADURA' ;
                SET v_texto7y8 = 'Soldar con el mismo procedimiento y colada de consumibles';
                SET v_texto3 = '2 probetas de 150 x 350 mm - Biseladas';
                SET v_cant_probetas = 2;
                SET v_biseladas = 1;
            END IF;
            --
            IF v_tipo IN (3,4) THEN 
                SET v_texto3 = 'Diam. x 150 mm de largo o 100x150mm';
            END IF;
            --
            SET v_traccion_sol = 1;
            SET v_charpy_sol = 1;
            SET v_plegado_sol = 1;
            SET v_tildesoldadura = 1;
            SET v_tildeprensa = 1;
            SET v_fpp050 = 'LLEVAR A';
            SET v_tipoprobetero = 'PROBETERO SOLDADURA';
        END IF;
        --
        SET v_quim_mb = IF(v_quim_ant = 0 OR v_inspeccion = 1 OR v_ra318 = 1, 1, 0);
        SET v_quim_sol = 0;
        SET v_quim_zac = 0;
        SET v_traccion_mb = 1;
        SET v_traccion_zac = 0;
        SET v_valor_charpy = -7;
        SET v_charpy_mb = 1;
        SET v_charpy_zac = 0;
        SET v_dureza_mb = 1;
        SET v_dureza_sol =  IF(v_solda =1 AND (v_ra318 = 1 OR v_inspeccion = 1), 1, 0);
        SET v_dureza_zac = IF(v_ra318 = 1, 1, 0);
        SET v_plegado_mb = 0;
        SET v_plegado_zac = 0;
      	SET v_cant_probetas=  IF(v_tipo IN(2,4), 2, v_cant_probetas);
        SET v_biseladas =  IF(v_tipo IN(2,4), 1, v_biseladas);
        SET v_texto3 = IF(v_tipo = 2, '2 probetas de 150 x 350 mm - Biseladas', IF(v_tipo IN (3,4), 'Diam. x 150 mm de largo o 100x150mm', ' '));
        --
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_DESC_1') FROM dual INTO v_tt_desc_1;
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_TEMP_1') FROM dual INTO v_tt_temp_1;
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_DESC_2') FROM dual INTO v_tt_desc_2;
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_TEMP_2') FROM dual INTO v_tt_temp_2;
        --
        SET v_piso = 'EC 7.4.1.12 rev02';
        --
        DELETE FROM aux_op_estudios WHERE 1 = 1;
        --
        INSERT INTO aux_op_estudios (orden_de_produccion_id, perfil_de_barrada, probeta_tamano, 
            direccion, probeta_cantidad,
            biselado, soldadura,
            tratamiento_termico_1, temperatura_1,tratamiento_termico_2, temperatura_2,
            mb_quimico, mb_traccion, mb_charpy,mb_dureza,mb_plegado,
            ma_quimico, ma_traccion, ma_charpy,   ma_dureza,   ma_plegado,
            zac_quimico,  zac_traccion,   zac_charpy,   zac_dureza,   zac_plegado, calidad_desc, espesor_desc, norma_desc, indicaciones_7y8, indicaciones_6, tipo_probetero, art_desc, pf_desc, ubic_axial)
        VALUES (p_opid, v_perfilbarrada, v_texto3, v_direccion, v_cant_probetas, v_biseladas, v_solda, v_tt_desc_1, v_tt_temp_1, v_tt_desc_2, v_tt_temp_2,
            v_quim_mb , v_traccion_mb ,v_charpy_mb, v_dureza_mb , v_plegado_mb ,
            v_quim_sol ,  v_traccion_sol, v_charpy_sol , v_dureza_sol , v_plegado_sol ,
            v_quim_zac ,  v_traccion_zac, v_charpy_zac , v_dureza_zac , v_plegado_zac, 
            v_cali_desc, v_espesor_desc, v_norma_desc, v_texto7y8, v_fpp006, v_tipoprobetero, v_art_desc, v_pf_desc, v_ubic_axial)
        ;
        --  RETURN CONCAT(v_perfilbarrada,' - ', v_tipo, ' - ', v_texto3, ' - ', v_tipoprobetero, ' - ', v_tildecurvado, ' - ', v_art_desc, ' - ', v_pf_desc);
        RETURN JSON_OBJECT(
            'orden_de_produccion_id', p_opid,
            'perfil_de_barrada', v_perfilbarrada,
            'probeta_tamano', v_texto3,
            'direccion', v_direccion,
            'probeta_cantidad', v_cant_probetas,
            'biselado', v_biseladas,
            'soldadura', v_solda,
            'tratamiento_termico_1', v_tt_desc_1,
            'temperatura_1', v_tt_temp_1,
            'tratamiento_termico_2', v_tt_desc_2,
            'temperatura_2', v_tt_temp_2,
            'mb_quimico', v_quim_mb,
            'mb_traccion', v_traccion_mb,
            'mb_charpy', v_charpy_mb,
            'mb_dureza', v_dureza_mb,
            'mb_plegado', v_plegado_mb,
            'ma_quimico', v_quim_sol,
            'ma_traccion', v_traccion_sol,
            'ma_charpy', v_charpy_sol,
            'ma_dureza', v_dureza_sol,
            'ma_plegado', v_plegado_sol,
            'zac_quimico', v_quim_zac,
            'zac_traccion', v_traccion_zac,
            'zac_charpy', v_charpy_zac,
            'zac_dureza', v_dureza_zac,
            'zac_plegado', v_plegado_zac,
            'calidad_desc', v_cali_desc,
            'espesor_desc', v_espesor_desc,
            'norma_desc', v_norma_desc,
            'indicaciones_7y8', v_texto7y8,
            'indicaciones_6', v_fpp006,
            'tipo_probetero', v_tipoprobetero,
            'art_desc', v_art_desc,
            'pf_desc', v_pf_desc,
            'ubic_axial', v_ubic_axial,
            'indicaciones40', v_fpp40y41,
            'titulo', v_titu_form
        );
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Funcion_OC_lab_FPL6`(p_opid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
        DECLARE v_ra318 VARCHAR(50);
        DECLARE v_inspeccion VARCHAR(50);
        DECLARE v_et3014 INT;
        DECLARE v_et3013 INT;
        DECLARE v_tipo INT;
        DECLARE v_inox VARCHAR(10);
        DECLARE v_direccion VARCHAR(50);
        DECLARE v_cant_probetas INT;
        DECLARE v_biseladas INT;
        DECLARE v_perfilbarrada VARCHAR(10);
        DECLARE v_calidad_mp INT;
        DECLARE v_tipoprobetero VARCHAR(50);
        DECLARE v_fpp006 VARCHAR(50);
        DECLARE v_espesor DECIMAL(10,3);
        DECLARE v_familia VARCHAR(10);
        DECLARE v_tildecurvado INT;
        DECLARE v_tildeprensa INT;
        DECLARE v_tildesoldadura INT;
        DECLARE v_medida1 DECIMAL(10,3);
        DECLARE v_medida2 DECIMAL(10,3);
        DECLARE v_texto3 VARCHAR(100);
        DECLARE v_texto7y8 VARCHAR(100);
        DECLARE v_fpp050 VARCHAR(10);
        DECLARE v_quim_sol VARCHAR(10);
        DECLARE v_quim_zac VARCHAR(10);
        DECLARE v_quim_ant INT;
        DECLARE v_valor_charpy VARCHAR(50); -- TEXTO52
        DECLARE v_quim_mb BOOLEAN;
        DECLARE v_traccion_mb BOOLEAN;
        DECLARE v_traccion_sol BOOLEAN;
        DECLARE v_traccion_zac BOOLEAN;
        DECLARE v_charpy_mb BOOLEAN;
        DECLARE v_charpy_sol BOOLEAN;
        DECLARE v_charpy_zac BOOLEAN;
        DECLARE v_dureza_mb BOOLEAN;
        DECLARE v_dureza_sol BOOLEAN;
        DECLARE v_dureza_zac BOOLEAN;
        DECLARE v_plegado_mb BOOLEAN;
        DECLARE v_plegado_sol BOOLEAN;
        DECLARE v_plegado_zac BOOLEAN;
        DECLARE v_piso VARCHAR(75);
        DECLARE v_solda INT;
        DECLARE v_tt_desc_1 VARCHAR(50);
        DECLARE v_tt_desc_2 VARCHAR(50);
        DECLARE v_tt_temp_1 VARCHAR(10);
        DECLARE v_tt_temp_2 VARCHAR(10);
        DECLARE v_art_cali VARCHAR(100);
        DECLARE v_art_desc VARCHAR(100);
        DECLARE v_pf_desc VARCHAR(100);
        DECLARE v_diametro DECIMAL(10,3);
        DECLARE v_cali_desc VARCHAR(30);
        DECLARE v_espesor_desc VARCHAR(30);
        DECLARE v_norma_desc VARCHAR(30);
        DECLARE v_agru_cali_id INT;
        DECLARE v_titu_form VARCHAR(10);
        DECLARE v_fpp40y41 VARCHAR(100);
        DECLARE v_boca DECIMAL(10,3);
        DECLARE v_ubic_axial VARCHAR(50);
        --
        SET v_texto7y8 = '';
        SET v_traccion_mb = 0;
        SET v_charpy_mb = 0;
        SET v_plegado_mb = 0;
        SET v_direccion = IF(v_tipo IN (1,3,5), '(-)', 'TRANSVERSAL');
        SET v_cant_probetas = 1;
        SET v_biseladas = 0;
        SET v_quim_ant = FuncionQuimicosAnteriores(p_opid);
        --
        SELECT ar.tipo_id, ar.espesor / 1000, pf.medida_1, pf.medida_2,  pff.cod_as400, ar.descripcion, ac.descripcion, pf.descripcion, ar.diametro, pfc.agrupacion_calidad_id, pfc.descripcion, pfe.descripcion, pfn.descripcion, ar.descripcion, pf.descripcion
        INTO v_tipo, v_espesor, v_medida1, v_medida2, v_familia, v_art_desc, v_art_cali, v_pf_desc, v_diametro, v_agru_cali_id, v_cali_desc, v_espesor_desc, v_norma_desc, v_art_desc, v_pf_desc
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas  ft ON op.ficha_tecnica_id = ft.id
        LEFT JOIN articulos ar ON ar.id = ft.articulo_id
        LEFT JOIN articulos_calidades ac ON ar.calidad_id = ac.id
        LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
        LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id 
        LEFT JOIN productos_fabricados_calidades pfc ON pfc.id = pf.calidad_id
        LEFT JOIN productos_fabricados_espesores pfe ON pfe.id = pf.espesor_id
        LEFT JOIN 	productos_fabricados_normas pfn ON pfn.id = pf.norma_id
        WHERE op.id = p_opid;
        --
        SELECT COUNT(*)
        INTO v_et3014
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
        WHERE op.id = p_opid
        AND et.etapa = 30 AND et.subetapa = 14;
        --
        SELECT COUNT(*)
        INTO v_et3013
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
        WHERE op.id = p_opid
        AND et.etapa = 30 AND et.subetapa = 13;
        --
        SELECT COUNT(*)
        INTO v_solda
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
        WHERE op.id = p_opid AND (etapa = 15 OR (etapa = 6 AND subetapa = 11));
        --
        SET v_ra318 = IF(v_et3014 > 0, 1, 0);
        SET v_inspeccion  = IF(v_et3013 > 0, 1, 0);
        SET v_direccion = IF(v_tipo IN (1,3,5), '(-)', 'Transversal');
        SET v_boca = IF(v_medida1 > v_medida2, v_medida1, v_medida2);
        IF v_boca <= 600 THEN
            SET v_direccion = 'Longitudinal';
            SET v_ubic_axial = 'Ubicación axial de muestra ';
            SET v_ubic_axial = CONCAT(v_ubic_axial, IF(v_espesor <= 38100, '1/2  t', '1/4 t'));
        ELSE
            SET v_direccion = 'Transversal';
        END IF;
        --
        IF v_tipo IN (1,5) THEN
            SET v_texto3 = IF(v_diametro <= 30000 AND v_agru_cali_id = 6, 'Diam. x 350 mm', 'Diam. x 200 mm de largo o 150x200mm');
        END IF;
        --
        IF v_tipo IN (2) THEN
            SET v_texto3 = '150 x 200 mm.';
        ELSE
            IF v_tipo IN (3,4) THEN
                SET v_texto3 = 'Diam. x 150 mm de largo o 100x150mm';
            END IF;
        END IF;
        --
      	SET v_tipoprobetero = FuncionColorProbetero(p_opid);
        SET v_quim_ant = FuncionQuimicosAnteriores(p_opid);
        --
        SELECT FuncionAsignacionBarrada(p_opid) 
        INTO v_perfilbarrada;
        --
        IF v_solda > 0 THEN
            IF V_tipo IN (2,4) THEN 
                SET v_fpp006 = 'SOLDADURA' ;
                SET v_texto7y8 = 'Soldar con el mismo procedimiento y colada de consumibles';
                SET v_texto3 = '2 probetas de 150 x 350 mm - Biseladas';
                SET v_cant_probetas = 2;
                SET v_biseladas = 1;
            END IF;
            --
            IF v_tipo IN (3,4) THEN 
                SET v_texto3 = 'Diam. x 150 mm de largo o 100x150mm';
            END IF;
            --
            SET v_traccion_sol = 1;
            SET v_charpy_sol = 1;	
            SET v_plegado_sol = 1;
            SET v_tildesoldadura = 1;
            SET v_tildeprensa = 1;
            SET v_fpp050 = 'LLEVAR A';
            SET v_tipoprobetero = 'PROBETERO SOLDADURA';
        END IF;
		--
        SET v_quim_mb = IF(v_quim_ant = 0 or v_inspeccion = 1 or v_ra318 = 1, 1, 0);
        SET v_quim_sol = 0;
        SET v_quim_zac = 0;
        SET v_traccion_mb = 1;
        SET v_traccion_zac = 0;
        SET v_valor_charpy = -7;
        SET v_charpy_mb = 1;
        SET v_charpy_zac = 0;
        SET v_dureza_mb = 1;
        SET v_dureza_sol =  IF(v_solda =1 AND (v_ra318 = 1 OR v_inspeccion = 1), 1, 0);
        SET v_dureza_zac = IF(v_ra318 = 1, 1, 0);
        SET v_plegado_mb = 0;
        SET v_plegado_zac = 0;
      	SET v_cant_probetas=  IF(v_tipo IN(2,4), 2, v_cant_probetas);
        SET v_biseladas =  IF(v_tipo IN(2,4), 1, v_biseladas);
        SET v_texto3 = IF(v_tipo = 2, '2 probetas de 150 x 350 mm - Biseladas', IF(v_tipo IN (3,4), 'Diam. x 150 mm de largo o 100x150mm', ' '));
        -- lo que está arriba corresponde al generico para perfiles 42 a 70
        -- De acá para abajo es lo indicado en la rutina FPL6P
        SET v_fpp40y41 = 'Una vez realizado el Tratamiento Térmico, identificar y enviar una pieza a "Probetas a entregar".';
        SET v_titu_form = 'FPL6';
        SET v_texto7y8 = '';
        SET v_traccion_mb = 0;
        SET v_charpy_mb = 0;
        SET v_plegado_mb = 0;
        SET v_direccion = IF(v_tipo IN (1,3,5), '(-)', 'TRANSVERSAL');
        SET v_cant_probetas = 1;
        SET v_biseladas = 0;
        SET v_quim_ant = FuncionQuimicosAnteriores(p_opid);
        --
        -- corregir desde acá según definiciones
        SELECT ar.tipo_id, ar.espesor / 1000, pf.medida_1, pf.medida_2,  pff.cod_as400, ar.descripcion, ac.descripcion, pf.descripcion, ar.diametro, pfc.agrupacion_calidad_id, pfc.descripcion, pfe.descripcion, pfn.descripcion, ar.descripcion, pf.descripcion
        INTO v_tipo, v_espesor, v_medida1, v_medida2, v_familia, v_art_desc, v_art_cali, v_pf_desc, v_diametro, v_agru_cali_id, v_cali_desc, v_espesor_desc, v_norma_desc, v_art_desc, v_pf_desc
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas  ft ON op.ficha_tecnica_id = ft.id
        LEFT JOIN articulos ar ON ar.id = ft.articulo_id
        LEFT JOIN articulos_calidades ac ON ar.calidad_id = ac.id
        LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
        LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id
        LEFT JOIN productos_fabricados_calidades pfc ON pfc.id = pf.calidad_id
        LEFT JOIN productos_fabricados_espesores pfe ON pfe.id = pf.espesor_id
        LEFT JOIN productos_fabricados_normas pfn ON pfn.id = pf.norma_id
        WHERE op.id = p_opid;
        --
        SELECT COUNT(*)
        INTO v_et3014
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
        WHERE op.id = p_opid
        AND et.etapa = 30 AND et.subetapa = 14;
        --
        SELECT COUNT(*)
        INTO v_et3013
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
        WHERE op.id = p_opid
        AND et.etapa = 30 AND et.subetapa = 13;
        --
        SELECT COUNT(*)
        INTO v_solda
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
        WHERE op.id = p_opid AND (etapa = 15 OR (etapa = 6 AND subetapa = 11));
        --
        SET v_ra318 = IF(v_et3014 > 0, 1, 0);
        SET v_inspeccion  = IF(v_et3013 > 0, 1, 0);
        SET v_direccion = IF(v_tipo IN (1,3,5), '(-)', 'Transversal');
        --
        IF v_familia IN ('CRC', 'CRL', 'FTE', 'FTR', 'FNI', 'F90', 'REF', 'RET', 'SWC', 'SWE', 'TE', 'TEM', 'TER', 'TNS', 'TRS') THEN
            SET v_texto3 = IF(v_tipo IN (3,4), 'Diam. x 150 mm de largo o 100x150mm', 'UNA PIEZA'); 
        END IF;
        --
        SET v_cant_probetas = 1;
        SET v_biseladas = 0;
        -- SET  v_tipoprobetero = FuncionColorProbetero(p_opid);
        SET v_quim_ant = FuncionQuimicosAnteriores(p_opid);
        --
        SELECT FuncionAsignacionBarrada(p_opid) 
        INTO v_perfilbarrada;
        --
        SET v_fpp40y41 = 'Una vez realizado el Tratamiento Térmico, identificar y enviar una pieza a "Probetas a entregar".';
        SET v_quim_mb = IF(v_inspeccion = 1 or v_ra318 = 1, 1, 0);
        SET v_quim_sol = 0;
        SET v_quim_zac = 0;
        SET v_traccion_mb = 1;
        SET v_traccion_sol = 0;
        SET v_traccion_zac = 0;
        SET v_valor_charpy = -46;
        SET v_charpy_mb = 1;
        SET v_charpy_sol = 0;
        SET v_charpy_zac = 0;
        SET v_dureza_mb = 1;
        SET v_dureza_sol = 0;
        SET v_dureza_zac = 0;
        -- hasta acá
        IF(v_inspeccion = 1 OR v_ra318 = 1) AND v_solda > 0 THEN
            SET v_dureza_sol = 1;	
            SET v_texto3 = IF(v_tipo = 2, '2 probetas de 150 x 350 mm - Biseladas', IF(v_tipo IN (3,5), 'Diam. x 150 mm de largo o 100x150mm', ''));
            SET v_cant_probetas = 2;
            SET v_biseladas = 1;	 
            SET v_dureza_zac = IF(v_ra318= 1, 1, v_dureza_zac);        
        END IF;
        --
        SET v_plegado_mb = 0;
        SET v_plegado_sol =	0;
        SET v_plegado_zac =	0;
        SET v_piso = 'EC 7.4.1.12 rev02';
        --
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_DESC_1') FROM dual INTO v_tt_desc_1;
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_TEMP_1') FROM dual INTO v_tt_temp_1;
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_DESC_2') FROM dual INTO v_tt_desc_2;
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_TEMP_2') FROM dual INTO v_tt_temp_2;
        --
        DELETE FROM aux_op_estudios WHERE 1 = 1;
        --
        INSERT INTO aux_op_estudios (orden_de_produccion_id,  perfil_de_barrada, probeta_tamano,
            direccion, probeta_cantidad,
            biselado, soldadura,
            tratamiento_termico_1, temperatura_1,tratamiento_termico_2, temperatura_2,
            mb_quimico, mb_traccion, mb_charpy,mb_dureza,mb_plegado,
            ma_quimico, ma_traccion, ma_charpy,   ma_dureza,   ma_plegado,
            zac_quimico,  zac_traccion,   zac_charpy,   zac_dureza,   zac_plegado, calidad_desc, espesor_desc, norma_desc, indicaciones_7y8, indicaciones_6, tipo_probetero, art_desc, pf_desc, indicaciones40, ubic_axial, titulo)
        VALUES (p_opid, v_perfilbarrada, v_texto3, v_direccion, v_cant_probetas, v_biseladas, v_solda, v_tt_desc_1, v_tt_temp_1, v_tt_desc_2, v_tt_temp_2,
            v_quim_mb , v_traccion_mb ,v_charpy_mb, v_dureza_mb , v_plegado_mb ,
            v_quim_sol ,  v_traccion_sol, v_charpy_sol , v_dureza_sol , v_plegado_sol ,
            v_quim_zac ,  v_traccion_zac, v_charpy_zac , v_dureza_zac , v_plegado_zac, 
            v_cali_desc, v_espesor_desc, v_norma_desc, v_texto7y8, v_fpp006, v_tipoprobetero, v_art_desc, v_pf_desc, v_fpp40y41, v_ubic_axial, v_titu_form)
        ;
        --   RETURN CONCAT(v_perfilbarrada,' - ', v_tipo, ' - ', v_texto3, ' - ', v_tipoprobetero, ' - ', v_tildecurvado, ' - ', v_art_desc, ' - ', v_pf_desc);
        RETURN JSON_OBJECT(
            'orden_de_produccion_id', p_opid,
            'perfil_de_barrada', v_perfilbarrada,
            'probeta_tamano', v_texto3,
            'direccion', v_direccion,
            'probeta_cantidad', v_cant_probetas,
            'biselado', v_biseladas,
            'soldadura', v_solda,
            'tratamiento_termico_1', v_tt_desc_1,
            'temperatura_1', v_tt_temp_1,
            'tratamiento_termico_2', v_tt_desc_2,
            'temperatura_2', v_tt_temp_2,
            'mb_quimico', v_quim_mb,
            'mb_traccion', v_traccion_mb,
            'mb_charpy', v_charpy_mb,
            'mb_dureza', v_dureza_mb,
            'mb_plegado', v_plegado_mb,
            'ma_quimico', v_quim_sol,
            'ma_traccion', v_traccion_sol,
            'ma_charpy', v_charpy_sol,
            'ma_dureza', v_dureza_sol,
            'ma_plegado', v_plegado_sol,
            'zac_quimico', v_quim_zac,
            'zac_traccion', v_traccion_zac,
            'zac_charpy', v_charpy_zac,
            'zac_dureza', v_dureza_zac,
            'zac_plegado', v_plegado_zac,
            'calidad_desc', v_cali_desc,
            'espesor_desc', v_espesor_desc,
            'norma_desc', v_norma_desc,
            'indicaciones_7y8', v_texto7y8,
            'indicaciones_6', v_fpp006,
            'tipo_probetero', v_tipoprobetero,
            'art_desc', v_art_desc,
            'pf_desc', v_pf_desc,
            'ubic_axial', v_ubic_axial,
            'indicaciones40', v_fpp40y41,
            'titulo', v_titu_form
        );
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Funcion_OC_lab_FPMP`(p_opid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
        DECLARE v_ra318 VARCHAR(50);
        DECLARE v_inspeccion VARCHAR(50);
        DECLARE v_et3014 INT;
        DECLARE v_et3013 INT;
        DECLARE v_tipo INT;
        DECLARE v_inox VARCHAR(10);
        DECLARE v_direccion VARCHAR(50);
        DECLARE v_cant_probetas INT;
        DECLARE v_biseladas INT;
        DECLARE v_perfilbarrada VARCHAR(10);
        DECLARE v_calidad_mp INT;
        DECLARE v_tipoprobetero VARCHAR(50);
        DECLARE v_fpp006 VARCHAR(50);
        DECLARE v_espesor DECIMAL(10,3);
        DECLARE v_familia VARCHAR(10);
        DECLARE v_tildecurvado INT;
        DECLARE v_tildeprensa INT;
        DECLARE v_tildesoldadura INT;
        DECLARE v_medida1 DECIMAL(10,3);
        DECLARE v_medida2 DECIMAL(10,3);
        DECLARE v_texto3 VARCHAR(100);
        DECLARE v_texto7y8 VARCHAR(100);
        DECLARE v_fpp050 VARCHAR(10);
        DECLARE v_quim_sol VARCHAR(10);
        DECLARE v_quim_zac VARCHAR(10);
        DECLARE v_quim_ant INT;
        DECLARE v_valor_charpy VARCHAR(50); -- TEXTO52
        DECLARE v_quim_mb BOOLEAN;
        DECLARE v_traccion_mb BOOLEAN;
        DECLARE v_traccion_sol BOOLEAN;
        DECLARE v_traccion_zac BOOLEAN;
        DECLARE v_charpy_mb BOOLEAN;
        DECLARE v_charpy_sol BOOLEAN;
        DECLARE v_charpy_zac BOOLEAN;
        DECLARE v_dureza_mb BOOLEAN;
        DECLARE v_dureza_sol BOOLEAN;
        DECLARE v_dureza_zac BOOLEAN;
        DECLARE v_plegado_mb BOOLEAN;
        DECLARE v_plegado_sol BOOLEAN;
        DECLARE v_plegado_zac BOOLEAN;
        DECLARE v_piso VARCHAR(75);
        DECLARE v_solda INT;
        DECLARE v_tt_desc_1 VARCHAR(50);
        DECLARE v_tt_desc_2 VARCHAR(50);
        DECLARE v_tt_temp_1 VARCHAR(10);
        DECLARE v_tt_temp_2 VARCHAR(10);
        DECLARE v_art_cali VARCHAR(100);
        DECLARE v_art_desc VARCHAR(100);
        DECLARE v_pf_desc VARCHAR(100);
        DECLARE v_diametro DECIMAL(10,3);
        DECLARE v_cali_desc VARCHAR(30);
        DECLARE v_espesor_desc VARCHAR(30);
        DECLARE v_norma_desc VARCHAR(30);
        DECLARE v_agru_cali_id INT;
        DECLARE v_titu_form VARCHAR(10);
        DECLARE v_fpp40y41 VARCHAR(100);
        DECLARE v_boca DECIMAL(10,3);
        DECLARE v_ubic_axial VARCHAR(50);
        --
        SET v_texto7y8 = '';
        SET v_traccion_mb = 0;
        SET v_charpy_mb = 0;
        SET v_plegado_mb = 0;
        SET v_direccion = IF(v_tipo IN (1,3,5), '(-)', 'TRANSVERSAL');
        SET v_cant_probetas = 1;
        SET v_biseladas = 0;
        SET v_quim_ant = FuncionQuimicosAnteriores(p_opid);
        --
        SELECT ar.tipo_id, ar.espesor / 1000, pf.medida_1, pf.medida_2,  pff.cod_as400, ar.descripcion, ac.descripcion, pf.descripcion, ar.diametro, pfc.agrupacion_calidad_id, pfc.descripcion, pfe.descripcion, pfn.descripcion, ar.descripcion, pf.descripcion
        INTO v_tipo, v_espesor, v_medida1, v_medida2, v_familia, v_art_desc, v_art_cali, v_pf_desc, v_diametro, v_agru_cali_id, v_cali_desc, v_espesor_desc, v_norma_desc, v_art_desc, v_pf_desc
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas  ft ON op.ficha_tecnica_id = ft.id
        LEFT JOIN articulos ar ON ar.id = ft.articulo_id
        LEFT JOIN articulos_calidades ac ON ar.calidad_id = ac.id
        LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
        LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id 
        LEFT JOIN productos_fabricados_calidades pfc ON pfc.id = pf.calidad_id
        LEFT JOIN productos_fabricados_espesores pfe ON pfe.id = pf.espesor_id
        LEFT JOIN 	productos_fabricados_normas pfn ON pfn.id = pf.norma_id
        WHERE op.id = p_opid;
        --
        SELECT COUNT(*)
        INTO v_et3014
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
        WHERE op.id = p_opid
        AND et.etapa = 30 AND et.subetapa = 14;
        --
        SELECT COUNT(*)
        INTO v_et3013
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
        WHERE op.id = p_opid
        AND et.etapa = 30 AND et.subetapa = 13;
        --
        SELECT COUNT(*)
        INTO v_solda
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
        WHERE op.id = p_opid AND (etapa = 15 OR (etapa = 6 AND subetapa = 11));
        --
        SET v_ra318 = IF(v_et3014 > 0, 1, 0);
        SET v_inspeccion  = IF(v_et3013 > 0, 1, 0);
        SET v_direccion = IF(v_tipo IN (1,3,5), '(-)', 'Transversal');
        SET v_boca = IF(v_medida1 > v_medida2, v_medida1, v_medida2);
        --
        IF v_boca <= 600 THEN
            SET v_direccion = 'Longitudinal';
            SET v_ubic_axial = 'Ubicación axial de muestra ';
            SET v_ubic_axial = CONCAT(v_ubic_axial, IF(v_espesor <= 38100, '1/2  t', '1/4 t'));
        ELSE
            SET v_direccion = 'Transversal';
        END IF;
        --
        IF v_tipo IN (1,5) THEN
            SET v_texto3 = IF( v_diametro <= 30000 AND v_agru_cali_id = 6, 'Diam. x 350 mm', 'Diam. x 200 mm de largo o 150x200mm');
        END IF;
        --
        IF v_tipo IN (2) THEN
            SET v_texto3 = '150 x 200 mm.';
        ELSE
            IF v_tipo IN (3,4) THEN
                SET v_texto3 = 'Diam. x 150 mm de largo o 100x150mm';
            END IF;
        END IF;
        --
      	SET v_tipoprobetero = FuncionColorProbetero(p_opid);
        SET v_quim_ant = FuncionQuimicosAnteriores(p_opid);
        --
        SELECT FuncionAsignacionBarrada(p_opid)
        INTO v_perfilbarrada;
        --
        IF v_solda > 0 THEN
            IF V_tipo IN (2,4) THEN
                SET v_fpp006 = 'SOLDADURA';
                SET v_texto7y8 = 'Soldar con el mismo procedimiento y colada de consumibles';
                SET v_texto3 = '2 probetas de 150 x 350 mm - Biseladas';
                SET v_cant_probetas = 2;
                SET v_biseladas = 1;
            END IF;
            --
            IF v_tipo IN (3,4) THEN 
                SET v_texto3 = 'Diam. x 150 mm de largo o 100x150mm';
            END IF;
            --
            SET v_traccion_sol = 1;
            SET v_charpy_sol = 1;
            SET v_plegado_sol = 1;
            SET v_tildesoldadura = 1;
            SET v_tildeprensa = 1;
            SET v_fpp050 = 'LLEVAR A';
            SET v_tipoprobetero = 'PROBETERO SOLDADURA';
        END IF;
		--
        SET v_quim_mb = IF(v_quim_ant = 0 or v_inspeccion = 1 or v_ra318 = 1, 1, 0);
        SET v_quim_sol = 0;
        SET v_quim_zac = 0;
        SET v_traccion_mb = 1;
        SET v_traccion_zac = 0;
        SET v_valor_charpy = -7;
        SET v_charpy_mb = 1;
        SET v_charpy_zac = 0;
        SET v_dureza_mb = 1;
        SET v_dureza_sol =  IF(v_solda =1 AND (v_ra318 = 1 OR v_inspeccion = 1), 1, 0);
        SET v_dureza_zac = IF(v_ra318 = 1, 1, 0);
        SET v_plegado_mb = 0;
        SET v_plegado_zac = 0;
      	SET v_cant_probetas=  IF(v_tipo IN(2,4), 2, v_cant_probetas);
        SET v_biseladas =  IF(v_tipo IN(2,4), 1, v_biseladas);
        SET v_texto3 = IF(v_tipo = 2, '2 probetas de 150 x 350 mm - Biseladas', IF(v_tipo IN (3,4), 'Diam. x 150 mm de largo o 100x150mm', ' '));
        -- lo que está arriba corresponde al generico para perfiles 42 a 70
        -- De acá para abajo es lo indicado en la rutina FPMP
        SET v_titu_form = 'FPMP';
        SET v_texto7y8 = '';
        SET v_traccion_mb = 0;
        SET v_charpy_mb = 0;
        SET v_plegado_mb = 0;
        SET v_direccion = IF(v_tipo IN (1,3,5), '(-)', 'TRANSVERSAL');
        SET v_cant_probetas = 1;
        SET v_biseladas = 0;
        SET v_quim_ant = FuncionQuimicosAnteriores(p_opid);
        --
        -- corregir desde acá según definiciones
        SELECT ar.tipo_id, ar.espesor / 1000, pf.medida_1, pf.medida_2,  pff.cod_as400, ar.descripcion, ac.descripcion, pf.descripcion, ar.diametro, pfc.agrupacion_calidad_id, pfc.descripcion, pfe.descripcion, pfn.descripcion, ar.descripcion, pf.descripcion
        INTO v_tipo, v_espesor, v_medida1, v_medida2, v_familia, v_art_desc, v_art_cali, v_pf_desc, v_diametro, v_agru_cali_id, v_cali_desc, v_espesor_desc, v_norma_desc, v_art_desc, v_pf_desc
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas  ft ON op.ficha_tecnica_id = ft.id
        LEFT JOIN articulos ar ON ar.id = ft.articulo_id
        LEFT JOIN articulos_calidades ac ON ar.calidad_id = ac.id
        LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
        LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id 
        LEFT JOIN productos_fabricados_calidades pfc ON pfc.id = pf.calidad_id
        LEFT JOIN productos_fabricados_espesores pfe ON pfe.id = pf.espesor_id
        LEFT JOIN 	productos_fabricados_normas pfn ON pfn.id = pf.norma_id
        WHERE op.id = p_opid;
        --
        SELECT COUNT(*)
        INTO v_et3014
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
        WHERE op.id = p_opid
        AND et.etapa = 30 AND et.subetapa = 14;
        --
        SELECT COUNT(*)
        INTO v_et3013
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
        WHERE op.id = p_opid
        AND et.etapa = 30 AND et.subetapa = 13;
        --
        SELECT COUNT(*)
        INTO v_solda
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
        WHERE op.id = p_opid AND (etapa = 15 OR (etapa = 6 AND subetapa = 11));
        --
        SET v_ra318 = IF(v_et3014 > 0, 1, 0);
        SET v_inspeccion  = IF(v_et3013 > 0, 1, 0);
        SET v_direccion = IF(v_tipo IN (1,3,5), '(-)', 'Transversal');
        --
        IF v_familia IN ('CRC', 'CRL', 'FTE', 'FTR', 'FNI', 'F90', 'REF', 'RET', 'SWC', 'SWE', 'TE', 'TEM', 'TER', 'TNS', 'TRS') THEN
            SET v_texto3 = IF(v_tipo IN (3,4), 'Diam. x 150 mm de largo o 100x150mm', 'UNA PIEZA'); 
        END IF;
        --
        SET v_cant_probetas = 1;
        SET v_biseladas = 0;
        -- SET  v_tipoprobetero = FuncionColorProbetero(p_opid);
        SET v_quim_ant = FuncionQuimicosAnteriores(p_opid);
        --
        SELECT FuncionAsignacionBarrada(p_opid) 
        INTO v_perfilbarrada;
        --
        SET v_fpp40y41 = 'Una vez realizado el Tratamiento Térmico, identificar y enviar una pieza a "Probetas a entregar".';
        SET v_quim_mb = IF(v_inspeccion = 1 or v_ra318 = 1, 1, 0);
        SET v_quim_sol = 0;
        SET v_quim_zac = 0;
        SET v_traccion_mb = 1;
        SET v_traccion_sol = 0;
        SET v_traccion_zac = 0;
        SET v_valor_charpy = -7;
        SET v_charpy_mb = 1;
        SET v_charpy_sol = 0;
        SET v_charpy_zac = 0;
        SET v_dureza_mb = 1;
        SET v_dureza_sol = 0;
        SET v_dureza_zac = 0;
        --
        IF(v_inspeccion = 1 OR v_ra318 = 1) AND v_solda > 0 THEN
            SET v_dureza_sol = 1;
            SET v_texto3 = IF(v_tipo = 2, '2 probetas de 150 x 350 mm - Biseladas', IF(v_tipo IN (3,5), 'Diam. x 150 mm de largo o 100x150mm', ''));
            SET v_cant_probetas = 2;
            SET v_biseladas = 1;
            SET v_dureza_zac = IF(v_ra318= 1, 1, v_dureza_zac);
        END IF;
        --
        SET v_plegado_mb = 0;
        SET v_plegado_sol =	0;
        SET v_plegado_zac =	0;
        SET v_piso = 'EC 7.4.1.12 rev02';
        --
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_DESC_1') FROM dual INTO v_tt_desc_1;
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_TEMP_1') FROM dual INTO v_tt_temp_1;
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_DESC_2') FROM dual INTO v_tt_desc_2;
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_TEMP_2') FROM dual INTO v_tt_temp_2;
        --
        DELETE FROM aux_op_estudios WHERE 1 = 1;
        --
        INSERT INTO aux_op_estudios (orden_de_produccion_id,  perfil_de_barrada, probeta_tamano, 
            direccion, probeta_cantidad,
            biselado, soldadura,
            tratamiento_termico_1, temperatura_1,tratamiento_termico_2, temperatura_2,
            mb_quimico, mb_traccion, mb_charpy,mb_dureza,mb_plegado,
            ma_quimico, ma_traccion, ma_charpy,   ma_dureza,   ma_plegado,
            zac_quimico,  zac_traccion,   zac_charpy,   zac_dureza,   zac_plegado, calidad_desc, espesor_desc, norma_desc, indicaciones_7y8, indicaciones_6, tipo_probetero, art_desc, pf_desc, ubic_axial, indicaciones40, titulo)
        VALUES (p_opid,  v_perfilbarrada, v_texto3, v_direccion, v_cant_probetas, v_biseladas, v_solda, v_tt_desc_1, v_tt_temp_1, v_tt_desc_2, v_tt_temp_2,
            v_quim_mb , v_traccion_mb ,v_charpy_mb, v_dureza_mb , v_plegado_mb ,
            v_quim_sol ,  v_traccion_sol, v_charpy_sol , v_dureza_sol , v_plegado_sol ,
            v_quim_zac ,  v_traccion_zac, v_charpy_zac , v_dureza_zac , v_plegado_zac, 
            v_cali_desc, v_espesor_desc, v_norma_desc, v_texto7y8, v_fpp006, v_tipoprobetero, v_art_desc, v_pf_desc, v_ubic_axial, v_fpp40y41, v_titu_form)
        ;
        --  RETURN CONCAT(v_perfilbarrada,' - ', v_tipo, ' - ', v_texto3, ' - ', v_tipoprobetero, ' - ', v_tildecurvado, ' - ', v_art_desc, ' - ', v_pf_desc);
        RETURN JSON_OBJECT(
            'orden_de_produccion_id', p_opid,
            'perfil_de_barrada', v_perfilbarrada,
            'probeta_tamano', v_texto3,
            'direccion', v_direccion,
            'probeta_cantidad', v_cant_probetas,
            'biselado', v_biseladas,
            'soldadura', v_solda,
            'tratamiento_termico_1', v_tt_desc_1,
            'temperatura_1', v_tt_temp_1,
            'tratamiento_termico_2', v_tt_desc_2,
            'temperatura_2', v_tt_temp_2,
            'mb_quimico', v_quim_mb,
            'mb_traccion', v_traccion_mb,
            'mb_charpy', v_charpy_mb,
            'mb_dureza', v_dureza_mb,
            'mb_plegado', v_plegado_mb,
            'ma_quimico', v_quim_sol,
            'ma_traccion', v_traccion_sol,
            'ma_charpy', v_charpy_sol,
            'ma_dureza', v_dureza_sol,
            'ma_plegado', v_plegado_sol,
            'zac_quimico', v_quim_zac,
            'zac_traccion', v_traccion_zac,
            'zac_charpy', v_charpy_zac,
            'zac_dureza', v_dureza_zac,
            'zac_plegado', v_plegado_zac,
            'calidad_desc', v_cali_desc,
            'espesor_desc', v_espesor_desc,
            'norma_desc', v_norma_desc,
            'indicaciones_7y8', v_texto7y8,
            'indicaciones_6', v_fpp006,
            'tipo_probetero', v_tipoprobetero,
            'art_desc', v_art_desc,
            'pf_desc', v_pf_desc,
            'ubic_axial', v_ubic_axial,
            'indicaciones40', v_fpp40y41,
            'titulo', v_titu_form
        );
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `funcion_OC_lab_L6yletras`(p_opid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
        DECLARE v_ra318 VARCHAR(50);
        DECLARE v_inspeccion VARCHAR(50);
        DECLARE v_et3014 INT;
        DECLARE v_et3013 INT;
        DECLARE v_tipo INT;
        DECLARE v_inox VARCHAR(10);
        DECLARE v_direccion VARCHAR(50);
        DECLARE v_cant_probetas INT;
        DECLARE v_biseladas INT;
        DECLARE v_perfilbarrada VARCHAR(10);
        DECLARE v_calidad_mp INT;
        DECLARE v_tipoprobetero VARCHAR(50);
        DECLARE v_fpp006 VARCHAR(50);
        DECLARE v_espesor DECIMAL(10,3);
        DECLARE v_familia VARCHAR(10);
        DECLARE v_tildecurvado INT;
        DECLARE v_tildeprensa INT;
        DECLARE v_tildesoldadura INT;
        DECLARE v_medida1 DECIMAL(10,3);
        DECLARE v_medida2 DECIMAL(10,3);
        DECLARE v_texto3 VARCHAR(100);
        DECLARE v_texto7y8 VARCHAR(100);
        DECLARE v_fpp050 VARCHAR(10);
        DECLARE v_quim_sol VARCHAR(10);
        DECLARE v_quim_zac VARCHAR(10);
        DECLARE v_quim_ant INT;
        DECLARE v_valor_charpy VARCHAR(50); -- TEXTO52
        DECLARE v_quim_mb BOOLEAN;
        DECLARE v_traccion_mb BOOLEAN;
        DECLARE v_traccion_sol BOOLEAN;
        DECLARE v_traccion_zac BOOLEAN;
        DECLARE v_charpy_mb BOOLEAN;
        DECLARE v_charpy_sol BOOLEAN;
        DECLARE v_charpy_zac BOOLEAN;
        DECLARE v_dureza_mb BOOLEAN;
        DECLARE v_dureza_sol BOOLEAN;
        DECLARE v_dureza_zac BOOLEAN;
        DECLARE v_plegado_mb BOOLEAN;
        DECLARE v_plegado_sol BOOLEAN;
        DECLARE v_plegado_zac BOOLEAN;
        DECLARE v_piso VARCHAR(75);
        DECLARE v_solda INT;
        DECLARE v_tt_desc_1 VARCHAR(50);
        DECLARE v_tt_desc_2 VARCHAR(50);
        DECLARE v_tt_temp_1 VARCHAR(10);
        DECLARE v_tt_temp_2 VARCHAR(10);
        DECLARE v_art_cali VARCHAR(100);
        DECLARE v_art_desc VARCHAR(100);
        DECLARE v_pf_desc VARCHAR(100);
        DECLARE v_diametro DECIMAL(10,3);
        DECLARE v_cali_desc VARCHAR(30);
        DECLARE v_espesor_desc VARCHAR(30);
        DECLARE v_norma_desc VARCHAR(30);
        DECLARE v_agru_cali_id INT;
        DECLARE v_rt_agru_cali INT;
        DECLARE v_titu_form VARCHAR(10);
        DECLARE v_fpp40y41 VARCHAR(100);
        DECLARE v_boca DECIMAL(10,3);
        DECLARE v_ubic_axial VARCHAR(50);
        --
        SET v_quim_ant = FuncionQuimicosAnteriores(p_opid);
        SET v_texto7y8 = '';
        SET v_traccion_mb = 0;
        SET v_charpy_mb = 0;
        SET v_plegado_mb = 0;
        SET v_direccion = IF(v_tipo IN (1,3,5), '(-)', 'TRANSVERSAL');
        SET v_cant_probetas = 1;
        SET v_biseladas = 0;
        --
        SELECT ar.tipo_id, ar.espesor / 1000, pf.medida_1, pf.medida_2,  pff.cod_as400, ar.descripcion, ac.descripcion, pf.descripcion, ar.diametro, pfc.agrupacion_calidad_id, pfc.descripcion, pfe.descripcion, pfn.descripcion, ar.descripcion, pf.descripcion, rt.agrupacion_calidad_id
        INTO v_tipo, v_espesor, v_medida1, v_medida2, v_familia, v_art_desc, v_art_cali, v_pf_desc, v_diametro, v_agru_cali_id, v_cali_desc, v_espesor_desc, v_norma_desc, v_art_desc, v_pf_desc, v_rt_agru_cali
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas  ft ON op.ficha_tecnica_id = ft.id
        LEFT JOIN articulos ar ON ar.id = ft.articulo_id
        LEFT JOIN articulos_calidades ac ON ar.calidad_id = ac.id
        LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
        LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id 
        LEFT JOIN productos_fabricados_calidades pfc ON pfc.id = pf.calidad_id
        LEFT JOIN productos_fabricados_espesores pfe ON pfe.id = pf.espesor_id
        LEFT JOIN productos_fabricados_normas pfn ON pfn.id = pf.norma_id
        LEFT JOIN recepciones_tecnicas rt ON op.recepcion_tecnica_id = rt.id
        WHERE op.id = p_opid;
        --
        SELECT COUNT(*)
        INTO v_et3014
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
        WHERE op.id = p_opid
        AND et.etapa = 30 AND et.subetapa = 14;
        --
        SELECT COUNT(*)
        INTO v_et3013
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
        WHERE op.id = p_opid
        AND et.etapa = 30 AND et.subetapa = 13;
        --
        SELECT COUNT(*)
        INTO v_solda
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
        WHERE op.id = p_opid AND (etapa = 15 OR (etapa = 6 AND subetapa = 11));
        --
        SELECT FuncionAsignacionBarrada(p_opid) INTO v_perfilbarrada;
        SET v_fpp050 = 'LLEVAR A:';
        SET v_tildeprensa = 1;
        SET v_tipoprobetero = FuncionColorProbetero(p_opid);
        SET v_ra318 = IF(v_et3014 > 0, 1, 0);
        SET v_inspeccion = IF(v_et3013 > 0, 1, 0);
        --
        IF v_solda >= 1 THEN
        	SET v_tipoprobetero = 'PROBETERO SOLDADURA';
        	SET v_tildesoldadura = 1;
        	SET v_tildeprensa = 1;
        	SET v_fpp006 = 'SOLDADURA';
        	SET v_texto7y8 = 'Soldar con el mismo procedimiento y colada de consumibles';
			SET v_texto3 = IF(v_tipo = 2, '2 probetas de 150 x 350 mm - Biseladas', IF(v_tipo IN (3,4), 'Diam. x 150 mm de largo o 100x150mm', ''));
			--
            IF v_tipo IN (2,4) THEN
				SET v_cant_probetas = 2;
				SET v_biseladas = 1;
				SET v_traccion_sol = 1;
				SET v_charpy_sol = 1;				
			END IF;
		END IF;
        --
		SET v_tt_desc_1 = 'NORMALIZADO';
		SET v_tt_temp_1 = 885;
		SET v_quim_mb = IF(v_quim_ant = 1, 1, 0); 
		SET v_quim_sol = 0;			
		SET v_quim_zac = 0;
		SET v_traccion_mb = 1;
		SET v_traccion_zac = 0;
		SET v_valor_charpy = -46;
		SET v_charpy_mb = 1;
		SET v_charpy_zac = 0;
		SET v_dureza_mb = 1;
		SET v_dureza_sol = 0;
		SET v_dureza_zac = 0;
		--
		IF v_inspeccion OR v_ra318 THEN
			SET v_quim_mb = 1;
		END IF;
        --
		IF v_solda AND (v_inspeccion OR v_ra318) THEN
			SET v_dureza_sol = 1;
			SET v_texto3 = IF(v_tipo = 2, '2 probetas de 150 x 350 mm - Biseladas', IF(v_tipo IN (3,4), 'Diam. x 150 mm de largo o 100x150mm', ''));
			SET v_cant_probetas =2;
			SET v_biseladas = 1;
			SET v_dureza_zac = IF(v_ra318,1, v_dureza_zac);	
		END IF;
        --
		SET v_plegado_mb = 0;
		SET v_plegado_zac = 0;
		SET v_piso = 'EC 7.4.1.15 rev02';
		--	
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_DESC_1') FROM dual INTO v_tt_desc_1;
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_TEMP_1') FROM dual INTO v_tt_temp_1;
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_DESC_2') FROM dual INTO v_tt_desc_2;
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_TEMP_2') FROM dual INTO v_tt_temp_2;
        --
        DELETE FROM aux_op_estudios WHERE 1 = 1;
        --
        INSERT INTO aux_op_estudios(orden_de_produccion_id, perfil_de_barrada, probeta_tamano, 
            direccion, probeta_cantidad,
            biselado, soldadura,
            tratamiento_termico_1, temperatura_1,tratamiento_termico_2, temperatura_2,
            mb_quimico, mb_traccion, mb_charpy,mb_dureza,mb_plegado,
            ma_quimico, ma_traccion, ma_charpy,   ma_dureza,   ma_plegado,
            zac_quimico,  zac_traccion,   zac_charpy,   zac_dureza,   zac_plegado, calidad_desc, espesor_desc, norma_desc, indicaciones_7y8, indicaciones_6, tipo_probetero, art_desc, pf_desc)
        VALUES (p_opid,  v_perfilbarrada, v_texto3, v_direccion, v_cant_probetas, v_biseladas, v_solda, v_tt_desc_1, v_tt_temp_1, v_tt_desc_2, v_tt_temp_2,
            v_quim_mb , v_traccion_mb ,v_charpy_mb, v_dureza_mb , v_plegado_mb ,
            v_quim_sol ,  v_traccion_sol, v_charpy_sol , v_dureza_sol , v_plegado_sol ,
            v_quim_zac ,  v_traccion_zac, v_charpy_zac , v_dureza_zac , v_plegado_zac, 
            v_cali_desc, v_espesor_desc, v_norma_desc, v_texto7y8, v_fpp006, v_tipoprobetero, v_art_desc, v_pf_desc)
        ;
        --  RETURN CONCAT(v_perfilbarrada,' - ', v_tipo, ' - ', v_texto3, ' - ', v_tipoprobetero, ' - ', v_tildecurvado, ' - ', v_art_desc, ' - ', v_pf_desc);
	 	RETURN JSON_OBJECT(
            'orden_de_produccion_id', p_opid,
            'perfil_de_barrada', v_perfilbarrada,
            'probeta_tamano', v_texto3,
            'direccion', v_direccion,
            'probeta_cantidad', v_cant_probetas,
            'biselado', v_biseladas,
            'soldadura', v_solda,
            'tratamiento_termico_1', v_tt_desc_1,
            'temperatura_1', v_tt_temp_1,
            'tratamiento_termico_2', v_tt_desc_2,
            'temperatura_2', v_tt_temp_2,
            'mb_quimico', v_quim_mb,
            'mb_traccion', v_traccion_mb,
            'mb_charpy', v_charpy_mb,
            'mb_dureza', v_dureza_mb,
            'mb_plegado', v_plegado_mb,
            'ma_quimico', v_quim_sol,
            'ma_traccion', v_traccion_sol,
            'ma_charpy', v_charpy_sol,
            'ma_dureza', v_dureza_sol,
            'ma_plegado', v_plegado_sol,
            'zac_quimico', v_quim_zac,
            'zac_traccion', v_traccion_zac,
            'zac_charpy', v_charpy_zac,
            'zac_dureza', v_dureza_zac,
            'zac_plegado', v_plegado_zac,
            'calidad_desc', v_cali_desc,
            'espesor_desc', v_espesor_desc,
            'norma_desc', v_norma_desc,
            'indicaciones_7y8', v_texto7y8,
            'indicaciones_6', v_fpp006,
            'tipo_probetero', v_tipoprobetero,
            'art_desc', v_art_desc,
            'pf_desc', v_pf_desc,
            'ubic_axial', v_ubic_axial,
            'indicaciones40', v_fpp40y41,
            'titulo', v_titu_form
        );
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Funcion_OC_rubpp1`(p_opid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
        DECLARE v_ra318 VARCHAR(50);
        DECLARE v_inspeccion VARCHAR(50);
        DECLARE v_et3014 INT;
        DECLARE v_et3013 INT;
        DECLARE v_tipo INT;
        DECLARE v_inox VARCHAR(10);
        DECLARE v_direccion VARCHAR(50);
        DECLARE v_cant_probetas INT;
        DECLARE v_biseladas INT;
        DECLARE v_perfilbarrada VARCHAR(10);
        DECLARE v_calidad_mp INT;
        DECLARE v_tipoprobetero VARCHAR(50);
        DECLARE v_fpp006 VARCHAR(50);
        DECLARE v_espesor DECIMAL(10,3);
        DECLARE v_familia VARCHAR(10);
        DECLARE v_tildecurvado INT;
        DECLARE v_tildeprensa INT;
        DECLARE v_tildesoldadura INT;
        DECLARE v_medida1 DECIMAL(10,3);
        DECLARE v_medida2 DECIMAL(10,3);
        DECLARE v_texto3 VARCHAR(100);
        DECLARE v_texto7y8 VARCHAR(100);
        DECLARE v_fpp050 VARCHAR(10);
        DECLARE v_quim_sol VARCHAR(10);
        DECLARE v_quim_zac VARCHAR(10);
        DECLARE v_quim_ant INT;
        DECLARE v_valor_charpy VARCHAR(50); -- TEXTO52
        DECLARE v_quim_mb BOOLEAN;
        DECLARE v_traccion_mb BOOLEAN;
        DECLARE v_traccion_sol BOOLEAN;
        DECLARE v_traccion_zac BOOLEAN;
        DECLARE v_charpy_mb BOOLEAN;
        DECLARE v_charpy_sol BOOLEAN;
        DECLARE v_charpy_zac BOOLEAN;
        DECLARE v_dureza_mb BOOLEAN;
        DECLARE v_dureza_sol BOOLEAN;
        DECLARE v_dureza_zac BOOLEAN;
        DECLARE v_plegado_mb BOOLEAN;
        DECLARE v_plegado_sol BOOLEAN;
        DECLARE v_plegado_zac BOOLEAN;
        DECLARE v_piso VARCHAR(75);
        DECLARE v_solda INT;
        DECLARE v_tt_desc_1 VARCHAR(50);
        DECLARE v_tt_desc_2 VARCHAR(50);
        DECLARE v_tt_temp_1 VARCHAR(10);
        DECLARE v_tt_temp_2 VARCHAR(10);
        DECLARE v_art_cali VARCHAR(100);
        DECLARE v_art_desc VARCHAR(100);
        DECLARE v_pf_desc VARCHAR(100);
        DECLARE v_diametro DECIMAL(10,3);
        DECLARE v_cali_desc VARCHAR(30);
        DECLARE v_espesor_desc VARCHAR(30);
        DECLARE v_norma_desc VARCHAR(30);
        DECLARE v_agru_cali_id INT;
        DECLARE v_rt_agru_cali INT;
        DECLARE v_titu_form VARCHAR(10);
        DECLARE v_fpp40y41 VARCHAR(100);
        DECLARE v_boca DECIMAL(10,3);
        DECLARE v_ubic_axial VARCHAR(50);
        --
        SET v_quim_ant = FuncionQuimicosAnteriores(p_opid);
        SET v_texto7y8 = '';
        SET v_traccion_mb = 0;
        SET v_charpy_mb = 0;
        SET v_plegado_mb = 0;
        SET v_direccion = IF(v_tipo IN (1,3,5), '(-)', 'TRANSVERSAL');
        SET v_cant_probetas = 1;
        SET v_biseladas = 0;
        -- poner funcion para ver si tiene ensayos químicos aneteriores
        --
        SELECT ar.tipo_id, ar.espesor / 1000, pf.medida_1, pf.medida_2,  pff.cod_as400, ar.descripcion, ac.descripcion, pf.descripcion, ar.diametro, pfc.agrupacion_calidad_id, pfc.descripcion, pfe.descripcion, pfn.descripcion, ar.descripcion, pf.descripcion, rt.agrupacion_calidad_id
        INTO v_tipo, v_espesor, v_medida1, v_medida2, v_familia, v_art_desc, v_art_cali, v_pf_desc, v_diametro, v_agru_cali_id, v_cali_desc, v_espesor_desc, v_norma_desc, v_art_desc, v_pf_desc, v_rt_agru_cali
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas  ft ON op.ficha_tecnica_id = ft.id
        LEFT JOIN articulos ar ON ar.id = ft.articulo_id
        LEFT JOIN articulos_calidades ac ON ar.calidad_id = ac.id
        LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
        LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id 
        LEFT JOIN productos_fabricados_calidades pfc ON pfc.id = pf.calidad_id
        LEFT JOIN productos_fabricados_espesores pfe ON pfe.id = pf.espesor_id
        LEFT JOIN 	productos_fabricados_normas pfn ON pfn.id = pf.norma_id
        LEFT JOIN recepciones_tecnicas rt ON op.recepcion_tecnica_id = rt.id
        WHERE op.id = p_opid;
        --
        SELECT COUNT(*)
        INTO v_et3014
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
        WHERE op.id = p_opid
        AND et.etapa = 30 AND et.subetapa = 14;
        --
        SELECT COUNT(*)
        INTO v_et3013
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
        WHERE op.id = p_opid
        AND et.etapa = 30 AND et.subetapa = 13;
        --
        SELECT COUNT(*)
        INTO v_solda
        FROM ordenes_de_produccion op
        LEFT JOIN fichas_tecnicas_procesos ftp ON op.ficha_tecnica_id = ftp.ficha_tecnica_id
        LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
        WHERE op.id = p_opid AND (etapa = 15 OR (etapa = 6 AND subetapa = 11));
        --
        SELECT FuncionAsignacionBarrada(p_opid) 
            INTO v_perfilbarrada;
        --
        SET v_ra318 = IF(v_et3014 > 0, 1, 0);
        SET v_inspeccion  = IF(v_et3013 > 0, 1, 0);
        SET v_direccion = IF(v_tipo IN (1,3,5), '(-)', 'Transversal');
        --
        IF v_perfilbarrada IN ('/TR', '/NS') THEN
            IF v_tipo IN (1,5) THEN
                SET v_texto3 = IF( v_diametro <= 30000 AND v_agru_cali_id = 6, 'Diam. x 350 mm', 'Diam. x 200 mm de largo o 150x200mm');
            END IF;
            IF v_tipo IN (2) THEN 
                SET v_texto3 = '2 probetas de 150 x 350 mm - Biseladas';
            ELSE
                IF v_tipo IN (3,4) THEN
                    SET v_texto3 = 'Diam. x 150 mm de largo o 100x150mm';
                END IF;
            END IF;
        ELSE
            IF v_tipo IN (1,5) THEN
                SET v_texto3 = IF( v_diametro <= 30000 AND v_agru_cali_id = 6, 'Diam. x 350 mm', 'Diam. x 200 mm de largo o 150x200mm');
            END IF;
            --
            IF v_tipo IN (2) THEN 
                SET v_texto3 = '150 x 200 mm.';
            ELSE
                IF v_tipo IN (3,4) THEN
                    SET v_texto3 = 'Diam. x 150 mm de largo o 100x150mm';
                END IF;
            END IF;	
            --
            SET v_valor_charpy = '-7';
            --
            IF v_perfilbarrada IN ('/NR', '/NE', '/FA') THEN
                IF v_tipo IN (1,3,5) THEN
                    SET v_piso = 'EC 7.4.1.20 rev01';
                END IF;
                IF v_tipo IN (2,4) THEN
                    set v_piso = 'EC 7.4.1.22 rev01';
                END IF;
            ELSE
                SET v_piso = IF(v_rt_agru_cali = 13, 'EC 7.4.1.17 rev01', 'EC 7.4.1.23 rev01'); -- falta desarrollar
            END IF;
            --
            IF v_tipo IN (1,3,5) THEN
                SET v_traccion_sol = 0;
                SET v_charpy_sol = 0;
                SET v_plegado_sol = 0;
            END IF;
            --
            IF v_tipo IN (2,4) THEN
                SET v_traccion_sol = 1;
                SET v_charpy_sol = 1;
                SET v_plegado_sol = 1;
                SET v_texto7y8 = 'Soldar de acuerdo a procedimiento correspondiente';
            END IF;
            --
            SET v_dureza_sol = 0;
            SET v_dureza_zac = 0;
            SET v_fpp006 = 'SOLDADURA';
            -- SET v_texto7y8 = '150 x 200 mm.'; -- chequear con Roque / suena raro
        END IF;
        --
        IF v_perfilbarrada IN ('/N', '/NR', '/NE', '/FA') THEN
       	    SET v_tildeprensa = 1;
 		END IF;
        -- hasta acá       
        --
        IF v_solda > 0 THEN
            SET v_tildeprensa = 1;
		END IF;
        --
        -- SET v_quim_mb = buscar si hay anteriores
        SET v_quim_mb = IF(v_inspeccion = 1 or v_ra318 = 1, 1, 0);
        SET v_quim_sol = 0;
        SET v_quim_zac = 0;
        SET v_traccion_mb = 1;
        SET v_traccion_zac = 0;
        SET v_valor_charpy = -7;
        --
        IF v_perfilbarrada = '/N' THEN
            SET v_charpy_mb = IF(v_inspeccion + v_ra318 = 0, 0, 1);
        ELSE
            SET v_charpy_mb = 1;
        END IF;
        --
        SET v_charpy_zac = 0;
        SET v_dureza_mb = 1;
        SET v_dureza_sol = IF(v_solda =1 AND (v_ra318 = 1 OR v_inspeccion = 1), 1, 0);
        SET v_dureza_zac = IF(v_ra318 = 1, 1, 0);
        SET v_plegado_mb = 0;
        SET v_plegado_zac = 0;
      	SET v_cant_probetas=  IF(v_tipo IN(2,4), 2, v_cant_probetas);
        SET v_biseladas =  IF(v_tipo IN(2,4), 1, v_biseladas);
        SET v_texto3 = IF(v_tipo = 2, '2 probetas de 150 x 350 mm - Biseladas', IF(v_tipo IN (3,4), 'Diam. x 150 mm de largo o 100x150mm', ' '));
        --
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_DESC_1') FROM dual INTO v_tt_desc_1;
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_TEMP_1') FROM dual INTO v_tt_temp_1;
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_DESC_2') FROM dual INTO v_tt_desc_2;
        SELECT JSON_EXTRACT (FuncionTratamientoTermico(p_opid), '$.TT_TEMP_2') FROM dual INTO v_tt_temp_2;
        --
        IF v_perfilbarrada IN ('/NR', '/NE', '/FA') THEN
            SET v_tt_desc_1 = IF(v_agru_cali_id IN (4,5), 'RECOCIDO', 'NORMALIZADO');
            SET v_tt_temp_1 = 885;
            SET v_tt_desc_2 = 'REVENIDO';
            SET v_tt_temp_2 = IF(v_agru_cali_id IN (4,5), 720, 690);
        END IF;
	    --
        SET v_piso = 'EC 7.4.1.12 rev02';
        --
        DELETE FROM aux_op_estudios WHERE 1 = 1;
        --
        INSERT INTO aux_op_estudios(orden_de_produccion_id, perfil_de_barrada, probeta_tamano,
            direccion, probeta_cantidad,
            biselado, soldadura,
            tratamiento_termico_1, temperatura_1,tratamiento_termico_2, temperatura_2,
            mb_quimico, mb_traccion, mb_charpy,mb_dureza,mb_plegado,
            ma_quimico, ma_traccion, ma_charpy,   ma_dureza,   ma_plegado,
            zac_quimico,  zac_traccion,   zac_charpy,   zac_dureza,   zac_plegado, calidad_desc, espesor_desc, norma_desc, indicaciones_7y8, indicaciones_6, tipo_probetero, art_desc, pf_desc)
        VALUES (p_opid, v_perfilbarrada, v_texto3, v_direccion, v_cant_probetas, v_biseladas, v_solda, v_tt_desc_1, v_tt_temp_1, v_tt_desc_2, v_tt_temp_2,
            v_quim_mb , v_traccion_mb ,v_charpy_mb, v_dureza_mb , v_plegado_mb ,
            v_quim_sol ,  v_traccion_sol, v_charpy_sol , v_dureza_sol , v_plegado_sol ,
            v_quim_zac ,  v_traccion_zac, v_charpy_zac , v_dureza_zac , v_plegado_zac, 
            v_cali_desc, v_espesor_desc, v_norma_desc, v_texto7y8, v_fpp006, v_tipoprobetero, v_art_desc, v_pf_desc)
        ;
        --  RETURN CONCAT(v_perfilbarrada,' - ', v_tipo, ' - ', v_texto3, ' - ', v_tipoprobetero, ' - ', v_tildecurvado, ' - ', v_art_desc, ' - ', v_pf_desc);
        RETURN JSON_OBJECT(
            'orden_de_produccion_id', p_opid,
            'perfil_de_barrada', v_perfilbarrada,
            'probeta_tamano', v_texto3,
            'direccion', v_direccion,
            'probeta_cantidad', v_cant_probetas,
            'biselado', v_biseladas,
            'soldadura', v_solda,
            'tratamiento_termico_1', v_tt_desc_1,
            'temperatura_1', v_tt_temp_1,
            'tratamiento_termico_2', v_tt_desc_2,
            'temperatura_2', v_tt_temp_2,
            'mb_quimico', v_quim_mb,
            'mb_traccion', v_traccion_mb,
            'mb_charpy', v_charpy_mb,
            'mb_dureza', v_dureza_mb,
            'mb_plegado', v_plegado_mb,
            'ma_quimico', v_quim_sol,
            'ma_traccion', v_traccion_sol,
            'ma_charpy', v_charpy_sol,
            'ma_dureza', v_dureza_sol,
            'ma_plegado', v_plegado_sol,
            'zac_quimico', v_quim_zac,
            'zac_traccion', v_traccion_zac,
            'zac_charpy', v_charpy_zac,
            'zac_dureza', v_dureza_zac,
            'zac_plegado', v_plegado_zac,
            'calidad_desc', v_cali_desc,
            'espesor_desc', v_espesor_desc,
            'norma_desc', v_norma_desc,
            'indicaciones_7y8', v_texto7y8,
            'indicaciones_6', v_fpp006,
            'tipo_probetero', v_tipoprobetero,
            'art_desc', v_art_desc,
            'pf_desc', v_pf_desc,
            'ubic_axial', v_ubic_axial,
            'indicaciones40', v_fpp40y41,
            'titulo', v_titu_form
        );
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Regla_HHombre`(p_idft INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
        DECLARE ALTERNATIVA INT;
        DECLARE VERSION_10 INT;
        DECLARE MODIFICA VARCHAR(2);
        DECLARE LOTE INT;
        DECLARE MENSAJE VARCHAR(50);
        DECLARE HorasHombre DECIMAL (10,3);
        DECLARE TiempoMaq DECIMAL (10,3);
        DECLARE ValorFinal DECIMAL (10,3);
        DECLARE json_result JSON;
        SET ALTERNATIVA = 0;

        SELECT alternativa, lote_economico, modificacion_hh INTO ALTERNATIVA, LOTE, MODIFICA
        FROM fichas_tecnicas
        WHERE id = p_idft;

        if LOTE = 0 THEN
            SELECT Regla_loteEconomico (p_idft,0) INTO LOTE;
        END IF;


        SELECT SUM( 1/std_piezas * if(cantidad_operarios > 3, 3, cantidad_operarios) * unidad_x_art) INTO HorasHombre
        FROM fichas_tecnicas_procesos ftp
        LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
        WHERE ficha_tecnica_id = p_idft
                  AND NOT ((et.etapa = 15 AND et.subetapa = 1) OR etapa = 17 OR etapa = 30);

        SELECT SUM(tiempo_setup_maquina * cantidad_operarios / LOTE) INTO TiempoMaq
        FROM fichas_tecnicas_procesos ftp
        LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
        WHERE ficha_tecnica_id = p_idft
		          AND NOT ((et.etapa = 15 AND et.subetapa = 1) OR etapa = 17 OR etapa = 30);

        SET ValorFinal = (HorasHombre + TiempoMaq) * 1.15;
        SELECT JSON_ARRAYAGG(JSON_OBJECT('MOD', HorasHombre, 'TIEMPOMAQ', TIempoMaq, 'Horas Hombre', ValorFinal))
        INTO json_result
        FROM dual;

    RETURN json_result;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Regla_HorasHombre`(p_idft INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
        DECLARE ALTERNATIVA INT;
        DECLARE VERSION_10 INT;
        DECLARE MODIFICA VARCHAR(2);
        DECLARE LOTE INT;
        DECLARE MENSAJE VARCHAR(50);
        DECLARE HorasHombre DECIMAL (10,3);
        DECLARE TiempoMaq DECIMAL (10,3);
        DECLARE ValorFinal DECIMAL (10,3);
        DECLARE json_result JSON;
        SET ALTERNATIVA = 0;

        SELECT alternativa, lote_economico, modificacion_hh INTO ALTERNATIVA, LOTE, MODIFICA
        FROM fichas_tecnicas
        WHERE id = p_idft;

        if LOTE = 0 THEN
            SELECT Regla_loteEconomico (p_idft,0) INTO LOTE;
        END IF;


        SELECT SUM( 1/std_piezas * if(cantidad_operarios > 3, 3, cantidad_operarios) * unidad_x_art) INTO HorasHombre
        FROM fichas_tecnicas_procesos ftp
        LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
        WHERE ficha_tecnica_id = p_idft
                  AND NOT ((et.etapa = 15 AND et.subetapa = 1) OR etapa = 17 OR etapa = 30);

        SELECT SUM(tiempo_setup_maquina * cantidad_operarios / LOTE) INTO TiempoMaq
        FROM fichas_tecnicas_procesos ftp
        LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
        WHERE ficha_tecnica_id = p_idft
		          AND NOT ((et.etapa = 15 AND et.subetapa = 1) OR etapa = 17 OR etapa = 30);

        SET ValorFinal = (HorasHombre + TiempoMaq) * 1.15;
        SELECT JSON_ARRAYAGG(JSON_OBJECT('MOD', HorasHombre, 'TIEMPOMAQ', TIempoMaq, 'Horas Hombre', ValorFinal))
        INTO json_result
        FROM dual;

    RETURN json_result;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `Regla_LoteEconomico`(p_idft INT, p_recalculo INT) RETURNS int(11)
BEGIN
        DECLARE v_producto_id INT;
        DECLARE v_lote_maestro INT;
		DECLARE v_lote_economico INT;
        DECLARE v_alternativa INT;
        DECLARE v_articulo_id INT;
        DECLARE MENSAJE VARCHAR(50);
        DECLARE v_cantidad_producida INT;
        DECLARE v_cantidad_op INT;
        DECLARE v_medida INT;
        DECLARE lote_devuelve INT;
        --
        SELECT lote_economico, alternativa, articulo_id, medida_1, a.producto_fabricado_id
        INTO v_lote_economico, v_alternativa, v_articulo_id, v_medida, v_producto_id
        FROM fichas_tecnicas a
        LEFT JOIN articulos b ON a.articulo_id = b.id
        LEFT JOIN productos_fabricados pf ON a.producto_fabricado_id = pf.id
        WHERE a.id = p_idft;
        --
        IF v_alternativa = 10 THEN
            SELECT le.lote_economico
            INTO v_lote_maestro
            FROM lotes_economicos le
            WHERE le.producto_fabricado_id = v_producto_id;
        END IF;
		--
        IF IFNULL(v_lote_maestro, 0) > 0 THEN
            SET MENSAJE = CONCAT('Lote economico ', CAST(v_lote_maestro AS CHAR));
            SET lote_devuelve = v_lote_maestro;
        ELSE
            IF v_alternativa = 10 THEN
                DELETE FROM aux_lote_economico WHERE TRUE;
                --
                INSERT INTO aux_lote_economico (cantidad)
                SELECT cantidad FROM ordenes_de_produccion a
                WHERE cantidad <> 0
                AND a.id IN (
                    SELECT c.id FROM ordenes_de_produccion c
                    LEFT JOIN fichas_tecnicas b ON c.ficha_tecnica_id = b.id
                    WHERE b.producto_fabricado_id = v_producto_id
                    AND b.alternativa = v_alternativa
                    AND c.fue_lanzada)
                ORDER BY a.id DESC
                LIMIT 3;
                --
                SELECT SUM(cantidad), COUNT(*) INTO v_cantidad_producida, v_cantidad_op FROM aux_lote_economico;
                --
                IF v_cantidad_op > 0 THEN
                    SET MENSAJE = CONCAT('LOTE CALCULADO ', CAST(v_cantidad_producida/v_cantidad_op AS CHAR));
                    SET lote_devuelve = v_cantidad_producida/v_cantidad_op;
                ELSE
                    IF v_medida > 2000 THEN
                        SET lote_devuelve = 4;
                        SET MENSAJE = CONCAT('NO HAY OPS - Medida > 2000 - Lote', CAST(lote_devuelve AS CHAR));
                    ELSE
                        IF v_medida >1200 THEN
                            SET lote_devuelve = 10;
                            SET MENSAJE = 'NO HAY OPS - MEDIDA entre 1200 y  2000';
                        ELSE
                            SET lote_devuelve = 15;
                            SET MENSAJE = 'NO HAY OPS - MEDIDA menor 1200';
                        END IF;
                    END IF;
                END IF;
            ELSE
                IF v_alternativa BETWEEN 50 AND 59 THEN
                    SET MENSAJE = 'Alternativa entre 50 y 59 - No hace nada';
                ELSE
                    SET MENSAJE = 'Alternativa no 10 y no 50';
                    --
                    DELETE FROM aux_lote_economico WHERE TRUE;
                    --
                    INSERT INTO aux_lote_economico (cantidad)
                    SELECT cantidad FROM ordenes_de_produccion a
                    WHERE cantidad <> 0
                    AND a.id IN (
                        SELECT c.id FROM ordenes_de_produccion c
                        LEFT JOIN fichas_tecnicas b ON c.ficha_tecnica_id = b.id
                        WHERE b.producto_fabricado_id = v_producto_id
                        AND b.alternativa = v_alternativa
                  		AND c.fue_lanzada)
                    ORDER BY a.id DESC
                    LIMIT 3;
                    --
                    SELECT SUM(cantidad), COUNT(*) INTO v_cantidad_producida, v_cantidad_op FROM aux_lote_economico;
                    --
                    IF v_cantidad_op > 0 THEN
                        SET MENSAJE = CONCAT('LOTE CALCULADO ALT NO 10 - ', CAST(v_cantidad_producida/v_cantidad_op AS CHAR));
                        SET lote_devuelve = v_cantidad_producida/v_cantidad_op;
                    ELSE
                        SET MENSAJE = 'NO ENCUENTRA OPs ALT NO 10';
                    END IF;
                END IF;
            END IF;
        END IF;
        --
        RETURN lote_devuelve;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'NO_AUTO_VALUE_ON_ZERO' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `regla_rxpieza`(`p_medida` INT,
	`p_familia` VARCHAR(50),
	`p_costuras` INT,
	`p_ancho` INT
) RETURNS int(11)
BEGIN
  DECLARE cantidad_placas INT;
  DECLARE cantidad_extra INT;
  SET cantidad_placas = 0;
  SET cantidad_extra = 0;
  SELECT IFNULL(SUM(cantidad), 0) INTO cantidad_placas
  FROM aux_rxpieza
  WHERE medida = p_medida
  AND familia = p_familia;


  IF p_familia IN ('CRL','C45', 'CRC') AND p_costuras = 1 THEN

    	 SET cantidad_extra = p_ancho / 300 ;

  END IF;
  RETURN cantidad_placas + cantidad_extra ;

END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalcAnchoVirola`(p_medida INT) RETURNS int(11)
BEGIN
        DECLARE v_ancho_virola INT;
        --
        CASE p_medida 
            WHEN 1200 THEN SET v_ancho_virola = 250;
            WHEN 1400 THEN SET v_ancho_virola = 400;
            WHEN 1600 THEN SET v_ancho_virola = 410;
            WHEN 1800 THEN SET v_ancho_virola = 440;
            WHEN 2000 THEN SET v_ancho_virola = 565;
            WHEN 2200 THEN SET v_ancho_virola = 565;
            WHEN 2400 THEN SET v_ancho_virola = 565;
            WHEN 2600 THEN SET v_ancho_virola = 680;
            WHEN 2800 THEN SET v_ancho_virola = 680;
            WHEN 3000 THEN SET v_ancho_virola = 680;
            WHEN 3200 THEN SET v_ancho_virola = 680;
            WHEN 3400 THEN SET v_ancho_virola = 680;
            WHEN 3600 THEN SET v_ancho_virola = 680;
            WHEN 3800 THEN SET v_ancho_virola = 680;
            WHEN 4000 THEN SET v_ancho_virola = 680;
            WHEN 4200 THEN SET v_ancho_virola = 680;
            WHEN 4800 THEN SET v_ancho_virola = 800;
        END CASE;
        --
        RETURN v_ancho_virola;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculo1_PBCRect`(p_anchochapa DOUBLE, p_largochapa DOUBLE, p_espesorchapa DOUBLE, p_anchoP DOUBLE, p_largoP DOUBLE, p_limite DOUBLE) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
		DECLARE v_piezasA INT;
		DECLARE v_piezasL INT;
		DECLARE v_sobranteA INT;
		DECLARE v_sobranteL INT;
		DECLARE v_sobA_largoC INT;
		DECLARE v_sobL_anchoC INT;
		DECLARE v_calculo1 INT;
		DECLARE v_cant1 INT;
		DECLARE v_P_AS INT;  
		DECLARE v_P_LS INT;
		DECLARE v_Piezas_AS INT;
		DECLARE v_Piezas_LS INT; 
		DECLARE v_devuelve VARCHAR (40);
		DECLARE v_cast_valor1 VARCHAR(20);
		DECLARE v_cast_valor2 VARCHAR(20);
		DECLARE v_xsobra1 INT;
		DECLARE v_xsobra1A INT;
		DECLARE v_sobrantelargo1 INT;
		DECLARE v_sobrantelargo2 INT;
		DECLARE v_sobranteancho1 INT;
		DECLARE v_sobranteancho2 INT;
		DECLARE v_descuentolargo INT;
		DECLARE v_descuentoancho INT;
		DECLARE v_pesochapaestimado DECIMAL (10,3);

		SET v_piezasA = TRUNCATE( p_anchochapa / p_anchoP,0);
		SET v_piezasL = TRUNCATE( p_largochapa / p_largoP,0);
		SET v_cant1 = v_piezasA * v_piezasL;
		SET v_sobranteA = p_anchochapa - (v_piezasA * p_anchoP);
		SET v_sobranteL = p_largochapa - (v_piezasL * p_largoP);
		SET v_sobA_largoC = TRUNCATE( v_sobranteA / p_largoP,0);
		SET v_sobL_anchoC = TRUNCATE( v_sobranteL / p_anchoP,0);
		SET v_P_AS = p_anchochapa / p_largoP;
		SET v_P_LS = p_largochapa / p_anchoP;
		SET v_Piezas_AS = TRUNCATE(v_sobA_largoC * v_P_LS, 0);
		SET v_Piezas_LS = TRUNCATE(v_sobL_anchoC * v_P_AS, 0);
		SET v_calculo1 = v_cant1 + v_Piezas_AS + v_Piezas_LS;

		IF v_piezas_LS < 1 THEN
			SET v_xsobra1 = 0;
		ELSE
			SET v_xsobra1 = v_sobL_anchoC * p_anchoP;
		END IF;		

		SET v_sobrantelargo1 = v_sobranteL - v_xsobra1;

		IF v_piezas_AS < 1 THEN
			SET v_xsobra1A = 0;
		ELSE
			SET v_xsobra1A = v_sobA_largoC * p_largoP;
		END IF;		

		SET v_sobranteancho1 = v_sobranteA - v_xsobra1A;

		IF v_sobrantelargo1 >= p_limite THEN
			SET v_descuentolargo = v_sobrantelargo1;
		ELSE
			SET v_descuentolargo = 0;
		END IF;	

		IF v_sobranteancho1 >= 950 THEN 
			SET v_descuentoancho = v_sobranteancho1;
		ELSE
			SET v_descuentoancho = 0;
		END IF;	

		SET v_pesochapaestimado = (p_anchochapa - v_descuentoancho) * (p_largochapa - v_descuentolargo) * p_espesorchapa * 0.00000791;
		SET v_cast_valor1 = CONCAT(CAST(v_calculo1 AS CHAR), ' - ');
		SET v_cast_valor2 = CAST(v_pesochapaestimado AS CHAR);
		SET v_devuelve = CONCAT(v_cast_valor1, v_cast_valor2);
		RETURN v_devuelve;
	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculo2_PBCRect`(p_anchochapa INT, p_largochapa INT, p_espesorchapa DOUBLE, p_anchoP INT, p_largoP INT, p_limite INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
		DECLARE v_piezasA INT;
		DECLARE v_piezasL INT;
		DECLARE v_sobranteA INT;
		DECLARE v_sobranteL INT;
		DECLARE v_sobA_anchoC INT;
		DECLARE v_sobL_largoC INT;
		DECLARE v_calculo2 INT;
		DECLARE v_cant1 INT;
		declare v_P_AS INT;  
		DECLARE v_P_LS INT;
		DECLARE v_Piezas_AS INT;
		DECLARE v_Piezas_LS INT; 
		DECLARE v_devuelve VARCHAR (100);
		DECLARE v_cast_valor1 VARCHAR(20);
		DECLARE v_cast_valor2 VARCHAR(20);
		DECLARE v_xsobra2 INT;
		DECLARE v_xsobra2A INT;
		DECLARE v_sobrantelargo1 INT;
		DECLARE v_sobrantelargo2 INT;
		DECLARE v_sobranteancho1 INT;
		DECLARE v_sobranteancho2 INT;
		DECLARE v_descuentolargo INT;
		DECLARE v_descuentoancho INT;
		DECLARE v_pesochapaestimado DECIMAL(10,3);

		SET v_piezasA = TRUNCATE( p_anchochapa / p_largoP,0);
		SET v_piezasL = TRUNCATE( p_largochapa / p_anchoP,0);
		SET v_cant1 = v_piezasA * v_piezasL;
		SET v_sobranteA = p_anchochapa - (v_piezasA * p_largoP);
		SET v_sobranteL = p_largochapa - (v_piezasL * p_anchoP);
		SET v_sobA_anchoC = TRUNCATE( v_sobranteA / p_anchoP,0);
		SET v_sobL_largoC = TRUNCATE( v_sobranteL / p_largoP,0);
		SET v_P_AS = TRUNCATE( p_anchochapa / p_anchoP, 0) ;  
		SET v_P_LS = TRUNCATE( p_largochapa / p_largoP, 0) ;
		SET v_Piezas_AS = v_sobA_anchoC * v_P_LS;
		SET v_Piezas_LS = v_sobL_largoC * v_P_AS;
		SET v_calculo2 = v_cant1 + v_Piezas_AS + v_Piezas_LS;

		IF v_piezas_LS < 1 THEN
			SET v_xsobra2 = 0;
		ELSE
			SET v_xsobra2 = v_sobL_largoC * p_largoP;
		END IF;		

		SET v_sobrantelargo2 = v_sobranteL - v_xsobra2;

		IF v_piezas_AS < 1 THEN
			SET v_xsobra2A = 0;
		ELSE
			SET v_xsobra2A = v_sobA_anchoC * p_anchoP;
		END IF;		

		SET v_sobranteancho2 = v_sobranteA - v_xsobra2A;

		IF v_sobrantelargo2 >= p_limite THEN
			SET v_descuentolargo = v_sobrantelargo2;
		ELSE
			SET v_descuentolargo = 0;
		END IF;	

		IF v_sobranteancho2 >= 950 THEN 
			SET v_descuentoancho = v_sobranteancho2;
		ELSE
			SET v_descuentoancho = 0;
		END IF;	

		SET v_pesochapaestimado = (p_anchochapa - v_descuentoancho) * (p_largochapa - v_descuentolargo) * p_espesorchapa * 0.00000791;
		SET v_cast_valor1 = CONCAT(CAST(v_calculo2 AS CHAR), ' - ');
		SET v_cast_valor2 = CAST(v_pesochapaestimado AS CHAR);
		
		SET v_devuelve = CONCAT(v_cast_valor1, v_cast_valor2);

		RETURN v_devuelve;
	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculoPzHora_Pant1_13_Rejas`(p_ftid INT) RETURNS decimal(10,3)
BEGIN
        DECLARE v_medida1 DECIMAL(10, 3);
        DECLARE v_medida2 DECIMAL(10, 3);
        DECLARE v_traer DECIMAL(10, 3);
        DECLARE v_recortar DECIMAL(10, 3);
        DECLARE v_coef DECIMAL(10, 3);
        DECLARE v_retirar DECIMAL(10, 3);
        DECLARE v_resultado DECIMAL(10, 3);
        DECLARE v_familia VARCHAR(3);
        DECLARE v_cant_rejas INT;
        DECLARE v_espesor_reja DECIMAL(10, 3);
        DECLARE v_velocidad DECIMAL(10, 3);
        DECLARE v_pinchado DECIMAL(10, 3);
        DECLARE v_perimetro DECIMAL(10, 3);
        DECLARE v_hora INT;

        SET v_coef = 1.05;
        SET v_hora = 50;

        SELECT pf.medida_1, pf.medida_2, pff.cod_as400
        INTO v_medida1, v_medida2, v_familia
        FROM fichas_tecnicas ft
        LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
        LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id
        WHERE ft.id = p_ftid;

        IF v_medida2 < 400 THEN
            SET v_espesor_reja = 4.76;
        ELSE
            IF v_medida2 < 1000 THEN
                SET v_espesor_reja = 6.35;
            ELSE
                IF v_medida2 < 2000 THEN
                    SET v_espesor_reja = 9.5;
                ELSE
                    IF v_medida2 < 3000 THEN
                        SET v_espesor_reja = 12.5;
                    ELSE
                        SET v_espesor_reja = 19.1;
                    END IF;
                END IF;
            END IF;
        END IF;

        IF v_medida2 < 400 THEN SET v_cant_rejas = 1;
        ELSE
            IF v_medida2 < 2000 THEN SET v_cant_rejas = 2;
            ELSE
                IF v_medida2 < 3600 THEN SET v_cant_rejas = 4;
                ELSE SET v_cant_rejas = 6;
                END IF;
            END IF;
        END IF;

        IF v_espesor_reja < 7 THEN
            SET v_velocidad = 370;
            SET v_pinchado = 0.5;
        ELSE
            IF v_espesor_reja < 10 THEN
                SET v_velocidad = 400;
                SET v_pinchado = 0.55;
            ELSE
                IF v_espesor_reja < 13 THEN
                    SET v_velocidad = 380;
                    SET v_pinchado = 0.6;
                ELSE
                    SET v_velocidad = 350;
                    SET v_pinchado = 0.9;
                END IF;
            END IF;
        END IF;

        CASE v_medida2
            WHEN 150 THEN SET v_perimetro = 210;
            WHEN 200 THEN SET v_perimetro = 231;
            WHEN 250 THEN SET v_perimetro = 275;
            WHEN 300 THEN SET v_perimetro = 315;
            WHEN 350 THEN SET v_perimetro = 350;
            WHEN 400 THEN SET v_perimetro = 388;
            WHEN 500 THEN SET v_perimetro = 462;
            WHEN 600 THEN SET v_perimetro = 537;
            WHEN 800 THEN SET v_perimetro = 670;
            WHEN 1000 THEN SET v_perimetro = 823;
            WHEN 1200 THEN SET v_perimetro = 969;
            WHEN 1400 THEN SET v_perimetro = 1065;
            WHEN 1600 THEN SET v_perimetro = 1175;
            WHEN 1800 THEN SET v_perimetro = 1322;
            WHEN 2000 THEN SET v_perimetro = 1468;
            WHEN 2200 THEN SET v_perimetro = 1615;
            WHEN 2400 THEN SET v_perimetro = 1686;
            WHEN 2600 THEN SET v_perimetro = 1908;
            WHEN 2800 THEN SET v_perimetro = 2018;
            WHEN 3000 THEN SET v_perimetro = 2165;
            WHEN 3200 THEN SET v_perimetro = 2311;
            WHEN 3400 THEN SET v_perimetro = 2458;
            WHEN 3600 THEN SET v_perimetro = 2605;
            WHEN 3800 THEN SET v_perimetro = 2751;
            WHEN 4000 THEN SET v_perimetro = 2898;
            WHEN 4200 THEN SET v_perimetro = 2969;
            WHEN 4400 THEN SET v_perimetro = 3154;
            WHEN 4600 THEN SET v_perimetro = 3300;
            WHEN 4800 THEN SET v_perimetro = 3447;
        END CASE;

        IF v_medida2 < 600 THEN SET v_retirar = 0.3;
        ELSE
            IF v_medida2 < 1000 THEN SET v_retirar = 0.4;
            ELSE
                IF v_medida2 < 1400 THEN SET v_retirar = 0.6;
                ELSE
                    IF v_medida2 < 2000 THEN SET v_retirar = 1;
                    ELSE
                        IF v_medida2 < 3000
                            THEN SET v_retirar = 1.5;
                        ELSE
                            SET v_retirar = 3;
                        END IF;
                    END IF;
                END IF;
            END IF;
        END IF;

        SET v_recortar = (v_perimetro / v_velocidad) + v_pinchado;

        SET v_resultado = v_hora / ((1 + v_recortar + v_Retirar) * v_coef);

        RETURN v_resultado;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculoPzHora_Pant1_23_Regletas`(p_ftid INT) RETURNS decimal(10,3)
BEGIN
        DECLARE v_medida1 DECIMAL(10, 3);
        DECLARE v_medida2 DECIMAL(10, 3);
        DECLARE v_ancho DECIMAL(10, 3);
        DECLARE v_traer DECIMAL(10, 3);
        DECLARE v_recortar DECIMAL(10, 3);
        DECLARE v_coef DECIMAL(10, 3);
        DECLARE v_retirar DECIMAL(10, 3);
        DECLARE v_resultado DECIMAL(10, 3);
        DECLARE v_familia VARCHAR(3);
        DECLARE v_cant_rejas INT;
        DECLARE v_espesor DECIMAL(10, 3);
        DECLARE v_velocidad DECIMAL(10, 3);
        DECLARE v_pinchado DECIMAL(10, 3);
        DECLARE v_perimetro DECIMAL(10, 3);
        DECLARE v_hora INT;
        DECLARE v_espR DECIMAL(10, 3);
        DECLARE v_anchoR DECIMAL(10, 3);
        DECLARE v_perimR DECIMAL(10, 3);
        DECLARE v_largoR DECIMAL(10, 3);

        SET v_coef = 1.05;
        SET v_hora = 50;
        SET v_traer = 1.5;

        SELECT pf.medida_1, pf.medida_2, pff.cod_as400, ft.ancho, ar.espesor / 1000
        INTO v_medida1, v_medida2, v_familia, v_ancho, v_espesor
        FROM fichas_tecnicas ft
        LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
        LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id
        LEFT JOIN articulos ar ON ar.id = ft.articulo_id
        WHERE ft.id = p_ftid;

        IF v_medida2 <= 1000 THEN 
            IF v_espesor < 11 THEN SET v_espR = 9.5;
            END IF; 
            IF v_espesor < 14 THEN SET v_espR = 12.7;
            END IF;
            IF v_espesor < 17 THEN SET v_espR = 15.8;
            END IF;
            IF v_espesor < 20 THEN SET v_espR = 19.1;
            END IF;
            IF v_espesor < 23 THEN SET v_espR = 22.22;
            ELSE
                SET v_espR = 0;
            END IF;
        ELSE
            IF v_espesor < 11 THEN SET v_espR = 12.5; END IF;
            IF v_espesor < 14 THEN SET v_espR = 19.1; END IF;
            IF v_espesor < 17 THEN SET v_espR = 22.2; END IF;
            IF v_espesor < 20 THEN SET v_espR = 25.4; END IF;
            IF v_espesor < 23 THEN SET v_espR = 31.7; 
            ELSE
                SET v_espR = 0;
            END IF;
        END IF;

        IF v_medida2 < 1600 THEN SET v_anchoR = 50;
        END IF;
        IF v_medida2 < 2200 THEN SET v_anchoR = 80;
        END IF;
        IF v_medida2 < 2600 THEN SET v_anchoR = 100;
        END IF;

        IF v_medida2 < 3200 THEN SET v_anchoR = 120;
        END IF;
        IF v_medida2 < 3800 THEN SET v_anchoR = 140;
        END IF;

        SET v_largoR = 0;
        IF v_familia = 'RTA' THEN
            SET v_largoR = v_ancho;
        ELSE
            IF v_medida1 = 200 AND v_medida2 = 400 THEN SET v_largoR = 150;
            END IF;
            IF v_medida1 = 400 AND v_medida2 = 400 THEN SET v_largoR = 300;
            END IF;
            IF v_medida1 = 400 AND v_medida2 = 600 THEN SET v_largoR = 260;
            END IF;
            IF v_medida1 = 400 AND v_medida2 = 800 THEN SET v_largoR = 260;
            END IF;
            IF v_medida1 = 600 AND v_medida2 = 600 THEN SET v_largoR = 350;
            END IF;
            IF v_medida1 = 600 AND v_medida2 = 800 THEN SET v_largoR = 350;
            END IF;
            IF v_medida1 = 800 AND v_medida2 = 800 THEN SET v_largoR = 450;
            END IF;
            IF v_medida1 = 800 AND v_medida2 = 1200 THEN SET v_largoR = 450;
            END IF;
            IF v_medida1 = 1200 AND v_medida2 = 1200 THEN SET v_largoR = 570;
            END IF;
        END IF;
        IF v_largoR = 0 THEN SET v_largoR = v_ancho;
        END IF;

        SET v_perimR = v_largoR * 2 + v_anchoR * 2;

        IF v_espR < 7 THEN
            SET v_velocidad = 450;
            SET v_pinchado = 0.4;
        ELSE
            IF v_espR < 10 THEN 
                SET v_velocidad = 500;
                SET v_pinchado = 0.44;
            ELSE
                IF v_espR < 13 
                    THEN SET v_velocidad = 460;
                    SET v_pinchado = 0.45;
                ELSE 
                    IF v_espR < 17 THEN SET v_velocidad = 450;
                        SET v_pinchado = 0.68;
                    ELSE 
                        IF v_espR < 20 THEN SET v_velocidad = 420;
                            SET v_pinchado = 0.69;
                        ELSE
                            IF v_espR < 23 
                                THEN SET v_velocidad = 400;
                                SET v_pinchado = 0.7;
                            ELSE
                                IF v_espR < 27 THEN
                                    SET v_velocidad = 380;
                                    SET v_pinchado = 0.94;
                                ELSE
                                    IF v_espR < 32 THEN SET v_velocidad = 350;
                                        SET v_pinchado = 0.95;
                                    END IF;
                                END IF;
                            END IF;
                        END IF;
                    END IF;
                END IF;
            END IF;
        END IF;
                                        
        IF v_medida1 < 600 THEN SET v_retirar = 0.5;
            ELSE
            IF v_medida1 < 1000 THEN SET v_retirar = 0.8; 
            ELSE
                IF v_medida1 < 1400 THEN SET v_retirar = 1;
                ELSE
                    IF v_medida1 < 2000 THEN SET v_retirar = 1.1;
                    ELSE
                        IF v_medida1 < 3000 THEN SET v_retirar = 1.5;
                        ELSE
                            SET v_retirar = 2;
                        END IF;
                    END IF;
                END IF;
            END IF;
        END IF;

        SET v_recortar = (v_perimR / v_velocidad) + v_pinchado;

        SET v_resultado = (v_Hora / (v_traer + v_Recortar + v_Retirar) * v_Coef);

        RETURN v_resultado;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculo_ProbetaSoldada`(p_ftid INT) RETURNS tinyint(1)
BEGIN
		DECLARE v_soldada INT;
		DECLARE v_etapa151 INT;
		DECLARE v_agru_cali VARCHAR(10);
		DECLARE v_familia VARCHAR(10);
		--
		SELECT COUNT(*)
		INTO v_etapa151
		FROM fichas_tecnicas ft
		LEFT JOIN fichas_tecnicas_procesos ftp ON ft.id = ftp.ficha_tecnica_id
		LEFT JOIN etapas_subetapas et ON ftp.etapa_subetapa_id = et.id
		WHERE ft.id = p_ftid
		AND  et.etapa = 15
		AND et.subetapa = 1;
		--
		SELECT pff.cod_as400, agru.id
		INTO v_familia, v_agru_cali
		FROM fichas_tecnicas ft
		LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
		LEFT JOIN productos_fabricados_familias pff ON pff.id = pf.familia_id
		LEFT JOIN productos_fabricados_calidades pfc ON pfc.id = pf.calidad_id
		LEFT JOIN agrupaciones_calidades agru ON agru.id = pfc.agrupacion_calidad_id
		WHERE ft.id = p_ftid;
		--
		SET v_soldada = 0;
		--
		IF v_etapa151 > 0 AND v_agru_cali IN (42, 46, 52, 56, 60, 65, 70, 6, 8042, 8046, 8052, 8056, 8060, 8065, 8070) AND v_familia IN ('C45', 'CRL', 'CRC', 'REC', 'REE', 'TE', 'TER', 'TNS', 'TRS', 'FNI', 'CRU', 'CZR') THEN
			SET v_soldada = 1;
		END IF;
		--
		RETURN v_soldada;
	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculo_PzHoraSoldadura_ET402`(p_ftid INT) RETURNS decimal(10,3)
BEGIN
		DECLARE v_tiempo_oxi_int DECIMAL(10,3);
		DECLARE v_tiempo_oxi_ext DECIMAL(10,3);
		DECLARE v_des_int DECIMAL(10,3);
		DECLARE v_des_ext DECIMAL(10,3);
		DECLARE v_tiempo_total DECIMAL(10,3);
		DECLARE v_pzhora DECIMAL(10,3);
		DECLARE v_grua INT;
		DECLARE v_familia VARCHAR(4);
		DECLARE v_peso_neto DECIMAL(10,3);
		DECLARE v_coef_peso DECIMAL(10,3);
		DECLARE v_espesor DECIMAL(10,3);
		DECLARE v_ancho DECIMAL(10,3);
		DECLARE v_medida1 DECIMAL(10,3);
		DECLARE v_peso_semicodo DECIMAL(10,3);
		DECLARE v_carga DECIMAL(10,3);
		DECLARE v_interno DECIMAL(10,3);
		DECLARE v_externo1 DECIMAL(10,3);
		DECLARE v_externo2 DECIMAL(10,3);
		DECLARE v_descargar DECIMAL(10,3);
		DECLARE v_medir DECIMAL(10,3);
		DECLARE v_auxiliar DOUBLE;
		DECLARE v_tiempo_auxiliar DECIMAL(10,3);
		DECLARE v_nro_des INT;
		DECLARE v_circ_int INT;
		DECLARE v_circ_ext INT;
		DECLARE v_diam_ext DECIMAL(10,3);
		DECLARE v_sob_int INT;
		DECLARE v_sob_ext INT;
		DECLARE v_vi DECIMAL(10,3);
		DECLARE v_ve DECIMAL(10,3);
		DECLARE v_coef_velint DOUBLE;
		DECLARE v_coef_velext DOUBLE;
		DECLARE v_vel_int DECIMAL(10,3);
		DECLARE v_vel_ext DECIMAL(10,3);
		DECLARE v_rec_int INT;
		DECLARE v_rec_ext INT;
        --
		SELECT pff.cod_as400, ar.espesor /1000, ft.peso_neto, ft.ancho, pf.medida_1
		INTO v_familia, v_espesor, v_peso_neto, v_ancho, v_medida1
		FROM fichas_tecnicas ft
		LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
		LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id
		LEFT JOIN articulos ar ON ft.articulo_id = ar.id
		WHERE ft.id = p_ftid;
        --
		SELECT aux.carga, aux.interno, aux.externo1, aux.externo2, aux.descargar, aux.medir
		INTO v_carga, v_interno, v_externo1, v_externo2, v_descargar, v_medir
		FROM aux_tiempos_oxicorte aux
		WHERE aux.medida1 = v_medida1;
        --
		SET v_peso_semicodo = v_peso_neto / 2 * 1.4;
		SET v_auxiliar = v_carga + v_interno + v_externo1 + v_externo2+ v_descargar+ v_medir;
		SET v_tiempo_auxiliar = IF(v_familia IN ('C45'), v_auxiliar * 0.9, v_auxiliar);
        --
		IF v_peso_semicodo <= 350 THEN
			SET v_grua = 0;
		ELSE
			SET v_grua = 2;
		END IF;
		--
		SET v_diam_ext = v_medida1 * 25.4;	
        --
		IF v_familia IN ('CRL', 'C45') THEN
			SET v_circ_int = 2;
			SET v_circ_ext = 4;
			SET v_nro_des = IF(v_familia = 'CRL', 4,8);
		ELSE
			SET v_circ_int = 1;
			SET v_circ_ext = 3;
			SET v_nro_des = 4;
		END IF;
        --
		CASE v_medida1 
			WHEN v_medida1 = 1200 THEN
				SET v_sob_int = IF (v_familia = 'CRC', 45,35);
				SET v_sob_ext = IF (v_familia = 'CRC', 75,85);
			WHEN v_medida1 = 1400 THEN
				SET v_sob_int = IF (v_familia = 'CRC', 50,40);
				SET v_sob_ext = IF (v_familia = 'CRC', 80,100);
			WHEN v_medida1 = 1600 THEN
				SET v_sob_int = IF (v_familia = 'CRC', 50,45);
				SET v_sob_ext = IF (v_familia = 'CRC', 105,150);
			WHEN v_medida1 = 1800 THEN
				SET v_sob_int = IF (v_familia = 'CRC', 50,45);
				SET v_sob_ext = IF (v_familia = 'CRC', 130,220);
			WHEN v_medida1 = 2000 THEN
				SET v_sob_int = IF (v_familia = 'CRC', 50,45);
				SET v_sob_ext = IF (v_familia = 'CRC', 190,220);	
			WHEN v_medida1 = 2200 THEN
				SET v_sob_int = IF (v_familia = 'CRC', 50,45);
				SET v_sob_ext = IF (v_familia = 'CRC', 190,220);
			WHEN v_medida1 = 2400 THEN
				SET v_sob_int = IF (v_familia = 'CRC', 50,45);
				SET v_sob_ext = IF (v_familia = 'CRC', 195,220);			
			WHEN v_medida1 IN (2600,2800, 3000) THEN
				SET v_sob_int = 45;
				SET v_sob_ext = 220;
			WHEN v_medida1 = 3200 THEN
				SET v_sob_int = 45;
				SET v_sob_ext = 245;
			WHEN v_medida1 = 3400 THEN
				SET v_sob_int = 45;
				SET v_sob_ext = 275;
			WHEN v_medida1 = 3600 THEN
				SET v_sob_int = 110 ;
				SET v_sob_ext = 400;
		ELSE
            SET v_sob_int = 1;
            SET v_sob_ext = 1;
		END CASE;
        --
		SET v_des_int = (v_diam_ext * v_circ_int * 3.1416 / v_nro_des ) + v_sob_int;
		SET v_des_ext = (v_diam_ext * v_circ_ext * 3.1416 / v_nro_des ) + v_sob_ext;
        --
		IF v_espesor > 40 THEN 
			SET v_vi = 	350 ;	
			SET v_ve =	350;
		ELSE
			SET v_vi = 	216 ;	
			SET v_ve =	240;
		END IF;
		IF v_espesor < 33 THEN
			SET v_vi = 	252 ;	
			SET v_ve =	280;
		END IF;
		IF v_espesor < 24 THEN
			SET v_vi = 	297 ;	
			SET v_ve =	330;
		END IF;
		IF v_espesor < 17 THEN 
			SET v_vi = 	315 ;	
			SET v_ve =	350;
		END IF;
        --
		SET v_coef_velint = 1;
		SET v_coef_velext = 1;
        --
		IF v_familia = 'CRC' THEN
			SET v_coef_velint = 1.5;
			SET v_coef_velext = 1.2;
		END IF;
        --
		SET v_vel_int = v_vi / v_coef_velint;
		SET v_vel_ext = v_ve / v_coef_velext;
		SET v_rec_int = 1;
		SET v_rec_ext = 2;
        --
		IF v_familia = 'CRC' THEN
			SET v_rec_int = 2;
		END IF;
        --
		SET v_tiempo_oxi_int = v_des_int / v_vel_int * v_rec_int;
		SET v_tiempo_oxi_ext = v_des_ext / v_vel_ext * v_rec_ext;
		SET v_tiempo_total = (v_tiempo_auxiliar + v_grua  + v_tiempo_oxi_int + v_tiempo_oxi_ext) * 1.14;
		-- 60 / Tiempo Total x Unidades de carga
		SET v_pzhora = 60 / v_tiempo_total * 2;
		RETURN (v_pzhora);
	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculo_PzHoraSoldadura_ET617`(p_ftid INT) RETURNS decimal(10,3)
BEGIN
        DECLARE v_tiempo_total DECIMAL(10,3);
        DECLARE v_pzhora DECIMAL(10,3);
        DECLARE v_familia VARCHAR(4);
        DECLARE v_peso_neto DECIMAL(10,3);
        DECLARE v_coef_peso DECIMAL(10,3);
        DECLARE v_espesor DECIMAL(10,3);
        DECLARE v_ancho DECIMAL(10,3);
        DECLARE v_medida1 DECIMAL(10,3);
        DECLARE v_peso_virola DECIMAL(10,3);
        DECLARE v_carga DECIMAL(10,3);
        DECLARE v_oreja DECIMAL(10,3);
        DECLARE v_respaldo DECIMAL(10,3);
        DECLARE v_limpieza DECIMAL(10,3);
        DECLARE v_descarga DECIMAL(10,3);
        DECLARE v_cepillo DECIMAL(10,3);
        DECLARE v_precalentado DECIMAL(10,3);
        DECLARE v_largo_soldadura DECIMAL(10,3);
        DECLARE v_cant_pasadas INT;
        DECLARE v_cant_enfriamiento INT;
        DECLARE v_soldar DECIMAL(10,3);
        DECLARE v_enfriamiento DECIMAL(10,3);
        DECLARE v_aspirar DECIMAL(10,3);
        DECLARE v_retirar DECIMAL(10,3);
        DECLARE v_acuñar DECIMAL(10,3);
        DECLARE v_coeficiente DECIMAL(10,3);
        --
        SELECT pff.cod_as400, ar.espesor /1000, ft.peso_neto, ft.ancho, pf.medida_1
        INTO v_familia, v_espesor, v_peso_neto, v_ancho, v_medida1
        FROM fichas_tecnicas ft
        LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
        LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id
        LEFT JOIN articulos ar ON ft.articulo_id = ar.id
        WHERE ft.id = p_ftid;
        -- AND ft.es_la_version_vigente = 1;
        IF IFNULL(v_ancho,0) = 0 THEN 

            SET v_ancho = SubCalcAnchoVirola(v_medida1);
        END IF;
        --
        SET v_coef_peso = 1.2;
        --
        SET v_peso_virola = v_peso_neto * v_coef_peso;
        --
        IF v_peso_virola > 450 THEN 
            SET v_carga = 5;
        ELSE
            IF v_Ancho >=	1500
                THEN SET v_carga = 4;
            END IF;
            IF v_Ancho <	1500
                THEN SET v_carga = 2.7;
            END IF;
            IF v_Ancho <	1000
                THEN SET v_carga = 2.2;
            END IF;
            IF v_Ancho <	600 THEN SET v_carga =	1;
            END IF;
        END IF;
        --
        IF v_ancho >= 1500
            THEN SET v_cepillo = 6;
        ELSE
            IF v_ancho < 1500
                THEN SET v_cepillo = 5;
            END IF;
            IF v_ancho < 1250
                THEN SET v_cepillo = 4.5;
            END IF; 
            IF v_ancho < 1000
                THEN SET v_cepillo = 4;
            END IF;
            IF v_ancho < 800
                THEN SET v_cepillo = 3.5;
            END IF;
            IF v_ancho < 600
                THEN SET v_cepillo = 3;
            END IF;
        END IF;	
        --
        SET v_largo_soldadura = v_ancho + 120;
        SET v_precalentado = 1;
        IF v_espesor >= 51 THEN
            SET v_cant_pasadas = 45;
            SET v_cant_enfriamiento = 6;
        END IF;
        IF v_espesor < 51 THEN
            SET v_cant_pasadas = 32;
            SET v_cant_enfriamiento = 4;
        END IF;
        IF v_espesor < 45 THEN
            SET v_cant_pasadas = 27;
            SET v_cant_enfriamiento = 3;
        END IF;
        IF v_espesor < 39 THEN
            SET v_cant_pasadas = 21;
            SET v_cant_enfriamiento = 2;
        END IF;
        IF v_espesor < 32 THEN
            SET v_cant_pasadas = 15;
            SET v_cant_enfriamiento = 2;
        END IF;
        IF v_espesor < 26 THEN
            SET v_cant_pasadas = 12;
            SET v_cant_enfriamiento = 1;
        END IF;
        IF v_espesor < 23 THEN
            SET v_cant_pasadas = 9;
            SET v_cant_enfriamiento = 1;
        END IF;
        IF v_espesor < 20 THEN
            SET v_cant_pasadas = 6;
            SET v_cant_enfriamiento = 0;
        END IF;
        IF v_espesor < 16.5 THEN
            SET v_cant_pasadas = 4;
            SET v_cant_enfriamiento = 0;
        END IF;
        IF v_espesor < 13 THEN
            SET v_cant_pasadas = 3;
            SET v_cant_enfriamiento = 0;
        END IF;
        --
        SET v_soldar = v_largo_soldadura / 550 * v_cant_pasadas;		
        SET v_Enfriamiento = v_cant_enfriamiento * 8;
        SET v_aspirar = 	300 / 550 * v_cant_pasadas;	
        --
        IF v_ancho >= 1500 THEN 
            SET v_limpieza = 5 * v_cant_pasadas;
        ELSE 
            SET v_limpieza = 4 * v_cant_pasadas;
        END IF;
        IF v_ancho < 1250 THEN 
            SET v_limpieza = 3.5 * v_cant_pasadas;
        END IF;	
        IF v_ancho < 1000 THEN 
            SET v_limpieza = 3 * v_cant_pasadas;
        END IF;	
        IF v_ancho < 800 THEN 
            SET v_limpieza = 2.5 * v_cant_pasadas;
        END IF;	
        IF v_ancho < 600 THEN 
            SET v_limpieza = 2 * v_cant_pasadas;
        END IF;	
        --
        SET v_acuñar = 1;
        --
        IF v_peso_virola >= 500 THEN 
            SET v_retirar = 2;
        ELSE 
            SET v_retirar = 1;
        END IF;
        IF v_peso_virola < 400 THEN
            SET v_retirar = 0.8;
        END IF;
        IF v_peso_virola < 300 THEN 
            SET v_retirar = 0.6;
        END IF;			
        IF v_peso_virola < 150 THEN 
            SET v_retirar = 0.5;
        END IF;			
        --
        SET v_coeficiente = 1.1;
        SET v_tiempo_total = (v_retirar + v_acuñar + v_limpieza + v_enfriamiento + v_soldar + v_aspirar + v_cepillo + v_carga) * v_coeficiente;
        SET v_pzhora = 60 / v_tiempo_total;
        --
        RETURN v_pzhora;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculo_PzHoraSoldadura_ET618`(p_ftid INT) RETURNS decimal(10,3)
BEGIN
        DECLARE v_tiempo_total DECIMAL(10,3);
        DECLARE v_pzhora DECIMAL(10,3);
        DECLARE v_familia VARCHAR(4);
        DECLARE v_peso_neto DECIMAL(10,3);
        DECLARE v_coef_peso DECIMAL(10,3);
        DECLARE v_espesor DECIMAL(10,3);
        DECLARE v_ancho DECIMAL(10,3);
        DECLARE v_medida1 DECIMAL(10,3);
        DECLARE v_peso_virola DECIMAL(10,3);
        DECLARE v_precalentado DECIMAL(10,3);
        DECLARE v_carga DECIMAL(10,3);
        DECLARE v_oreja DECIMAL(10,3);
        DECLARE v_respaldo DECIMAL(10,3);
        DECLARE v_limpieza DECIMAL(10,3);
        DECLARE v_descarga DECIMAL(10,3);
        DECLARE v_cepillo DECIMAL(10,3);
        DECLARE v_largo_soldadura DECIMAL(10,3);
        DECLARE v_cant_pasadas INT;
        DECLARE v_cant_enfriamiento INT;
        DECLARE v_soldar DECIMAL(10,3);
        DECLARE v_enfriamiento DECIMAL(10,3);
        DECLARE v_repelado DECIMAL(10,3);
        DECLARE v_acuñar DECIMAL(10,3);
        DECLARE v_aspirar DECIMAL(10,3);
        DECLARE v_coeficiente DECIMAL(10,3);
        --
        SELECT pff.cod_as400, ar.espesor /1000, ft.peso_neto, ft.ancho, pf.medida_1
        INTO v_familia, v_espesor, v_peso_neto, v_ancho, v_medida1
        FROM fichas_tecnicas ft
        LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
        LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id
        LEFT JOIN articulos ar ON ft.articulo_id = ar.id
        WHERE ft.id = p_ftid;
        -- AND ft.es_la_version_vigente = 1;
        --
        IF IFNULL(v_ancho,0) = 0 THEN 
            SET v_ancho = SubCalcAnchoVirola(v_medida1);
        END IF;
        --
        SET v_coef_peso = 1.2;
        SET v_peso_virola = v_peso_neto * v_coef_peso;
        SET v_precalentado = 1;
        --
        IF v_medida1 >=	3400
            THEN SET v_carga = 3.5;
        END IF;
        IF v_medida1 <	3400
            THEN SET v_carga = 2.8;
        END IF;
        IF v_medida1 <	3200
            THEN SET v_carga = 2.4;
        END IF;
        IF v_medida1 <	2800
            THEN SET v_carga =	2.2;
        END IF;
        IF v_medida1 <	2600
            THEN SET v_carga =	1.8;
        END IF;
        IF v_medida1 <	2400
            THEN SET v_carga =	1.5;
        END IF;
        IF v_medida1 <	2000
            THEN SET v_carga =	1.2;
        END IF;
        IF v_medida1 <	1400
            THEN SET v_carga =	1;
        END IF;
        IF v_peso_virola >= 500
            THEN SET v_carga = v_carga + 2;
        END IF;
        --
        SET v_limpieza = v_ancho / 700;
        SET v_largo_soldadura = v_ancho + 120;
        --
        IF v_espesor >= 51 THEN
            SET v_cant_pasadas = 3;
        END IF;
        IF v_espesor < 51 THEN
            SET v_cant_pasadas = 3;
        END IF;
        IF v_espesor < 13 THEN
            SET v_cant_pasadas = 2;
        END IF;
        IF v_espesor < 10 THEN
            SET v_cant_pasadas = 1;
        END IF;
        --
        SET v_soldar = v_largo_soldadura / 300 * v_cant_pasadas;
        SET v_aspirar = 	120 / 300 * v_cant_pasadas;	
        SET v_cepillo = v_ancho / 500 * v_cant_pasadas;
        SET v_acuñar = 1;
        --
        IF v_medida1 >=	3400
            THEN SET v_descarga = 5;
        END IF;
        IF v_medida1 <	3400
            THEN SET v_descarga = 3.8;
        END IF;
        IF v_medida1 <	3200
            THEN SET v_descarga = 3.2;
        END IF;
        IF v_medida1 <	2800
            THEN SET v_descarga =	2.8;
        END IF;
        IF v_medida1 <	2600
            THEN SET v_descarga =	2.2;
        END IF;
        IF v_medida1 <	2400
            THEN SET v_descarga =	1.8;
        END IF;
        IF v_medida1 <	2000
            THEN SET v_descarga =	1.4;
        END IF;
        IF v_medida1 <	1400
            THEN SET v_descarga =	1;
        END IF;
        IF v_peso_virola >= 1000
            THEN SET v_descarga = v_descarga + 4;
        END IF;
        -- hasta acá
        SET v_coeficiente = 1.15;
        SET v_tiempo_total = ( v_carga + v_precalentado + v_limpieza + v_soldar + v_aspirar + v_cepillo + v_acuñar +v_descarga) * v_coeficiente;
        SET v_pzhora = 60 / v_tiempo_total;
        -- RETURN  CONCAT(  'SOLDAR - ',  v_soldar, ' / ASPIRAR - ', v_aspirar ,' /CEPILLO - ',  v_cepillo, ' - ',  v_acuñar , ' - ', v_descarga);
        RETURN v_pzhora;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculo_PzHoraSoldadura_ET630`(p_ftid INT) RETURNS decimal(10,3)
BEGIN
        DECLARE v_tiempo_total DECIMAL(10,3);
        DECLARE v_pzhora DECIMAL(10,3);
        DECLARE v_familia VARCHAR(4);
        DECLARE v_peso_neto DECIMAL(10,3);
        DECLARE v_coef_peso DECIMAL(10,3);
        DECLARE v_espesor DECIMAL(10,3);
        DECLARE v_ancho DECIMAL(10,3);
        DECLARE v_medida1 DECIMAL(10,3);
        DECLARE v_peso_virola DECIMAL(10,3);
        DECLARE v_carga DECIMAL(10,3);
        DECLARE v_oreja DECIMAL(10,3);
        DECLARE v_respaldo DECIMAL(10,3);
        DECLARE v_limpieza DECIMAL(10,3);
        DECLARE v_descarga DECIMAL(10,3);
        DECLARE v_cepillo DECIMAL(10,3);
        DECLARE v_precalentado DECIMAL(10,3);
        DECLARE v_largo_soldadura DECIMAL(10,3);
        DECLARE v_cant_pasadas INT;
        DECLARE v_cant_enfriamiento INT;
        DECLARE v_soldar DECIMAL(10,3);
        DECLARE v_enfriamiento DECIMAL(10,3);
        DECLARE v_repelado DECIMAL(10,3);
        DECLARE v_amolado DECIMAL(10,3);
        DECLARE v_cambiar DECIMAL(10,3);
        DECLARE v_coeficiente DECIMAL(10,3);
        --
        SELECT pff.cod_as400, ar.espesor /1000, ft.peso_neto, ft.ancho, pf.medida_1
        INTO v_familia, v_espesor, v_peso_neto, v_ancho, v_medida1
        FROM fichas_tecnicas ft
        LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
        LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id
        LEFT JOIN articulos ar ON ft.articulo_id = ar.id
        WHERE ft.id = p_ftid;
        -- AND ft.es_la_version_vigente = 1;
        --
        IF IFNULL(v_ancho,0) = 0 THEN 
            -- SET v_ancho = 680 ;
            SET v_ancho = SubCalcAnchoVirola(v_medida1);
        END IF;
        --
        SET v_coef_peso = 1.2;
        SET v_peso_virola = v_peso_neto * v_coef_peso;
        --
        IF v_medida1 >=	3400
            THEN SET v_carga = 5.5;
        END IF;
        IF v_medida1 <	3400
            THEN SET v_carga = 5;
        END IF;
        IF v_medida1 <	3200
            THEN SET v_carga = 4.5;
        END IF;
        IF v_medida1 <	2800
            THEN SET v_carga =	4;
        END IF;
        IF v_medida1 <	2600
            THEN SET v_carga =	3.5;
        END IF;
        IF v_medida1 <	2400
            THEN SET v_carga =	3;
        END IF;
        IF v_medida1 <	2000
            THEN SET v_carga =	2.5;
        END IF;
        IF v_medida1 <	1400
            THEN SET v_carga =	2;
        END IF;
        IF v_peso_virola >= 500
            THEN SET v_carga = v_carga + 2;
        END IF;
        IF v_medida1 >=	3400
            THEN SET v_descarga = 5;
        END IF;
        IF v_medida1 <	3400
            THEN SET v_descarga = 4.5;
        END IF;
        IF v_medida1 <	3200
            THEN SET v_descarga = 4;
        END IF;
        IF v_medida1 <	2800
            THEN SET v_descarga =	3.5;
        END IF;
        IF v_medida1 <	2600
            THEN SET v_descarga =	3;
        END IF;
        IF v_medida1 <	2400
            THEN SET v_descarga =	2.5;
        END IF;
        IF v_medida1 <	2000
            THEN SET v_descarga =	1.5;
        END IF;
        IF v_medida1 <	1400
            THEN SET v_descarga =	1;
        END IF;
        IF v_peso_virola >= 500
            THEN SET v_descarga = v_descarga + 2;
        END IF;
        --
        SET v_repelado = v_ancho / 135;
        SET v_amolado = v_ancho / 160;
        SET v_cambiar = 1;
        SET v_coeficiente = 1.15;
        SET v_tiempo_total = ( v_carga + v_repelado + v_amolado + v_cambiar + v_descarga) * v_coeficiente;
        SET v_pzhora = 60 / v_tiempo_total;
        --
        RETURN v_pzhora;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculo_PzHoraSoldadura_ET633`(p_ftid INT) RETURNS decimal(10,3)
BEGIN
        DECLARE v_tiempo_total DECIMAL(10,3);
        DECLARE v_pzhora DECIMAL(10,3);
        DECLARE v_familia VARCHAR(4);
        DECLARE v_peso_neto DECIMAL(10,3);
        DECLARE v_coef_peso DECIMAL(10,3);
        DECLARE v_espesor DECIMAL(10,3);
        DECLARE v_ancho DECIMAL(10,3);
        DECLARE v_medida1 DECIMAL(10,3);
        DECLARE v_peso_virola DECIMAL(10,3);
        DECLARE v_carga DECIMAL(10,3);
        DECLARE v_oreja DECIMAL(10,3);
        DECLARE v_respaldo DECIMAL(10,3);
        DECLARE v_limpieza DECIMAL(10,3);
        DECLARE v_descarga DECIMAL(10,3);
        --
        SELECT pff.cod_as400, ar.espesor / 1000, ft.peso_neto, ft.ancho, pf.medida_1
        INTO v_familia, v_espesor, v_peso_neto, v_ancho, v_medida1
        FROM fichas_tecnicas ft
        LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
        LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id
        LEFT JOIN articulos ar ON ft.articulo_id = ar.id
        WHERE ft.id = p_ftid;
        --
        IF IFNULL(v_ancho,0) = 0 THEN
            SET v_ancho = SubCalcAnchoVirola(v_medida1);
        END IF;
        --
        SET v_coef_peso = 1.2;
        SET v_peso_virola = v_peso_neto * v_coef_peso;
        --
        IF v_medida1 >= 3400
            THEN SET v_carga = 6.8;
        END IF;
        IF v_medida1 <	3400
            THEN SET v_carga= 6.1;
        END IF;
        IF v_medida1 <	3200
            THEN SET v_carga= 5.4;
        END IF;
        IF v_medida1 <	2800
            THEN SET v_carga= 4.8;
        END IF;
        IF v_medida1 <	2600
            THEN SET v_carga= 4.1;
        END IF;
        IF v_medida1 <	2200
            THEN SET v_carga= 3.7;
        END IF;
        IF v_medida1 <	1600
            THEN SET v_carga= 3.4;
        END IF;
        IF v_peso_virola >= 1000
            THEN SET v_carga = v_carga + 2;
        END IF;
        IF v_espesor >= 52 THEN
            SET v_oreja = IF(v_medida1 < 2000, 22, 25);
        END IF;
        IF v_espesor < 52 THEN
            SET v_oreja = IF(v_medida1 < 2000, 16, 17);
        END IF;
        IF v_espesor < 40 THEN
            SET v_oreja = IF(v_medida1 < 2000, 15, 16);
        END IF;
        IF v_espesor < 32 THEN
            SET v_oreja = IF(v_medida1 < 2000, 14, 15);
        END IF;
        IF v_espesor < 26 THEN
            SET v_oreja = IF(v_medida1 < 2000, 13, 14);
        END IF;
        IF v_espesor < 23 THEN
            SET v_oreja = IF(v_medida1 < 2000, 12, 13);
        END IF;
        IF v_espesor < 20 THEN
            SET v_oreja = IF(v_medida1 < 2000, 11, 12);
        END IF;
        IF v_espesor < 16 THEN
            SET v_oreja = IF(v_medida1 < 2000, 10, 11);
        END IF;
        IF v_espesor < 13 THEN
            SET v_oreja = IF(v_medida1 < 2000, 9, 10);
        END IF;
        IF v_espesor < 10 THEN
            SET v_oreja = IF(v_medida1 < 2000, 8.5, 9);
        END IF;
        --
        SET v_limpieza = v_ancho / 400;
        SET v_respaldo = v_ancho / 350;
        --
        IF v_medida1 >= 3400
            THEN SET v_descarga = 8;
        END IF;
        IF v_medida1 <	3400
            THEN SET v_descarga= 5.6;
        END IF;
        IF v_medida1 <	3200
            THEN SET v_descarga= 4.4;
        END IF;
        IF v_medida1 <	2800
            THEN SET v_descarga= 3.6;
        END IF;
        IF v_medida1 <	2600
            THEN SET v_descarga= 2.8;
        END IF;
        IF v_medida1 <	2200
            THEN SET v_descarga= 2.4;
        END IF;
        IF v_medida1 <	1600
            THEN SET v_descarga= 2;
        END IF;
        IF v_peso_virola >= 1000
            THEN SET v_descarga = v_descarga + 2;
        END IF;
        --
        SET v_tiempo_total = (v_carga  + v_oreja + v_limpieza + v_respaldo + v_descarga) * 1.2;
        SET v_pzhora = 60 / v_tiempo_total;
        -- RETURN CONCAT (v_espesor, ' - ', v_medida1, ' - ', v_carga  , ' - ', v_oreja , ' - ',v_limpieza , ' - ',v_respaldo ,' - ', v_descarga);
        RETURN v_pzhora;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculo_PzHoraSoldadura_ET634`(p_ftid INT) RETURNS decimal(10,3)
BEGIN
        DECLARE v_tiempo_total DECIMAL(10,3);
        DECLARE v_pzhora DECIMAL(10,3);
        DECLARE v_familia VARCHAR(4);
        DECLARE v_peso_neto DECIMAL(10,3);
        DECLARE v_coef_peso DECIMAL(10,3);
        DECLARE v_espesor DECIMAL(10,3);
        DECLARE v_ancho DECIMAL(10,3);
        DECLARE v_medida1 DECIMAL(10,3);
        DECLARE v_peso_virola DECIMAL(10,3);
        DECLARE v_recortar DECIMAL(10,3);
        DECLARE v_oreja DECIMAL(10,3);
        DECLARE v_respaldo DECIMAL(10,3);
        DECLARE v_limpieza DECIMAL(10,3);
        DECLARE v_traer DECIMAL(10,3);
        DECLARE v_cepillo DECIMAL(10,3);
        DECLARE v_precalentado DECIMAL(10,3);
        DECLARE v_largo_soldadura DECIMAL(10,3);
        DECLARE v_cant_pasadas INT;
        DECLARE v_cant_enfriamiento INT;
        DECLARE v_soldar DECIMAL(10,3);
        DECLARE v_enfriamiento DECIMAL(10,3);
        DECLARE v_repelado DECIMAL(10,3);
        DECLARE v_amolado DECIMAL(10,3);
        DECLARE v_cambiar DECIMAL(10,3);
        DECLARE v_coeficiente DECIMAL(10,3);
        DECLARE v_vel_emprolijado DECIMAL(10,3);
        DECLARE v_coef_emp INT;
        DECLARE v_emprolijado DECIMAL(10,3);
        DECLARE v_amolado_rebaba DECIMAL(10,3);
        DECLARE v_retirar  DECIMAL(10,3);
        --
        SELECT pff.cod_as400, ar.espesor /1000, ft.peso_neto, ft.ancho, pf.medida_1
        INTO v_familia, v_espesor, v_peso_neto, v_ancho, v_medida1
        FROM fichas_tecnicas ft
        LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
        LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id
        LEFT JOIN articulos ar ON ft.articulo_id = ar.id
        WHERE ft.id = p_ftid;
        -- AND ft.es_la_version_vigente = 1;
        IF IFNULL(v_ancho,0) = 0
            THEN 
            SET v_ancho = SubCalcAnchoVirola(v_medida1);
        END IF;
        --
        SET v_coef_peso = 1.2;
        SET v_peso_virola = v_peso_neto * v_coef_peso;
        --
        IF v_espesor >= 52 THEN
            SET v_recortar = IF(v_medida1 >= 2000, 12,11);
        ELSE
            SET v_recortar = IF(v_medida1 < 2000, 9, 10);
        END IF;
        IF v_espesor < 40 THEN
            SET v_recortar = IF(v_medida1 < 2000, 8, 8.5);
        END IF;
        IF v_espesor < 32 THEN
            SET v_recortar = IF(v_medida1 < 2000, 7, 7.5);
        END IF;
        IF v_espesor < 26 THEN
            SET v_recortar = IF(v_medida1 < 2000, 6.6 , 7.2);
        END IF;
        IF v_espesor < 23 THEN
            SET v_recortar = IF(v_medida1 < 2000, 6.4 , 7);
        END IF;
        IF v_espesor < 20 THEN
            SET v_recortar = IF(v_medida1 < 2000, 6.2 , 6.9);
        END IF;
        IF v_espesor < 16 THEN
            SET v_recortar = IF(v_medida1 < 2000, 6 , 6.8);
        END IF;
        IF v_espesor < 13 THEN
            SET v_recortar = IF(v_medida1 < 2000, 5.9 , 6.7);
        END IF;
        IF v_espesor < 10
            THEN
            SET v_recortar = IF(v_medida1 < 2000, 5.8 , 6.6);
        END IF;
        IF v_peso_virola >= 500 THEN
            SET v_traer = 3;
        ELSE
            IF v_ancho >= 1500 THEN
                SET v_traer = 2.5;
            ELSE
                SET v_traer = IF (v_ancho < 1000, 1, 1.5);
            END IF;	
        END IF;
        IF v_espesor >= 51 THEN 
            SET v_vel_emprolijado = 100;
        ELSE
            SET v_vel_emprolijado = 120;
        END IF;
        IF v_espesor < 45 THEN
            SET v_vel_emprolijado = 140;
        END IF;
        IF v_espesor < 39 THEN
            SET v_vel_emprolijado = 160;
        END IF;
        IF v_espesor < 32 THEN
            SET v_vel_emprolijado = 180;
        END IF;
        IF v_espesor < 26 THEN
            SET v_vel_emprolijado = 200;
        END IF;
        IF v_espesor < 20 THEN
            SET v_vel_emprolijado = 210;
        END IF;
        IF v_espesor < 16 THEN
            SET v_vel_emprolijado = 230;
        END IF;
        IF v_espesor < 10 THEN
            SET v_vel_emprolijado = 250;
        END IF;
        IF v_familia NOT IN ('TE', 'TER', 'TRS', 'TNS') THEN
            SET v_coef_emp = 1;
        ELSE
            SET v_coef_emp = IF(v_medida1 = 3400, 1, IF (v_medida1 > 1400, 0, 1));	
        END IF;
        --
        SET v_emprolijado = v_ancho / v_vel_emprolijado * v_coef_emp;
        --
        IF v_espesor >= 51 THEN
            SET v_amolado_rebaba = 2.5;
        ELSE
            SET v_amolado_rebaba = 2;
        END IF;
        IF v_espesor < 45 THEN
            SET v_amolado_rebaba = 1.8;
        END IF;
        IF v_espesor < 39 THEN
            SET v_amolado_rebaba = 1.4;
        END IF;
        IF v_espesor < 32 THEN
            SET v_amolado_rebaba = 1.2;
        END IF;
        IF v_espesor < 26 THEN
            SET v_amolado_rebaba = 1;
        END IF;
        IF v_espesor < 20 THEN
            SET v_amolado_rebaba = 0.9;
        END IF;
        IF v_espesor < 16 THEN
            SET v_amolado_rebaba = 0.8;
        END IF;
        IF v_espesor < 10 THEN
            SET v_amolado_rebaba = 0.7;
        END IF;
        IF v_peso_virola >= 500 THEN
            SET v_retirar = 1.1;
        ELSE
            SET v_retirar = 0.9;
        END IF;
        IF v_peso_virola < 400 THEN
            SET v_retirar = 0.7;
        END IF;
        IF v_peso_virola < 300 THEN
            SET v_retirar = 0.6;
        END IF;
        IF v_peso_virola < 150 THEN
            SET v_retirar = 0.5;
        END IF;
        --
        SET v_cambiar = 1;
        SET v_coeficiente = IF(v_coef_emp = 0, 1.2, 1.3);
        SET v_tiempo_total = ( v_recortar + v_traer + v_emprolijado + v_amolado_rebaba + v_cambiar + v_retirar) * v_coeficiente;
        SET v_pzhora = 60 / v_tiempo_total;
        --
        RETURN v_pzhora;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculo_PzHoraSoldadura_ET635`(p_ftid INT) RETURNS decimal(10,3)
BEGIN
        DECLARE v_tiempo_total DECIMAL(10,3);
        DECLARE v_pzhora DECIMAL(10,3);
        DECLARE v_familia VARCHAR(4);
        DECLARE v_peso_neto DECIMAL(10,3);
        DECLARE v_coef_peso DECIMAL(10,3);
        DECLARE v_espesor DECIMAL(10,3);
        DECLARE v_ancho DECIMAL(10,3);
        DECLARE v_medida1 DECIMAL(10,3);
        DECLARE v_peso_virola DECIMAL(10,3);
        DECLARE v_carga DECIMAL(10,3);
        DECLARE v_recortar DECIMAL(10,3);
        DECLARE v_respaldo DECIMAL(10,3);
        DECLARE v_limpieza DECIMAL(10,3);
        DECLARE v_descarga DECIMAL(10,3);
        DECLARE v_cepillo DECIMAL(10,3);
        DECLARE v_precalentado DECIMAL(10,3);
        DECLARE v_largo_soldadura DECIMAL(10,3);
        DECLARE v_cant_pasadas INT;
        DECLARE v_cant_enfriamiento INT;
        DECLARE v_vel_amolado DECIMAL(10,3);
        DECLARE v_sobremonta DECIMAL(10,3);
        DECLARE v_interior DECIMAL(10,3);
        DECLARE v_amolado DECIMAL(10,3);
        DECLARE v_traer DECIMAL(10,3);
        DECLARE v_coeficiente DECIMAL(10,3);
        DECLARE v_amolado_rebaba DECIMAL(10,3);
        DECLARE  v_retirar DECIMAL(10,3);
        --
        SELECT pff.cod_as400, ar.espesor /1000, ft.peso_neto, ft.ancho, pf.medida_1
        INTO v_familia, v_espesor, v_peso_neto, v_ancho, v_medida1
        FROM fichas_tecnicas ft
        LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
        LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id
        LEFT JOIN articulos ar ON ft.articulo_id = ar.id
        WHERE ft.id = p_ftid;
        -- AND ft.es_la_version_vigente = 1;
        --
        IF IFNULL(v_ancho,0) = 0 THEN
            SET v_ancho = SubCalcAnchoVirola(v_medida1);
        END IF;
        IF v_espesor >= 52 THEN
            SET v_recortar = IF(v_medida1 >= 2000, 14,12);
        ELSE
            SET v_recortar = IF(v_medida1 < 2000, 9.5, 11);
        END IF;
        IF v_espesor < 40 THEN
            SET v_recortar = IF(v_medida1 < 2000, 8, 9);
        END IF;
        IF v_espesor < 32 THEN
            SET v_recortar = IF(v_medida1 < 2000, 7.5, 8.5);
        END IF;
        IF v_espesor < 26 THEN
            SET v_recortar = IF(v_medida1 < 2000, 7.3 , 8.3);
        END IF;
        IF v_espesor < 23 THEN
            SET v_recortar = IF(v_medida1 < 2000, 7 , 8);
        END IF;
        IF v_espesor < 20 THEN
            SET v_recortar = IF(v_medida1 < 2000, 6.8 , 7.8);
        END IF;
        IF v_espesor < 16 THEN
            SET v_recortar = IF(v_medida1 < 2000, 7.3 , 8.3);
        END IF;
        IF v_espesor < 13 THEN
            SET v_recortar = IF(v_medida1 < 2000, 6.3 , 7.3);
        END IF;
        IF v_espesor < 10
            THEN
            SET v_recortar = IF(v_medida1 < 2000, 6 , 7);
        END IF;
        --
        SET v_coef_peso = 1.2;
        SET v_peso_virola = v_peso_neto * v_coef_peso;
        --
        IF v_ancho >= 1500 THEN
            SET v_traer = IF (v_peso_virola < 500, 1.5, 3);
        ELSE
            SET v_traer = IF (v_peso_virola < 500, 1, 3);
        END IF;
        IF v_ancho < 1000 THEN
            SET v_traer = IF (v_peso_virola < 500, 0.5, 3);
        END IF;
        IF v_espesor >= 51 THEN
            SET v_vel_amolado = 10;
        ELSE
            SET v_vel_amolado = 15;
        END IF;
        IF v_espesor < 45 THEN
            SET v_vel_amolado = 20;
        END IF;
        IF v_espesor < 39 THEN
            SET v_vel_amolado = 25;
        END IF;
        IF v_espesor < 32 THEN
            SET v_vel_amolado = 30;
        END IF;
        IF v_espesor < 26 THEN
            SET v_vel_amolado = 35;
        END IF;
        IF v_espesor < 20 THEN
            SET v_vel_amolado = 40;
        END IF;
        IF v_espesor < 16 THEN
            SET v_vel_amolado = 45;
        END IF;
        IF v_espesor < 10 THEN
            SET v_vel_amolado = 50;
        END IF;
        --
        SET v_sobremonta = v_ancho / v_vel_amolado;
        SET v_interior = (200 / v_vel_amolado) + 0.5;
        SET v_amolado = v_interior + v_sobremonta;
        --
        IF v_espesor >= 51 THEN
            SET v_amolado_rebaba = 5;
        ELSE
            SET v_amolado_rebaba = 3;
        END IF;
        IF v_espesor < 45 THEN
            SET v_amolado_rebaba = 2.5;
        END IF;
        IF v_espesor < 39 THEN
            SET v_amolado_rebaba = 2;
        END IF;
        IF v_espesor < 32 THEN
            SET v_amolado_rebaba = 1.8;
        END IF;
        IF v_espesor < 26 THEN
            SET v_amolado_rebaba = 1.5;
        END IF;
        IF v_espesor < 20 THEN
            SET v_amolado_rebaba = 1.3;
        END IF;
        IF v_espesor < 16 THEN
            SET v_amolado_rebaba = 1.2;
        END IF;
        IF v_espesor < 10 THEN
            SET v_amolado_rebaba = 1;
        END IF;
        IF v_peso_virola >= 500 THEN
            SET v_retirar = 1.1;
        ELSE
            SET v_retirar = 0.9;
        END IF;
        IF v_peso_virola < 400 THEN
            SET v_retirar = 0.7;
        END IF;
        IF v_peso_virola < 300 THEN
            SET v_retirar = 0.6;
        END IF;
        IF v_peso_virola < 100 THEN
            SET v_retirar = 0.5;
        END IF;
        --
        SET v_coeficiente = 1.3;
        SET v_tiempo_total = ( v_recortar + v_traer + v_amolado + v_amolado_rebaba + 1 + v_retirar) * v_coeficiente;
        SET v_pzhora = 60 / v_tiempo_total;
        --
        RETURN v_pzhora;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculo_PzHora_Pant1_13_Rejas`(p_ftid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
        DECLARE v_medida1 DECIMAL(10, 3);
        DECLARE v_medida2 DECIMAL(10, 3);
        DECLARE v_traer DECIMAL(10, 3);
        DECLARE v_recortar DECIMAL(10, 3);
        DECLARE v_coef DECIMAL(10, 3);
        DECLARE v_retirar DECIMAL(10, 3);
        DECLARE v_resultado DECIMAL(10, 3);
        DECLARE v_familia VARCHAR(3);
        DECLARE v_cant_rejas INT;
        DECLARE v_espesor_reja DECIMAL(10, 3);
        DECLARE v_velocidad DECIMAL(10, 3);
        DECLARE v_pinchado DECIMAL(10, 3);
        DECLARE v_perimetro DECIMAL(10, 3);
        DECLARE v_hora INT;

        SET v_coef = 1.05;
        SET v_hora = 50;

        SELECT pf.medida_1, pf.medida_2, pff.cod_as400
        INTO v_medida1, v_medida2, v_familia
        FROM fichas_tecnicas ft
        LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
        LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id
        WHERE ft.id = p_ftid;

        IF v_medida2 < 400 THEN
            SET v_espesor_reja = 4.76;
        ELSE
            IF v_medida2 < 1000 THEN
                SET v_espesor_reja = 6.35;
            ELSE
                IF v_medida2 < 2000 THEN
                    SET v_espesor_reja = 9.5;
                ELSE
                    IF v_medida2 < 3000 THEN
                        SET v_espesor_reja = 12.5;
                    ELSE
                        SET v_espesor_reja = 19.1;
                    END IF;
                END IF;
            END IF;
        END IF;

        IF v_medida2 < 400 THEN SET v_cant_rejas = 1;
        ELSE
            IF v_medida2 < 2000 THEN SET v_cant_rejas = 2;
            ELSE
                IF v_medida2 < 3600 THEN SET v_cant_rejas = 4;
                ELSE SET v_cant_rejas = 6;
                END IF;
            END IF;
        END IF;

        IF v_espesor_reja < 7 THEN
            SET v_velocidad = 370;
            SET v_pinchado = 0.5;
        ELSE
            IF v_espesor_reja < 10 THEN
                SET v_velocidad = 400;
                SET v_pinchado = 0.55;
            ELSE
                IF v_espesor_reja < 13 THEN
                    SET v_velocidad = 380;
                    SET v_pinchado = 0.6;
                ELSE
                    SET v_velocidad = 350;
                    SET v_pinchado = 0.9;
                END IF;
            END IF;
        END IF;

        CASE v_medida2
            WHEN 150 THEN SET v_perimetro = 210;
            WHEN 200 THEN SET v_perimetro = 231;
            WHEN 250 THEN SET v_perimetro = 275;
            WHEN 300 THEN SET v_perimetro = 315;
            WHEN 350 THEN SET v_perimetro = 350;
            WHEN 400 THEN SET v_perimetro = 388;
            WHEN 500 THEN SET v_perimetro = 462;
            WHEN 600 THEN SET v_perimetro = 537;
            WHEN 800 THEN SET v_perimetro = 670;
            WHEN 1000 THEN SET v_perimetro = 823;
            WHEN 1200 THEN SET v_perimetro = 969;
            WHEN 1400 THEN SET v_perimetro = 1065;
            WHEN 1600 THEN SET v_perimetro = 1175;
            WHEN 1800 THEN SET v_perimetro = 1322;
            WHEN 2000 THEN SET v_perimetro = 1468;
            WHEN 2200 THEN SET v_perimetro = 1615;
            WHEN 2400 THEN SET v_perimetro = 1686;
            WHEN 2600 THEN SET v_perimetro = 1908;
            WHEN 2800 THEN SET v_perimetro = 2018;
            WHEN 3000 THEN SET v_perimetro = 2165;
            WHEN 3200 THEN SET v_perimetro = 2311;
            WHEN 3400 THEN SET v_perimetro = 2458;
            WHEN 3600 THEN SET v_perimetro = 2605;
            WHEN 3800 THEN SET v_perimetro = 2751;
            WHEN 4000 THEN SET v_perimetro = 2898;
            WHEN 4200 THEN SET v_perimetro = 2969;
            WHEN 4400 THEN SET v_perimetro = 3154;
            WHEN 4600 THEN SET v_perimetro = 3300;
            WHEN 4800 THEN SET v_perimetro = 3447;
        END CASE;

        IF v_medida2 < 600 THEN SET v_retirar = 0.3;
        ELSE
            IF v_medida2 < 1000 THEN SET v_retirar = 0.4;
            ELSE
                IF v_medida2 < 1400 THEN SET v_retirar = 0.6;
                ELSE
                    IF v_medida2 < 2000 THEN SET v_retirar = 1;
                    ELSE
                        IF v_medida2 < 3000
                            THEN SET v_retirar = 1.5;
                        ELSE
                            SET v_retirar = 3;
                        END IF;
                    END IF;
                END IF;
            END IF;
        END IF;

        SET v_recortar = (v_perimetro / v_velocidad) + v_pinchado;

        SET v_resultado = v_hora / ((1 + v_recortar + v_Retirar) * v_coef);

        RETURN JSON_ARRAYAGG(JSON_OBJECT('Cant Piezas x hora', v_resultado));
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculo_PzHora_Pant1_23_Regletas`(p_ftid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
        DECLARE v_medida1 DECIMAL(10, 3);
        DECLARE v_medida2 DECIMAL(10, 3);
        DECLARE v_ancho DECIMAL(10, 3);
        DECLARE v_traer DECIMAL(10, 3);
        DECLARE v_recortar DECIMAL(10, 3);
        DECLARE v_coef DECIMAL(10, 3);
        DECLARE v_retirar DECIMAL(10, 3);
        DECLARE v_resultado DECIMAL(10, 3);
        DECLARE v_familia VARCHAR(3);
        DECLARE v_cant_rejas INT;
        DECLARE v_espesor DECIMAL(10, 3);
        DECLARE v_velocidad DECIMAL(10, 3);
        DECLARE v_pinchado DECIMAL(10, 3);
        DECLARE v_perimetro DECIMAL(10, 3);
        DECLARE v_hora INT;
        DECLARE v_espR DECIMAL(10, 3);
        DECLARE v_anchoR DECIMAL(10, 3);
        DECLARE v_perimR DECIMAL(10, 3);
        DECLARE v_largoR DECIMAL(10, 3);

        SET v_coef = 1.05;
        SET v_hora = 50;
        SET v_traer = 1.5;

        SELECT pf.medida_1, pf.medida_2, pff.cod_as400, ft.ancho, ar.espesor / 1000
        INTO v_medida1, v_medida2, v_familia, v_ancho, v_espesor
        FROM fichas_tecnicas ft
        LEFT JOIN productos_fabricados pf ON ft.producto_fabricado_id = pf.id
        LEFT JOIN productos_fabricados_familias pff ON pf.familia_id = pff.id
        LEFT JOIN articulos ar ON ar.id = ft.articulo_id
        WHERE ft.id = p_ftid;

        IF v_medida2 <= 1000 THEN 
            IF v_espesor < 11 THEN SET v_espR = 9.5;
            END IF; 
            IF v_espesor < 14 THEN SET v_espR = 12.7;
            END IF;
            IF v_espesor < 17 THEN SET v_espR = 15.8;
            END IF;
            IF v_espesor < 20 THEN SET v_espR = 19.1;
            END IF;
            IF v_espesor < 23 THEN SET v_espR = 22.22;
            ELSE
                SET v_espR = 0;
            END IF;
        ELSE
            IF v_espesor < 11 THEN SET v_espR = 12.5; END IF;
            IF v_espesor < 14 THEN SET v_espR = 19.1; END IF;
            IF v_espesor < 17 THEN SET v_espR = 22.2; END IF;
            IF v_espesor < 20 THEN SET v_espR = 25.4; END IF;
            IF v_espesor < 23 THEN SET v_espR = 31.7; 
            ELSE
                SET v_espR = 0;
            END IF;
        END IF;

        IF v_medida2 < 1600 THEN SET v_anchoR = 50;
        END IF;
        IF v_medida2 < 2200 THEN SET v_anchoR = 80;
        END IF;
        IF v_medida2 < 2600 THEN SET v_anchoR = 100;
        END IF;

        IF v_medida2 < 3200 THEN SET v_anchoR = 120;
        END IF;
        IF v_medida2 < 3800 THEN SET v_anchoR = 140;
        END IF;

        SET v_largoR = 0;
        IF v_familia = 'RTA' THEN
            SET v_largoR = v_ancho;
        ELSE
            IF v_medida1 = 200 AND v_medida2 = 400 THEN SET v_largoR = 150;
            END IF;
            IF v_medida1 = 400 AND v_medida2 = 400 THEN SET v_largoR = 300;
            END IF;
            IF v_medida1 = 400 AND v_medida2 = 600 THEN SET v_largoR = 260;
            END IF;
            IF v_medida1 = 400 AND v_medida2 = 800 THEN SET v_largoR = 260;
            END IF;
            IF v_medida1 = 600 AND v_medida2 = 600 THEN SET v_largoR = 350;
            END IF;
            IF v_medida1 = 600 AND v_medida2 = 800 THEN SET v_largoR = 350;
            END IF;
            IF v_medida1 = 800 AND v_medida2 = 800 THEN SET v_largoR = 450;
            END IF;
            IF v_medida1 = 800 AND v_medida2 = 1200 THEN SET v_largoR = 450;
            END IF;
            IF v_medida1 = 1200 AND v_medida2 = 1200 THEN SET v_largoR = 570;
            END IF;
        END IF;
        IF v_largoR = 0 THEN SET v_largoR = v_ancho;
        END IF;

        SET v_perimR = v_largoR * 2 + v_anchoR * 2;

        IF v_espR < 7 THEN
            SET v_velocidad = 450;
            SET v_pinchado = 0.4;
        ELSE
            IF v_espR < 10 THEN 
                SET v_velocidad = 500;
                SET v_pinchado = 0.44;
            ELSE
                IF v_espR < 13 
                    THEN SET v_velocidad = 460;
                    SET v_pinchado = 0.45;
                ELSE 
                    IF v_espR < 17 THEN SET v_velocidad = 450;
                        SET v_pinchado = 0.68;
                    ELSE 
                        IF v_espR < 20 THEN SET v_velocidad = 420;
                            SET v_pinchado = 0.69;
                        ELSE
                            IF v_espR < 23 
                                THEN SET v_velocidad = 400;
                                SET v_pinchado = 0.7;
                            ELSE
                                IF v_espR < 27 THEN
                                    SET v_velocidad = 380;
                                    SET v_pinchado = 0.94;
                                ELSE
                                    IF v_espR < 32 THEN SET v_velocidad = 350;
                                        SET v_pinchado = 0.95;
                                    END IF;
                                END IF;
                            END IF;
                        END IF;
                    END IF;
                END IF;
            END IF;
        END IF;
                                        
        IF v_medida1 < 600 THEN SET v_retirar = 0.5;
            ELSE
            IF v_medida1 < 1000 THEN SET v_retirar = 0.8; 
            ELSE
                IF v_medida1 < 1400 THEN SET v_retirar = 1;
                ELSE
                    IF v_medida1 < 2000 THEN SET v_retirar = 1.1;
                    ELSE
                        IF v_medida1 < 3000 THEN SET v_retirar = 1.5;
                        ELSE
                            SET v_retirar = 2;
                        END IF;
                    END IF;
                END IF;
            END IF;
        END IF;

        SET v_recortar = (v_perimR / v_velocidad) + v_pinchado;

        SET v_resultado = (v_Hora / (v_traer + v_Recortar + v_Retirar) * v_Coef);

        RETURN JSON_ARRAYAGG(JSON_OBJECT('Cant Piezas x hora', v_resultado));
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculo_PzHora_Pant_Casquete`(p_ftid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
		DECLARE v_ancho_chapa DECIMAL(10,3);
		DECLARE v_esp_chapa DECIMAL(10,3);
		DECLARE v_largo_chapa DECIMAL(10,3);
		DECLARE v_ancho_tabla INT;
		DECLARE v_etapa INT;
		DECLARE v_subetapa INT;
		DECLARE v_diam_disco DECIMAL(10,3);
		DECLARE v_peso_bruto DECIMAL(10,3);
		DECLARE v_texto_hp VARCHAR(100);
		DECLARE json_result JSON;
		DECLARE v_unid_x_art INT;
		DECLARE v_discos_x_chapa INT;
		DECLARE v_unidades DECIMAL(10,1);
		DECLARE v_unidades_char VARCHAR(10);
		DECLARE v_cant_piezas DECIMAL(10,5);
		DECLARE v_velocidad INT;
		DECLARE v_tiempo_pinchado DECIMAL(10,3);
		DECLARE v_panto INT;
		DECLARE v_perimetro DECIMAL(10,3);
		DECLARE v_tiempo_neto_corte DECIMAL(10,3);
		DECLARE v_tiempo_neto_pinchado DECIMAL(10,3);
		DECLARE v_tiempo_traslado_cortes DECIMAL(10,3);
		DECLARE v_tiempo_marcado DECIMAL(10,3);
		DECLARE v_probeta_soldada INT;
		DECLARE v_bisel INT;
		DECLARE v_cant_pinchados INT;
		DECLARE v_acomodar INT;
		DECLARE v_perimetro_probeta INT;
		DECLARE v_tiempo_corte_probeta DECIMAL(10,3);
		DECLARE v_tiempo_pinchado_probeta DECIMAL(10,3);
		DECLARE v_tiempo_total_probeta DECIMAL(10,3);
		DECLARE v_tiempo_corte_bisel DECIMAL(10,3);
		DECLARE v_tiempo_abastecer_chapa DECIMAL(10,3);
		DECLARE v_cant_recortes DECIMAL(10,3);
		DECLARE v_tiempo_recortado DECIMAL(10,3);
		DECLARE v_tiempo_posicionar DECIMAL(10,3);
		DECLARE v_tiempo_total_recortado DECIMAL(10,3);
		DECLARE v_retirar DECIMAL(10,3);
		DECLARE v_tiempo_total_retirar DECIMAL(10,3);
		DECLARE v_tiempo_recortes DECIMAL(10,3);
		DECLARE v_retirar_sobrantes DECIMAL(10,3);
		DECLARE v_coeficiente DECIMAL(10,3);
		DECLARE v_tiempo_total DECIMAL(10,3);
		DECLARE v_ciclos_diarios DECIMAL(10,3);
		DECLARE v_piezas_x_hora DECIMAL(10,3);
		--
		SELECT ar.diametro, ar.espesor / 1000, ar.largo, et.etapa, et.subetapa, ft.diametro / 1000, ft.peso_bruto,  ftp.unidad_x_art, 400 + maq.numero
		INTO v_ancho_chapa, v_esp_chapa, v_largo_chapa, v_etapa, v_subetapa, v_diam_disco, v_peso_bruto, v_unid_x_art, v_panto
		FROM fichas_tecnicas ft
		LEFT JOIN articulos ar ON ar.id = ft.articulo_id
		LEFT JOIN fichas_tecnicas_procesos ftp ON ft.id = ftp.ficha_tecnica_id
		LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
		LEFT JOIN fichas_tecnicas_maquinas ftm ON ftp.id = ftm.proceso_id
		LEFT JOIN maquinas_herramientas maq ON maq.id = ftm.maquina_id
		WHERE p_ftid = ft.id
		AND ftp. orden = 1
		AND maq.tipo_id = 4;
		--
   		SELECT COALESCE(CAST(JSON_EXTRACT(Calculo_PBCinicial(p_ftid), '$.UNIDADES') AS DECIMAL(10,1)), 0) FROM dual INTO v_unidades;
		--
		SET v_discos_x_chapa = IF(IFNULL( v_unidades, 0) > 0, v_unidades, ROUND((v_ancho_chapa / v_diam_disco),0) * ROUND( (v_largo_chapa / v_diam_disco),0));
		-- modificar
		--	SET v_panto = 430;
		-- modificar
		IF v_esp_chapa >= 75 THEN
			SET v_velocidad = 75;
			SET v_tiempo_pinchado = 2;
		ELSE
			IF v_esp_chapa < 75 THEN
				SET v_velocidad = IF(v_panto = 430, 100, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 1.5, 0);
			END IF;
			--
			IF v_esp_chapa < 52 THEN
				SET v_velocidad = IF(v_panto = 430, 150, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 1.13, 0);
			END IF;
			--
			IF v_esp_chapa < 45 THEN
				SET v_velocidad = IF(v_panto = 430, 175, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.95, 0);
			END IF;
			--
			IF v_esp_chapa < 39 THEN
				SET v_velocidad = IF(v_panto = 430, 200, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.93, 0);
			END IF;
			--
			IF v_esp_chapa < 32 THEN
				SET v_velocidad = IF(v_panto = 430, 212, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.76, 0);
			END IF;
			--
			IF v_esp_chapa < 26 THEN
				SET v_velocidad = IF(v_panto = 430, 225, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.76, 0);
			END IF;
			--
			IF v_esp_chapa < 23 THEN
				SET v_velocidad = IF(v_panto = 430, 237, 1300);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.58, 0.9);
			END IF;
			--
			IF v_esp_chapa < 20 THEN
				SET v_velocidad = IF(v_panto = 430, 250, 1500);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.58, 0.8);
			END IF;
			--
			IF v_esp_chapa < 16 THEN
				SET v_velocidad = IF(v_panto = 430, 262, 1800);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.58, 0.6);
			END IF;
			--
			IF v_esp_chapa < 13 THEN
				SET v_velocidad = IF(v_panto = 430, 275, 2400);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.41, 0.5);
			END IF;
			--
			IF v_esp_chapa < 10 THEN
				SET v_velocidad = IF(v_panto = 430, 287, 2900);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.4, 0.33);
			END IF;
			--
			IF v_esp_chapa < 8.5 THEN
				SET v_velocidad = IF(v_panto = 430, 262, 3200);
				SET v_tiempo_pinchado = IF(v_panto = 430,  0.33, 0.3);
			END IF;
			--
			IF v_esp_chapa < 5 THEN
				SET v_velocidad = IF(v_panto = 430, 262, 3500);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.33, 0.3);
			END IF;
		END IF;
		--
		SET v_perimetro = v_diam_disco * v_unidades * 3.1416;
		SET v_tiempo_neto_corte	= v_perimetro / v_velocidad;
		SET v_tiempo_neto_pinchado = v_discos_x_chapa * v_tiempo_pinchado;
		SET v_tiempo_traslado_cortes = v_diam_disco / IF(v_panto = 430,  1500, IF(v_velocidad > 1500, v_velocidad, 1500)) * v_discos_x_chapa;
     	SET v_tiempo_marcado = 0.5 * v_discos_x_chapa / 1.5;
     	SET v_probeta_soldada = SubCalculo_ProbetaSoldada(p_ftid);
     	--
     	IF v_probeta_soldada = 0 OR v_probeta_soldada IS null THEN 
			SET v_perimetro_probeta = 700;
			SET v_bisel = 0;
			SET v_cant_pinchados = 1;
			SET v_acomodar = 5;
		ELSE
			SET v_perimetro_probeta = 2000;
			SET v_bisel = 700;
			SET v_cant_pinchados = 2;
			SET v_acomodar = 10;
		END IF;
		--
		SET v_tiempo_corte_probeta= v_perimetro_probeta / v_velocidad;
		SET v_Tiempo_pinchado_probeta = v_tiempo_pinchado * v_cant_pinchados;
		SET v_tiempo_corte_bisel = IF(v_bisel = 0, v_bisel, v_bisel / v_velocidad);
		SET v_tiempo_total_probeta = v_tiempo_corte_probeta + v_tiempo_pinchado_probeta + v_tiempo_corte_bisel + v_acomodar;
		SET v_tiempo_abastecer_chapa = IF(v_ancho_chapa <= 1610, 12, 20);
		SET v_cant_recortes = IF(v_ancho_chapa <= 1610, 21, 56);
		SET v_tiempo_recortado =  30 * v_cant_recortes / v_velocidad;
		SET v_tiempo_posicionar = 0.3 * v_cant_recortes;
		SET v_tiempo_total_recortado = v_tiempo_recortado + v_tiempo_posicionar;
		--
		IF v_peso_bruto >= 201 THEN
			SET v_retirar = 1.8;
		ELSE
			IF v_peso_bruto < 200 THEN
				SET v_retirar = 1.4;
			END IF;
			--
			IF v_peso_bruto < 21 THEN
				SET v_retirar = 1.2;
			END IF;
			--
			IF v_peso_bruto < 11 THEN
				SET v_retirar = 0.5;
			END IF;
		END IF;
		--
		SET v_tiempo_total_retirar = v_retirar * v_discos_x_chapa;
		SET v_cant_recortes = IF(v_ancho_chapa <= 1610,	15, 32);
		SET v_tiempo_recortes = IF(v_esp_chapa > 25, 1.6, IF(v_esp_chapa < 16,1.1, 1.3));
		SET v_retirar_sobrantes = v_cant_recortes * v_tiempo_recortes;
		SET v_coeficiente =  IF(v_panto = 430, 	1.05, 1.3);
		SET v_tiempo_total = (v_tiempo_neto_corte  + v_tiempo_neto_pinchado + v_tiempo_traslado_cortes + v_tiempo_marcado
			+ v_tiempo_total_probeta + v_tiempo_abastecer_chapa + v_tiempo_total_recortado + v_tiempo_total_retirar + v_retirar_sobrantes) * v_coeficiente;
		SET v_ciclos_diarios = 450 / v_tiempo_total;
		SET v_piezas_x_hora = v_ciclos_diarios * v_discos_x_chapa / 8;
		--
		SELECT JSON_ARRAYAGG(JSON_OBJECT('Cant Piezas x hora', v_piezas_x_hora))
		INTO json_result 
		FROM DUAL;
		--
		RETURN json_result;
	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculo_PzHora_Pant_Plantilla`(p_ftid INT, p_familia VARCHAR(5)) RETURNS decimal(10,3)
BEGIN
		DECLARE v_medida1 DECIMAL(10,3);
		DECLARE v_medida2 DECIMAL(10,3);
		DECLARE v_ancho DECIMAL(10,3);
		DECLARE v_largo DECIMAL(10,3);
		DECLARE v_aprovecha_1 INT;
		DECLARE v_aprovecha_2 INT;
		DECLARE v_ancho_chapa DECIMAL(10,3);
		DECLARE v_esp_chapa DECIMAL(10,3);
		DECLARE v_largo_chapa DECIMAL(10,3);
		DECLARE v_ancho_tabla INT;
		DECLARE v_etapa INT;
		DECLARE v_subetapa INT;
		DECLARE v_diam_disco DECIMAL(10,3);
		DECLARE v_peso_bruto DECIMAL(10,3);
		DECLARE v_texto_hp VARCHAR(100);
		DECLARE json_result JSON;
		DECLARE v_unid_x_art INT;
		DECLARE v_rectangulos_x_chapa INT;
		DECLARE v_unidades DECIMAL(10,1);
		DECLARE v_unidades_char VARCHAR(10);
		DECLARE v_cant_piezas DECIMAL(10,5);
		DECLARE v_velocidad INT;
		DECLARE v_tiempo_pinchado DECIMAL(10,3);
		DECLARE v_panto INT;
		DECLARE v_perimetro DECIMAL(10,3);
		DECLARE v_perimetro_total DECIMAL(10,3);
		DECLARE v_tiempo_neto_corte DECIMAL(10,3);
		DECLARE v_tiempo_neto_pinchado DECIMAL(10,3);
		DECLARE v_tiempo_traslado_cortes DECIMAL(10,3);
		DECLARE v_tiempo_marcado DECIMAL(10,3);
		DECLARE v_probeta_soldada INT;
		DECLARE v_bisel INT;
		DECLARE v_cant_pinchados INT;
		DECLARE v_acomodar INT;
		DECLARE v_perimetro_probeta INT;
		DECLARE v_tiempo_corte_probeta DECIMAL(10,3);
		DECLARE v_tiempo_pinchado_probeta DECIMAL(10,3);
		DECLARE v_tiempo_total_probeta DECIMAL(10,3);
		DECLARE v_tiempo_corte_bisel DECIMAL(10,3);
		DECLARE v_tiempo_abastecer_chapa DECIMAL(10,3);
		DECLARE v_cant_recortes DECIMAL(10,3);
		DECLARE v_tiempo_recortado DECIMAL(10,3);
		DECLARE v_tiempo_posicionar DECIMAL(10,3);
		DECLARE v_tiempo_total_recortado DECIMAL(10,3);
		DECLARE v_retirar DECIMAL(10,3);
		DECLARE v_tiempo_total_retirar DECIMAL(10,3);
		DECLARE v_tiempo_recortes DECIMAL(10,3);
		DECLARE v_retirar_sobrantes DECIMAL(10,3);
		DECLARE v_coeficiente DECIMAL(10,3);
		DECLARE v_tiempo_total DECIMAL(10,3);
		DECLARE v_ciclos_diarios DECIMAL(10,3);
		DECLARE v_piezas_x_hora DECIMAL(10,3);
		DECLARE v_tiempo_pinchado_refuerzos DECIMAL(10,3);
		DECLARE v_tiempo_neto_puentes DECIMAL(10,3);
		DECLARE v_tiempo_total_pantografo DECIMAL(10,3);
		--
		SELECT pf.medida_1, pf.medida_2, ar.diametro, ar.espesor / 1000, ar.largo, et.etapa, et.subetapa, ft.ancho / 1000, ft.largo / 1000, ft.peso_bruto, ftp.unidad_x_art, 400 + maq.numero
		INTO v_medida1, v_medida2, v_ancho_chapa, v_esp_chapa, v_largo_chapa, v_etapa, v_subetapa, v_ancho, v_largo, v_peso_bruto, v_unid_x_art, v_panto
		FROM fichas_tecnicas ft
		LEFT JOIN articulos ar ON ar.id = ft.articulo_id
		LEFT JOIN fichas_tecnicas_procesos ftp ON ft.id = ftp.ficha_tecnica_id
		LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
		LEFT JOIN fichas_tecnicas_maquinas ftm ON ftp.id = ftm.proceso_id
		LEFT JOIN maquinas_herramientas maq ON maq.id = ftm.maquina_id
		LEFT JOIN productos_fabricados pf ON pf.id = ft.producto_fabricado_id
		WHERE p_ftid = ft.id
		AND ftp. orden = 1
		AND maq.tipo_id = 4;
		--
		IF p_familia IN ('REC', 'REE') THEN
			SELECT ap.ancho, ap.largo, ap.perimetro
			INTO v_ancho, v_largo, v_perimetro
			FROM aux_plantillas ap
			WHERE ap.familia = p_familia
			AND medida1 = v_medida1
			AND medida2 = v_medida2;
		ELSE
			SELECT ap.ancho, ap.largo, ap.perimetro
			INTO v_ancho, v_largo, v_perimetro
			FROM aux_plantillas ap
			WHERE ap.familia = p_familia
			AND medida1 = v_medida1;
		END IF;
		--
   		SELECT COALESCE(CAST(JSON_EXTRACT(Calculo_PBCinicial(p_ftid), '$.UNIDADES') AS DECIMAL(10,0)), 0) FROM dual INTO v_unidades;
		--
		SET v_aprovecha_1 = TRUNCATE(v_ancho_chapa / v_ancho,0) * TRUNCATE( v_largo_chapa / v_largo,0);
		SET v_aprovecha_2 = TRUNCATE(v_ancho_chapa / v_largo,0) * TRUNCATE( v_largo_chapa / v_ancho,0);
		SET v_rectangulos_x_chapa = IF(v_aprovecha_1 > v_aprovecha_2, v_aprovecha_1, v_aprovecha_2);
		SET v_rectangulos_x_chapa = IF(v_unidades > v_rectangulos_x_chapa , v_unidades, v_rectangulos_x_chapa);
		--
		IF v_esp_chapa >= 75 THEN
			SET v_velocidad = 75;
			SET v_tiempo_pinchado = 2;
		ELSE
			IF v_esp_chapa < 75 THEN
				SET v_velocidad = IF(v_panto = 430, 100, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 1.5, 0);
			END IF;
			--
			IF v_esp_chapa < 52 THEN
				SET v_velocidad = IF(v_panto = 430, 150, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 1.13, 0);
			END IF;
			--
			IF v_esp_chapa < 45 THEN
				SET v_velocidad = IF(v_panto = 430, 175, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.95, 0);
			END IF;
			--
			IF v_esp_chapa < 39 THEN
				SET v_velocidad = IF(v_panto = 430, 200, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.93, 0);
			END IF;
			--
			IF v_esp_chapa < 32 THEN
				SET v_velocidad = IF(v_panto = 430, 212, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.76, 0);
			END IF;
			--
			IF v_esp_chapa < 26 THEN
				SET v_velocidad = IF(v_panto = 430, 225, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.76, 0);
			END IF;
			--
			IF v_esp_chapa < 23 THEN
				SET v_velocidad = IF(v_panto = 430, 237, 1300);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.58, 0.9);
			END IF;
			--
			IF v_esp_chapa < 20 THEN
				SET v_velocidad = IF(v_panto = 430, 250, 1500);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.58, 0.8);
			END IF;
			--
			IF v_esp_chapa < 16 THEN
				SET v_velocidad = IF(v_panto = 430, 262, 1800);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.58, 0.6);
			END IF;
			--
			IF v_esp_chapa < 13 THEN
				SET v_velocidad = IF(v_panto = 430, 275, 2400);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.41, 0.5);
			END IF;
			--
			IF v_esp_chapa < 10 THEN
				SET v_velocidad = IF(v_panto = 430, 287, 2600);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.4, 0.33);
			END IF;
			--
			IF v_esp_chapa < 8.5 THEN
				SET v_velocidad = IF(v_panto = 430, 262, 3200);
				SET v_tiempo_pinchado = IF(v_panto = 430,  0.33, 0.3);
			END IF;
			--
			IF v_esp_chapa < 5 THEN
				SET v_velocidad = IF(v_panto = 430, 262, 3500);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.33, 0.3);
			END IF;
		END IF;
		--
		SET v_perimetro_total  = v_perimetro * v_rectangulos_x_chapa;
		SET v_tiempo_neto_corte	= v_perimetro_total / v_velocidad;
		SET v_tiempo_neto_pinchado = v_rectangulos_x_chapa * v_tiempo_pinchado / 3;
		SET v_tiempo_pinchado_refuerzos = 0;
		SET v_tiempo_traslado_cortes = v_largo_chapa / IF(v_panto	= 430,  1500,  IF(v_velocidad > 1500, v_velocidad, 1500));
		-- 		Tiempo neto de Puentes				long. Puente / Velocidad x Cant. de puentes		
		SET v_tiempo_neto_puentes = 80 / v_velocidad * (v_rectangulos_x_chapa - 1);
	  	SET v_tiempo_marcado = 0.5 * v_rectangulos_x_chapa / 1.5;
	  	SET v_tiempo_total_pantografo = v_tiempo_neto_corte + v_tiempo_neto_pinchado + v_tiempo_pinchado_refuerzos + v_tiempo_traslado_cortes + v_tiempo_neto_puentes + v_tiempo_marcado;
		SET v_probeta_soldada = SubCalculo_ProbetaSoldada(p_ftid);
     	--
     	IF v_probeta_soldada = 0 OR v_probeta_soldada IS NULL THEN 
			SET v_perimetro_probeta = 700;
			SET v_bisel = 0;
			SET v_cant_pinchados = 1;
			SET v_acomodar = 5;
		ELSE
			SET v_perimetro_probeta = 2000;
			SET v_bisel = 700;
			SET v_cant_pinchados = 2;
			SET v_acomodar = 10;
		END IF;
		--
		SET v_tiempo_corte_probeta= v_perimetro_probeta / v_velocidad;
		SET v_Tiempo_pinchado_probeta	 = v_tiempo_pinchado * v_cant_pinchados;
		SET v_tiempo_corte_bisel = IF(v_bisel = 0, v_bisel, v_bisel / v_velocidad);
		SET v_tiempo_total_probeta = v_tiempo_corte_probeta + v_tiempo_pinchado_probeta + v_tiempo_corte_bisel + v_acomodar;
		SET v_tiempo_abastecer_chapa = IF(v_ancho_chapa <= 1610, 12, 20);
		SET v_cant_recortes = IF(v_ancho_chapa <= 1610, 21, 56);
		SET v_tiempo_recortado =  30 * v_cant_recortes / v_velocidad;
		SET v_tiempo_posicionar = 0.3 * v_cant_recortes;
		SET v_tiempo_total_recortado = v_tiempo_recortado + v_tiempo_posicionar;
		--
		IF v_peso_bruto >= 201 THEN
			SET v_retirar = 1.8;
		ELSE
			IF v_peso_bruto < 200 THEN
				SET v_retirar = 1.4;
			END IF;
			--
			IF v_peso_bruto < 21 THEN
				SET v_retirar = 1.2;
			END IF;
			--
			IF v_peso_bruto < 11 THEN
				SET v_retirar = 0.5;
			END IF;
		END IF;
		--
		SET v_tiempo_total_retirar = v_retirar * v_rectangulos_x_chapa;
		SET v_cant_recortes = IF(v_ancho_chapa <= 1610,	15, 32);
		SET v_tiempo_recortes = IF(v_esp_chapa > 25, 1.6, IF(v_esp_chapa < 16,1.1, 1.3));
		SET v_retirar_sobrantes = v_cant_recortes * v_tiempo_recortes;
		-- hasta acá
		SET v_coeficiente = IF(v_panto = 430, 1.05, 1.3);
		SET v_tiempo_total = (v_tiempo_total_pantografo + v_tiempo_total_probeta + v_tiempo_abastecer_chapa + v_tiempo_total_recortado + v_tiempo_total_retirar + v_retirar_sobrantes) * v_coeficiente;
		SET v_ciclos_diarios = 450 / v_tiempo_total;
		SET v_piezas_x_hora = v_ciclos_diarios * v_unidades / 8;
		--
		SELECT JSON_ARRAYAGG(JSON_OBJECT('Cant Piezas x hora', v_piezas_x_hora))
		INTO json_result
		FROM DUAL;
		--
		RETURN json_result;
	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculo_PzHora_Pant_Refuerzo`(p_ftid INT) RETURNS decimal(10,3)
BEGIN
		DECLARE v_ancho_chapa DECIMAL(10,3);
		DECLARE v_esp_chapa DECIMAL(10,3);
		DECLARE v_largo_chapa DECIMAL(10,3);
		DECLARE v_ancho_tabla INT;
		DECLARE v_etapa INT;
		DECLARE v_subetapa INT;
		DECLARE v_diam_disco DECIMAL(10,3);
		DECLARE v_peso_bruto DECIMAL(10,3);
		DECLARE v_texto_hp VARCHAR(100);
		DECLARE json_result JSON;
		DECLARE v_unid_x_art INT;
		DECLARE v_discos_x_chapa INT;
		DECLARE v_unidades DECIMAL(10,1);
		DECLARE v_unidades_char VARCHAR(10);
		DECLARE v_cant_piezas DECIMAL(10,5);
		DECLARE v_velocidad INT;
		DECLARE v_tiempo_pinchado DECIMAL(10,3);
		DECLARE v_panto INT;
		DECLARE v_perimetro DECIMAL(10,3);
		DECLARE v_tiempo_neto_corte DECIMAL(10,3);
		DECLARE v_tiempo_neto_pinchado DECIMAL(10,3);
		DECLARE v_tiempo_traslado_cortes DECIMAL(10,3);
		DECLARE v_tiempo_marcado DECIMAL(10,3);
		DECLARE v_probeta_soldada INT;
		DECLARE v_bisel INT;
		DECLARE v_cant_pinchados INT;
		DECLARE v_acomodar INT;
		DECLARE v_perimetro_probeta INT;
		DECLARE v_tiempo_corte_probeta DECIMAL(10,3);
		DECLARE v_tiempo_pinchado_probeta DECIMAL(10,3);
		DECLARE v_tiempo_total_probeta DECIMAL(10,3);
		DECLARE v_tiempo_corte_bisel DECIMAL(10,3);
		DECLARE v_tiempo_abastecer_chapa DECIMAL(10,3);
		DECLARE v_cant_recortes DECIMAL(10,3);
		DECLARE v_tiempo_recortado DECIMAL(10,3);
		DECLARE v_tiempo_posicionar DECIMAL(10,3);
		DECLARE v_tiempo_total_recortado DECIMAL(10,3);
		DECLARE v_retirar DECIMAL(10,3);
		DECLARE v_tiempo_total_retirar DECIMAL(10,3);
		DECLARE v_tiempo_recortes DECIMAL(10,3);
		DECLARE v_retirar_sobrantes DECIMAL(10,3);
		DECLARE v_coeficiente DECIMAL(10,3);
		DECLARE v_tiempo_total DECIMAL(10,3);
		DECLARE v_ciclos_diarios DECIMAL(10,3);
		DECLARE v_piezas_x_hora DECIMAL(10,3);
		DECLARE v_tiempo_pinchado_refuerzos DECIMAL(10,3);
		--
		SELECT ar.diametro, ar.espesor / 1000, ar.largo, et.etapa, et.subetapa, ft.diametro / 1000, ft.peso_bruto,  ftp.unidad_x_art, 400 + maq.numero
		INTO v_ancho_chapa, v_esp_chapa, v_largo_chapa, v_etapa, v_subetapa, v_diam_disco, v_peso_bruto, v_unid_x_art, v_panto
		FROM fichas_tecnicas ft
		LEFT JOIN articulos ar ON ar.id = ft.articulo_id
		LEFT JOIN fichas_tecnicas_procesos ftp ON ft.id = ftp.ficha_tecnica_id
		LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
		LEFT JOIN fichas_tecnicas_maquinas ftm ON ftp.id = ftm.proceso_id
		LEFT JOIN maquinas_herramientas maq ON maq.id = ftm.maquina_id
		WHERE p_ftid = ft.id
		AND ftp. orden = 1
		AND maq.tipo_id = 4;
		--
	   	SELECT COALESCE(CAST(JSON_EXTRACT(Calculo_PBCinicial(p_ftid), '$.UNIDADES') AS DECIMAL(10,1)), 0) FROM dual INTO v_unidades;
		--
		SET v_discos_x_chapa = IF(IFNULL(v_unidades, 0) > 0, v_unidades, ROUND((v_ancho_chapa / v_diam_disco),0) * ROUND( (v_largo_chapa / v_diam_disco),0));
		-- modificar
		--	SET v_panto = 430;
		-- modificar
		IF v_esp_chapa >= 75 THEN
			SET v_velocidad = 75;
			SET v_tiempo_pinchado = 2;
		ELSE
			IF v_esp_chapa < 75 THEN
				SET v_velocidad = IF(v_panto = 430, 100, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 1.5, 0);
			END IF;
			--
			IF v_esp_chapa < 52 THEN
				SET v_velocidad = IF(v_panto = 430, 150, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 1.13, 0);
			END IF;
			--
			IF v_esp_chapa < 45 THEN
				SET v_velocidad = IF(v_panto = 430, 175, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.95, 0);
			END IF;
			--
			IF v_esp_chapa < 39 THEN
				SET v_velocidad = IF(v_panto = 430, 200, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.93, 0);
			END IF;
			--
			IF v_esp_chapa < 32 THEN
				SET v_velocidad = IF(v_panto = 430, 212, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.76, 0);
			END IF;
			--
			IF v_esp_chapa < 26 THEN
				SET v_velocidad = IF(v_panto = 430, 225, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.76, 0);
			END IF;
			--
			IF v_esp_chapa < 23 THEN
				SET v_velocidad = IF(v_panto = 430, 237, 1300);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.58, 0.9);
			END IF;
			--
			IF v_esp_chapa < 20 THEN
				SET v_velocidad = IF(v_panto = 430, 250, 1500);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.58, 0.8);
			END IF;
			--
			IF v_esp_chapa < 16 THEN
				SET v_velocidad = IF(v_panto = 430, 262, 1800);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.58, 0.6);
			END IF;
			--
			IF v_esp_chapa < 13 THEN
				SET v_velocidad = IF(v_panto = 430, 275, 2400);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.41, 0.5);
			END IF;
			--
			IF v_esp_chapa < 10 THEN
				SET v_velocidad = IF(v_panto = 430, 287, 2600);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.4, 0.33);
			END IF;
			--
			IF v_esp_chapa < 8.5 THEN
				SET v_velocidad = IF(v_panto = 430, 262, 3200);
				SET v_tiempo_pinchado = IF(v_panto = 430,  0.33, 0.3);
			END IF;
			--
			IF v_esp_chapa < 5 THEN
				SET v_velocidad = IF(v_panto = 430, 262, 3500);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.33, 0.3);
			END IF;
		END IF;
		-- Coeficiente aguj. Int.		Ødisco <	180	1,3 		Ødisco >/=	180	1,5
		SET v_perimetro = v_diam_disco * v_discos_x_chapa * 3.1416 * IF(v_diam_disco < 180, 1.3, 1.5);
		SET v_tiempo_neto_corte	= v_perimetro / v_velocidad;
		SET v_tiempo_neto_pinchado = v_discos_x_chapa * v_tiempo_pinchado;
		SET v_tiempo_pinchado_refuerzos  = v_discos_x_chapa * v_tiempo_pinchado; -- así está en la definición / consultar con Luis (parece raro)
		SET v_tiempo_traslado_cortes = v_diam_disco / IF(v_panto	= 430,  1500, IF(v_velocidad > 1500, v_velocidad, 1500)) * v_discos_x_chapa;
		-- SET v_tiempo_traslado_cortes = IF(v_panto	= 430,  1500, IF(v_velocidad > 1500, v_velocidad, 1500));
     	SET v_tiempo_marcado = 0.5 * v_discos_x_chapa / 1.5;
     	SET v_probeta_soldada = SubCalculo_ProbetaSoldada(p_ftid);
     	--
     	IF v_probeta_soldada = 0 OR v_probeta_soldada IS NULL THEN
			SET v_perimetro_probeta = 700;
			SET v_bisel = 0;
			SET v_cant_pinchados = 1;
			SET v_acomodar = 5;
		ELSE
			SET v_perimetro_probeta = 2000;
			SET v_bisel = 700;
			SET v_cant_pinchados = 2;
			SET v_acomodar = 10;
		END IF;
		--
		SET v_tiempo_corte_probeta= v_perimetro_probeta / v_velocidad;
		SET v_Tiempo_pinchado_probeta = v_tiempo_pinchado * v_cant_pinchados;
		SET v_tiempo_corte_bisel = IF(v_bisel = 0, v_bisel, v_bisel / v_velocidad);
		SET v_tiempo_total_probeta = v_tiempo_corte_probeta + v_tiempo_pinchado_probeta + v_tiempo_corte_bisel + v_acomodar;
		SET v_tiempo_abastecer_chapa = IF(v_ancho_chapa <= 1610, 12, 20);
		SET v_cant_recortes = IF(v_ancho_chapa <= 1610, 21, 56);
		SET v_tiempo_recortado =  30 * v_cant_recortes / v_velocidad;
		SET v_tiempo_posicionar = 0.3 * v_cant_recortes;
		SET v_tiempo_total_recortado = v_tiempo_recortado + v_tiempo_posicionar;
		--
		IF v_peso_bruto >= 201 THEN 
			SET v_retirar = 1.8;
		ELSE
			IF v_peso_bruto < 200 THEN
				SET v_retirar = 1.4;
			END IF;
			IF v_peso_bruto < 21 THEN
				SET v_retirar = 1.2;
			END IF;
			IF v_peso_bruto < 11 THEN
				SET v_retirar = 0.5;
			END IF;
		END IF;
		--
		SET v_tiempo_total_retirar = v_retirar * v_discos_x_chapa;
		SET v_cant_recortes = IF(v_ancho_chapa <= 1610,	15, 32);
		SET v_tiempo_recortes = IF(v_esp_chapa > 25, 1.6, IF(v_esp_chapa < 16,1.1, 1.3));
		SET v_retirar_sobrantes = v_cant_recortes * v_tiempo_recortes;
		SET v_coeficiente =  IF(v_panto = 430, 	1.05, 1.3);
		SET v_tiempo_total = (v_tiempo_neto_corte + v_tiempo_neto_pinchado + v_tiempo_pinchado_refuerzos + v_tiempo_traslado_cortes + v_tiempo_marcado
			+ v_tiempo_total_probeta + v_tiempo_abastecer_chapa + v_tiempo_total_recortado + v_tiempo_total_retirar + v_retirar_sobrantes) * v_coeficiente;
		SET v_ciclos_diarios = 450 / v_tiempo_total;
		SET v_piezas_x_hora = v_ciclos_diarios * v_discos_x_chapa / 8;
		--
		SELECT JSON_ARRAYAGG(JSON_OBJECT('Cant Piezas x hora', v_piezas_x_hora))
		INTO json_result
		FROM DUAL;
		--
		RETURN json_result;
	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculo_PzHora_Pant_TE`(p_ftid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
		DECLARE v_ancho DECIMAL(10,3);
		DECLARE v_largo DECIMAL(10,3);
		DECLARE v_aprovecha_1 INT;
		DECLARE v_aprovecha_2 INT;
		DECLARE v_ancho_chapa DECIMAL(10,3);
		DECLARE v_esp_chapa DECIMAL(10,3);
		DECLARE v_largo_chapa DECIMAL(10,3);
		DECLARE v_ancho_tabla INT;
		DECLARE v_etapa INT;
		DECLARE v_subetapa INT;
		DECLARE v_diam_disco DECIMAL(10,3);
		DECLARE v_peso_bruto DECIMAL(10,3);
		DECLARE v_texto_hp VARCHAR(100);
		DECLARE json_result JSON;
		DECLARE v_unid_x_art INT;
		DECLARE v_rectangulos_x_chapa INT;
		DECLARE v_unidades DECIMAL(10,1);
		DECLARE v_unidades_char VARCHAR(10);
		DECLARE v_cant_piezas DECIMAL(10,5);
		DECLARE v_velocidad INT;
		DECLARE v_tiempo_pinchado DECIMAL(10,3);
		DECLARE v_panto INT;
		DECLARE v_perimetro DECIMAL(10,3);
		DECLARE v_tiempo_neto_corte DECIMAL(10,3);
		DECLARE v_tiempo_neto_pinchado DECIMAL(10,3);
		DECLARE v_tiempo_traslado_cortes DECIMAL(10,3);
		DECLARE v_tiempo_marcado DECIMAL(10,3);
		DECLARE v_probeta_soldada INT;
		DECLARE v_bisel INT;
		DECLARE v_cant_pinchados INT;
		DECLARE v_acomodar INT;
		DECLARE v_perimetro_probeta INT;
		DECLARE v_tiempo_corte_probeta DECIMAL(10,3);
		DECLARE v_tiempo_pinchado_probeta DECIMAL(10,3);
		DECLARE v_tiempo_total_probeta DECIMAL(10,3);
		DECLARE v_tiempo_corte_bisel DECIMAL(10,3);
		DECLARE v_tiempo_abastecer_chapa DECIMAL(10,3);
		DECLARE v_cant_recortes DECIMAL(10,3);
		DECLARE v_tiempo_recortado DECIMAL(10,3);
		DECLARE v_tiempo_posicionar DECIMAL(10,3);
		DECLARE v_tiempo_total_recortado DECIMAL(10,3);
		DECLARE v_retirar DECIMAL(10,3);
		DECLARE v_tiempo_total_retirar DECIMAL(10,3);
		DECLARE v_tiempo_recortes DECIMAL(10,3);
		DECLARE v_retirar_sobrantes DECIMAL(10,3);
		DECLARE v_coeficiente DECIMAL(10,3);
		DECLARE v_tiempo_total DECIMAL(10,3);
		DECLARE v_ciclos_diarios DECIMAL(10,3);
		DECLARE v_piezas_x_hora DECIMAL(10,3);
		DECLARE v_tiempo_pinchado_refuerzos DECIMAL(10,3);
		DECLARE v_tiempo_neto_puentes DECIMAL(10,3);
		DECLARE v_tiempo_total_pantografo DECIMAL(10,3);
		-- acá cambie ancho y largo estaban divididos por mil
		SELECT ar.diametro, ar.espesor / 1000, ar.largo, et.etapa, et.subetapa, ft.ancho , ft.largo , peso_bruto,  ftp.unidad_x_art, 400 + maq.numero
		INTO v_ancho_chapa, v_esp_chapa, v_largo_chapa, v_etapa, v_subetapa, v_ancho, v_largo, v_peso_bruto, v_unid_x_art, v_panto
		FROM fichas_tecnicas ft
		LEFT JOIN articulos ar ON ar.id = ft.articulo_id
		LEFT JOIN fichas_tecnicas_procesos ftp ON ft.id = ftp.ficha_tecnica_id
		LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
		LEFT JOIN fichas_tecnicas_maquinas ftm ON ftp.id = ftm.proceso_id
		LEFT JOIN maquinas_herramientas maq ON maq.id = ftm.maquina_id
		WHERE p_ftid = ft.id
		AND ftp. orden = 1
		AND maq.tipo_id = 4;
		--
   		SELECT COALESCE(CAST(JSON_EXTRACT(Calculo_PBCinicial(p_ftid), '$.UNIDADES') AS DECIMAL(10,1)), 0) FROM dual INTO v_unidades;
		--
		SET v_aprovecha_1 = TRUNCATE(v_ancho_chapa / v_ancho,0) * TRUNCATE( v_largo_chapa / v_largo,0);
		SET v_aprovecha_2 = TRUNCATE(v_ancho_chapa / v_largo,0) * TRUNCATE( v_largo_chapa / v_ancho,0);
		SET v_rectangulos_x_chapa = IF(v_aprovecha_1 > v_aprovecha_2, v_aprovecha_1, v_aprovecha_2);
		SET v_rectangulos_x_chapa = IF(v_unidades > v_rectangulos_x_chapa, v_unidades, v_rectangulos_x_chapa);
		--
		IF v_esp_chapa >= 75 THEN
			SET v_velocidad = 75;
			SET v_tiempo_pinchado = 2;
		ELSE
			IF v_esp_chapa < 75 THEN
				SET v_velocidad = IF(v_panto = 430, 100, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 1.5, 0);
			END IF;
			--
			IF v_esp_chapa < 52 THEN
				SET v_velocidad = IF(v_panto = 430, 150, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 1.13, 0);
			END IF;
			--
			IF v_esp_chapa < 45 THEN
				SET v_velocidad = IF(v_panto = 430, 175, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.95, 0);
			END IF;
			--
			IF v_esp_chapa < 39 THEN
				SET v_velocidad = IF(v_panto = 430, 200, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.93, 0);
			END IF;
			--
			IF v_esp_chapa < 32 THEN
				SET v_velocidad = IF(v_panto = 430, 212, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.76, 0);
			END IF;
			--
			IF v_esp_chapa < 26 THEN
				SET v_velocidad = IF(v_panto = 430, 225, 0);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.76, 0);
			END IF;
			--
			IF v_esp_chapa < 23 THEN
				SET v_velocidad = IF(v_panto = 430, 237, 1300);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.58, 0.9);
			END IF;
			--
			IF v_esp_chapa < 20 THEN
				SET v_velocidad = IF(v_panto = 430, 250, 1500);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.58, 0.8);
			END IF;
			--
			IF v_esp_chapa < 16 THEN
				SET v_velocidad = IF(v_panto = 430, 262, 1800);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.58, 0.6);
			END IF;
			--
			IF v_esp_chapa < 13 THEN
				SET v_velocidad = IF(v_panto = 430, 275, 2400);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.41, 0.5);
			END IF;
			--
			IF v_esp_chapa < 10 THEN
				SET v_velocidad = IF(v_panto = 430, 287, 2600);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.4, 0.33);
			END IF;
			--
			IF v_esp_chapa < 8.5 THEN
				SET v_velocidad = IF(v_panto = 430, 262, 3200);
				SET v_tiempo_pinchado = IF(v_panto = 430,  0.33, 0.3);
			END IF;
			--
			IF v_esp_chapa < 5 THEN
				SET v_velocidad = IF(v_panto = 430, 262, 3500);
				SET v_tiempo_pinchado = IF(v_panto = 430, 0.33, 0.3);
			END IF;
		END IF;
		--
		DELETE FROM aux_log;
		INSERT INTO aux_log VALUES
			('recta x chapa', v_rectangulos_x_chapa),
			('v_tiempo_pinchado', v_tiempo_pinchado);
		--
		SET v_perimetro = (v_largo * 2 + v_ancho * 2) * IF(v_panto = 430,1,1.3);
		SET v_tiempo_neto_corte	= v_perimetro / v_velocidad;
		SET v_tiempo_neto_pinchado = v_rectangulos_x_chapa * v_tiempo_pinchado / 3;
		SET v_tiempo_pinchado_refuerzos = v_rectangulos_x_chapa * v_tiempo_pinchado;
		SET v_tiempo_traslado_cortes = v_largo_chapa / IF(v_panto = 430, 1500, IF(v_velocidad > 1500, v_velocidad, 1500));
		-- 		Tiempo neto de Puentes				long. Puente / Velocidad x Cant. de puentes
		SET v_tiempo_neto_puentes = 80 / v_velocidad * (v_rectangulos_x_chapa - 1);
	  	SET v_tiempo_marcado = 0.5 * v_rectangulos_x_chapa / 1.5;
	  	SET v_tiempo_total_pantografo = v_tiempo_neto_corte + v_tiempo_neto_pinchado + v_tiempo_pinchado_refuerzos + v_tiempo_traslado_cortes + v_tiempo_neto_puentes + v_tiempo_marcado;
		SET v_probeta_soldada = SubCalculo_ProbetaSoldada(p_ftid);
     	--
     	IF v_probeta_soldada = 0 OR v_probeta_soldada IS NULL THEN 
			SET v_perimetro_probeta = 700;
			SET v_bisel = 0;
			SET v_cant_pinchados = 1;
			SET v_acomodar = 5;
		ELSE
			SET v_perimetro_probeta = 2000;
			SET v_bisel = 700;
			SET v_cant_pinchados = 2;
			SET v_acomodar = 10;
		END IF;
		--
		SET v_tiempo_corte_probeta= v_perimetro_probeta / v_velocidad;
		SET v_Tiempo_pinchado_probeta = v_tiempo_pinchado * v_cant_pinchados;
		SET v_tiempo_corte_bisel = IF(v_bisel = 0, v_bisel, v_bisel / v_velocidad);
		SET v_tiempo_total_probeta = v_tiempo_corte_probeta + v_tiempo_pinchado_probeta + v_tiempo_corte_bisel + v_acomodar;
		SET v_tiempo_abastecer_chapa = IF(v_ancho_chapa <= 1610, 12, 20);
		SET v_cant_recortes = IF(v_ancho_chapa <= 1610, 21, 56);
		SET v_tiempo_recortado = 30 * v_cant_recortes / v_velocidad;
		SET v_tiempo_posicionar = 0.3 * v_cant_recortes;
		SET v_tiempo_total_recortado = v_tiempo_recortado + v_tiempo_posicionar;
		--
		IF v_peso_bruto >= 201 THEN
			SET v_retirar = 1.8;
		ELSE
			IF v_peso_bruto < 200 THEN
				SET v_retirar = 1.4;
			END IF;
			IF v_peso_bruto < 21 THEN
				SET v_retirar = 1.2;
			END IF;
			IF v_peso_bruto < 11 THEN
				SET v_retirar = 0.5;
			END IF;
		END IF;
		--
		SET v_tiempo_total_retirar = v_retirar * v_rectangulos_x_chapa;
		SET v_cant_recortes = IF(v_ancho_chapa <= 1610,	15, 32);
		SET v_tiempo_recortes = IF(v_esp_chapa > 25, 1.6, IF(v_esp_chapa < 16,1.1, 1.3));
		SET v_retirar_sobrantes = v_cant_recortes * v_tiempo_recortes;
		SET v_coeficiente =  IF(v_panto = 430, 	1.05, 1.3);
		SET v_tiempo_total = (v_tiempo_total_pantografo + v_tiempo_total_probeta + v_tiempo_abastecer_chapa + v_tiempo_total_recortado + v_tiempo_total_retirar + v_retirar_sobrantes) * v_coeficiente;
		SET v_ciclos_diarios = 450 / v_tiempo_total;
		SET v_piezas_x_hora = v_ciclos_diarios * v_unidades / 8;
		--
		SELECT JSON_ARRAYAGG(JSON_OBJECT('Cant Piezas x hora', v_piezas_x_hora))
		INTO json_result
		FROM DUAL;
		--
		RETURN json_result;
	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculo_PzHora_Sierra_Dano420`(p_ftid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
		DECLARE v_diam_tubo DOUBLE;
		DECLARE v_esp_tubo DOUBLE;
		DECLARE v_calidad_tubo INT;
		DECLARE v_largo_tubo DOUBLE;
		DECLARE v_ancho_tabla INT;
		DECLARE v_alto_tabla INT;
		DECLARE v_lote_calc DOUBLE;
		DECLARE v_velocidad_corte INT;
		DECLARE v_autocontrol INT;
		DECLARE v_avanzar DOUBLE;
		DECLARE v_ancho_sierra DOUBLE;
		DECLARE v_largo_neto DOUBLE;
		DECLARE v_largo_corte DOUBLE;
		DECLARE v_altC DOUBLE;
		DECLARE v_cortes_x_tubo INT;
		DECLARE v_circ1 DOUBLE;
		DECLARE v_circ2 DOUBLE;
		DECLARE v_paquete INT;
		DECLARE v_area_tubo DOUBLE;
		DECLARE v_area_cortar DOUBLE;
		DECLARE v_tubos_x_lote INT;
		DECLARE v_ancho_paquete INT;
		DECLARE v_alto_paquete INT;
		DECLARE v_sobrante DOUBLE;
		DECLARE v_mov_largo INT;
		DECLARE v_mov_corto INT;
		DECLARE v_altura_subir DOUBLE;
		DECLARE v_vel_subir DOUBLE;
		DECLARE v_subir_hoja DOUBLE;
		DECLARE v_avanzar_paq DOUBLE;
		DECLARE v_retroceder_carro DOUBLE;
		DECLARE v_abrir_paquete DOUBLE;
		DECLARE v_retroceder_carro_post DOUBLE;
		DECLARE v_bajar_sierra DOUBLE;
		DECLARE v_movimientos DOUBLE;
		DECLARE v_tiempo_corte DOUBLE;
		DECLARE v_coef_auto DOUBLE;
		DECLARE v_tiempo_corte_paquete DOUBLE;
		DECLARE v_tau DOUBLE;
		DECLARE v_autom_pz DOUBLE;
		DECLARE v_cortes_tubo INT;
		DECLARE v_pz_paquete INT;
		DECLARE v_dato3_autocontrol DOUBLE;	
		DECLARE v_dato3_acomodar DOUBLE;
		DECLARE v_dato3_soluble DOUBLE;
		DECLARE v_dato3_arrojar_descarte DOUBLE;
		DECLARE v_dato3_llenar_tarjeta DOUBLE;
		DECLARE v_T1 DOUBLE;
		DECLARE v_dato2 INT;
		DECLARE v_T2 DOUBLE;
		DECLARE v_prep_maq_1 DOUBLE;
		DECLARE v_despunte_paq  DOUBLE;
		DECLARE v_ingresar_paq DOUBLE;
		DECLARE v_ultimo_corte DOUBLE;
		DECLARE v_cambio_sierra DOUBLE;
		DECLARE v_T3 DOUBLE;
		DECLARE v_dif_pz DOUBLE;
		DECLARE v_tiempo_corte_paq DOUBLE;
		DECLARE v_tiempo_corte_pz DOUBLE;
		DECLARE v_M1 INT;
		DECLARE v_manual INT;
		DECLARE v_cant_cortes_hora DOUBLE;
		DECLARE v_cant_piezas_hora DOUBLE;
		DECLARE v_lote_economico INT;
		DECLARE v_texto_hp VARCHAR(100);
		DECLARE json_result JSON;

		SET v_avanzar = 440;
		SET v_ancho_sierra = 2;
		SET v_altC = 95;

		SELECT ar.diametro / 1000, ar.espesor / 1000, ar.calidad_id, ft.tubo_largo_n1, ft.lote_economico
		INTO v_diam_tubo, v_esp_tubo, v_calidad_tubo, v_largo_neto, v_lote_economico
		FROM fichas_tecnicas ft
		LEFT JOIN articulos ar ON ar.id = ft.articulo_id
		WHERE p_ftid = ft.id;

		SELECT ts.ancho_dano420, ts.alto_dano420, ts.largo_tubo * 1000, ts.lote_calculado
		INTO v_ancho_tabla, v_alto_tabla, v_largo_tubo, v_lote_calc
		FROM tabla_sierras ts 
		WHERE ts.diametro = v_diam_tubo
		AND ts.espesor = v_esp_tubo;

		IF v_diam_tubo < 115 THEN 
			SET v_velocidad_corte = 3000;
		ELSE 
			SET v_velocidad_corte = 6000;
		END IF;

		IF v_diam_tubo < 50 THEN
			SET v_autocontrol = 6;
		ELSE
			IF v_diam_tubo < 65 THEN
				SET v_autocontrol = 5;
			ELSE
				IF v_diam_tubo < 115 THEN
						SET v_autocontrol = 4;
				ELSE
					SET v_autocontrol = 3;
				END IF;
			END IF;
		END IF;

		IF v_calidad_tubo NOT IN (18,19)  THEN
			SET v_lote_calc = v_lote_economico;
		END IF;

		SET v_largo_corte = v_largo_neto + v_ancho_sierra;

		SET v_cortes_x_tubo = TRUNCATE(v_largo_tubo / v_largo_corte, 0);

		SET v_tubos_x_lote = CEILING(v_lote_calc / v_cortes_x_tubo);

		SET v_paquete = SubCalculo_SierraPaquete(v_ancho_tabla, v_alto_tabla, v_tubos_x_lote, v_altC, v_diam_tubo);

		SELECT tp.ancho, tp.alto
		INTO v_ancho_paquete, v_alto_paquete
		FROM tabla_calculo_paquete tp
		WHERE tp.numero = v_paquete; 

		SET v_circ1 = (v_diam_tubo / 2)*(v_diam_tubo / 2) * 3.1416;
		SET v_circ2 = ((v_diam_tubo - v_esp_tubo * 2) / 2) * ((v_diam_tubo - v_esp_tubo * 2) / 2) * 3.1416;

		SET v_area_tubo =  v_circ1 - v_circ2;
		SET v_area_cortar = v_area_tubo * v_ancho_paquete * v_alto_paquete;

		SET v_largo_corte = v_largo_neto + v_ancho_sierra;
		SET v_mov_largo = TRUNCATE(v_largo_corte / v_avanzar, 0);
		SET v_sobrante = v_largo_corte  - (v_avanzar * v_mov_largo);

		IF v_sobrante > 0 THEN 
			SET v_mov_corto = 1;
		ELSE
			SET v_mov_corto = 0;
		END IF;

		SET v_altura_subir = (v_diam_tubo * v_alto_paquete) + 15;
		SET v_vel_subir = 2300;
		SET v_subir_hoja = v_altura_subir / v_vel_subir;

		SET v_avanzar_paq = 0.186 * v_mov_largo;
		SET v_retroceder_carro = 0.225 * v_mov_largo;
		SET v_abrir_paquete = v_sobrante / 2360;
		SET v_retroceder_carro_post = 0;
		SET v_bajar_sierra = 0.207;
		SET v_movimientos = v_subir_hoja + v_avanzar_paq + v_retroceder_carro + v_abrir_paquete + v_retroceder_carro_post + v_bajar_sierra;

		SET v_tiempo_corte = v_area_cortar / v_velocidad_corte;		

		SELECT COUNT(*)
		INTO v_coef_auto
		FROM fichas_tecnicas_procesos ftp
		LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
		WHERE p_ftid = ftp.ficha_tecnica_id
		AND et.etapa = 2;

		IF v_coef_auto > 0 THEN
			SET v_coef_auto = 1.2;
		ELSE 
			SET v_coef_auto = 1;
		END IF;

		SET v_tiempo_corte_paquete = v_tiempo_corte * v_coef_auto;
		SET v_tau = ( v_tiempo_corte_paquete +  v_movimientos);	

		SET v_autom_pz = v_tau / (v_ancho_paquete * v_alto_paquete) ;
		SET v_pz_paquete = v_cortes_x_tubo * (v_ancho_paquete * v_alto_paquete);

		SET v_dato3_autocontrol = 0.71	*  V_autocontrol / (60 /v_autom_pz);	
		SET v_dato3_acomodar =	0.327 / (v_ancho_paquete * v_alto_paquete) ;
		SET v_dato3_soluble =  5.92 /	(60 / v_autom_pz * 8.5);
		SET v_dato3_arrojar_descarte =	2 / v_pz_paquete	;
		SET v_dato3_llenar_tarjeta = 	1.42	/ 1500;
							
		SET v_T1 = v_dato3_autocontrol +
            v_dato3_acomodar +
            v_dato3_soluble +
            v_dato3_arrojar_descarte +
            v_dato3_llenar_tarjeta
        ;

		IF v_diam_tubo < 100 THEN SET v_dato2 = 6000;
		ELSE
			SET v_dato2 = 600;
		END IF;

		SET v_prep_maq_1 = 14.63 / v_dato2;
		SET v_despunte_paq = v_tau / v_pz_paquete;
		SET v_ingresar_paq = 4.04 / v_pz_paquete;
		SET v_ultimo_corte = 3.93 / v_pz_paquete;
		SET v_cambio_sierra = 8 / ((3000000/ v_area_cortar) * (v_ancho_paquete * v_alto_paquete));

		SET v_T2 = v_prep_maq_1 + v_despunte_paq  + v_ingresar_paq + v_ultimo_corte + v_cambio_sierra;

		SET v_dif_pz = v_autom_pz - v_T1;

		IF v_dif_pz > 0 THEN		
			SET v_T3 = v_dif_pz * 1.055;
		ELSE
			SET v_T3 = v_dif_pz * -1.055;
		END IF;

		SET v_tiempo_corte_paq = ((v_T1 + v_T2 + v_T3) * v_ancho_paquete * v_alto_paquete );

		SET v_tiempo_corte_pz = v_T1 + v_T2 + v_T3;

		IF v_tubos_x_lote >= 4 THEN SET v_M1 = 0;
		ELSE
			CASE v_tubos_x_lote 
				WHEN 3	THEN SET v_M1 = 1;
				WHEN 2	THEN SET v_M1 = 1;
				WHEN 1 	THEN SET v_M1 = 2;
				ELSE
					SET v_M1 = 99999;
			END CASE;
		END IF;	
			
		SET v_manual = if(v_alto_paquete > 0, 0, v_tau * v_M1 / (v_ancho_paquete * v_alto_paquete));
							
		SET v_cant_cortes_hora =  60 / (v_tiempo_corte_paq + v_manual);
							
		SET v_cant_piezas_hora =  v_cant_cortes_hora * v_ancho_paquete * v_alto_paquete;

		SET v_texto_hp = CONCAT('Paquete Ancho: ', v_ancho_paquete, ' Alto: ', v_alto_paquete, ' Largo Corte: ',  v_largo_neto, ' TAU: ', v_tau);

		SELECT JSON_ARRAYAGG(JSON_OBJECT('Cant Piezas x hora', v_cant_piezas_hora, 'TEXTO HP', v_texto_hp, 'Ancho Paquete', v_ancho_paquete, 'Alto Paquete', v_alto_paquete, 'Largo Corte',  v_largo_neto, 'TAU', v_tau, 'AREA CORTAR', v_area_cortar, 'MOV Largo', v_mov_largo))
        INTO json_result
        FROM dual;
		
		RETURN json_result;
	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculo_PzHora_Sierra_Dano520`(p_ftid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
		DECLARE v_diam_tubo DOUBLE;
		DECLARE v_esp_tubo DOUBLE;
		DECLARE v_calidad_tubo INT;
		DECLARE v_largo_tubo DOUBLE;
		DECLARE v_ancho_tabla INT;
		DECLARE v_alto_tabla INT;
		DECLARE v_lote_calc DOUBLE;
		DECLARE v_velocidad_corte INT;
		DECLARE v_autocontrol INT;
		DECLARE v_avanzar DOUBLE;
		DECLARE v_ancho_sierra DOUBLE;
		DECLARE v_largo_neto DOUBLE;
		DECLARE v_largo_corte DOUBLE;
		DECLARE v_altC DOUBLE;
		DECLARE v_cortes_x_tubo DOUBLE;
		DECLARE v_circ1 DOUBLE;
		DECLARE v_circ2 DOUBLE;
		DECLARE v_paquete INT;
		DECLARE v_area_tubo DOUBLE;
		DECLARE v_area_cortar DOUBLE;
		DECLARE v_tubos_x_lote INT;
		DECLARE v_ancho_paquete INT;
		DECLARE v_alto_paquete INT;
		DECLARE v_sobrante DOUBLE;
		DECLARE v_mov_largo INT;
		DECLARE v_mov_corto INT;
		DECLARE v_altura_subir DOUBLE;
		DECLARE v_vel_subir DOUBLE;
		DECLARE v_subir_hoja DOUBLE;
		DECLARE v_avanzar_paq DOUBLE;
		DECLARE v_retroceder_carro DOUBLE;
		DECLARE v_abrir_paquete DOUBLE;
		DECLARE v_retroceder_carro_post DOUBLE;
		DECLARE v_bajar_sierra DOUBLE;
		DECLARE v_movimientos DOUBLE;
		DECLARE v_tiempo_corte DOUBLE;
		DECLARE v_coef_auto DOUBLE;
		DECLARE v_tiempo_corte_paquete DOUBLE;
		DECLARE v_tau DOUBLE;
		DECLARE v_autom_pz DOUBLE;
		DECLARE v_cortes_tubo INT;
		DECLARE v_pz_paquete INT;
		DECLARE v_dato3_autocontrol DOUBLE;	
		DECLARE v_dato3_acomodar DOUBLE;
		DECLARE v_dato3_soluble DOUBLE;
		DECLARE v_dato3_arrojar_descarte DOUBLE;
		DECLARE v_dato3_llenar_tarjeta DOUBLE;
		DECLARE v_T1 DOUBLE;
		DECLARE v_dato2 INT;
		DECLARE v_T2 DOUBLE;
		DECLARE v_prep_maq_1 DOUBLE;
		DECLARE v_despunte_paq  DOUBLE;
		DECLARE v_ingresar_paq DOUBLE;
		DECLARE v_ultimo_corte DOUBLE;
		DECLARE v_cambio_sierra DOUBLE;
		DECLARE v_T3 DOUBLE;
		DECLARE v_dif_pz DOUBLE;
		DECLARE v_tiempo_corte_paq DOUBLE;
		DECLARE v_tiempo_corte_pz DOUBLE;
		DECLARE v_M1 INT;
		DECLARE v_manual INT;
		DECLARE v_cant_cortes_hora DOUBLE;
		DECLARE v_cant_piezas_hora DOUBLE;
		DECLARE json_result JSON; 
		DECLARE v_texto_hp VARCHAR(100);
		DECLARE v_lote_economico INT;

		SET v_avanzar = 375;
		SET v_ancho_sierra = 2.5;
		SET v_altC = 125;

		SELECT ar.diametro / 1000, ar.espesor / 1000, ar.calidad_id, ft.tubo_largo_n1, ft.lote_economico
		INTO v_diam_tubo, v_esp_tubo, v_calidad_tubo, v_largo_neto, v_lote_economico
		FROM fichas_tecnicas ft
		LEFT JOIN articulos ar ON ar.id = ft.articulo_id
		WHERE p_ftid = ft.id;

		SELECT ts.ancho_dano520, ts.alto_dano520, ts.largo_tubo * 1000, ts.lote_calculado
		INTO v_ancho_tabla, v_alto_tabla, v_largo_tubo, v_lote_calc
		FROM tabla_sierras ts 
		WHERE ts.diametro = v_diam_tubo
		and ts.espesor = v_esp_tubo;

		IF v_ancho_tabla > 1 THEN 
			SET v_velocidad_corte = 2700;
		ELSE 
			IF v_ancho_tabla = 1 THEN 
				SET v_velocidad_corte = 2000;
			END IF;
		END IF;

		IF v_diam_tubo < 180 THEN
			SET v_autocontrol = 3;
		ELSE
			SET v_autocontrol = 2;
		END IF;

		SET v_largo_corte = v_largo_neto + v_ancho_sierra;

		SET v_cortes_x_tubo = TRUNCATE(v_largo_tubo / v_largo_corte,0) ;
		SET v_tubos_x_lote = CEILING(v_lote_calc / v_cortes_x_tubo);

		SET v_paquete = SubCalculo_SierraPaquete(v_ancho_tabla, v_alto_tabla, v_tubos_x_lote, v_altC, v_diam_tubo);

		SELECT tp.ancho, tp.alto
		INTO v_ancho_paquete, v_alto_paquete
		FROM tabla_calculo_paquete tp
		WHERE tp.numero = v_paquete; 

		SET v_circ1 = (v_diam_tubo / 2)*(v_diam_tubo / 2)  * 3.1416;
		SET v_circ2 = ((v_diam_tubo - v_esp_tubo * 2) / 2) * ((v_diam_tubo - v_esp_tubo * 2) / 2) * 3.1416;

		SET v_area_tubo =  v_circ1 - v_circ2;
		SET v_area_cortar = v_area_tubo * v_ancho_paquete * v_alto_paquete; 

		IF v_calidad_tubo NOT IN (18,19) THEN
			SET v_lote_calc = v_lote_economico;
		END IF;

		SET v_largo_corte = v_largo_neto + v_ancho_sierra;
		SET v_mov_largo = TRUNCATE(v_largo_corte / v_avanzar,0) ;
		SET v_sobrante = v_largo_corte  - (v_avanzar * v_mov_largo);

		IF v_sobrante > 0 THEN 
			SET v_mov_corto = 1;
		ELSE 
			SET v_mov_corto = 0;
		END IF;

		SET v_altura_subir = (v_diam_tubo * v_alto_paquete) + 15;
		SET v_vel_subir = 1325;
		SET v_subir_hoja = v_altura_subir / v_vel_subir;

		SET v_avanzar_paq = 0.189 * v_mov_largo;
		SET v_retroceder_carro = 0.225 * v_mov_largo;
		SET v_abrir_paquete = v_sobrante / 1740;
		SET v_retroceder_carro_post = v_sobrante / 1440;
		SET v_bajar_sierra = 0.152;
		SET v_movimientos = v_subir_hoja + v_avanzar_paq + v_retroceder_carro + v_abrir_paquete + v_retroceder_carro_post + v_bajar_sierra;

		SET v_tiempo_corte = v_area_cortar / v_velocidad_corte;

		SELECT COUNT(*)
		INTO v_coef_auto
		FROM fichas_tecnicas_procesos ftp
		LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
		WHERE p_ftid = ftp.ficha_tecnica_id
		AND et.etapa = 2;

		IF v_coef_auto > 0 THEN
			SET v_coef_auto = 1.15;
		ELSE
			SET v_coef_auto = 1;
		END IF;

		SET v_tiempo_corte_paquete = v_tiempo_corte * v_coef_auto;
		SET v_tau = ( v_tiempo_corte_paquete +  v_movimientos );

		--		Autom x pz	0,11	( Tau / total tubos )
		--		Cortes por tubo:	152	Entero ( Largo tubo / largo corte )
		--		Pz x paquete	4560	( Cortes por tubo x total tubos )	

		SET v_autom_pz = v_tau / (v_ancho_paquete * v_alto_paquete) ;
		SET v_cortes_tubo = v_largo_tubo / v_largo_corte;  -- no se usa...
		SET v_pz_paquete = v_cortes_x_tubo * (v_ancho_paquete * v_alto_paquete);

		SET v_dato3_autocontrol = 2.26	*  V_autocontrol / (60 /v_autom_pz);	
		SET v_dato3_acomodar =	0.327 / v_ancho_paquete * v_alto_paquete ;
		SET v_dato3_soluble =  5.92 /	(60 / v_autom_pz * 8.5);
		SET v_dato3_arrojar_descarte =	2 / v_pz_paquete	;
		SET v_dato3_llenar_tarjeta = 	1.42	/ 34;
		SET v_T1 = v_dato3_autocontrol +
			v_dato3_acomodar +
			v_dato3_soluble +
			v_dato3_arrojar_descarte +
			v_dato3_llenar_tarjeta;

		IF v_diam_tubo < 	170 THEN SET v_dato2 = 	1300;
		ELSE
			IF v_diam_tubo <	220 THEN SET v_dato2 =	950;
			ELSE
				IF v_diam_tubo < 280	 THEN SET v_dato2 = 550;
				ELSE
					IF v_diam_tubo < 360	 THEN SET v_dato2 =	290;
					ELSE
						SET v_dato2 =	180;
					END IF;
				END IF;
			END IF;
		END IF;			
							
		SET v_prep_maq_1 = 6.63 / v_dato2;
		SET v_despunte_paq = v_tau	/ v_pz_paquete	;
		SET v_ingresar_paq = 1.745	/ v_pz_paquete	;
		SET v_ultimo_corte = 2.905 / v_pz_paquete ;
		SET v_cambio_sierra =	12.5 /  ((3000000/ v_area_cortar) * (v_ancho_paquete * v_alto_paquete)); 
			
		SET v_T2 = v_prep_maq_1 + v_despunte_paq  + v_ingresar_paq + v_ultimo_corte + v_cambio_sierra;

		SET v_dif_pz = v_autom_pz - v_T1;

		IF v_dif_pz > 0 THEN 					
			SET v_T3 = v_dif_pz * 1.055;
		ELSE
			SET v_T3 = v_dif_pz * -1.055;
		END IF;		

		SET v_tiempo_corte_paq = ((v_T1 + v_T2 + v_T3) * v_ancho_paquete * v_alto_paquete );

		SET v_tiempo_corte_pz = v_T1 + v_T2 + v_T3;

		IF v_tubos_x_lote >= 4 THEN SET v_M1 = 0;
		ELSE
			CASE v_tubos_x_lote 
				WHEN 3	THEN SET v_M1 = 1;
				WHEN 2	THEN SET v_M1 = 1;
				WHEN 1 	THEN SET v_M1 = 2;
				ELSE         SET v_M1 = 0;
			END CASE;
		END IF;	
			
		SET v_manual = if(v_alto_paquete > 0, 0, v_tau * v_M1 / (v_ancho_paquete * v_alto_paquete));
							
		SET v_cant_cortes_hora =  60 / (v_tiempo_corte_paq + v_manual);
							
		SET v_cant_piezas_hora =  v_cant_cortes_hora * v_ancho_paquete * v_alto_paquete;

		-- SELECT JSON_ARRAYAGG(JSON_OBJECT('Cant Piezas x hora', v_cant_piezas_hora, 'Ancho Paquete', v_ancho_paquete, 'Alto Paquete', v_alto_paquete, 'Largo Corte',  v_largo_corte, 'TAU', v_tau))
		SET v_texto_hp = CONCAT('Paquete Ancho: ', v_ancho_paquete, ' Alto: ', v_alto_paquete, ' Largo Corte: ',  v_largo_neto, ' TAU: ', v_tau);
		--
		SELECT JSON_ARRAYAGG(JSON_OBJECT('Cant Piezas x hora', v_cant_piezas_hora, 'TEXTO HP', v_texto_hp, 'Ancho Paquete', v_ancho_paquete, 'Alto Paquete', v_alto_paquete, 'Largo Corte',  v_largo_neto, 'TAU', v_tau, 'AREA CORTAR', v_area_cortar))
        INTO json_result
        FROM dual;

        RETURN json_result;
  	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculo_PzHora_Sierra_Metora380`(p_ftid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
		DECLARE json_result JSON;
		DECLARE v_diam_tubo DECIMAL(10, 3);
		DECLARE v_esp_tubo DECIMAL(10, 3);
		DECLARE v_calidad_tubo INT;
		DECLARE v_largo_tubo DECIMAL(10, 3);
		DECLARE v_ancho_tabla INT;
		DECLARE v_alto_tabla INT;
		DECLARE v_lote_calc DECIMAL(10, 3);
		DECLARE v_velocidad_corte INT;
		DECLARE v_autocontrol INT;
		DECLARE v_avanzar DECIMAL(10, 3);
		DECLARE v_ancho_sierra DECIMAL(10, 3);
		DECLARE v_largo_neto DECIMAL(10, 3);
		DECLARE v_largo_corte DECIMAL(10, 3);
		DECLARE v_altC DECIMAL(10, 3);
		DECLARE v_cortes_x_tubo DECIMAL(10, 3);
		DECLARE v_circ1 DECIMAL(10, 3);
		DECLARE v_circ2 DECIMAL(10, 3);
		DECLARE v_paquete INT;
		DECLARE v_area_tubo DECIMAL(10, 3);
		DECLARE v_area_cortar DECIMAL(10, 3);
		DECLARE v_tubos_x_lote INT;
		DECLARE v_ancho_paquete INT;
		DECLARE v_alto_paquete INT;
		DECLARE v_sobrante DECIMAL(10, 3);
		DECLARE v_mov_largo INT;
		DECLARE v_mov_corto INT;
		DECLARE v_altura_subir DECIMAL(10, 3);
		DECLARE v_vel_subir DECIMAL(10, 3);
		DECLARE v_subir_hoja DECIMAL(10, 3);
		DECLARE v_avanzar_paq DECIMAL(10, 3);
		DECLARE v_retroceder_carro DECIMAL(10, 3);
		DECLARE v_abrir_paquete DECIMAL(10, 3);
		DECLARE v_retroceder_carro_post DECIMAL(10, 3);
		DECLARE v_bajar_sierra DECIMAL(10, 3);
		DECLARE v_movimientos DECIMAL(10, 3);
		DECLARE v_tiempo_corte DECIMAL(10, 3);
		DECLARE v_coef_auto DECIMAL(10, 3);
		DECLARE v_tiempo_corte_paquete DECIMAL(10, 3);
		DECLARE v_tau DECIMAL(10, 3);
		DECLARE v_autom_pz DECIMAL(10, 3);
		DECLARE v_cortes_tubo INT;
		DECLARE v_pz_paquete INT;
		DECLARE v_dato3_autocontrol DECIMAL(10, 3);	
		DECLARE v_dato3_acomodar DECIMAL(10, 3);
		DECLARE v_dato3_soluble DECIMAL(10, 3);
		DECLARE v_dato3_arrojar_descarte DECIMAL(10, 3);
		DECLARE v_dato3_llenar_tarjeta DECIMAL(10, 3);
		DECLARE v_T1 DECIMAL(10, 3);
		DECLARE v_dato2 INT;
		DECLARE v_T2 DECIMAL(10, 3);
		DECLARE v_prep_maq_1 DECIMAL(10, 3);
		DECLARE v_despunte_paq  DECIMAL(10, 3);
		DECLARE v_ingresar_paq DECIMAL(10, 3);
		DECLARE v_ultimo_corte DECIMAL(10, 3);
		DECLARE v_cambio_sierra DECIMAL(10, 3);
		DECLARE v_T3 DECIMAL(10, 3);
		DECLARE v_dif_pz DECIMAL(10, 3);
		DECLARE v_tiempo_corte_paq DECIMAL(10, 3);
		DECLARE v_tiempo_corte_pz DECIMAL(10, 3);
		DECLARE v_M1 INT;
		DECLARE v_manual INT;
		DECLARE v_cant_cortes_hora DECIMAL(10, 3);
		DECLARE v_cant_piezas_hora DECIMAL(10, 3);
		DECLARE v_vCorte DECIMAL(10, 3);
		DECLARE v_coef_vel DECIMAL(10, 3);
		DECLARE v_texto_hp VARCHAR(100);
		DECLARE v_lote_economico INT;
		--
		SET v_avanzar = 440;
		SET v_ancho_sierra = 2;
		SET v_altC = 101.6;
		--
		SELECT ar.diametro / 1000, ar.espesor / 1000, ar.calidad_id, ft.tubo_largo_n1, ft.lote_economico
		INTO v_diam_tubo, v_esp_tubo, v_calidad_tubo, v_largo_neto, v_lote_economico
		FROM fichas_tecnicas ft
		LEFT JOIN articulos ar ON ar.id = ft.articulo_id
		WHERE p_ftid = ft.id;
		--
		SELECT ts.ancho_meto380, ts.alto_meto380, ts.largo_tubo * 1000, ts.lote_calculado
		INTO v_ancho_tabla, v_alto_tabla, v_largo_tubo, v_lote_calc
		FROM tabla_sierras ts 
		WHERE ts.diametro = v_diam_tubo
		and ts.espesor = v_esp_tubo;
		--
		IF v_ancho_tabla > 1 THEN
			SET v_vCorte = 2050;
		ELSE
			IF v_ancho_tabla = 1 THEN
				SET v_vCorte = 1750;
			END IF;
		END IF;
		--
		IF v_diam_tubo < 27 THEN
			SET v_coef_vel = 1.2;
		ELSE
			IF v_diam_tubo < 115 THEN
				SET v_coef_vel = 1;
			ELSE
				SET v_coef_vel  = 1.1;
			END IF;
		END IF;	
		--
		SET v_velocidad_corte = (v_vCorte / v_coef_vel);
		--
		IF v_diam_tubo < 50 THEN
			SET v_autocontrol = 6;
		ELSE
			IF v_diam_tubo < 65 THEN
				SET v_autocontrol = 5;
			ELSE
				IF v_diam_tubo < 105 THEN
					SET v_autocontrol = 4;
				ELSE
					IF v_diam_tubo < 115 THEN
						SET v_autocontrol = 3;
					ELSE
						SET v_autocontrol = 2;
					END IF;
				END IF;
			END IF;
		END IF;
		--
		SET v_circ1 = (v_diam_tubo / 2)*(v_diam_tubo / 2)  * 3.1416;
		SET v_circ2 = ((v_diam_tubo - v_esp_tubo * 2) / 2) * ((v_diam_tubo - v_esp_tubo * 2) / 2) * 3.1416;
		SET v_area_tubo =  v_circ1 - v_circ2;
		SET v_area_cortar = v_area_tubo * v_ancho_paquete * v_alto_paquete;
		--
		IF v_calidad_tubo NOT IN (18,19) THEN
			SET v_lote_calc = v_lote_economico;
		END IF;
		--
		SET v_largo_corte = v_largo_neto + v_ancho_sierra;
		SET v_cortes_x_tubo = TRUNCATE(v_largo_tubo / v_largo_corte,0);
		SET v_tubos_x_lote = CEILING(v_lote_calc / v_cortes_x_tubo);
		SET v_paquete = SubCalculo_SierraPaquete(v_ancho_tabla, v_alto_tabla, v_tubos_x_lote, v_altC, v_diam_tubo);
		-- hasta acá
		SELECT tp.ancho, tp.alto
		INTO v_ancho_paquete, v_alto_paquete
		FROM tabla_calculo_paquete tp
		WHERE tp.numero = v_paquete;
		--
		SET v_largo_corte = v_largo_neto + v_ancho_sierra;
		SET v_mov_largo = v_largo_corte / v_avanzar;
		SET v_sobrante = v_largo_corte  - (v_avanzar * v_mov_largo);
		--
		IF v_sobrante > 0 THEN 
			SET v_mov_corto = 1;
		ELSE
			SET v_mov_corto = 0;
		END IF;
		--
		SET v_altura_subir = (v_diam_tubo * v_alto_paquete) + 15;
		SET v_vel_subir = 1500;
		SET v_subir_hoja = v_altura_subir / v_vel_subir;
		SET v_avanzar_paq = 0.288 * v_mov_largo;
		SET v_retroceder_carro = 0.349 * v_mov_largo;
		SET v_abrir_paquete = v_sobrante / 1525;
		SET v_retroceder_carro_post = 0;
		SET v_bajar_sierra = 0.321;
		SET v_movimientos = v_subir_hoja + v_avanzar_paq + v_retroceder_carro + v_abrir_paquete + v_retroceder_carro_post + v_bajar_sierra;
		SET v_tiempo_corte = v_area_cortar / v_velocidad_corte;
		--
		SELECT COUNT(*)
		INTO v_coef_auto
		FROM fichas_tecnicas_procesos ftp
		LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
		WHERE p_ftid = ftp.ficha_tecnica_id
		AND et.etapa = 2;
		--
		IF v_coef_auto > 0 THEN
			SET v_coef_auto = 1.2;
		ELSE 
			SET v_coef_auto = 1;
		END IF;
		--
		SET v_tiempo_corte_paquete = v_tiempo_corte * v_coef_auto;
		SET v_tau = ( v_tiempo_corte_paquete +  v_movimientos );
		--		Autom x pz	0,11	( Tau / total tubos )
		--		Cortes por tubo:	152	Entero ( Largo tubo / largo corte )
		--		Pz x paquete	4560	( Cortes por tubo x total tubos )
		SET v_autom_pz = v_tau / (v_ancho_paquete * v_alto_paquete) ;
		SET v_cortes_tubo = ROUND(v_largo_tubo / v_largo_corte,0);
		SET v_pz_paquete = v_cortes_tubo * (v_ancho_paquete * v_alto_paquete);
		-- hasta acá
		SET v_dato3_autocontrol = 0.71	*  v_autocontrol / (60 /v_autom_pz);
		SET v_dato3_acomodar =	0.327 / v_ancho_paquete * v_alto_paquete;
		SET v_dato3_soluble =  5.92 /	(60 / v_autom_pz * 8.5);
		SET v_dato3_arrojar_descarte =	2 / v_pz_paquete;
		SET v_dato3_llenar_tarjeta = 1.42 / 1500;							
		SET v_T1 = v_dato3_autocontrol +
			v_dato3_acomodar +
			v_dato3_soluble +
			v_dato3_arrojar_descarte +
			v_dato3_llenar_tarjeta
		;
		--
		IF v_diam_tubo < 45 THEN
			SET v_dato2 = 14500;
		ELSE
			IF v_diam_tubo < 70 THEN
				SET v_dato2 = 7500;
			ELSE
				IF v_diam_tubo < 90 THEN
					SET v_dato2 = 4900;
				ELSE
					SET v_dato2 = 2800;
				END IF;
			END IF;
		END IF;
		--
		SET v_prep_maq_1 = 14.63 / v_dato2;
		SET v_despunte_paq = v_tau / v_pz_paquete;
		SET v_ingresar_paq = 4.04 / v_pz_paquete;
		SET v_ultimo_corte = 3.93 / v_pz_paquete;
		SET v_cambio_sierra = 8 / ((3000000/ v_area_cortar) * (v_ancho_paquete * v_alto_paquete));
		SET v_T2 = v_prep_maq_1 + v_despunte_paq  + v_ingresar_paq + v_ultimo_corte + v_cambio_sierra;
		SET v_dif_pz = v_autom_pz - v_T1;
		--
		IF v_dif_pz > 0 THEN 					
			SET v_T3 = v_dif_pz * 1.055;
		ELSE
			SET v_T3 = v_dif_pz * -1.055;
		END IF;
		--
		SET v_tiempo_corte_paq = ( (v_T1 + v_T2 + v_T3) * v_ancho_paquete * v_alto_paquete );
		SET v_tiempo_corte_pz = v_T1 + v_T2 + v_T3;
		SET v_manual = if(v_alto_paquete > 0, 1,0);
		SET v_cant_cortes_hora = 60 / (v_tiempo_corte_paq * v_manual);
		SET v_cant_piezas_hora = v_cant_cortes_hora * v_ancho_paquete * v_alto_paquete;
		SET v_texto_hp = CONCAT('Paquete Ancho: ', v_ancho_paquete, ' Alto: ', v_alto_paquete, ' Largo Corte: ',  v_largo_corte, ' TAU: ', v_tau);
		--
		SELECT JSON_ARRAYAGG(JSON_OBJECT('Cant Piezas x hora', v_cant_piezas_hora, 'TEXTO HP', v_texto_hp, 'Ancho Paquete', v_ancho_paquete, 'Alto Paquete', v_alto_paquete, 'Largo Corte',  v_largo_neto, 'TAU', v_tau))
        INTO json_result
        FROM dual;
		--
		RETURN json_result;
	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculo_PzHora_Sierra_Metora550`(p_ftid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
		DECLARE json_result JSON;
		DECLARE v_diam_tubo DECIMAL(10, 3);
		DECLARE v_esp_tubo DECIMAL(10, 3);
		DECLARE v_calidad_tubo INT;
		DECLARE v_largo_tubo DECIMAL(10, 3);
		DECLARE v_ancho_tabla INT;
		DECLARE v_alto_tabla INT;
		DECLARE v_lote_calc DECIMAL(10, 3);
		DECLARE v_velocidad_corte INT;
		DECLARE v_autocontrol INT;
		DECLARE v_avanzar DECIMAL(10, 3);
		DECLARE v_ancho_sierra DECIMAL(10, 3);
		DECLARE v_largo_neto DECIMAL(10, 3);
		DECLARE v_largo_corte DECIMAL(10, 3);
		DECLARE v_altC DECIMAL(10, 3);
		DECLARE v_cortes_x_tubo DECIMAL(10, 3);
		DECLARE v_circ1 DECIMAL(10, 3);
		DECLARE v_circ2 DECIMAL(10, 3);
		DECLARE v_paquete INT;
		DECLARE v_area_tubo DECIMAL(10, 3);
		DECLARE v_area_cortar DECIMAL(10, 3);
		DECLARE v_tubos_x_lote INT;
		DECLARE v_ancho_paquete INT;
		DECLARE v_alto_paquete INT;
		DECLARE v_sobrante DECIMAL(10, 3);
		DECLARE v_mov_largo INT;
		DECLARE v_mov_corto INT;
		DECLARE v_altura_subir DECIMAL(10, 3);
		DECLARE v_vel_subir DECIMAL(10, 3);
		DECLARE v_subir_hoja DECIMAL(10, 3);
		DECLARE v_avanzar_paq DECIMAL(10, 3);
		DECLARE v_retroceder_carro DECIMAL(10, 3);
		DECLARE v_abrir_paquete DECIMAL(10, 3);
		DECLARE v_retroceder_carro_post DECIMAL(10, 3);
		DECLARE v_bajar_sierra DECIMAL(10, 3);
		DECLARE v_movimientos DECIMAL(10, 3);
		DECLARE v_tiempo_corte DECIMAL(10, 3);
		DECLARE v_coef_auto DECIMAL(10, 3);
		DECLARE v_tiempo_corte_paquete DECIMAL(10, 3);
		DECLARE v_tau DECIMAL(10, 3);
		DECLARE v_autom_pz DECIMAL(10, 3);
		DECLARE v_cortes_tubo INT;
		DECLARE v_pz_paquete INT;
		DECLARE v_dato3_autocontrol DECIMAL(10, 3);	
		DECLARE v_dato3_acomodar DECIMAL(10, 3);
		DECLARE v_dato3_soluble DECIMAL(10, 3);
		DECLARE v_dato3_arrojar_descarte DECIMAL(10, 3);
		DECLARE v_dato3_llenar_tarjeta DECIMAL(10, 3);
		DECLARE v_T1 DECIMAL(10, 3);
		DECLARE v_dato2 INT;
		DECLARE v_T2 DECIMAL(10, 3);
		DECLARE v_prep_maq_1 DECIMAL(10, 3);
		DECLARE v_despunte_paq  DECIMAL(10, 3);
		DECLARE v_ingresar_paq DECIMAL(10, 3);
		DECLARE v_ultimo_corte DECIMAL(10, 3);
		DECLARE v_cambio_sierra DECIMAL(10, 3);
		DECLARE v_T3 DECIMAL(10, 3);
		DECLARE v_dif_pz DECIMAL(10, 3);
		DECLARE v_tiempo_corte_paq DECIMAL(10, 3);
		DECLARE v_tiempo_corte_pz DECIMAL(10, 3);
		DECLARE v_M1 INT;
		DECLARE v_manual INT;
		DECLARE v_cant_cortes_hora DECIMAL(10, 3);
		DECLARE v_cant_piezas_hora DECIMAL(10, 3);
		DECLARE v_vCorte DECIMAL(10, 3);
		DECLARE v_coef_vel DECIMAL(10, 3);
		DECLARE v_texto_hp VARCHAR(100);
		DECLARE v_lote_economico INT;
		--
		SET v_avanzar = 500;
		SET v_ancho_sierra = 2.5;
		SET v_altC = 101.6;
		--
		SELECT ar.diametro / 1000, ar.espesor / 1000, ar.calidad_id, ft.tubo_largo_n1, ft.lote_economico
		INTO v_diam_tubo, v_esp_tubo, v_calidad_tubo, v_largo_neto, v_lote_economico
		FROM fichas_tecnicas ft
		LEFT JOIN articulos ar ON ar.id = ft.articulo_id
		WHERE p_ftid = ft.id;
		--
		SELECT ts.ancho_meto550, ts.alto_meto550, ts.largo_tubo * 1000, ts.lote_calculado
		INTO v_ancho_tabla, v_alto_tabla, v_largo_tubo, v_lote_calc
		FROM tabla_sierras ts 
		WHERE ts.diametro = v_diam_tubo
		AND ts.espesor = v_esp_tubo;
		--
		IF v_ancho_tabla > 1 THEN
			SET v_vCorte = 2700;
		ELSE
			IF v_ancho_tabla = 1 THEN
				SET v_vCorte = 1850;
			END IF;
		END IF;
		--
		SET v_velocidad_corte = (v_vCorte / 1);
		--
		IF v_diam_tubo < 180 THEN
			SET v_autocontrol = 3;
		ELSE
			SET v_autocontrol = 2;
		END IF;
		--
		SET v_circ1 = (v_diam_tubo / 2)*(v_diam_tubo / 2) * 3.1416;
		SET v_circ2 = ((v_diam_tubo - v_esp_tubo * 2) / 2) * ((v_diam_tubo - v_esp_tubo * 2) / 2) * 3.1416;
		SET v_area_tubo =  v_circ1 - v_circ2;
		--
		IF v_calidad_tubo NOT IN (18,19) THEN
			SET v_lote_calc = v_lote_economico;
		END IF;
		--
		SET v_largo_corte = v_largo_neto + v_ancho_sierra;
		SET v_cortes_x_tubo = TRUNCATE(v_largo_tubo / v_largo_corte,0);
		SET v_tubos_x_lote = CEILING(v_lote_calc / v_cortes_x_tubo);
		SET v_paquete = SubCalculo_SierraPaquete(v_ancho_tabla, v_alto_tabla, v_tubos_x_lote, v_altC, v_diam_tubo);
		--
		SELECT tp.ancho, tp.alto
		INTO v_ancho_paquete, v_alto_paquete
		FROM tabla_calculo_paquete tp
		WHERE tp.numero = v_paquete;
		--
		SET v_area_cortar = v_area_tubo * v_ancho_paquete * v_alto_paquete;
		SET v_largo_corte = v_largo_neto + v_ancho_sierra;
		SET v_mov_largo = ROUND(v_largo_corte / v_avanzar,0);
		SET v_sobrante = v_largo_corte - (v_avanzar * v_mov_largo);
		--
		IF v_sobrante > 0 THEN
			SET v_mov_corto = 1;
		ELSE
			SET v_mov_corto = 0;
		END IF;
		--
		SET v_altura_subir = (v_diam_tubo * v_alto_paquete) + 15;
		SET v_vel_subir = 1125;
		SET v_subir_hoja = v_altura_subir / v_vel_subir;
		SET v_avanzar_paq = 0.252 * v_mov_largo;
		SET v_retroceder_carro = 0.3 * v_mov_largo;
		SET v_abrir_paquete = v_sobrante / 2050;
		SET v_retroceder_carro_post = v_sobrante / 1660;
		SET v_bajar_sierra = 0.303;
		SET v_movimientos = v_subir_hoja + v_avanzar_paq + v_retroceder_carro + v_abrir_paquete + v_retroceder_carro_post + v_bajar_sierra;
		SET v_tiempo_corte = v_area_cortar / v_velocidad_corte;
		--
		SELECT COUNT(*)
		INTO v_coef_auto
		FROM fichas_tecnicas_procesos ftp
		LEFT JOIN etapas_subetapas et ON et.id = ftp.etapa_subetapa_id
		WHERE p_ftid = ftp.ficha_tecnica_id
		AND et.etapa = 2;
		--
		IF v_coef_auto > 0 THEN
			SET v_coef_auto = 1.15;
		ELSE
			SET v_coef_auto = 1;
		END IF;
		--
		SET v_tiempo_corte_paquete = v_tiempo_corte * v_coef_auto;
		SET v_tau = (v_tiempo_corte_paquete +  v_movimientos);
		--		Autom x pz	0,11	( Tau / total tubos )
		--		Cortes por tubo:	152	Entero ( Largo tubo / largo corte )
		--		Pz x paquete	4560	( Cortes por tubo x total tubos )
		SET v_autom_pz = v_tau / (v_ancho_paquete * v_alto_paquete);
		SET v_cortes_tubo = ROUND(v_largo_tubo / v_largo_corte,0);
		SET v_pz_paquete = v_cortes_tubo * (v_ancho_paquete * v_alto_paquete);
		SET v_dato3_autocontrol = 2.26 * v_autocontrol / (60 /v_autom_pz);
		SET v_dato3_acomodar = 0.327 / v_ancho_paquete * v_alto_paquete;
		SET v_dato3_soluble = 5.92 / (60 / v_autom_pz * 8.5);
		SET v_dato3_arrojar_descarte = 2 / v_pz_paquete;
		SET v_dato3_llenar_tarjeta = 1.42 / 34;
		SET v_T1 = v_dato3_autocontrol +
			v_dato3_acomodar +
			v_dato3_soluble +
			v_dato3_arrojar_descarte +
			v_dato3_llenar_tarjeta
		;
		--
		IF v_diam_tubo < 170 THEN
			SET v_dato2 = 1300;
		ELSE
			IF v_diam_tubo < 220 THEN
				SET v_dato2 = 950;
			ELSE
				IF v_diam_tubo < 280 THEN
					SET v_dato2 = 550;
				ELSE
					IF v_diam_tubo < 360 THEN
						SET v_dato2 = 290;
					ELSE
						SET v_dato2 = 180;
					END IF;
				END IF;
			END IF;
		END IF;
		--
		SET v_prep_maq_1 = 6.63 / v_dato2;
		SET v_despunte_paq = v_tau / v_pz_paquete;
		SET v_ingresar_paq = 1.745 / v_pz_paquete;
		SET v_ultimo_corte = 2.905 / v_pz_paquete;
		SET v_cambio_sierra = 12.5 / ((3000000/ v_area_cortar) * (v_ancho_paquete * v_alto_paquete));
		SET v_T2 = v_prep_maq_1 + v_despunte_paq  + v_ingresar_paq + v_ultimo_corte + v_cambio_sierra;
		SET v_dif_pz = v_autom_pz - v_T1;
		--
		IF v_dif_pz > 0 THEN 					
			SET v_T3 = v_dif_pz * 1.055;
		ELSE
			SET v_T3 = v_dif_pz * -1.055;
		END IF;		
		--
		SET v_tiempo_corte_paq = ((v_T1 + v_T2 + v_T3) * v_ancho_paquete * v_alto_paquete);
		SET v_tiempo_corte_pz = v_T1 + v_T2 + v_T3;
		--
		IF v_tubos_x_lote >= 4 THEN
			SET v_M1 = 0;
		ELSE
			CASE v_tubos_x_lote
				WHEN 3 THEN
					SET v_M1 = 1;
				WHEN 2 THEN
					SET v_M1 = 1;
				WHEN 1 THEN
					SET v_M1 = 2;
				ELSE
					SET v_M1 = 0;
			END CASE;
		END IF;
		--
		SET v_manual = IF(v_alto_paquete > 0, 0, v_tau * v_M1 / (v_ancho_paquete * v_alto_paquete));	
		SET v_cant_cortes_hora = 60 / (v_tiempo_corte_paq + v_manual);
		SET v_cant_piezas_hora = v_cant_cortes_hora * v_ancho_paquete * v_alto_paquete;
		SET v_texto_hp = CONCAT('Paquete Ancho: ', v_ancho_paquete, ' Alto: ', v_alto_paquete, ' Largo Corte: ',  v_largo_corte, ' TAU: ', v_tau);
		--
		SELECT JSON_ARRAYAGG(JSON_OBJECT('Cant Piezas x hora', v_cant_piezas_hora, 'TEXTO HP', v_texto_hp, 'Ancho Paquete', v_ancho_paquete, 'Alto Paquete', v_alto_paquete, 'Largo Corte',  v_largo_neto, 'TAU', v_tau))
        INTO json_result
        FROM dual;
		--
		RETURN json_result;
	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculo_SierraPaquete`(p_ancho INT, p_alto INT, p_tuboxlote INT, p_altC DOUBLE, p_diametro_tubo DOUBLE) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
		DECLARE json_result JSON;
		DECLARE numero_paquete INT;
		DECLARE minimo_numero INT;
		DECLARE numero_sobrante INT;
		--
		SELECT numero
		INTO numero_paquete
		FROM tabla_calculo_paquete
		WHERE ancho = p_ancho
		AND alto = p_alto;
		--
		SELECT MIN(numero) 
		INTO minimo_numero
		FROM tabla_calculo_paquete
		WHERE numero >= numero_paquete
		AND ancho * alto <= p_tuboxlote
		AND alto * p_diametro_tubo > p_altC;
		--
		SELECT numero
		INTO numero_sobrante 
		FROM tabla_calculo_paquete
		WHERE numero >= numero_paquete
		AND ancho * alto = p_tuboxlote;
		IF IFNULL(minimo_numero, 22) > ifnull(numero_sobrante,0) THEN
			RETURN IFNULL(minimo_numero, 22);
		ELSE
			RETURN numero_sobrante;
		END IF;
	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SubCalculo_Sierra_Paquete`(p_ancho INT, p_alto INT, p_tuboxlote INT, p_altC DOUBLE, p_diametro_tubo DOUBLE) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
BEGIN
		DECLARE json_result JSON;
		DECLARE numero_paquete INT;
		DECLARE minimo_numero INT;

		SELECT numero
		INTO numero_paquete
		FROM tabla_calculo_paquete
		WHERE ancho = p_ancho
		AND alto = p_alto;

		SELECT MIN(numero) 
		INTO minimo_numero
		FROM tabla_calculo_paquete
		WHERE numero >= numero_paquete
		AND ancho * alto <= p_tuboxlote
		AND alto * p_diametro_tubo > p_altC;

		RETURN minimo_numero;
	END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'NO_AUTO_VALUE_ON_ZERO' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `SugerirColores`(p_mpid INT) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_bin
    COMMENT 'Dada la identificacion de la materia prima, devuelve los colores que se pueden usar'
BEGIN
   DECLARE json_result JSON;
        CREATE TEMPORARY TABLE temp_sugerencia_color
        SELECT col.tipo, col.id, col.descripcion, NVL(uso_d1.ultimo_uso, uso_d2.ultimo_uso) ultimo_uso
        FROM
        (
                SELECT 1 AS tipo, co.id, co.descripcion
                FROM colores co
                WHERE co.clasificacion = 'P'
                UNION ALL
                SELECT 2, co.id, co.descripcion
                FROM colores co
                WHERE co.clasificacion = 'S'
        ) col
        LEFT JOIN
        (SELECT color_id, MAX(aprobacion_calidad_fecha_hora) ultimo_uso
                FROM recepciones_tecnicas rt
                , articulos ar
                , articulos pivot
                WHERE rt.articulo_id = ar.id
                AND pivot.id = p_mpid
                AND ((ar.diametro = pivot.diametro AND pivot.tipo_id IN (1,3))
                        OR (ar.espesor = pivot.espesor AND NOT pivot.tipo_id IN (1,3)))
                GROUP BY color_id) uso_d1 ON col.id = uso_d1.color_id
        LEFT JOIN
        (SELECT color_id, MAX(aprobacion_calidad_fecha_hora) ultimo_uso
                FROM recepciones_tecnicas rt
                , articulos ar
                , articulos pivot
                WHERE rt.articulo_id = ar.id
                AND pivot.id = p_mpid
                AND ar.diametro = pivot.diametro
                AND ar.espesor = pivot.espesor
                GROUP BY color_id) uso_d2 ON col.id = uso_d2.color_id
        ORDER BY NVL(uso_d1.ultimo_uso, uso_d2.ultimo_uso) ASC, tipo, id;
        SELECT JSON_ARRAYAGG(JSON_OBJECT('tipo', tipo, 'id', id, 'descripcion', descripcion, 'criterio', ultimo_uso))
        INTO json_result
        FROM temp_sugerencia_color
        ORDER BY ultimo_uso ASC, tipo, id;
        DROP TEMPORARY TABLE IF EXISTS temp_sugerencia_color;
        RETURN json_result;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `ValidarColada`(id_colada INT, es_cintolo BOOLEAN) RETURNS longtext CHARSET utf8mb4 COLLATE utf8mb4_general_ci
BEGIN
        DECLARE v_grupo INT;
        DECLARE v_resultado VARCHAR(100);
        DECLARE v_CeqforL DOUBLE;
        DECLARE v_carbono DOUBLE;
        DECLARE v_manganeso DOUBLE;
        DECLARE v_f DOUBLE;
        DECLARE v_CUNICRMB DOUBLE;
        DECLARE v_CUMB DOUBLE;
        DECLARE v_tipo VARCHAR(2);
        DECLARE v_orig VARCHAR(2);
        DECLARE v_espesor DOUBLE;
        DECLARE v_alargamiento_pb DOUBLE;
        DECLARE v_resultado_id INT;
        DECLARE json_resultado JSON;

        IF es_cintolo = 0 THEN
                SELECT rt.agrupacion_calidad_id
                INTO v_grupo
                FROM recepciones_tecnicas rt
                WHERE rt.id = id_colada;
        ELSE
                SELECT rt.agrupacion_calidad_id
                INTO v_grupo
                FROM ordenes_de_produccion_estudios rt
                WHERE rt.id = id_colada;
        END IF;

        IF es_cintolo = 0 THEN
                        INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                        (SELECT id_colada, par.id, rtp.valor_decimal,
                        concat(par.parametro, IF (rtp.valor_decimal < ifnull(esp.valor_minimo,0), ' - MENOR QUE EL MINIMO',
                        IF (rtp.valor_decimal > ifnull(esp.valor_maximo,9999), ' - SUPERA EL MAXIMO', ' - RANGO CORRECTO'))),
                        IF (rtp.valor_decimal < ifnull(esp.valor_minimo,0), -1,
                        IF (rtp.valor_decimal > ifnull(esp.valor_maximo,9999), 1, 10))
                        FROM recepciones_tecnicas_partes rtp
                        LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                        LEFT JOIN ensayos_rangos_quimicos esp ON par.id = esp.parametro_id
                        WHERE rtp.recepcion_tecnica_id = id_colada
                        AND esp.agrupacion_calidad_id = v_grupo);

                        INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, resultado, resultado_id)
                        (SELECT id_colada, par.id, CONCAT(par.descripcion, ' SIN RESULTADO INFORMADO'), 0
                  FROM ensayos_rangos_quimicos pbe
                  LEFT JOIN ensayos_parametros par ON pbe.parametro_id = par.id
                        WHERE pbe.agrupacion_calidad_id = v_grupo
                        AND (valor_minimo IS not NULL OR valor_maximo IS NOT NULL)
                        AND NOT EXISTS
                        (SELECT * FROM recepciones_tecnicas_partes rtp
                                        WHERE pbe.parametro_id = rtp.parametro_id
                                         AND rtp.recepcion_tecnica_id = id_colada)
            );
        ELSE
                 INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                                 (SELECT id_colada, par.id, rtp.valor_decimal,
                                concat(par.parametro, IF (rtp.valor_decimal < ifnull(esp.valor_minimo,0), ' - MENOR QUE EL MINIMO',
                                IF (rtp.valor_decimal > ifnull(esp.valor_maximo,9999), ' - SUPERA EL MAXIMO', ' - RANGO CORRECTO'))),
                                IF (rtp.valor_decimal < ifnull(esp.valor_minimo,0), -1,
                                IF (rtp.valor_decimal > ifnull(esp.valor_maximo,9999), 1, 10))
                                FROM ordenes_de_produccion_estudios_partes rtp
                                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                                LEFT JOIN ensayos_rangos_quimicos esp ON par.id = esp.parametro_id
                                WHERE rtp.estudio_id = id_colada
                                AND     esp.agrupacion_calidad_id = v_grupo);

                                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, resultado, resultado_id)
                                        (SELECT id_colada, par.id, CONCAT(par.descripcion, ' SIN RESULTADO INFORMADO'), 0
                   FROM ensayos_rangos_quimicos pbe
                        LEFT JOIN ensayos_parametros par ON pbe.parametro_id = par.id
                           WHERE pbe.agrupacion_calidad_id = v_grupo
                                        AND (valor_minimo IS not NULL OR valor_maximo IS NOT NULL)
                    AND NOT EXISTS
                    (SELECT * FROM ordenes_de_produccion_estudios_partes rtp
                     WHERE pbe.parametro_id = rtp.parametro_id
                     AND rtp.estudio_id = id_colada)
            );
        END IF;

        IF es_cintolo = 0 THEN
                SELECT sum(if(par.descripcion = 'carbono', valor_decimal, 0)), sum(if(par.descripcion = 'manganeso', valor_decimal, 0))
                   INTO v_carbono, v_manganeso
                        FROM recepciones_tecnicas_partes rtp
                        LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.recepcion_tecnica_id = id_colada;
                        -- Calculos Auxiliares 13 Silicio
            SELECT sum(if(par.parametro = 'C', valor_decimal, 0)), sum(if(par.parametro = 'Mn', valor_decimal/6, if(par.parametro IN ('Cr', 'Mo', 'V'), valor_decimal / 5,
                if(par.parametro IN ('Ni','Cu') , valor_decimal / 15, valor_decimal))))
                INTO v_carbono, v_CeqforL
                FROM recepciones_tecnicas_partes rtp
                        LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                        LEFT JOIN ensayos_rangos_quimicos esp ON par.id = esp.parametro_id
                          WHERE rtp.recepcion_tecnica_id = id_colada
                        AND esp.agrupacion_calidad_id = v_grupo
                        AND par.parametro IN ('Co', 'Mn', 'Cr', 'Mb', 'V', 'Ni', 'Cu');

--          COBRE + NIQUEL + CROMO + MOLIBDENO  no exeder  1%
            SELECT SUM(ifnull(rtp.valor_decimal,0))
                        INTO v_CUNICRMB
                        FROM recepciones_tecnicas_partes rtp
                        LEFT JOIN ensayos_parametros par ON par.id  = rtp.parametro_id
                        WHERE rtp.recepcion_tecnica_id = id_colada
                        AND par.parametro IN ('Cu', 'Ni', 'Cr', 'Mb');
                        SELECT SUM(ifnull(rtp.valor_decimal,0))
                        INTO v_CUMB
                        FROM recepciones_tecnicas_partes rtp
                        LEFT JOIN ensayos_parametros par ON par.id  = rtp.parametro_id
                        WHERE rtp.recepcion_tecnica_id = id_colada
                        AND par.parametro IN ('Cu','Mb');
                                ELSE
                                        SELECT sum(if(par.descripcion = 'carbono', valor_decimal, 0)), sum(if(par.descripcion = 'manganeso', valor_decimal, 0))
                   INTO v_carbono, v_manganeso
                                FROM ordenes_de_produccion_estudios_partes rtp
                                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                WHERE rtp.estudio_id = id_colada;
                        -- Calculos Auxiliares 13 Silicio
                SELECT sum(if(par.parametro = 'C', valor_decimal, 0)), sum(if(par.parametro = 'Mn', valor_decimal/6, if(par.parametro IN ('Cr', 'Mo', 'V'), valor_decimal / 5,
                if(par.parametro IN ('Ni','Cu') , valor_decimal / 15, valor_decimal))))
                INTO v_carbono, v_CeqforL
                                FROM ordenes_de_produccion_estudios_partes rtp
                                        LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                                        LEFT JOIN ensayos_rangos_quimicos esp ON par.id = esp.parametro_id
                          WHERE rtp.estudio_id = id_colada
                                        AND esp.agrupacion_calidad_id = v_grupo
                                        AND par.parametro IN ('Co', 'Mn', 'Cr', 'Mb', 'V', 'Ni', 'Cu')
                                        ;

--          COBRE + NIQUEL + CROMO + MOLIBDENO  no exeder  1%
                SELECT SUM(ifnull(rtp.valor_decimal,0))
                        INTO v_CUNICRMB
                        FROM ordenes_de_produccion_estudios_partes rtp
                        LEFT JOIN ensayos_parametros par ON par.id  = rtp.parametro_id
                        WHERE rtp.estudio_id = id_colada
                        AND par.parametro IN ('Cu', 'Ni', 'Cr', 'Mb');
                  SELECT SUM(ifnull(rtp.valor_decimal,0))
                        INTO v_CUMB
                        FROM ordenes_de_produccion_estudios_partes rtp
                        LEFT JOIN ensayos_parametros par ON par.id  = rtp.parametro_id
                        WHERE rtp.estudio_id = id_colada
                        AND par.parametro IN ('Cu','Mb');

        END IF;

        IF v_grupo BETWEEN 42 AND 70 THEN
                        IF v_carbono > 0.17 THEN
                                IF v_CeqForL < 0.45 THEN
                                        SET  v_resultado = 'Carbono mayor a 0.17 - CeqforL RANGO CORRECTO';
                                        SET v_resultado_id = 10;
                                ELSE
                                        SET v_resultado ='Carbono mayor 0.17 - CeqforL SUPERA EL MAXIMO de 0.45%'  ;
                                        SET v_resultado_id = 1;
                                END IF;
                        ELSE
                                CASE v_carbono
                                WHEN 0.06 THEN set v_f = 0.54;
                                WHEN 0.07 THEN set v_f = 0.56;
                                        WHEN 0.08 THEN set v_f = 0.58;
                                        WHEN 0.09 THEN set v_f = 0.62;
                                        WHEN 0.10 THEN set v_f = 0.66;
                                        WHEN 0.11 THEN set v_f = 0.70;
                                        WHEN 0.12 THEN set v_f = 0.75;
                                        WHEN 0.13 THEN set v_f = 0.80;
                                        WHEN 0.14 THEN set v_f = 0.85;
                                        WHEN 0.15 THEN set v_f = 0.88;
                                WHEN 0.16 THEN set v_f = 0.92;
                                        WHEN 0.17 THEN set v_f = 0.94;
                                ELSE
                                        SET v_f = 0.53;
                                END CASE;
                                -- CARBONO + F *( (MANGANESO / 6) + (SILICIO / 24) + (COBRE / 24) + (NIQUEL / 20)  + ((CROMO + MOLIBDENO + VANADIO + NIOBIO)+5*BORO)
                                                IF es_cintolo = 0 THEN
                                SELECT sum(if(par.parametro = 'C', valor_decimal, 0)
                                        + v_f * if(par.parametro = 'Mn', valor_decimal/6, 0)
                                        + if(par.parametro = 'Si' , valor_decimal/24, 0)
                                        + if(par.parametro = 'Cu', valor_decimal / 24, 0 )
                                        + if(par.parametro = 'Ni', valor_decimal / 20, 0 )
                                        + if(par.parametro IN ('Cr', 'Mb', 'V', 'Nb') , valor_decimal, 0))
                                        INTO v_CeqforL
                                        FROM recepciones_tecnicas_partes rtp
                                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                                LEFT JOIN ensayos_rangos_quimicos esp ON par.id = esp.parametro_id
                                WHERE rtp.recepcion_tecnica_id = id_colada
                                        AND esp.agrupacion_calidad_id = v_grupo;
        ELSE
                                 SELECT sum(if(par.parametro = 'C', valor_decimal, 0)
                                        + v_f * if(par.parametro = 'Mn', valor_decimal/6, 0)
                                        + if(par.parametro = 'Si' , valor_decimal/24, 0)
                                        + if(par.parametro = 'Cu', valor_decimal / 24, 0 )
                                        + if(par.parametro = 'Ni', valor_decimal / 20, 0 )
                                        + if(par.parametro IN ('Cr', 'Mb', 'V', 'Nb') , valor_decimal, 0))
                                        INTO v_CeqforL
                                        FROM ordenes_de_produccion_estudios_partes rtp
                                LEFT JOIN ensayos_parametros par ON rtp.parametro_id = par.id
                                LEFT JOIN ensayos_rangos_quimicos esp ON par.id = esp.parametro_id
                                WHERE rtp.estudio_id = id_colada
                                        AND esp.agrupacion_calidad_id = v_grupo;
                                                 END IF;


                                IF v_CeqForL < 0.45 THEN
                                        SET  v_resultado = 'Carbono menor a 0.17 - CeqforL RANGO CORRECTO';
                                        SET v_resultado_id = 10;
                                ELSE
                                        SET v_resultado ='Carbono menor 0.17 - CeqforL SUPERA EL MAXIMO de 0.45%'  ;
                                        SET v_resultado_id = 1;
                                END IF;
                        END IF;
                        IF es_cintolo = 0 THEN
                                                                        INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                                VALUES (id_colada, 99, v_CeqForL, v_resultado, v_resultado_id);
                        ELSE
                                 INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                                VALUES (id_colada, 99, v_CeqForL, v_resultado, v_resultado_id);
                                                                END IF;
                END IF;
                IF v_grupo = 2 THEN
                        IF v_manganeso BETWEEN 1.06 AND 1.35 THEN
                                IF (v_carbono < 0.25 AND v_manganeso + (0.25 - v_carbono) * 0.06 < 1.35) THEN
                                        SET     v_resultado = 'Rango mayor de Manganeso permitido por reducción de carbono con respecto al máximo';
                                        SET v_resultado_id = 10;
                                END IF;

                                                                         IF es_cintolo = 0 THEN
                                                                                        INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                                        VALUES (id_colada, 97, ifnull(v_manganeso,0), v_resultado, v_resultado_id);
                              ELSE
                                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                                        VALUES (id_colada, 97, ifnull(v_manganeso,0), v_resultado, v_resultado_id);
                                        END IF;
                                                                END if;
                        IF ifnull(v_CeqForL,0) < 0.5 THEN
                                        SET  v_resultado = 'CeqforL RANGO CORRECTO';
                                        SET v_resultado_id = 10;
                                ELSE
                                        SET v_resultado ='CeqforL SUPERA EL MAXIMO de 0.5%'  ;
                                        SET v_resultado_id= 1;
                                END IF;

                        IF es_cintolo = 0 THEN
                                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado,resultado_id)
                                VALUES (id_colada, 98, ifnull(v_CeqForL,0), v_resultado, v_resultado_id);
                        ELSE
                                                                        INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado,resultado_id)
                                VALUES (id_colada, 98, ifnull(v_CeqForL,0), v_resultado, v_resultado_id);
                        END IF;
                        IF IFNULL(v_CUNICRMB,0) > 1 THEN
                                SET v_resultado = 'Cobre+Niquel+Cromo+Molibdeno SUPERA EL MAXIMO de 1%'  ;
                                SET v_resultado_id = 1;
                        ELSE
                                SET v_resultado = 'Cobre+Niquel+Cromo+Molibdeno RANGO CORRECTO'  ;
                                SET v_resultado_id = 10;
                        END if;
                IF es_cintolo = 0 THEN
                        INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 97, ifnull(v_CUNICRMB,0), v_resultado, v_resultado_id);
                ELSE
                        INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 97, ifnull(v_CUNICRMB,0), v_resultado, v_resultado_id);
                END IF;
        END IF;

        IF V_GRUPO = 10 THEN
                IF v_manganeso BETWEEN 1.06 AND 1.30 THEN
                        IF (v_carbono < 0.25 AND v_manganeso + (0.25 - v_carbono) * 0.06 < 1.30) THEN
                                SET     v_resultado = 'Rango mayor de Manganeso permitido por reducción de carbono con respecto al máximo';
                                SET v_resultado_id = 10;
                        END IF;

                        IF es_cintolo = 0 THEN
                                INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                                VALUES (id_colada, 1, ifnull(v_manganeso,0), v_resultado, v_resultado_id);
                        ELSE
                                INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                                VALUES (id_colada, 1, ifnull(v_manganeso,0), v_resultado, v_resultado_id);
                        END IF;

                END if;
                IF ifnull(v_CeqForL,0) < 0.43 THEN
                        SET  v_resultado = 'CeqforL RANGO CORRECTO';
                        SET v_resultado_id = 10;
                ELSE
                        SET v_resultado ='CeqforL SUPERA EL MAXIMO de 0.43%'  ;
                        SET v_resultado_id= 1;
                END IF;
                IF es_cintolo = 0 THEN
                        INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado,resultado_id)
                        VALUES (id_colada, 99, ifnull(v_CeqForL,0), v_resultado, v_resultado_id);
                ELSE
                        INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado,resultado_id)
                        VALUES (id_colada, 99, ifnull(v_CeqForL,0), v_resultado, v_resultado_id);
                END IF;
                IF IFNULL(v_CUNICRMB,0) > 1 THEN
                        SET v_resultado = 'Cobre+Niquel+Cromo+Molibdeno SUPERA EL MAXIMO de 1%'  ;
                        SET v_resultado_id = 1;
                ELSE
                        SET v_resultado = 'Cobre+Niquel+Cromo+Molibdeno RANGO CORRECTO'  ;
                        SET v_resultado_id = 10;
                END if;
                IF es_cintolo = 0 THEN
                        INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 97, ifnull(v_CUNICRMB,0), v_resultado, v_resultado_id);
                ELSE
                        INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 97, ifnull(v_CUNICRMB,0), v_resultado, v_resultado_id);
                END IF;

-- COBRE + MOLIBDENO  no exceder  0,32%
                IF IFNULL(v_CUMB,0) > 0.32 THEN
                        SET v_resultado = 'Cobre+Molibdeno SUPERA EL MAXIMO de 0.32%'  ;
                        SET v_resultado_id = 1;
                ELSE
                        SET v_resultado = 'Cobre+Molibdeno RANGO CORRECTO'  ;
                        SET v_resultado_id = 10;
                END if;
                IF es_cintolo = 0 THEN
                        INSERT INTO recepciones_tecnicas_resultados (recepcion_tecnica_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 96, ifnull(v_CUMB,0), v_resultado, v_resultado_id);
                ELSE
                        INSERT INTO ordenes_de_produccion_estudios_resultados (estudio_id, parametro_id, valor, resultado, resultado_id)
                        VALUES (id_colada, 96, ifnull(v_CUMB,0), v_resultado, v_resultado_id);
                END IF;
        END IF;
        IF v_grupo = 2 THEN
                SET v_resultado = analisis_mecanicos_grupo_2 (id_colada, es_cintolo);
        END if;
        IF v_grupo = 10 THEN
                SET v_resultado = analisis_mecanicos_grupo10 (id_colada, es_cintolo);
        END if;
        IF v_grupo BETWEEN 42 AND 70 THEN
                set v_resultado = Analisis_mecanicos_grupo42a70 (id_colada, es_cintolo, v_grupo) ;
        END IF;

        IF v_grupo = 4 THEN
                set v_resultado = Analisis_mecanico_grupo4 (id_colada, es_cintolo) ;
        END IF;
        IF v_grupo = 5 THEN
                set v_resultado = Analisis_mecanico_grupo5 (id_colada, es_cintolo) ;
        END IF;
        IF v_grupo = 6 THEN
                set v_resultado = Analisis_mecanicos_grupo6 (id_colada, es_cintolo) ;
        END IF;
        IF v_grupo IN (7, 8, 13) THEN
                set v_resultado = Analisis_mecanicos_grupo7_8_13 (id_colada, es_cintolo, v_grupo) ;
        END IF;
        IF v_grupo = 111 THEN
                set v_resultado = Analisis_mecanicos_grupo111 (es_cintolo) ;
        END IF;
        IF v_grupo IN ( 112,113) THEN
                set v_resultado = Analisis_mecanicos_grupo112y113 (es_cintolo) ;
        END IF;

        IF es_cintolo = 0 THEN
                SELECT JSON_ARRAYAGG(JSON_OBJECT('parametro_id', rts.parametro_id, 'parametro_descripcion', par.descripcion,  'resultado_id', resultado_id, 'resultado_descripcion', resultado))
                INTO json_resultado
                FROM recepciones_tecnicas_resultados rts
                LEFT JOIN ensayos_parametros par ON rts.parametro_id = par.id
                WHERE recepcion_tecnica_id = id_colada AND rts.alta_fecha_hora = (SELECT MAX(alta_fecha_hora)
                FROM recepciones_tecnicas_resultados rt2 WHERE recepcion_tecnica_id = rts.recepcion_tecnica_id);
        ELSE
                SELECT JSON_ARRAYAGG(JSON_OBJECT('parametro_id', rts.parametro_id, 'parametro_descripcion', par.descripcion,  'resultado_id', resultado_id, 'resultado_descripcion', resultado))
                INTO json_resultado
                FROM ordenes_de_produccion_estudios_resultados rts
                LEFT JOIN ensayos_parametros par ON rts.parametro_id = par.id
                WHERE estudio_id = id_colada AND rts.alta_fecha_hora = (SELECT MAX(alta_fecha_hora)
                FROM ordenes_de_produccion_estudios_resultados rt2 WHERE estudio_id = rts.estudio_id) ;
        END IF;

        RETURN json_resultado;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb3 */ ;
/*!50003 SET character_set_results = utf8mb3 */ ;
/*!50003 SET collation_connection  = utf8mb3_general_ci */ ;
DELIMITER ;;
CREATE DEFINER=`cintolo`@`localhost` FUNCTION `verificar_baja_de_maquina`(baja_fecha_hora DATETIME) RETURNS tinyint(1)
BEGIN
        DECLARE esta_activa VARCHAR(8);
        IF baja_fecha_hora IS NULL THEN
            SET esta_activa = TRUE;
        ELSE
            IF baja_fecha_hora > NOW() THEN
                SET esta_activa = TRUE;
            ELSE
                SET esta_activa = FALSE;
            END IF;
        END IF;
        RETURN esta_activa;
    END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2025-12-20  8:10:42
